# rms-service

Приложение на FastAPI для верхоуровнего управления роботами на складах Маркета.

## Перед запуском

Необходимо создать конфигурационный файл:
```
/etc/yandex/datasources/infor/rms_app.properties
```

Пример конфигурационного файла можно посмотреть в папке properties
```
/properties/rms_app.properties.example
```

Если хотите использовать локальную БД, запустите PostgreSQL, создайте базу данных с названием ```rms-service-db```
и укажите креды к ней в ```/etc/yandex/datasources/infor/rms_app.properties```

Чтобы в БД создались необходимые таблицы, необходимо выполнить в терминале
команду ```alembic upgrade head``` (команду необходимо выполнять в папке ```/lib```)

Если у вас не установлен alembic, поставьте его с помощью ```pip(pip3)```.

Эта команда смотрит на миграции в папке ```/lib/alembic/version``` и прогоняет их на вашу БД.

После того, как в БД появятся таблицы, можно собрать проект:
```ya make``` (выполнить в папке rms-service)

и запустить его:
```./run```

### Разработка
Свагер-дока по всем ручкам приложения доступна по адресу:
```127.0.0.1:8000/docs```

Если вы поменяли модель(-и), необходимо создать новую миграцию Alembic, чтобы она
акутализировала таблицу(-ы) в БД:
```alembic revision --autogenerate -m "НАЗВАНИЕ_МИГРАЦИИ"```

После этого надо опять сделать:
```alembic upgrade head```

### Tests
Запустить тесты:
```
ya make -rt
```

### Run
```
./run
```

### Deploy
1. ```ya package pkg.json```
2. ```ya upload --type={TASK_TYPE} {tar_gz_name}```
3. go to link from prev step, click "Task ID", click "Release"
