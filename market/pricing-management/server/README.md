## Начало работы с проектом
Для генерации проекта для Intellij IDEA выполните:

```
cd ~/arcadia/market/pricing-management/server
sh generate_project.sh -a ~/arcadia/ -i ~/arc_projects/
```

По умолчанию проект создается в директории ```~/arc_projects/pricing-mgmt```.

## Локальный запуск

Некоторые пункты необязательны, сервис запускается без их выполнения. Такие пункты помечены "(опционально)".

### Подготовка
#### Docker (Postgres)
Для работы сервиса требуется запустить Postgres в Docker.
Скрипты для управления контейнером:
* Создание и запуск контейнера (первое использование) ```server/dev_scripts/pg_local_up.sh```
* Остановка контейнера ```server/dev_scripts/pg_local_stop.sh```
* Запуск контейнера после остановки ```server/dev_scripts/pg_local_start.sh```
* Удаление контейнера ```server/dev_scripts/pg_local_rm.sh``` - контейнер будет остановлен, разделы (в том числе с БД) будут удалены

#### Интеграция с Promoboss
По умолчанию при локальном запуске сервис соединяется с локально запущенным Promoboss.
В случае необходимости соединения с Promoboss-testing нужно добавить в service.yaml
```
clients:
  list:
    promoservice:
      env:
        local:
          dstEnv: testing
```

После внесения изменений нужно перегенерировать проект.

#### Проброс фронта (опционально)
Устанавливаем в переменные окружения

AWS_ACCESS_KEY_ID

AWS_SECRET_ACCESS_KEY

значения из https://yav.yandex-team.ru/edit/secret/sec-01fne5sjrjtdjfnf1ndhvr9h0e/explore/versions

#### Запуск в Idea

Для локального запуска нужно в Idea использовать сгенерированную конфигурацию ```Run Service (generated)```.

#### Заполнение БД при локальном запуске

При локальном запуске происходит заполнение таблиц БД:
* msku
* категории
* вендоры
* склады
* родительские промо
* словарь продвижения
* роли / пользователи / маппинг ролей пользователей

Достигается это с помощью liquibase следующим образом.
* liquebase заполняет таблицы при наличии в БД таблицы ```public.table_flag_local_fill_database```
* таблица ```public.table_flag_local_fill_database``` создается при создании контейнера в Docker (см. выше)

### Загрузка данных из YT (опционально)
Проставляем себе переменную окружения `YQL_TOKEN`, в которую проставляем свой YQL_TOKEN.
Заходим на http://localhost:8080/tms-ui и запускаем все лоадеры для загрузки данных из YT


