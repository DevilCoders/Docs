# MARKET_CHEF

Бекенд, реализующий хранение пользовательских настроек чекаута их применение и бизнес логику их изменения

### Как запускать

Установить плагин аркадии для Idea: https://a.yandex-team.ru/arc/trunk/arcadia/devtools/intellij

Сгенерировать проект для Idea:

```
./generate_idea.sh -i your-path
```

Каталог создастся сам (должен быть вне аркадии, путь может быть любой)

После генерации нужно открыть этот каталог из Idea, в ней уже будут два конфига:
https://docs.yandex-team.ru/mj-framework/pages/how_it_works/project_structure#run-configurations

- Run Service (generated) - конфигурация для запуска сервиса
- Regenerate project (generated) - для перегенерации проекта

После редактирования ya.make или service.yaml нужно перегенерировать проект.
Часто идея не видит результат генерации и дополнительно требуется сбросить в ней кеш (invalidate caches)

### Структура проекта

- api - все внешнее апи(контроллеры и дто), что не поместилась в api.yaml о каким-то причинам
- config - все настройки
- domain - доменные модели. Вся бизнес логика тут
- proxy - все для походов в другие бекенды
- services - сервисы
- storage - все для сохранения в бд
- utils - разные мелкие, статические методы для удобства

### Конфигурационные файлы проекта

Общий конфигурационный файл лежит в src/main/properties.d/00_application.properties.
Там стоит хранить неконфиденциальные проперти которые имеют одинаковое значение для всех сред.

Конфигурационные файлы для разных сред лежат в:

- Прод - src/main/properties.d/production/application.properties
- Тест - src/main/properties.d/testing/application.properties
- Локал - src/main/properties.d/local/application.properties

Они имеют бОльший приоритет чем проперти в общем конфиге и перезатрут значение если такая же пропертя есть в общем файле

Чувствительные проперти (логины, пароли, креды, ключи и т.д.) надо хранить в секретнице:

- Прод - https://yav.yandex-team.ru/secret/sec-01g8zt64m58e1qj9fg315rjbk5
- Тест - https://yav.yandex-team.ru/secret/sec-01g8ztceqembkwhcps9v3fttw7

Эти проперти автоматически подтянутся в папку app/properties.d/ на соответствующие хосты.
Доступ к ним есть у всех в группе ABC bff_purchase

### Code style

- **О сервисах и классах**
  Приветствуются классы в которых помимо данных есть и поведение, то есть классы умеют со своими данными работать (
  дтошки не в счет).
  Максимум бизнес логики должно быть сосредоточенно в доменных классах. Бизнес логика в сервисах не приветствуется.
  Каждый класс должен заботится о своих инвариантах. Как минимум проверять что все не Nullable поля в нем заполнены
  после его создания.
- **О nullable**
  По умолчанию считаем что каждое поле и каждый аргумент и возвращаемое значение метода не могут принимать значение
  null.
  Поэтому в каждой новой директории обязательно должен находится package-info.java c аннотацией @NonNullApi, в domains
  еще и с @NonNullFields
  Если поле, метод или возвращаемое значение могут быть null - они должны быть помечены аннотацией @Nullable.
  При выполнении этого правила идея удобно подсвечивает каждый момент где может быть выброшено npe

