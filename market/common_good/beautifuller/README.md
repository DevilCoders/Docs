# Beatifuller

- алгоритм автоматического умного кропа картинок по дизайнерским гайдам

## Структура папок

- `categories` - файлы названы по `hid` категории, внутри - json-список моделей с фотками
- `in` - папка, в которую скачиваются все фото сгруппированные по `hid`
- `out` - результат всей магии по улучшению фото
- `resources` - все ML модели для улучшения фото. _#todo: загружать из сендбокса_
- `scripts` - индивидуальные скрипты запуска для каждой категории (для платьев одни параметры, для кроссовок другие)
- `sequence` - утилитарная папка, генерирует видео-запись процесса преобразования с фотки `sequence/in/example.jpeg`

## Структура файлов

- `download.py` - скрипт для скачивания фоток из Аватарницы
- `make_video.py` - скрипт для склеивания "срезов" в единое видео
- `mass_rename.py` - скрипт для отрезания хешей у результатов. В итоге можно получить файл с названием `<sku_id>.jpeg`.
  Удобно для использования в проде
- `main.py` - вся магия по кропу происходит здесь

## Getting started

```bash
pip install -r requirements.txt

DEMO=true make all
```

## Makefile

`make clear`/`make clear_sequence`

Чистим папки, в которых происходила магия, чтобы магия происходила и дальше

-----

`sequence`

Берёт фотку `sequence/in/example.jpeg`, обрабатывает умным кропом, делая снапшот на каждом шаге, после чего склеивает
всё в видео и экспортит в `sequence/out.mp4`.
Обработанное фото будет в `sequence/photos`.
Снапшоты обработки будут в `sequence/out`

-----

`make download`

Смотрит на все json-файлы в `categories/`, создаёт для каждого папку в `in/` и скачивает туда картинки
Можно запускать с `DEMO=true`, тогда скачает только первые 10 фоток в каждой категории

-----

`make beautify`

По очереди запускает каждый скрипт в `scripts/`.
Скрипты названы по `hid` категории и умно кропят каждую категорию из списка.

 **Note:** Так же, можно размечать конкретную категорию, например: `make 7815007.sh`

----

`make rename folder=<>`

Чистит названия внутри заданной папки, приводя файлы к виду `<sku_id>.jpeg`

----

`make all`

**Note:** Лучше запускать с `DEMO=true` т.к. там 14к фоток, которые будут скачиваться и обрабатываться ~4 часа

Скачивает и обрабатывает все изображения из всех заданных категориях.

----

## Как добавить свою категорию?

1. Подготовить JSON-файл со списком SKU/картинок
2. Положить его в `categoies/`
3. Написать кастомный скрипт запуска в `scripts/<hid>.sh`
4. Сделать `make download && make <hid>.sh`
5. ???
6. PROFIT
