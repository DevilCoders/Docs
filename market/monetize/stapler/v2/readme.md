# Stapler.v2

Вторая версия библиотеки Stapler. Так же на базе valhalla v2

## Предысторию можно почитать в первой версии
- https://a.yandex-team.ru/arc/trunk/arcadia/market/monetize/stapler

## Рабочий пример
- https://a.yandex-team.ru/arc/trunk/arcadia/market/replenishment/monitoring

## Изменения v2

### Изменения интерфейса класса Task (теперь TaskAbc)
В класс добавлены свойства для управления запрашиваемыми ресурсами операции в Nirvana.
В первой версии такая возможность была, но требовалось перед каждым вызовом в граф-генераторе указывать сколько памяти, ядер и дискового пространства требуется выделить.
По умолчанию запрашивали много ресурсов и можно было часто видеть предупреждения о недоутилизации ресурсов, что не есть хорошо.

В новой версии эти настройки перенесли в сам класс задачи, что значительно упрощает управление ресурсами.

Все потомки класса TaskAbc реализуют паттерн **singleton**

### Изменение интерфейса класса StaplerAbc
Добавился метод **execute** для исполнения классов Task. В том числе для исключения путаницы нейминга метода run в классе TaskAbc и StaplerAbc.

Теперь в качестве первого аргумента принимается не инстанс класса, а сам класс. Так же убраны параметры для управления ресурсами (перенесены в свойства класса TaskAbc).
Сигнатура метода значительно упростилась.

В версии 2 теперь запрещено переопределять конструктор классов тасок (фактически бесполезно т.к. нигде не используется)

### Граф-генератор + Калькулятор
Основной поинт написании второй версии был в объединении приложения граф-генератора и исполняемого приложения (калькулятора)

Добавлен класс `v2.cli.CliBuilder` позволяющий быстро и просто построить **CLI** приложения на основе реализованных классов ContextAbc, StaplerAbc, и классов с полезной нагрузкой реализующих интерфейс TaskAbc

