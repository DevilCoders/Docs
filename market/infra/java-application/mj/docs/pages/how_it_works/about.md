# Как это работает
Фреймворк состоит из **двух генераторов**, **модулей** кода и собственных **ya.make с зависимостиями**.
Работа всего этого в конкретном приложении конфигурируется через файл **service.yaml**.

{% note warning %}

Каждый раз, когда меняется `service.yaml`, `api.yaml` (у текущего сервиса или у сервиса, к которому генерируется клиент) или `ya.make`, необходимо производить перегенерацию проекта. Это нужно, чтобы эти изменения вступили в силу.
Перегенерировать можно с помощью соответствующей конфигурации запуска в idea, либо запустив скрипт `generate_project.sh`, который находится в корне сервиса.

В некоторых случаях (напр. добавление модуля, изменение зависимостей в ya.make) после перегенерации еще придется переоткрыть проект в idea, как после запуска ya ide idea.

**Важно**

Если меняется код бизнес логики, то можно пользоваться и обычным ya make или Regenerate and Reload: ya ide.
...но можно просто запускать не думая наш скрипт всегда :)

{% endnote %}

## Про генераторы
В MJ есть два генератора кода.
Один генерирует код в папку, которая создается во время сборки проекта (назовем эту папку **build root**).
Второй генерирует код **в исходники** (отключаемое поведение).

### Генератор Build Root
Этот генератор запускается средствами `ya make`, то есть всегда (при вызове `ya make`, при вызове `ya ide`, при нажатии кнопки "Regenerate and reload: ya ide"...). С помощью него генерируются **контроллеры** и **клиенты** на основе двух файлов:
- **[service.yaml](configuration/service_yaml.md)** - там указываются, к каким openapi спецификациям генерировать клиентов, настройки [tvm](../features/tvm.md).
- **[api.yaml](configuration/api_yaml.md)** (а точнее `src/main/resources/openapi/api/api.yaml`) - это openapi спецификация ручек текущего сервиса.

### Генератор в исходники и generate_project.sh
Этот генератор запускается руками разработчиков с помощью `generate_project.sh`, который лежит в корне каждого сервиса. Он может генерировать:
- **файлы с зависимостями** для подключаемхы модулей кода (указываются в [service.yaml](configuration/service_yaml.md))
- **заглушки кода**, например, для реализации ручек
- вызывает `ya ide idea` с нужными параметрами (параметры [можно донастроить](../features/generation_settings.md#Пользовательская-настройка-флагов-для-ya-ide-idea) в service.yaml)
- создает **Run configurations** для проекта в idea для локального запуска приложения и для запуска перегенерации проекта с помощью этого генератора
- подкладывает нужный **package.json** в зависимости от того, куда деплоится приложение (nanny или deploy)

Генератор можно запускать всегда, когда хочется сделать `ya ide`. Для этого можно использовать готовую run configuration в idea (она называется `Regenerate project (generated)`) или просто вызывать `generate_project.sh` через консоль.

Над интеграцией в плагин и в ya мы работаем [в этом тикете](https://st.yandex-team.ru/MARKETDX-281).


## Модули
Модули кода - это готовые библиотеки, которые уменьшают бойлерплейт код и включаются с помощью настроек в service.yaml.
