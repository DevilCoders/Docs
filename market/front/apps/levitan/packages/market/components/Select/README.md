# Компонент Select

Позволяет выбрать одно значение из выпадающего меню.

## Отличия от b2b-компонента

На 2022-06-14 отличий нет.

## Архитектура компонента

Компонент Select является композицией следующих компонентов:
1. Controller - компонент, в котором отображается выбранное пользователем значение и кнопка разворота выпадающего меню.
2. Popover - компонент всплывающего окна, в котором содержится элементы выпадающего меню
3. OptionsController - компонент, обеспечивающий возможность выбора элемента из выпадающего меню.

```jsx
<OptionsController>
    <Popover>
        <Controller />
    </Popover>
</OptionsController>
```

### Popover ###
Компонент Popover унаследован от Floater - универсального компонента, отображающего всплывающую панель в зависимости
от состояния другого компонента, называемого якорным (anchor) или целевым (target). Например, всплывающую панель можно
показать по клику, фокусу или наведению мышью на якорный элемент - см. triggers в core/components/Floater.

### Controller ###
Компонент Controller внутри Select является якорным элементом для Popover. В качестве триггера раскрытия
выпадающего меню внутри Popover по умолчанию выступает обработчик onClick у Controller. При выборе других триггеров
(фокус или ховер) на Controller навешиваются соответствующие обработчики. Также Popover подписывается на событие
onKeyDown

### OptionsController ###
Компонент OptionsController отвечает за выбор элемента из выпадающего меню. Именно он обрабатывает клики мышкой или 
нажатия на клавиши клавиатуры (стрелки вверх/вниз, Enter) и генерирует событие onSelect с параметрами
выбранного элемента.

**Отображение выпадающего меню**

Для отображения элементов выпадающего меню **в компонент Select необходимо передать проп children** со списком элементов
меню. Список может иметь произвольную верстку, однако для корректной работы механизма выбора у каждого выбираемого
DOM-узла элемента списка должны быть проставлены следующие атрибуты:
1. `role="option"` - Маркер узла элемента списка, элемент с именно таким атрибутом ищут обработчики клика и нажатия на
   клавишу клавиатуры. 
2. `data-value="<id>"` - Идентификатор выбранного элемента, попадает первым параметром в обработчик onSelect
3. *\[необязательно\]* `data-label="<label>"` - Текстовое представление выбранного элемента, попадает вторым параметром в
   обработчик onSelect
4. *\[необязательно\]* `role="group"` - Маркер узла группы выбираемых элементов (если нужна группировка).
   Узел группы не участвует в механизме выбора и игнорируется обработчиками и нужен для визуального оформления
   выпадаюшего меню.

Select проксирует children в OptionsController, внутри Options специальный класс OptionsManager добавляет обработчики:
1. клик по children - обработчик ищет у event.target вверх по иерархии DOM-узел с атрибутом `role="option"` и
   **генерирует событие onSelect со значениями атрибутов data-value и data-label** этого DOM-узла.
2. клик внутри document вне children - закрывает выпадающее меню
3. нажатие на клавишу клавиатуры внутри document - подсвечивает или выбирает элемент в раскрытом выпадающем меню.

Все обработчики событий срабатывают благодаря механизму всплытия.

OptionsManager внутри себя сохраняет идентификатор выбранного элемента (значение атрибута data-value) и при
следующем отображении выпадающего меню добавляет к DOM-узлу выбранного элемента атрибут `data-selected="true"`.

**Управление с клавиатуры**

Выбирать элементы меню можно не только мышью, но и с помощью клавиш клавиатуры - стрелки вверх/вниз подсвечивают
элемент, а по клавише Enter происходит выбор элемента через вызов метода click(). 

При подсветке элемента с помощью клавиш стрелок к его DOM-узлу добавляется атрибут `data-hovered="true"`.
**Эту особенность необходимо учитывать при написании стилей списка!**
