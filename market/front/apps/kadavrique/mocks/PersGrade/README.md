# PersGrade

## Ачивки

Ачивки функционируют на основе реализации трех ручек бэкенда.
1. Возвращает полный набор доступных ачивок в приложении (словарь ачивок).
2. Возвращает состояния ачивок для каждого конкретного юзера.
3. Возвращает изменение ачивок по айдишнику отзыва (зааффекченные).

Для работы ачивок достаточно мока для второй ручки бэкенда. Этот мок задаётся через стейт `schema.userAchievements`.
При этом для превой ручки создана дефолтная реализация, которая возвращает уже зафиксированный набор ачивок. Мокать его
отдельно нет особой необходимости. Если вдруг очень сильно хочется, то это можно сделать через установку стейта
`schema.achievements`. Если вам для тестов не хватает ачивок в словаре, то можно расширить словарь в файле
`acievementsDictionary`.
Третья ручка работает аналогично второй, только через стейт `schema.gradeAchievements`. Ключом в коллекции является айдишник отзыва.

Пример схемы `schema.userAchievements`:
```
{
	"userAchievements": {
		"100500": [{
			"achievementId": 0,
			"confirmedEventsCount": 10,
			"pendingEventsCount": 0
		}]
	}
}
```

Пример схемы `schema.gradeAchievements`:
```
{
	"gradeAchievements": {
		"500100": [{
			"achievementId": 0,
			"confirmedEventsCount": 9,
			"pendingEventsCount": 1
		}]
	}
}
```

## Модерации статей

Получаем статусы модерации статей пользователя.
Текущая реализация ничего не фильтрует, просто если в стейте лежат какие то статьи дополняет сущности по микроформату и возвращает результат.


## setGradeVote

### POST /api/grade/vote

Лайкает или дизлайкает отзыв.

Пример тела запроса:

```json
{
    "gradeId": 100500,
    "vote": 1
}
```

Если всё прошло успешно, в ответе будет значение `vote`, переданное в запросе.

```
1
```

## Сохранение отзыва на товар и магазин

### POST /api/grade/user/UID/<uid>/model/publish

Сохраняет отзыв на товар

Пример тела запроса:
```json
{
    "modelId": 13909442,
    "entity": "opinion",
    "comment": "Все ок",
    "pro": "хороший экран",
    "contra": "цена",
    "averageGrade": 5,
    "type": "1"
}
```

Если всё прошло успешно, в ответе будет отзыв, который был сохранен.

### POST /api/grade/user/UID/<uid>/shop/publish

Сохраняет отзыв на магазин

Пример тела запроса:
```json
{
    "entity": "opinion",
    "comment": "Хороший магазин",
    "delivery": "DELIVERY",
    "averageGrade": 5,
    "type": "0",
    "shop": {
        "entity": "shop",
        "id": 203084
    }
}
```

Если всё прошло успешно, в ответе будет отзыв, который был сохранен.

## Получение факторов по заданной категории товаров

### ### GET /api/grade/factor/category/<categoryId>

Отдаёт список факторов для сохранения пользователем во время создания отзывов.
