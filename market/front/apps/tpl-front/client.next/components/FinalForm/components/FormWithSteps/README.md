## Пошаговые формы (и не только)

Компоненты в текущей директории используются для создания пошаговых интерфейсов, либо для разбиения существующих форм на шаги с минимальным изменением написанного кода. При использовании с формами, разработанные компоненты рассчитаны на использование с React Final Form.

### Цель
- Для пользователей: улучшение UX при заполнении больших форм
- Для разработчиков: исключить повторную разработку типовой задачи

### Компоненты
- `FormSteps` — Оборачивает описание формы, которую надо разбить по шагам
- `Steps` — `FormSteps` является оберткой компонента `Steps`, отвечающего за механизм разбиения по шагам, но который ничего не знает о самих формах. То есть этот компонент, возможно, будет выделен в базовые компоненты.
- `Step` — Выделяет шаг
- `StepButton` — Кнопка перехода по шагам
- Компоненты отображения текущего состояния (визарды) — находятся в директории `Wizards`. Визарды, которые используются для компонента `FormSteps` могут использовать хук `useFormContext` для получения данных о текущем состоянии формы

### Пример преобразования формы в пошаговую
Допустим есть React Final-форма:
```tsx
<Form
    component={ExampleForm}
    validate={validateExampleForm}
    {...{initialValues, onSubmit, decorators}}
    mutators={{setFieldVisited}}
/>
```

И она описывается следующим видом:
```tsx
const ExampleForm = ({form, handleSubmit}: Props) => {

    return (
        <Column gap={5}>

            <Label text="Поле А">
                <Field
                    name="fieldA"
                    component={AField}
                />
            </Label>

            <Label text="Поле B">
                <Field
                    name="fieldB"
                    component={BField}
                />
            </Label>

            <Label text="Поле C">
                <Field
                    name="fieldC"
                    component={CField}
                />
            </Label>

            <Label text="Поле D">
                <Field
                    name="fieldD"
                    component={DField}
                />
            </Label>

            <Row inline>
                <Button variant="action" onClick={handleSubmit}>
                    Отправить
                </Button>
            </Row>
        </Column>
    );
};
```

И теперь хотим разделить ее на два шага. Это можно сделать следующим образом:
```tsx
const ExampleForm = ({form, handleSubmit}: Props) => {

    return (
        <FormSteps form={form} mutator={form?.mutators?.setFieldVisited} strict wizard={DefaultWizard}>
            <Step>
                <Column gap={5}>

                    <Label text="Поле А">
                        <Field
                            name="fieldA"
                            component={AField}
                        />
                    </Label>

                    <Label text="Поле B">
                        <Field
                            name="fieldB"
                            component={BField}
                        />
                    </Label>

                    <Row inline>
                        <StepButton to="next">Продолжить</StepButton>
                    </Row>
                </Column>
            </Step>

            <Step>
                <Column gap={5}>
                    <Label text="Поле C">
                        <Field
                            name="fieldC"
                            component={CField}
                        />
                    </Label>

                    <Label text="Поле D">
                        <Field
                            name="fieldD"
                            component={DField}
                        />
                    </Label>

                    <Row inline gap={4}>
                        <StepButton to="prev">Назад</StepButton>
                        <StepButton to="submit" onClick={handleSubmit}>
                            Отправить
                        </StepButton>
                    </Row>
                </Column>
            </Step>
        </FormSteps>
    );
};
```

### Описание компонента `FormSteps`
- Компонент `FormSteps` не имеет обязательных свойств и должен содержать в себе только компоненты `Step`
- Может содержать свойство `wizard`, в которое следует передать компонент для отображения текущего состояния формы. В директории `Wizards` находятся демонстранционные варианты таких компонентов и согласованные с дизайнерами варианты, которые следует предпочитать кастомным.
- Свойство `form` необходимо, если требуется в визарде отображать информацию о состоянии формы, а также если требуется _строгий_ режим работы
- Свойство `strict` отвечает за строгий/нестрогий режим работы. В строгом режиме переход к следующему шагу возможен только при корректном заполнении полей текущего шага
- Свойство `mutator` принимает в себя мутатор React Final-формы, который применяется к полям текущего шага при переходе к другому шагу. Например, для того, чтобы помечать такие поля как _посещенные_ с целью вывода для них результатов валидации

### Описание компонента `Steps`
- Компонент `Steps` не имеет обязательных свойств и должен содержать в себе только компоненты `Step`
- Может содержать свойство `wizard`, в которое следует передать компонент для отображения текущего состояния. В директории `Wizards` находятся демонстранционные варианты таких компонентов и согласованные с дизайнерами варианты, которые следует предпочитать кастомным.
- Свойство `onChange` может использоваться обертками над компонентом `Steps` для того, чтобы предотвратить/переопределить переход. В обработчике два аргумента: в первый будет передана информация о шагах, идентификаторе текущего шага, идентификаторе шага, на который должен произойти переход и информация, о посещенных шагах, во второй аргумент — функция обратного вызова, при вызове которой, будет осуществляться собственно переход.

### Описание компонента `Step`
- Основное назначение компонента — собственно разбиение формы по шагам
- Компонент `Step` имеет необязательное поле `stepId`, которое используется для обеспечения непоследовательного перехода по шагам (то есть когда кнопок перехода к следующему/предыдущему шагу недостаточно)

### Описание компонента `StepButton`
- Кнопка для перехода по шагам формы, которая имеет обязательное свойство `to` для задания типа перехода — вперед/назад/отправить форму/перейти к шагу с заданным `stepId`
- Кнопка является оберткой над компонентом `Button` и прокидывает все его свойства

### Компоненты `Wizard`
Данные компоненты пока не согласованы с дизайнерами и набор свойств, которые они должны поддерживать может изменяться. Пока выглядит так, что им требуются следующие данные:
- `stepsInfo` — структура, из которой можно понять какие значения формы к какому шагу относятся
- `activeStepIndex` — индекс текущего шага
- `visitedSteps` — идентификаторы шагов, которые были пройдены пользователем
- `onChangeStep` — обработчик для перехода по шагам
- если в визарде необходимо получить информацию о текущем состоянии формы, то можно воспользоваться хуком `useFormContext`

### Почему есть индекс шага, а есть идентификатор шага
С индексом происходит работа, когда происходит перебор шагов такими методами как `map`. Но шаги, теоретически, могут проходить через условный рендеринг и это будет приводить например к тому, что мы пометили третий шаг как пройденный, но из-за условного рендеринга он стал не третьм, а вторым или четвертым. Поэтому надежно такую информацию можно закреплять только за идентификаторами.

Идентификтором шага при отсутствии свойства `stepId` является его индекс приведенный к строке.