# Деградирующие флаги

## Зачем?

Админка конфигов еще далеко, но мы хотим иметь возможность для маневра в период повышенной нагрузки.
Больше мотивации [тут](https://st.yandex-team.ru/MARKETFRONTECH-3274)

## Как?

На `s3` заведен файл JSON, в котором прописаны возможности для отключения
- Каждый флаг строго булевый
- По умолчанию каждый флаг `false`
- `false` является поведением по умолчанию для каждого резолвера. Т.е. если в коде запрошено значение
  флага, а в JSON его нет, вернется `false`
- Флаги _асинхронно_ кешируются в памяти инстанса, и достаются _синхронно_ также из кеша
  - Т.е. после обновления конфига в s3 пройдет некоторое время, пока он раскатится по процессам
  - Доступ к флагу в коде осуществляется синхронно

## Пример конфига

```json
{
  "__notice": [
    "Любое изменение в этом файле должно согласовываться с @grumpy или @johnvee",
    "Все флаги в этом файле, строго булевые и отключающие. Попытка сделать иначе приведет к страшным последствиям"
  ],
  "flags": [
    {
      "id": "disableCartPage",
      "value": false,
      "__notice": "[Desktop][Touch] Отключает корзину и отдает 429 код вместо нее"
    }
  ]
}
```

## Как обновить конфиг?

Смотри в [readme.md](../readme.md) выше по файловой структуре
