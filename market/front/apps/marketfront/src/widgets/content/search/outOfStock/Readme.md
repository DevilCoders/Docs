# Не в продаже

## Архитектура: как это работает

В основе этой фичи лежит несколько виджетов. Все они связаны друг с другом. Выдачу показывает виджет Serp.

### Структура
```
- Index
  - Content (lazy, bare)
    - Serp
```

### Для человека
- На сервере отрабатывает виджет `Index`. Его можно встроить в CMS-разметку как обычный виджет выдачи, передать ему пропсы виджет враппера.
- Виджет `Index` формирует айдишник основной выдачи. После старта интерактивности начинает слушать VSR.
- Как только начинает соблюдаться условие показа выдачи "Не в продаже", виджет `Index` встраивает виджет `Content`.
Это ленивый виджет. Его задачи:
  - Показывать слот с выдачей.
  - Ходить за второй выдачей в репорт.
  - Отрисовывать вьюху (тайтл, дескрипшн).
- Виджет `Index` слушает VSR, проверяет условие показа. Если оно сработало, маунтит ленивый виджет `Content`.
- Так как виджет `Index` ничего не знает про вторую выдачу, он не может решить, стоит ли выдачи синхронизировать. Этим занимается эпик виджета `Content`.

### Для роботов

- На сервере отрабатывает виджет `Index`.
- Виджет `Index` подключает слот виджета `Content` нелениво.
- Если либо условия показа нет, или выдача "Не в продаже" пуста, выдача не рисуется.
