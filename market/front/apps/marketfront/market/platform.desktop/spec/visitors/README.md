## Visitors для карточки модели.

Тут собраны visitors (посетители) для сграбливания данных с карточки модели и ее частей с помощью [data-grabber](https://github.yandex-team.ru/market/data-grabber).

Пример карточки модели: https://market.yandex.ru/product--smartfon-samsung-galaxy-a50-64gb/394273081

### Как добавить новый визитор

data-grabber импортирует файлы из этой папки как модули JS.
Ожидается, что по умолчанию модуль будет экспортировать структуру со следующим набором полей:

```js
module.exports = {
    yqlQueryJson: "{action:'RUN',type:'CLICKHOUSE',content:'...'}",
    visitor: async function f({selector1, selector2}) {
        // Код этой функции будет исполняться в браузере (на клиенте)
    },
    visitorArgs: { // Этот объект будет передан как аргумент для функции на клиенте. Объект должен быть сериализуем.
        selector1: sel1,
        selector2: sel2,
    },
}
```

или

```js
module.exports = {
    yqlQueryJson: "{action:'RUN',type:'CLICKHOUSE',content:'...'}",
    visitor: async function f(selector1, selector2) {
        // Код этой функции будет исполняться в браузере (на клиенте)
    },
    visitorArgs: [ // Эти аргументы в таком же порядке будут переданы функции на клиенте
        sel1,
        sel2,
    ],
}
```

`yqlQueryJson` - это сериализованный объект с полями `action`, `type`, `content`. В `content` - скрипт для YQL, который вытащит топ-1000 урлов для этого визитора. 

#### ОБРАТИ ВНИМАНИЕ!

Экспортируемая функция будет выполняться в браузере, без окружения. Практически `eval(visitor.toString())` в консоли браузера. Она не будет ничего знать про окружение проекта.

Если в неё надо что-то передать, то это что-то должно быть сериализуемо и передавать его надо в аргументах функции
Например, так надо передавать селекторы PageObject-ов. 

----

В качестве результаты работы визитора ожидается объект или массив объектов.
Любой ответ будет преобразован в json и записан в результат работы data-grabber.
Но есть несколько объектов, которые мы умеем парсить из итогового JSON:

#### 1. Объект с ошибкой
```js
return {
    error: 'Не получилось найти ДО на странице' 
}
```
#### 2. Объект - результат
```js
return {
    selector: '[data-tid="1234asd"]',
    innerText: 'Абв абв\nабв абв\nабвАбавваыаы авыа',
    sizes: {
        x: 1286.078125,
        y: 369,
        width: 352.921875,
        height: 372,
        top: 369,
        right: 1639,
        bottom: 741,
        left: 1286.078125
    }
}
```

#### 3. Массив объектов-результатов
```js
return [
    {
        selector: '[data-tid="1234asd"]:nth-child(1)',
        innerText: 'Абв абв\nабв абв\nабвАбавваыаы авыа',
        sizes: {
            x: 1286.078125,
            y: 369,
            width: 352.921875,
            height: 372,
            top: 369,
            right: 1639,
            bottom: 741,
            left: 1286.078125
        }
    },
    {
        selector: '[data-tid="1234asd"]:nth-child(2)',
        innerText: 'Абв абв\nабв абв\nабвАбавваыаы авыа',
        sizes: {
            x: 1286.078125,
            y: 369,
            width: 352.921875,
            height: 372,
            top: 369,
            right: 1639,
            bottom: 741,
            left: 1286.078125
        }
    }
]
```
 

После того, как визитор написан, его алиас нужно добавить алиас для пути до файла от корня проекта в конфиги `configs/data-grabber.js`.
Например:
```
    ...
    externalVisitors: {
        ...
        'km-awesome': 'spec/visitors/km/awesome-visitor.js'
    }
    ...
```

Data-grabber будет пытаться резолвить файлы от рабочей директории. Конфиги сейчас написаны для запуска из платформенных папок.

### Как использовать

Опция для использования при cli-вызове data-grabber:

`--config=configs/data-grabber.js --visitor="km-awesome"`

TODO: wiki link
