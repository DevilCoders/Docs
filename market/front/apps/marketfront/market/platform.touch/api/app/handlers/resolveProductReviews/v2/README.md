# Резолвер resolveProductReviews

## Описание

Резолвер, способный вернуть отзывы на продукт вместе с пользователями, которые их оставили.
Умеет сортировать и фильтровать выдачу отзывов. Единственный обязательный параметр - `productId`.

_Сущность user была переименована в publicUser. Для обеспечения обратной совместимости отправляются 2 коллекции - в старом и новом формате. В новом коде предпочтительно использовать новое имя сущности и коллекции, т.е publicUser. По возможности в старом коде также желательно выполнить миграцию._

Ссылочки:

- [Входные параметры](https://github.yandex-team.ru/market/marketfront/blob/master/market/platform.touch/entities/review/helperTypes.js#L11-L38)
- [Микроформат сущности](https://github.yandex-team.ru/market/microformats/blob/master/modelOpinion/modelOpinion.json)
- [Описание сущности `отзыв` в проекте](https://github.yandex-team.ru/market/marketfront/blob/master/market/src/entities/review/index.js)

**WARNING**: микроформат устаревший и может не соответствовать действительности.

FAQ:

> На фронте есть значок "проверенный покупатель". Где он тут?

Это поле `cpa`. Говорит о том, что пользователь покупал когда-то этот товар на маркете через CPA.

> На фронте есть время использования. А в данных где?

Это числовое поле `usage`. Мы его интерпретируем вот [так](https://github.yandex-team.ru/market/marketfront/blob/master/market/platform.touch/app/node_modules/dictionary.js#L110-L118).

> Почему фильтр по оценкам принимает -2 от 2, а не от 0 до 5? И возвращает такие же значения.

Так сложилось исторически. Когда-то на Маркете оценки выставляли и отображали именно так.
Поэтому к оценкам нужно делать +3, если нужна шкала [0, 5];

> Я хочу получить отзывы для модели `1234`. На маркете отзывы есть, а фапи ничего не возвращает. Что делать?

Возможно, это просто групповая модель.

Особенность в том, что можно оставить отзыв на каждую из модификаций отдельно,
но при просмотре на фронте нужно отображать вообще все отзывы.
Поэтому отзывы для одной из модификаций нужно запрашивать не по её `productId`, а с `parentId`, который есть у этой модели.

Для этого мы подложили соломку в виде параметра `performProductTypeCheck`. Его нужно включить, если клиент не знает
(и не может узнать) тип модели. Тогда резолвер сходит и получит модель самостоятельно.
