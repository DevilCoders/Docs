# Преобразователи виджетов

## Преобразование для сохранения на сервере

### Алгоритм

-   Строим два дерева. Одно содержит старое состояние и второе - итоговое (отправим на сервер);
    Вначале они ни чем не отличаются;
    Первое дерево нам нужно, чтобы доставать от туда виджет в виде дерева (со всеми его потомками);
    Второе дерево нам нужно, чтобы по списку моделей с фронта, составлять новое состояние sins'a;
    По сути два дерева нам нужно только для того, чтобы не делать операцию удаления,
    тк при переносе из моделей в итоговое дерево не попадут модельки которые не пришли с фронта (то есть были удалены);
-   Чистим из итогового дерева все виджеты
-   Идем по моделям которые пришли с фронта
    Если виджет не новый (присутствует в старом состоянии) - обновляем поля у существующего виджета в соответствии с его типом (./encode-handlers)
    Иначе - создаем дерево виджета из соответствующего шаблона (./widgets-templates)
-   Если есть идентификатор мобильного виджета - повторяем предыдущий пункт
-   Приводим дерево в плоский вид

### Tips and tricks

## Преобразование для использования на фронте

### Алгоритм

-   Строим словарь с виджетами
-   Строим дерево
-   Достаем из дерева вхождение которое содержит ссылки на корневые элементы виджетов (WIDGETS).
-   Достаем из дерева все виджеты
-   Далее идем по всем виджетам и преобразуем их с помощью соответствующего обработчика

### Tips and tricks

## Обработчики моделей

Обработчики находятся в папке widget-handlers

-   widget-handlers
    -   base
        -   Handler - содержит базовый класс для обработчиков
    -   <тип виджета>
        -   templates - тут храним шаблоны
            -   <шаблоны виджета>
        -   <обработчик>

Для удобства был создан базовый класс BaseWidgetHandler, который можно расширить и переопределить необходимые вам методы (getEncodedTemplate, updateEncodedNode, decode)<br/>
Или же написать обработчик который реализует интерфейс WidgetHandler
