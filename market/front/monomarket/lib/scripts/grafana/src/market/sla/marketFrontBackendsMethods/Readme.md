# Как автоматически считается SLA бэкендов?

* Изначально нам известен полный список бэкендов, наших сервисов (приложений) и список SLA-страниц, на которых тайминги этих бэкендов играют роль в нашей агрегированной метрике.
* Получаем список с именами актуальных ручек, эти данные есть в `market_front_trace` в Clickhouse.
* Для каждой из ручек по формуле и уже существующим данным в графите рассчитываем значения SLO по каждой из необходимых метрик. Формулы можно редактировать в файле [./slo-calc.ts](./slo-calc.ts).
* Полученные данные фильтруем, заранее договорившись, что ручки с низким RPS (до определенного порога) нас не интересуют.
* Сохраняем полученные данные в [конфиг](../../../../generated/sla/market-front-backends-methods-sla.json). Это JSON, и его можно редактировать руками.

## Структура конфига

Конфиг сохраняет данные по каждой из метрик, при этом хранит предыдущую версию. Это нужно для того, чтобы уже по существующему конфигу можно было по кнопке построить таблицу изменений.

### Какие бывают значения?

Если у [RequestMethodConfig](./config-types.ts):
* есть поля `current` и `previous`, то будем считать, что значения SLO были пересчитаны и изменились;
* нет поля `current`, но есть `previous`, то будем считать, что эта ручка была отфильтрована в ходе последних изменений (либо ее просто не оказалось в трассировке);
* нет поля `previous`, но есть `current`, то будем считать, что эта ручка появилась в ходе последних изменений.

#### Аномалии

Если у [RequestMethodConfig](./config-types.ts) нет обеих полей, или значения внутри равны нулям — это свидетельство аномалии и некорректной работы скрипта.
