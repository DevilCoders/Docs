# rum/timemark/market_front_unified_blue_timemark
    
## Common properties

  * **Owner:** `marketfrontend`
  * **Table:** `timemark`

## Splits

```json
{
    "service_blue": "multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' )",
    "pageId": "arrayJoin(['any-page', replaceAll(page, ':', '_')])",
    "buckets_start": "if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time)))",
    "buckets_end": "if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time)))",
    "buckets_duration": "if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time)))",
    "buckets_init": "if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time)))",
    "buckets_dcl": "if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time)))",
    "buckets_ready": "if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time)))",
    "buckets_long-task-all": "if(roundToExp2(long_task_all) > 32000, 'more_32000', toString(roundToExp2(long_task_all)))",
    "buckets_long-task-self": "if(roundToExp2(long_task_self) > 32000, 'more_32000', toString(roundToExp2(long_task_self)))",
    "buckets_long-task-unknown": "if(roundToExp2(long_task_unknown) > 32000, 'more_32000', toString(roundToExp2(long_task_unknown)))",
    "buckets_fp": "if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time)))",
    "buckets_fcp": "if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time)))",
    "buckets_lcp": "if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time)))",
    "buckets_llep": "if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time)))",
    "expFlags": "replaceAll(arrayJoin(exp_flgs), '=', '_'))",
    "region": "replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_')",
    "browser": "concat(browser_name, '-', browser_version_major)",
    "requester": "arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ])",
    "testId": "arrayJoin(test_ids)"
}
```

## Filters

```json
[
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.start'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.end'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.duration'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.start'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.end'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.duration'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'js_framework_inited'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'load'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-paint'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-contentful-paint'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-contentful-paint'",
    "environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-loading-elem-paint'",
    "environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start'",
    "environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end'",
    "environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration'",
    "environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start'",
    "environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end'",
    "environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration'",
    "environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'js_framework_inited'",
    "environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'load'",
    "environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti'",
    "environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-paint'",
    "environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint'",
    "environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-contentful-paint'",
    "environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint'",
    "environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start'",
    "environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end'",
    "environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration'",
    "environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start'",
    "environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end'",
    "environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration'",
    "environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'js_framework_inited'",
    "environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'load'",
    "environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti'",
    "environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-paint'",
    "environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint'",
    "environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-contentful-paint'",
    "environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint'"
]
```

## Resulting metrics

  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.tti.duration.buckets.${buckets_duration}`](#7c428743a5c25aab18ca0badddd1f278)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.tti.duration.quantiles`](#7ee672cea76b43b45607c5ac4c726dfb)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.tti.end.buckets.${buckets_end}`](#cbbcc1c0e11817a8e95072fcd1ebf66c)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.tti.end.quantiles`](#1536b3f6fca949f05618fe966e9bfe28)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.tti.start.buckets.${buckets_start}`](#08c08f46ab95317b3aebcf9090a5ce8c)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.tti.start.quantiles`](#d2d32aa6504e774b135a7621438038db)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.ttr.duration.buckets.${buckets_duration}`](#b1646ded33496cfda4c151b6c814b4bf)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.ttr.duration.quantiles`](#f7442394b8e6bcc94b5e8f558cde95f3)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.ttr.end.buckets.${buckets_end}`](#947820bb294946446c453b4a651bb2a1)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.ttr.end.quantiles`](#58a36fa50bbc25af059f5c2d6aa105dc)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.ttr.start.buckets.${buckets_start}`](#53f3e851d4590180c4cc85e1e951e972)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.ttr.start.quantiles`](#c2a4d2e0bb36cd627615966f03fd8a47)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.dcl.buckets.${buckets_dcl}`](#8c2cb5d94aba9bfde1ac0f33d86f9a66)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.dcl.quantiles`](#86681f4e4291e4b6eafbac45b4ed8fb5)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.init.buckets.${buckets_init}`](#d8b20e3d49873734f0353185f7d36cb7)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.init.quantiles`](#e699174d24b37b948dfd32a56244c674)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.fcp.buckets.${buckets_fcp}`](#530e868695263c255282e50c7f6e5f72)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.fcp.quantiles`](#a1ac49275087cd57382c6dbb6912cd8d)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.fp.buckets.${buckets_fp}`](#36061a198d6e239bc894d7843b163995)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.fp.quantiles`](#8b85b3f3fc8bcaf5d3c1026db949619d)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.lcp.buckets.${buckets_lcp}`](#f264257d641ea78dc3d0b2e12e2cc10f)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.lcp.quantiles`](#5c5285f0115103576d82b0095c9a7070)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.llep.buckets.${buckets_llep}`](#9d899df5b7c083bf572a1730048f1af5)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.llep.quantiles`](#317dcd08fefb372fd7dad6e3e4e56a7f)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.long-task-all.buckets.${buckets_long-task-all}`](#2f4858fc5908980700f74e1406559ab7)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.long-task-all.quantiles`](#43c1f4f2e1b1f76cb1a4b2376d462957)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.long-task-self.buckets.${buckets_long-task-self}`](#db34aa78c46c414f13e207a29be05c06)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.long-task-self.quantiles`](#2f251c5f3554d9c2cfb4367b4eda552f)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.long-task-unknown.buckets.${buckets_long-task-unknown}`](#af48ed6b515c40795c41cd4e873dd0ef)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles`](#21d04e8692b9b6bb9e7777847930532d)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.ready.buckets.${buckets_ready}`](#6c851b3f6838d15d6417622c4a2fd4c4)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.ready.quantiles`](#c793106182bbc399a2c826eca02e335c)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.firstScreen.metrics.tti.duration.quantiles`](#252db006d09b11050891c8a4b92ac509)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.firstScreen.metrics.tti.end.quantiles`](#962367dbd6da66e46ddb4f4bd69b9a8f)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.firstScreen.metrics.tti.start.quantiles`](#2e9821c2866bd746757c539c02d24fb7)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.firstScreen.metrics.ttr.duration.quantiles`](#71ebffb431e4a793a13e82309ecffa87)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.firstScreen.metrics.ttr.end.quantiles`](#992771ad1f68a86e8ff2fd11f2ca2e0c)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.firstScreen.metrics.ttr.start.quantiles`](#25c18a10406852d973716c9d6447abcf)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.dcl.quantiles`](#9de09e437c6fc119904a35dfe5d138ac)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.init.quantiles`](#ec4f1562e578d754583ff28dbb70a41e)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.paint.fcp.quantiles`](#7f37b00b7c389dece22091455e889c1d)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.paint.fp.quantiles`](#4171b56ae09823420de00f1d59b5487d)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.paint.lcp.quantiles`](#fa86ca1bb41bfd77ed9a46bca81e444a)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.paint.llep.quantiles`](#c1305df3e5ee1c4d98fbd8cb58c2b122)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.tti.long-task-all.quantiles`](#5ab05186bd1fc8b2eec45691d5fcdbb0)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.tti.long-task-self.quantiles`](#f015979811798dda515cff446271050d)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles`](#ef90fd0bebc25cec9c55a2eea0152858)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.tti.ready.quantiles`](#b01dea449750f02573173ac49a79a1ff)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.firstScreen.metrics.tti.duration.quantiles`](#3d9d7d0167c3899c1dcb6a8d35ba6454)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.firstScreen.metrics.tti.end.quantiles`](#9157dd495a74df2bc9b6143e3aa15bd3)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.firstScreen.metrics.tti.start.quantiles`](#6ca9c05a73efcdd68277c06dc20be198)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.firstScreen.metrics.ttr.duration.quantiles`](#54b69ad609ba2b7ca816cdbb52123552)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.firstScreen.metrics.ttr.end.quantiles`](#30d607f5e3bed16cb849403a7da84f49)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.firstScreen.metrics.ttr.start.quantiles`](#ed822e3b6e94bc28e8cd8c389396383c)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.dcl.quantiles`](#9b0787ca315b9bdf4f3e5931a64fb234)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.init.quantiles`](#aa88885880ff742cc32144657af4abce)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.paint.fcp.quantiles`](#08724c607c4ee0bdc260ccb5ec01087b)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.paint.fp.quantiles`](#ddba093c2685f2e5f6cf5f58abb48905)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.paint.lcp.quantiles`](#044fd8fdcd84089fad2a85a279edd2fd)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.paint.llep.quantiles`](#2f211301f425300cf5ca71a0e6db0ab0)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.tti.long-task-all.quantiles`](#4e9dce3da795f86568ac6a6549c08959)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.tti.long-task-self.quantiles`](#7d11654808afd60a805c92a067d0e825)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles`](#40fe1778b6dfac4efa42f191bfd647df)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.tti.ready.quantiles`](#46420a9c7044a128bc9ea76ea96f81be)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.tti.duration.buckets.${buckets_duration}`](#5945f5c7801fb77c4500127c5317c564)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.tti.duration.quantiles`](#9a245f3729a28b939c18fe4add7543f8)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.tti.end.buckets.${buckets_end}`](#c43b9541aa30b23c8acaee4ac5bbc113)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.tti.end.quantiles`](#5491ea6925d10f54afe7ce8ce64d66a0)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.tti.start.buckets.${buckets_start}`](#11fd55def897ccf3b4eb93c206a1d69e)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.tti.start.quantiles`](#a904e19bc5bb5a0177a8f921d19bfbab)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.ttr.duration.buckets.${buckets_duration}`](#67f5af4441de3d7bb7251f07bf69d662)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.ttr.duration.quantiles`](#cdf90c2ad176d0559cc9d5da8bd5659b)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.ttr.end.buckets.${buckets_end}`](#88156368e05e4cbf902d129ddc1dac75)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.ttr.end.quantiles`](#6cd9a777c41355132045a34d72478af2)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.ttr.start.buckets.${buckets_start}`](#0d787e49b819ebf21fc0c40d903ad7d5)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.ttr.start.quantiles`](#781cf74184b419421c291d70cb5d341b)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.dcl.buckets.${buckets_dcl}`](#48f1a9e6148d5d3e76154252d8f5b8d9)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.dcl.quantiles`](#e2771eed8f013727a0392caf52a47d1f)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.init.buckets.${buckets_init}`](#edac997409e1da406785aa7b1d2575cc)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.init.quantiles`](#855fec58164beb4b737c681d5ecdd626)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.fcp.buckets.${buckets_fcp}`](#ca10e12860e35e2104cd1ed77f905510)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.fcp.quantiles`](#077811f90eac3448c771f392e9e66aed)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.fp.buckets.${buckets_fp}`](#336a488560981335346cad59f5f956b0)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.fp.quantiles`](#c7207257cf5106ca134f41694e20d4d5)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.lcp.buckets.${buckets_lcp}`](#04af62756864ec14c1bc1c7b498e8519)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.lcp.quantiles`](#c42ce6d02b76f17d2957669b45494adf)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.llep.buckets.${buckets_llep}`](#2d5e88b394a630b43b7a42674101903c)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.llep.quantiles`](#ce81a726713ffa63449d9fa7b9e4a44e)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.long-task-all.buckets.${buckets_long-task-all}`](#f983d7d60f813670b648704e9f3ad17a)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.long-task-all.quantiles`](#da471c0c489028429128e16650c29df0)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.long-task-self.buckets.${buckets_long-task-self}`](#9420ae3e7414f7786a0b1bee76fb0ed9)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.long-task-self.quantiles`](#69e977e68a0a6510a11f27cb2b420c02)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.long-task-unknown.buckets.${buckets_long-task-unknown}`](#c0ff7e275e6f120eadb7bdb3f9277f4f)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles`](#97cd9025840f664b5686c1f012d8b991)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.ready.buckets.${buckets_ready}`](#f6b69283b7e9fccae128fbf7c844e628)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.ready.quantiles`](#92695dafcda6fe2ecbb33046f4656aa4)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.tti.duration.buckets.${buckets_duration}`](#2623a8ce5d07d4508b54c93412f7d483)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.tti.duration.quantiles`](#a119b1d9113a4a6c8b6397dd454341da)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.tti.end.buckets.${buckets_end}`](#f54c373ab00def6f6170b9dae763f41a)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.tti.end.quantiles`](#68eeaf4e5ca9638d7d0eb582443848c3)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.tti.start.buckets.${buckets_start}`](#72ae350e5128bbf11edadb391427c4d0)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.tti.start.quantiles`](#1e82283d1013603dd9df17403b427197)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.ttr.duration.buckets.${buckets_duration}`](#49b6b248ba6a5f6849e88fee10edc8e7)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.ttr.duration.quantiles`](#a7d2160537505ad52c6590b5fa189cca)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.ttr.end.buckets.${buckets_end}`](#fb3b827f82c2b807b77c99d1411a150a)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.ttr.end.quantiles`](#fedd033defb641e3f8bc04549458fbf8)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.ttr.start.buckets.${buckets_start}`](#b05b851103154eca7f2cd13162d9d850)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.ttr.start.quantiles`](#983273f585b57f46ed2fe887db06bd45)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.dcl.buckets.${buckets_dcl}`](#ffc576faf8b62fec6564ac45b2054c49)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.dcl.quantiles`](#985a02126de49fd76348cd865cb76609)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.init.buckets.${buckets_init}`](#c246d9e8091cb09c6ba8d726083da5a6)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.init.quantiles`](#3d51f908b6477937c91020bbe34efefe)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.fcp.buckets.${buckets_fcp}`](#aa9a5208e833f1bb7fbb4c9ed8b7be00)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.fcp.quantiles`](#6c0305101afb6e7fa7571ee907766fbb)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.fp.buckets.${buckets_fp}`](#7c6639754352e60790f46e70dc0b0b0a)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.fp.quantiles`](#750bba1f42f2c6d1a5272864d1eb255a)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.lcp.buckets.${buckets_lcp}`](#ef31c122e412b815b6ee8e511c26502b)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.lcp.quantiles`](#cacaa7a266b8f1958d4207cbf39a5433)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.llep.buckets.${buckets_llep}`](#c35b32e79a6c6720f883e3d060de9cc0)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.llep.quantiles`](#287e19d145c9826290ddca5583a41b72)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.long-task-all.buckets.${buckets_long-task-all}`](#7670a02ff53ab7f476b468784223dc8a)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.long-task-all.quantiles`](#7119b57d15e23571297d73cd2a4f1fac)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.long-task-self.buckets.${buckets_long-task-self}`](#aa9d356acf804ea6d43c1756cad533d0)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.long-task-self.quantiles`](#5ddff44d8b5bbd9a35262fa61edb2415)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.long-task-unknown.buckets.${buckets_long-task-unknown}`](#83d7c67c67ea28797971770c996b9f50)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles`](#5d44853fdc7993216b767fe3098a66a7)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.ready.buckets.${buckets_ready}`](#f1553c671bd06b6b6d92a1502661bab0)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.ready.quantiles`](#f2825e416749df6855bdc7ef55fccacc)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.tti.duration.buckets.${buckets_duration}`](#47c4cf6416e6a7145e4add057045e761)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.tti.duration.quantiles`](#725146703b444466a2c397feafb214f6)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.tti.end.buckets.${buckets_end}`](#a4802a42d02141ae493752ed8ded44ad)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.tti.end.quantiles`](#6a3a5e8d3d675d422826c880176dfb16)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.tti.start.buckets.${buckets_start}`](#8cce18057a9e955cadc0766118f1a5f9)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.tti.start.quantiles`](#7d19afda861cc66424cf59e526aa1544)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.ttr.duration.buckets.${buckets_duration}`](#ae89b20946617dc867d1572b4c10591d)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.ttr.duration.quantiles`](#a3aaeb7867a063cfe984fb7a2f2d5f2f)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.ttr.end.buckets.${buckets_end}`](#08e6cbf29f8bf52cc316a8c60221a281)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.ttr.end.quantiles`](#9028fb7db65f63dfdbeb154789722809)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.ttr.start.buckets.${buckets_start}`](#8f879bdc9f745aa4b8424a02e73c73a7)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.ttr.start.quantiles`](#0a7d9a6e07100ab61a463982e81235ac)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.dcl.buckets.${buckets_dcl}`](#f2ed954ddc5bad6c9e476b85063ad1b4)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.dcl.quantiles`](#b75597b4084b45a55536120806f426ae)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.init.buckets.${buckets_init}`](#3a3517940970a423d9d2a902a3294adf)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.init.quantiles`](#9cb1ee62aba577c4b662d010e842639e)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.fcp.buckets.${buckets_fcp}`](#ee8ac3db71523d06b8c0c31a86dae921)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.fcp.quantiles`](#684da835ba0f4c379e6b8967a59ec356)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.fp.buckets.${buckets_fp}`](#fc3893a2a2802ff8c94ca45075f38c05)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.fp.quantiles`](#0f7d40eeb14bfaf75b39152f56ac1acd)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.lcp.buckets.${buckets_lcp}`](#36e94177065c349b3cab7050407d1d23)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.lcp.quantiles`](#945f2a2d64deb76eaec32eda6bf24b4b)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.llep.buckets.${buckets_llep}`](#1c6cd43732a9b526bbe68412f2591279)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.llep.quantiles`](#fa7f02b411d3e5408ef3104410189d03)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.long-task-all.buckets.${buckets_long-task-all}`](#1bb40da714e8701514deda5b85d32605)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.long-task-all.quantiles`](#3afc9557246000e82cd2a19c18c69a40)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.long-task-self.buckets.${buckets_long-task-self}`](#10219649b6f6c785f9dad86fb91d1922)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.long-task-self.quantiles`](#f4aea31c651a2123e05bf106483ff9b5)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.long-task-unknown.buckets.${buckets_long-task-unknown}`](#2cc338948231ba840c841a0763fd8a09)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles`](#fd96c7cdb3c46d0bc2e487cadb410651)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.ready.buckets.${buckets_ready}`](#a7a7c572633c514f010e55ceb07412bf)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.ready.quantiles`](#002b3ceb71e6a592b98fc428fb647f2a)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.tti.duration.buckets.${buckets_duration}`](#16136f6678c41533da899dce05465cb2)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.tti.duration.quantiles`](#60c8262e79a1a86b113e1c5daff7b75c)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.tti.end.buckets.${buckets_end}`](#41a749529cc5ee536363fcb74f36abb4)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.tti.end.quantiles`](#9e904b686e8131522577ecd538ea7108)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.tti.start.buckets.${buckets_start}`](#87f0344939280df127296264f4e586a8)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.tti.start.quantiles`](#3800d42cf0d4717a4279d3d9772ba89d)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.ttr.duration.buckets.${buckets_duration}`](#44912098e4a4fc41a3a1633e23ea6d76)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.ttr.duration.quantiles`](#1e36a9ea19df6469c790f99f9cdbadf3)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.ttr.end.buckets.${buckets_end}`](#8dc2df00ddb88f601ea9d4a8f0546e9a)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.ttr.end.quantiles`](#052bea937f39f7b16daf8ea056e488cb)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.ttr.start.buckets.${buckets_start}`](#6e199040edc2442c589b83cf95999fd6)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.ttr.start.quantiles`](#dfe01da7acc445f87a1340f671f175b0)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.dcl.buckets.${buckets_dcl}`](#a27a8e94c6e6f5aada466aebb768f0ce)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.dcl.quantiles`](#eb556af5e9e4722ebf4a8a56f0cfa80a)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.init.buckets.${buckets_init}`](#7b9d73b4f29f3cbad3e8c72f642e93bf)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.init.quantiles`](#67688c7f0ee7a37757d11b0f173c19b3)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.fcp.buckets.${buckets_fcp}`](#c9ac2d03e2d1c110d8ae19077e61f1c5)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.fcp.quantiles`](#56e4fae90ae9ab810dc8790b484bddf7)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.fp.buckets.${buckets_fp}`](#a1e07d1319604a1bf9c3961cf29a4e2f)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.fp.quantiles`](#17d9e0fd018d0e27216c49570b76d886)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.lcp.buckets.${buckets_lcp}`](#bba035c63bc48a222a3e95a62034f0e0)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.lcp.quantiles`](#3ddaa2173e10a461ccdceadaecf50e03)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.llep.buckets.${buckets_llep}`](#e90077419330a05c73a0bc203e5634b0)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.llep.quantiles`](#5af19e36219e2983832d2c924f726101)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.long-task-all.buckets.${buckets_long-task-all}`](#874b2ae4ecefe8077a0a1387ec84bfa3)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.long-task-all.quantiles`](#58e6913e05571df983a67b6838d41e1a)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.long-task-self.buckets.${buckets_long-task-self}`](#f9a367d1f1af65863f761d55b3fa80dd)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.long-task-self.quantiles`](#a3749a1b90861d6f45d16f0729a995d7)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.long-task-unknown.buckets.${buckets_long-task-unknown}`](#6db6477738e2231adf4977f4bb08828d)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.long-task-unknown.quantiles`](#4168b75efe7718071d7746c5bc255b8e)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.ready.buckets.${buckets_ready}`](#4fb212bbd2cdb1ae49836742b0ca3aaa)
  * [`market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.ready.quantiles`](#6d6981be81eefaee7a0389a263037f08)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.tti.duration.quantiles`](#3e3ef1fa04c2d2854ca744a24e6532a7)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.tti.end.quantiles`](#a4d3c5e3be3edafe630bb498b50ae1c5)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.tti.start.quantiles`](#ab91e983cb391e562be8ee96f96f389d)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.ttr.duration.quantiles`](#67626475a4294b449a17d31adc4c34ee)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.ttr.end.quantiles`](#8dd16b26bdd1e3f7af15836774ba2ec4)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.ttr.start.quantiles`](#a5e1a79977a9119669c7ea3a5b57e3e0)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.dcl.quantiles`](#652ef0246b96e85af4a08de97b8c1fef)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.init.quantiles`](#4f879f28f645d0d32d521a10ec3b19a9)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.fcp.quantiles`](#029afe941d1652a45e54dcc5e4268aa7)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.fp.quantiles`](#2285c344feeb8ead8b20e1e4aff2cdb7)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.lcp.quantiles`](#a71dc76ebe145ad5399019ee13ec64c0)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.llep.quantiles`](#717bcec3b65ea1b75cff30cc037ccb0f)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.long-task-all.quantiles`](#9d1104701e01d24c57f2c82049c52d2f)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.long-task-self.quantiles`](#560b462e6a135a9e9735531596681bee)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles`](#77a6ad19911f23df01d0539ced12c945)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.ready.quantiles`](#44069098d1dfeec2bb465a03d6ae6ff2)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.firstScreen.metrics.tti.duration.quantiles`](#b669744a12ba477c9fbe4125e696d02c)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.firstScreen.metrics.tti.end.quantiles`](#e332682f7f4f2384c5b9d889e5b1795f)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.firstScreen.metrics.tti.start.quantiles`](#c24d0f955f28a6a88243f98d83ad6de6)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.firstScreen.metrics.ttr.duration.quantiles`](#d3aa04d5301a7603444eeeb01ab91ab5)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.firstScreen.metrics.ttr.end.quantiles`](#9ae3d1c3dfd9ded7d43c3c045f4cde36)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.firstScreen.metrics.ttr.start.quantiles`](#1f1e18f0ddc4df33a611c6684f42eca8)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.dcl.quantiles`](#0bc3fe7f1413e8aeb2b373decc64c647)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.init.quantiles`](#260ff922b1317e6861d69893ee523270)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.paint.fcp.quantiles`](#acd55ba16e63efe2ff6498cbae88baf1)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.paint.fp.quantiles`](#2b27bcce06d0449e16e119ac175fd3b9)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.paint.lcp.quantiles`](#c058ac27ff8ded2ccdd5997499e2d8a2)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.paint.llep.quantiles`](#a5e3c595e2db414af8e5fa93b7e7d194)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.tti.long-task-all.quantiles`](#e4de888028d9428e1a3f4b14226e86ca)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.tti.long-task-self.quantiles`](#5de2eb12e83fdac0b6e795b3691355af)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles`](#da9a866af1aaa0d7ef9fa206616f4541)
  * [`market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.tti.ready.quantiles`](#b686a315bd83ad66b44024120299de16)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.tti.duration.quantiles`](#9535b986fc063068241741aaa36b4312)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.tti.end.quantiles`](#7c521cff599070df9c489997371ded90)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.tti.start.quantiles`](#6e3ec1a7ab31a5be42127c4a849006f5)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.ttr.duration.quantiles`](#28ac9be54d52c4ee106489857d339e38)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.ttr.end.quantiles`](#9a739be8682c51d48928cfa52db76696)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.ttr.start.quantiles`](#acfd87e80447fe3e1347e3ffb05efe2a)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.dcl.quantiles`](#47204fb69ea3584a2d4ed28080776906)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.init.quantiles`](#946503e91dec4fe44022455fb4d4f325)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.fcp.quantiles`](#aebc7c0049ab664442b6dd7922ad5b6e)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.fp.quantiles`](#8520269a8d29bbc50acc76c6498bd585)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.lcp.quantiles`](#e9319f1b3fe15a569063fa52f77dd010)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.llep.quantiles`](#168b856f5aa1ecca45662d0da5d4b6c4)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.long-task-all.quantiles`](#4882c0691f29afe8fc0d2d245aab4c9c)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.long-task-self.quantiles`](#a58f6c49667d968248b7b3d24094b44f)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles`](#9b66d2eaa27450e4c449d384374786e9)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.ready.quantiles`](#7f99763ddf884d7f3bf431b7dec3f3c5)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.firstScreen.metrics.tti.duration.quantiles`](#698afa0f2df395d1eddabdc655c4df17)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.firstScreen.metrics.tti.end.quantiles`](#a715dcfe7db2421ce7203a7fad98973c)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.firstScreen.metrics.tti.start.quantiles`](#bbf18149139a47e183f0a6493ee68201)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.firstScreen.metrics.ttr.duration.quantiles`](#0601ffac88bf9e8c5296e0d7c1463e1c)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.firstScreen.metrics.ttr.end.quantiles`](#8ea7def67fe610f9d0e50933b286624c)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.firstScreen.metrics.ttr.start.quantiles`](#d82aa248347b95ef159c4cea82b3b9c9)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.dcl.quantiles`](#29de4f679bccb00aadfb8e473da2ae8e)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.init.quantiles`](#0813b220fd5ed49c9d0c193311def995)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.paint.fcp.quantiles`](#ada6eb100a156cfd107dea438650bb56)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.paint.fp.quantiles`](#8ea81db9839ec1528f3e032d2e09c61a)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.paint.lcp.quantiles`](#369d01550161d6db16eedf5c9aed7b6c)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.paint.llep.quantiles`](#d05958c253482d5c153e94e237b26ce0)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.tti.long-task-all.quantiles`](#ab10d08a965fe333162f4c8212006269)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.tti.long-task-self.quantiles`](#db08317b8b58f01c6163b04c61dd553f)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles`](#573604ea89fcd230b252af650b6e6dcc)
  * [`market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.tti.ready.quantiles`](#2f4fe31a0157771ead1059f16e7815b6)

## Metrics

#### <a id='dfe01da7acc445f87a1340f671f175b0'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.ttr.start.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') as value_0,
    service_blue,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.firstScreen.metrics.ttr.start.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.ttr.start.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') as value_0,
        service_blue,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='781cf74184b419421c291d70cb5d341b'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.ttr.start.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') as value_0,
    service_blue,
    region,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.start.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.ttr.start.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') as value_0,
        service_blue,
        region,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='c2a4d2e0bb36cd627615966f03fd8a47'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.ttr.start.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') as value_0,
    service_blue,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.start.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.ttr.start.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') as value_0,
        service_blue,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='0a7d9a6e07100ab61a463982e81235ac'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.ttr.start.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') as value_0,
    service_blue,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.start.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.ttr.start.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') as value_0,
        service_blue,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='983273f585b57f46ed2fe887db06bd45'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.ttr.start.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') as value_0,
    service_blue,
    requester,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.start.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.ttr.start.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') as value_0,
        service_blue,
        requester,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='052bea937f39f7b16daf8ea056e488cb'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.ttr.end.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') as value_0,
    service_blue,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.firstScreen.metrics.ttr.end.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.ttr.end.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') as value_0,
        service_blue,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='6cd9a777c41355132045a34d72478af2'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.ttr.end.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') as value_0,
    service_blue,
    region,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.end.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.ttr.end.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') as value_0,
        service_blue,
        region,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='58a36fa50bbc25af059f5c2d6aa105dc'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.ttr.end.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') as value_0,
    service_blue,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.end.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.ttr.end.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') as value_0,
        service_blue,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='9028fb7db65f63dfdbeb154789722809'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.ttr.end.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') as value_0,
    service_blue,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.end.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.ttr.end.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') as value_0,
        service_blue,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='fedd033defb641e3f8bc04549458fbf8'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.ttr.end.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') as value_0,
    service_blue,
    requester,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.end.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.ttr.end.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') as value_0,
        service_blue,
        requester,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='1e36a9ea19df6469c790f99f9cdbadf3'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.ttr.duration.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') as value_0,
    service_blue,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.firstScreen.metrics.ttr.duration.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.ttr.duration.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') as value_0,
        service_blue,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='cdf90c2ad176d0559cc9d5da8bd5659b'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.ttr.duration.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') as value_0,
    service_blue,
    region,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.duration.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.ttr.duration.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') as value_0,
        service_blue,
        region,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='f7442394b8e6bcc94b5e8f558cde95f3'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.ttr.duration.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') as value_0,
    service_blue,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.duration.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.ttr.duration.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') as value_0,
        service_blue,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='a3aaeb7867a063cfe984fb7a2f2d5f2f'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.ttr.duration.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') as value_0,
    service_blue,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.duration.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.ttr.duration.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') as value_0,
        service_blue,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='a7d2160537505ad52c6590b5fa189cca'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.ttr.duration.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') as value_0,
    service_blue,
    requester,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.duration.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.ttr.duration.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') as value_0,
        service_blue,
        requester,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='3800d42cf0d4717a4279d3d9772ba89d'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.tti.start.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') as value_0,
    service_blue,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.firstScreen.metrics.tti.start.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.tti.start.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') as value_0,
        service_blue,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='a904e19bc5bb5a0177a8f921d19bfbab'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.tti.start.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') as value_0,
    service_blue,
    region,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.firstScreen.metrics.tti.start.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.tti.start.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') as value_0,
        service_blue,
        region,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='d2d32aa6504e774b135a7621438038db'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.tti.start.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') as value_0,
    service_blue,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.firstScreen.metrics.tti.start.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.tti.start.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') as value_0,
        service_blue,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='7d19afda861cc66424cf59e526aa1544'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.tti.start.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') as value_0,
    service_blue,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.tti.start.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.tti.start.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') as value_0,
        service_blue,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='1e82283d1013603dd9df17403b427197'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.tti.start.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') as value_0,
    service_blue,
    requester,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.firstScreen.metrics.tti.start.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.tti.start.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') as value_0,
        service_blue,
        requester,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='9e904b686e8131522577ecd538ea7108'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.tti.end.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') as value_0,
    service_blue,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.firstScreen.metrics.tti.end.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.tti.end.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') as value_0,
        service_blue,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='5491ea6925d10f54afe7ce8ce64d66a0'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.tti.end.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') as value_0,
    service_blue,
    region,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.firstScreen.metrics.tti.end.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.tti.end.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') as value_0,
        service_blue,
        region,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='1536b3f6fca949f05618fe966e9bfe28'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.tti.end.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') as value_0,
    service_blue,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.firstScreen.metrics.tti.end.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.tti.end.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') as value_0,
        service_blue,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='6a3a5e8d3d675d422826c880176dfb16'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.tti.end.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') as value_0,
    service_blue,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.tti.end.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.tti.end.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') as value_0,
        service_blue,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='68eeaf4e5ca9638d7d0eb582443848c3'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.tti.end.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') as value_0,
    service_blue,
    requester,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.firstScreen.metrics.tti.end.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.tti.end.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') as value_0,
        service_blue,
        requester,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='60c8262e79a1a86b113e1c5daff7b75c'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.tti.duration.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') as value_0,
    service_blue,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.firstScreen.metrics.tti.duration.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.tti.duration.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') as value_0,
        service_blue,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='9a245f3729a28b939c18fe4add7543f8'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.tti.duration.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') as value_0,
    service_blue,
    region,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.firstScreen.metrics.tti.duration.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.tti.duration.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') as value_0,
        service_blue,
        region,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='7ee672cea76b43b45607c5ac4c726dfb'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.tti.duration.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') as value_0,
    service_blue,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.firstScreen.metrics.tti.duration.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.tti.duration.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') as value_0,
        service_blue,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='725146703b444466a2c397feafb214f6'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.tti.duration.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') as value_0,
    service_blue,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.tti.duration.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.tti.duration.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') as value_0,
        service_blue,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='a119b1d9113a4a6c8b6397dd454341da'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.tti.duration.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') as value_0,
    service_blue,
    requester,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.firstScreen.metrics.tti.duration.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.tti.duration.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') as value_0,
        service_blue,
        requester,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='67688c7f0ee7a37757d11b0f173c19b3'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.init.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') as value_0,
    service_blue,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.standard.metrics.init.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.init.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') as value_0,
        service_blue,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='855fec58164beb4b737c681d5ecdd626'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.init.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') as value_0,
    service_blue,
    region,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.standard.metrics.init.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.init.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') as value_0,
        service_blue,
        region,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='e699174d24b37b948dfd32a56244c674'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.init.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') as value_0,
    service_blue,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.init.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.init.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') as value_0,
        service_blue,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='9cb1ee62aba577c4b662d010e842639e'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.init.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') as value_0,
    service_blue,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.init.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.init.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') as value_0,
        service_blue,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='3d51f908b6477937c91020bbe34efefe'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.init.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') as value_0,
    service_blue,
    requester,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.init.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.init.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') as value_0,
        service_blue,
        requester,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='eb556af5e9e4722ebf4a8a56f0cfa80a'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.dcl.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') as value_0,
    service_blue,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.standard.metrics.dcl.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.dcl.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') as value_0,
        service_blue,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='e2771eed8f013727a0392caf52a47d1f'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.dcl.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') as value_0,
    service_blue,
    region,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.standard.metrics.dcl.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.dcl.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') as value_0,
        service_blue,
        region,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='86681f4e4291e4b6eafbac45b4ed8fb5'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.dcl.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') as value_0,
    service_blue,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.dcl.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.dcl.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') as value_0,
        service_blue,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='b75597b4084b45a55536120806f426ae'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.dcl.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') as value_0,
    service_blue,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.dcl.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.dcl.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') as value_0,
        service_blue,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='985a02126de49fd76348cd865cb76609'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.dcl.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') as value_0,
    service_blue,
    requester,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.dcl.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.dcl.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') as value_0,
        service_blue,
        requester,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='6d6981be81eefaee7a0389a263037f08'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.ready.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
    service_blue,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.standard.metrics.tti.ready.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.ready.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
        service_blue,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='92695dafcda6fe2ecbb33046f4656aa4'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.ready.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
    service_blue,
    region,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.standard.metrics.tti.ready.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.ready.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
        service_blue,
        region,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='c793106182bbc399a2c826eca02e335c'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.ready.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
    service_blue,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.tti.ready.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.ready.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
        service_blue,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='002b3ceb71e6a592b98fc428fb647f2a'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.ready.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
    service_blue,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.tti.ready.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.ready.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
        service_blue,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='f2825e416749df6855bdc7ef55fccacc'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.ready.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
    service_blue,
    requester,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.tti.ready.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.ready.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
        service_blue,
        requester,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='17d9e0fd018d0e27216c49570b76d886'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.fp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') as value_0,
    service_blue,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.standard.metrics.paint.fp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.fp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') as value_0,
        service_blue,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='c7207257cf5106ca134f41694e20d4d5'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.fp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') as value_0,
    service_blue,
    region,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.standard.metrics.paint.fp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.fp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') as value_0,
        service_blue,
        region,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='8b85b3f3fc8bcaf5d3c1026db949619d'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.fp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') as value_0,
    service_blue,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.paint.fp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.fp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') as value_0,
        service_blue,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='0f7d40eeb14bfaf75b39152f56ac1acd'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.fp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') as value_0,
    service_blue,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.paint.fp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.fp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') as value_0,
        service_blue,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='750bba1f42f2c6d1a5272864d1eb255a'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.fp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') as value_0,
    service_blue,
    requester,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.paint.fp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.fp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') as value_0,
        service_blue,
        requester,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='56e4fae90ae9ab810dc8790b484bddf7'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.fcp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') as value_0,
    service_blue,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.standard.metrics.paint.fcp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.fcp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') as value_0,
        service_blue,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='077811f90eac3448c771f392e9e66aed'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.fcp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') as value_0,
    service_blue,
    region,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.standard.metrics.paint.fcp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.fcp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') as value_0,
        service_blue,
        region,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='a1ac49275087cd57382c6dbb6912cd8d'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.fcp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') as value_0,
    service_blue,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.paint.fcp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.fcp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') as value_0,
        service_blue,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='684da835ba0f4c379e6b8967a59ec356'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.fcp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') as value_0,
    service_blue,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.paint.fcp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.fcp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') as value_0,
        service_blue,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='6c0305101afb6e7fa7571ee907766fbb'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.fcp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') as value_0,
    service_blue,
    requester,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.paint.fcp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.fcp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') as value_0,
        service_blue,
        requester,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='3ddaa2173e10a461ccdceadaecf50e03'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.lcp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') as value_0,
    service_blue,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.standard.metrics.paint.lcp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.lcp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') as value_0,
        service_blue,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='c42ce6d02b76f17d2957669b45494adf'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.lcp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') as value_0,
    service_blue,
    region,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.standard.metrics.paint.lcp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.lcp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') as value_0,
        service_blue,
        region,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='5c5285f0115103576d82b0095c9a7070'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.lcp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') as value_0,
    service_blue,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.paint.lcp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.lcp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') as value_0,
        service_blue,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='945f2a2d64deb76eaec32eda6bf24b4b'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.lcp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') as value_0,
    service_blue,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.paint.lcp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.lcp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') as value_0,
        service_blue,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='cacaa7a266b8f1958d4207cbf39a5433'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.lcp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') as value_0,
    service_blue,
    requester,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.paint.lcp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.lcp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') as value_0,
        service_blue,
        requester,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='5af19e36219e2983832d2c924f726101'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.llep.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') as value_0,
    service_blue,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.standard.metrics.paint.llep.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.llep.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') as value_0,
        service_blue,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='ce81a726713ffa63449d9fa7b9e4a44e'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.llep.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') as value_0,
    service_blue,
    region,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.standard.metrics.paint.llep.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.llep.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') as value_0,
        service_blue,
        region,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='317dcd08fefb372fd7dad6e3e4e56a7f'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.llep.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') as value_0,
    service_blue,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.paint.llep.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.llep.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') as value_0,
        service_blue,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='fa7f02b411d3e5408ef3104410189d03'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.llep.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') as value_0,
    service_blue,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.paint.llep.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.llep.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') as value_0,
        service_blue,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='287e19d145c9826290ddca5583a41b72'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.llep.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') as value_0,
    service_blue,
    requester,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.paint.llep.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.llep.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') as value_0,
        service_blue,
        requester,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='ed822e3b6e94bc28e8cd8c389396383c'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.firstScreen.metrics.ttr.start.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.ttr.start')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.start') as value_0,
    service_blue,
    expFlags,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.start')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.splits.%24%7BexpFlags%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.start.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.ttr.start')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.firstScreen.metrics.ttr.start.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.start') as value_0,
        service_blue,
        expFlags,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.start')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='25c18a10406852d973716c9d6447abcf'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.firstScreen.metrics.ttr.start.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.ttr.start')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.start') as value_0,
    service_blue,
    expFlags,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.start')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.requester.splits.%24%7BexpFlags%7D.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.start.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.ttr.start')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.firstScreen.metrics.ttr.start.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.start') as value_0,
        service_blue,
        expFlags,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.start')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='30d607f5e3bed16cb849403a7da84f49'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.firstScreen.metrics.ttr.end.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.ttr.end')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.end') as value_0,
    service_blue,
    expFlags,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.end')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.splits.%24%7BexpFlags%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.end.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.ttr.end')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.firstScreen.metrics.ttr.end.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.end') as value_0,
        service_blue,
        expFlags,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.end')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='992771ad1f68a86e8ff2fd11f2ca2e0c'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.firstScreen.metrics.ttr.end.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.ttr.end')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.end') as value_0,
    service_blue,
    expFlags,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.end')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.requester.splits.%24%7BexpFlags%7D.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.end.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.ttr.end')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.firstScreen.metrics.ttr.end.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.end') as value_0,
        service_blue,
        expFlags,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.end')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='54b69ad609ba2b7ca816cdbb52123552'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.firstScreen.metrics.ttr.duration.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.duration') as value_0,
    service_blue,
    expFlags,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.duration')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.splits.%24%7BexpFlags%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.duration.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.firstScreen.metrics.ttr.duration.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.duration') as value_0,
        service_blue,
        expFlags,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.duration')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='71ebffb431e4a793a13e82309ecffa87'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.firstScreen.metrics.ttr.duration.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.duration') as value_0,
    service_blue,
    expFlags,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.duration')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.requester.splits.%24%7BexpFlags%7D.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.duration.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.firstScreen.metrics.ttr.duration.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.duration') as value_0,
        service_blue,
        expFlags,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.duration')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='6ca9c05a73efcdd68277c06dc20be198'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.firstScreen.metrics.tti.start.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.tti.start')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.start') as value_0,
    service_blue,
    expFlags,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.start')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.splits.%24%7BexpFlags%7D.%24%7BpageId%7D.firstScreen.metrics.tti.start.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.tti.start')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.firstScreen.metrics.tti.start.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.start') as value_0,
        service_blue,
        expFlags,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.start')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='2e9821c2866bd746757c539c02d24fb7'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.firstScreen.metrics.tti.start.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.tti.start')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.start') as value_0,
    service_blue,
    expFlags,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.start')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.requester.splits.%24%7BexpFlags%7D.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.tti.start.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.tti.start')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.firstScreen.metrics.tti.start.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.start') as value_0,
        service_blue,
        expFlags,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.start')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='9157dd495a74df2bc9b6143e3aa15bd3'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.firstScreen.metrics.tti.end.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.tti.end')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.end') as value_0,
    service_blue,
    expFlags,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.end')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.splits.%24%7BexpFlags%7D.%24%7BpageId%7D.firstScreen.metrics.tti.end.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.tti.end')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.firstScreen.metrics.tti.end.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.end') as value_0,
        service_blue,
        expFlags,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.end')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='962367dbd6da66e46ddb4f4bd69b9a8f'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.firstScreen.metrics.tti.end.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.tti.end')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.end') as value_0,
    service_blue,
    expFlags,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.end')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.requester.splits.%24%7BexpFlags%7D.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.tti.end.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.tti.end')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.firstScreen.metrics.tti.end.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.end') as value_0,
        service_blue,
        expFlags,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.end')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='3d9d7d0167c3899c1dcb6a8d35ba6454'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.firstScreen.metrics.tti.duration.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.tti.duration')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.duration') as value_0,
    service_blue,
    expFlags,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.duration')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.splits.%24%7BexpFlags%7D.%24%7BpageId%7D.firstScreen.metrics.tti.duration.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.tti.duration')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.firstScreen.metrics.tti.duration.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.duration') as value_0,
        service_blue,
        expFlags,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.duration')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='252db006d09b11050891c8a4b92ac509'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.firstScreen.metrics.tti.duration.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.tti.duration')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.duration') as value_0,
    service_blue,
    expFlags,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.duration')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.requester.splits.%24%7BexpFlags%7D.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.tti.duration.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.tti.duration')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.firstScreen.metrics.tti.duration.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.duration') as value_0,
        service_blue,
        expFlags,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.duration')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='aa88885880ff742cc32144657af4abce'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.init.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'js_framework_inited')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'js_framework_inited')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'js_framework_inited') as value_0,
    service_blue,
    expFlags,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'js_framework_inited')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.splits.%24%7BexpFlags%7D.%24%7BpageId%7D.standard.metrics.init.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'js_framework_inited')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'js_framework_inited')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.init.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'js_framework_inited') as value_0,
        service_blue,
        expFlags,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'js_framework_inited')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='ec4f1562e578d754583ff28dbb70a41e'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.init.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'js_framework_inited')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'js_framework_inited')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'js_framework_inited') as value_0,
    service_blue,
    expFlags,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'js_framework_inited')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.requester.splits.%24%7BexpFlags%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.init.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'js_framework_inited')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'js_framework_inited')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.init.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'js_framework_inited') as value_0,
        service_blue,
        expFlags,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'js_framework_inited')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='9b0787ca315b9bdf4f3e5931a64fb234'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.dcl.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'load')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'load')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'load') as value_0,
    service_blue,
    expFlags,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'load')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.splits.%24%7BexpFlags%7D.%24%7BpageId%7D.standard.metrics.dcl.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'load')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'load')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.dcl.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'load') as value_0,
        service_blue,
        expFlags,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'load')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='9de09e437c6fc119904a35dfe5d138ac'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.dcl.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'load')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'load')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'load') as value_0,
    service_blue,
    expFlags,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'load')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.requester.splits.%24%7BexpFlags%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.dcl.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'load')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'load')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.dcl.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'load') as value_0,
        service_blue,
        expFlags,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'load')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='46420a9c7044a128bc9ea76ea96f81be'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.tti.ready.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') as value_0,
    service_blue,
    expFlags,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.splits.%24%7BexpFlags%7D.%24%7BpageId%7D.standard.metrics.tti.ready.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.tti.ready.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') as value_0,
        service_blue,
        expFlags,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='b01dea449750f02573173ac49a79a1ff'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.tti.ready.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') as value_0,
    service_blue,
    expFlags,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.requester.splits.%24%7BexpFlags%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.tti.ready.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.tti.ready.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') as value_0,
        service_blue,
        expFlags,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='ddba093c2685f2e5f6cf5f58abb48905'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.paint.fp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'paint.first-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'paint.first-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-paint') as value_0,
    service_blue,
    expFlags,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.splits.%24%7BexpFlags%7D.%24%7BpageId%7D.standard.metrics.paint.fp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'paint.first-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'paint.first-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.paint.fp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-paint') as value_0,
        service_blue,
        expFlags,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='4171b56ae09823420de00f1d59b5487d'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.paint.fp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'paint.first-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'paint.first-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-paint') as value_0,
    service_blue,
    expFlags,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.requester.splits.%24%7BexpFlags%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.paint.fp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'paint.first-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'paint.first-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.paint.fp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-paint') as value_0,
        service_blue,
        expFlags,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='08724c607c4ee0bdc260ccb5ec01087b'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.paint.fcp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'paint.first-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-contentful-paint') as value_0,
    service_blue,
    expFlags,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-contentful-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.splits.%24%7BexpFlags%7D.%24%7BpageId%7D.standard.metrics.paint.fcp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'paint.first-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.paint.fcp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-contentful-paint') as value_0,
        service_blue,
        expFlags,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-contentful-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='7f37b00b7c389dece22091455e889c1d'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.paint.fcp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'paint.first-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-contentful-paint') as value_0,
    service_blue,
    expFlags,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-contentful-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.requester.splits.%24%7BexpFlags%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.paint.fcp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'paint.first-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.paint.fcp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-contentful-paint') as value_0,
        service_blue,
        expFlags,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-contentful-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='044fd8fdcd84089fad2a85a279edd2fd'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.paint.lcp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'largest-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'largest-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-contentful-paint') as value_0,
    service_blue,
    expFlags,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-contentful-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.splits.%24%7BexpFlags%7D.%24%7BpageId%7D.standard.metrics.paint.lcp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'largest-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'largest-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.paint.lcp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-contentful-paint') as value_0,
        service_blue,
        expFlags,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-contentful-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='fa86ca1bb41bfd77ed9a46bca81e444a'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.paint.lcp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'largest-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'largest-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-contentful-paint') as value_0,
    service_blue,
    expFlags,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-contentful-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.requester.splits.%24%7BexpFlags%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.paint.lcp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'largest-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'largest-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.paint.lcp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-contentful-paint') as value_0,
        service_blue,
        expFlags,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-contentful-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='2f211301f425300cf5ca71a0e6db0ab0'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.paint.llep.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'largest-loading-elem-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-loading-elem-paint') as value_0,
    service_blue,
    expFlags,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-loading-elem-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.splits.%24%7BexpFlags%7D.%24%7BpageId%7D.standard.metrics.paint.llep.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'largest-loading-elem-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.paint.llep.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-loading-elem-paint') as value_0,
        service_blue,
        expFlags,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-loading-elem-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='c1305df3e5ee1c4d98fbd8cb58c2b122'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.paint.llep.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'largest-loading-elem-paint')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-loading-elem-paint') as value_0,
    service_blue,
    expFlags,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-loading-elem-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.requester.splits.%24%7BexpFlags%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.paint.llep.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'largest-loading-elem-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.paint.llep.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-loading-elem-paint') as value_0,
        service_blue,
        expFlags,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-loading-elem-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='1f1e18f0ddc4df33a611c6684f42eca8'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.firstScreen.metrics.ttr.start.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.start')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.start.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.start')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.firstScreen.metrics.ttr.start.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='a5e1a79977a9119669c7ea3a5b57e3e0'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.ttr.start.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.start')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.start.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.start')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.ttr.start.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='9ae3d1c3dfd9ded7d43c3c045f4cde36'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.firstScreen.metrics.ttr.end.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.end')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.end.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.end')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.firstScreen.metrics.ttr.end.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='8dd16b26bdd1e3f7af15836774ba2ec4'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.ttr.end.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.end')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.end.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.end')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.ttr.end.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='d3aa04d5301a7603444eeeb01ab91ab5'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.firstScreen.metrics.ttr.duration.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.duration.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.firstScreen.metrics.ttr.duration.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='67626475a4294b449a17d31adc4c34ee'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.ttr.duration.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.duration.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.ttr.duration.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='c24d0f955f28a6a88243f98d83ad6de6'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.firstScreen.metrics.tti.start.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.start')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.firstScreen.metrics.tti.start.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.start')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.firstScreen.metrics.tti.start.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='ab91e983cb391e562be8ee96f96f389d'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.tti.start.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.start')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.tti.start.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.start')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.tti.start.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='e332682f7f4f2384c5b9d889e5b1795f'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.firstScreen.metrics.tti.end.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.end')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.firstScreen.metrics.tti.end.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.end')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.firstScreen.metrics.tti.end.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='a4d3c5e3be3edafe630bb498b50ae1c5'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.tti.end.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.end')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.tti.end.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.end')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.tti.end.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='b669744a12ba477c9fbe4125e696d02c'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.firstScreen.metrics.tti.duration.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.duration')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.firstScreen.metrics.tti.duration.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.duration')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.firstScreen.metrics.tti.duration.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='3e3ef1fa04c2d2854ca744a24e6532a7'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.tti.duration.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.duration')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.tti.duration.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.duration')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.tti.duration.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='260ff922b1317e6861d69893ee523270'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.init.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'js_framework_inited')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'js_framework_inited')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'js_framework_inited') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'js_framework_inited')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.standard.metrics.init.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'js_framework_inited')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'js_framework_inited')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.init.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'js_framework_inited') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'js_framework_inited')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='4f879f28f645d0d32d521a10ec3b19a9'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.init.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'js_framework_inited')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'js_framework_inited')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'js_framework_inited') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'js_framework_inited')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.init.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'js_framework_inited')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'js_framework_inited')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.init.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'js_framework_inited') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'js_framework_inited')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='0bc3fe7f1413e8aeb2b373decc64c647'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.dcl.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'load')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'load')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'load') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'load')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.standard.metrics.dcl.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'load')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'load')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.dcl.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'load') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'load')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='652ef0246b96e85af4a08de97b8c1fef'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.dcl.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'load')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'load')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'load') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'load')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.dcl.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'load')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'load')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.dcl.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'load') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'load')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='b686a315bd83ad66b44024120299de16'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.tti.ready.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.standard.metrics.tti.ready.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.tti.ready.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='44069098d1dfeec2bb465a03d6ae6ff2'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.ready.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.tti.ready.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.ready.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='2b27bcce06d0449e16e119ac175fd3b9'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.paint.fp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-paint')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-paint') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-paint')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.standard.metrics.paint.fp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.paint.fp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-paint') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-paint')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='2285c344feeb8ead8b20e1e4aff2cdb7'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.fp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-paint')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-paint') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-paint')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.paint.fp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.fp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-paint') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-paint')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='acd55ba16e63efe2ff6498cbae88baf1'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.paint.fcp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.standard.metrics.paint.fcp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.paint.fcp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='029afe941d1652a45e54dcc5e4268aa7'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.fcp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.paint.fcp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.fcp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='c058ac27ff8ded2ccdd5997499e2d8a2'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.paint.lcp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-contentful-paint') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-contentful-paint')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.standard.metrics.paint.lcp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.paint.lcp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-contentful-paint') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-contentful-paint')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='a71dc76ebe145ad5399019ee13ec64c0'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.lcp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-contentful-paint') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-contentful-paint')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.paint.lcp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.lcp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-contentful-paint') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-contentful-paint')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='a5e3c595e2db414af8e5fa93b7e7d194'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.paint.llep.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-loading-elem-paint')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.standard.metrics.paint.llep.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-loading-elem-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.paint.llep.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='717bcec3b65ea1b75cff30cc037ccb0f'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.llep.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-loading-elem-paint')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.paint.llep.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-loading-elem-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.llep.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='d82aa248347b95ef159c4cea82b3b9c9'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.firstScreen.metrics.ttr.start.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.start')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.start.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.start')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.firstScreen.metrics.ttr.start.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='acfd87e80447fe3e1347e3ffb05efe2a'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.ttr.start.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.start')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.start.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.start')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.ttr.start.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='8ea7def67fe610f9d0e50933b286624c'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.firstScreen.metrics.ttr.end.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.end')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.end.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.end')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.firstScreen.metrics.ttr.end.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='9a739be8682c51d48928cfa52db76696'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.ttr.end.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.end')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.end.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.end')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.ttr.end.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='0601ffac88bf9e8c5296e0d7c1463e1c'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.firstScreen.metrics.ttr.duration.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.duration.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.firstScreen.metrics.ttr.duration.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='28ac9be54d52c4ee106489857d339e38'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.ttr.duration.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.duration.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.ttr.duration.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='bbf18149139a47e183f0a6493ee68201'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.firstScreen.metrics.tti.start.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.start')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.firstScreen.metrics.tti.start.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.start')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.firstScreen.metrics.tti.start.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='6e3ec1a7ab31a5be42127c4a849006f5'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.tti.start.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.start')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.tti.start.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.start')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.tti.start.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='a715dcfe7db2421ce7203a7fad98973c'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.firstScreen.metrics.tti.end.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.end')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.firstScreen.metrics.tti.end.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.end')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.firstScreen.metrics.tti.end.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='7c521cff599070df9c489997371ded90'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.tti.end.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.end')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.tti.end.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.end')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.tti.end.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='698afa0f2df395d1eddabdc655c4df17'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.firstScreen.metrics.tti.duration.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.duration')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.firstScreen.metrics.tti.duration.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.duration')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.firstScreen.metrics.tti.duration.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='9535b986fc063068241741aaa36b4312'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.tti.duration.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.duration')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.tti.duration.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.duration')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.tti.duration.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='0813b220fd5ed49c9d0c193311def995'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.init.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'js_framework_inited')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'js_framework_inited')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'js_framework_inited') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'js_framework_inited')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.standard.metrics.init.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'js_framework_inited')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'js_framework_inited')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.init.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'js_framework_inited') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'js_framework_inited')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='946503e91dec4fe44022455fb4d4f325'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.init.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'js_framework_inited')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'js_framework_inited')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'js_framework_inited') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'js_framework_inited')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.init.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'js_framework_inited')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'js_framework_inited')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.init.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'js_framework_inited') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'js_framework_inited')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='29de4f679bccb00aadfb8e473da2ae8e'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.dcl.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'load')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'load')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'load') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'load')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.standard.metrics.dcl.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'load')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'load')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.dcl.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'load') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'load')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='47204fb69ea3584a2d4ed28080776906'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.dcl.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'load')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'load')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'load') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'load')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.dcl.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'load')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'load')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.dcl.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'load') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'load')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='2f4fe31a0157771ead1059f16e7815b6'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.tti.ready.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.standard.metrics.tti.ready.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.tti.ready.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='7f99763ddf884d7f3bf431b7dec3f3c5'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.ready.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.tti.ready.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.ready.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='8ea81db9839ec1528f3e032d2e09c61a'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.paint.fp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-paint')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-paint') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-paint')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.standard.metrics.paint.fp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.paint.fp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-paint') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-paint')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='8520269a8d29bbc50acc76c6498bd585'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.fp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-paint')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-paint') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-paint')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.paint.fp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.fp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-paint') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-paint')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='ada6eb100a156cfd107dea438650bb56'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.paint.fcp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.standard.metrics.paint.fcp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.paint.fcp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='aebc7c0049ab664442b6dd7922ad5b6e'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.fcp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.paint.fcp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.fcp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='369d01550161d6db16eedf5c9aed7b6c'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.paint.lcp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-contentful-paint') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-contentful-paint')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.standard.metrics.paint.lcp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.paint.lcp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-contentful-paint') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-contentful-paint')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='e9319f1b3fe15a569063fa52f77dd010'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.lcp.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-contentful-paint') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-contentful-paint')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.paint.lcp.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-contentful-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.lcp.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-contentful-paint') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-contentful-paint')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='d05958c253482d5c153e94e237b26ce0'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.paint.llep.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-loading-elem-paint')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.standard.metrics.paint.llep.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-loading-elem-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.paint.llep.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='168b856f5aa1ecca45662d0da5d4b6c4'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.llep.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-loading-elem-paint')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.paint.llep.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(time%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-loading-elem-paint')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.llep.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='6e199040edc2442c589b83cf95999fd6'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.ttr.start.buckets.${buckets_start}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_start%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_start%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    pageId,
    buckets_start

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.firstScreen.metrics.ttr.start.buckets.%24%7Bbuckets_start%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_start%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_start%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.ttr.start.buckets.${buckets_start}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        pageId,
        buckets_start
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='0d787e49b819ebf21fc0c40d903ad7d5'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.ttr.start.buckets.${buckets_start}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_start%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_start%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    region,
    pageId,
    buckets_start

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.start.buckets.%24%7Bbuckets_start%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_start%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_start%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.ttr.start.buckets.${buckets_start}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        region,
        pageId,
        buckets_start
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='53f3e851d4590180c4cc85e1e951e972'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.ttr.start.buckets.${buckets_start}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_start%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_start%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    browser,
    pageId,
    buckets_start

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.start.buckets.%24%7Bbuckets_start%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_start%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_start%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.ttr.start.buckets.${buckets_start}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        browser,
        pageId,
        buckets_start
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='8f879bdc9f745aa4b8424a02e73c73a7'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.ttr.start.buckets.${buckets_start}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_start%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_start%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    pageId,
    buckets_start

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.start.buckets.%24%7Bbuckets_start%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_start%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_start%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.ttr.start.buckets.${buckets_start}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        pageId,
        buckets_start
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='b05b851103154eca7f2cd13162d9d850'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.ttr.start.buckets.${buckets_start}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_start%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_start%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    browser,
    pageId,
    buckets_start

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.start.buckets.%24%7Bbuckets_start%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_start%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_start%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.ttr.start.buckets.${buckets_start}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        browser,
        pageId,
        buckets_start
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='8dc2df00ddb88f601ea9d4a8f0546e9a'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.ttr.end.buckets.${buckets_end}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_end%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_end%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    pageId,
    buckets_end

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.firstScreen.metrics.ttr.end.buckets.%24%7Bbuckets_end%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_end%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_end%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.ttr.end.buckets.${buckets_end}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        pageId,
        buckets_end
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='88156368e05e4cbf902d129ddc1dac75'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.ttr.end.buckets.${buckets_end}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_end%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_end%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    region,
    pageId,
    buckets_end

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.end.buckets.%24%7Bbuckets_end%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_end%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_end%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.ttr.end.buckets.${buckets_end}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        region,
        pageId,
        buckets_end
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='947820bb294946446c453b4a651bb2a1'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.ttr.end.buckets.${buckets_end}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_end%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_end%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    browser,
    pageId,
    buckets_end

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.end.buckets.%24%7Bbuckets_end%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_end%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_end%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.ttr.end.buckets.${buckets_end}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        browser,
        pageId,
        buckets_end
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='08e6cbf29f8bf52cc316a8c60221a281'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.ttr.end.buckets.${buckets_end}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_end%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_end%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    pageId,
    buckets_end

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.end.buckets.%24%7Bbuckets_end%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_end%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_end%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.ttr.end.buckets.${buckets_end}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        pageId,
        buckets_end
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='fb3b827f82c2b807b77c99d1411a150a'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.ttr.end.buckets.${buckets_end}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_end%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_end%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    browser,
    pageId,
    buckets_end

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.end.buckets.%24%7Bbuckets_end%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_end%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_end%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.ttr.end.buckets.${buckets_end}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        browser,
        pageId,
        buckets_end
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='44912098e4a4fc41a3a1633e23ea6d76'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.ttr.duration.buckets.${buckets_duration}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_duration%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_duration%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    pageId,
    buckets_duration

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.firstScreen.metrics.ttr.duration.buckets.%24%7Bbuckets_duration%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_duration%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_duration%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.ttr.duration.buckets.${buckets_duration}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        pageId,
        buckets_duration
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='67f5af4441de3d7bb7251f07bf69d662'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.ttr.duration.buckets.${buckets_duration}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_duration%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_duration%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    region,
    pageId,
    buckets_duration

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.duration.buckets.%24%7Bbuckets_duration%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_duration%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_duration%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.ttr.duration.buckets.${buckets_duration}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        region,
        pageId,
        buckets_duration
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='b1646ded33496cfda4c151b6c814b4bf'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.ttr.duration.buckets.${buckets_duration}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_duration%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_duration%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    browser,
    pageId,
    buckets_duration

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.duration.buckets.%24%7Bbuckets_duration%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_duration%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_duration%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.ttr.duration.buckets.${buckets_duration}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        browser,
        pageId,
        buckets_duration
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='ae89b20946617dc867d1572b4c10591d'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.ttr.duration.buckets.${buckets_duration}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_duration%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_duration%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    pageId,
    buckets_duration

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.duration.buckets.%24%7Bbuckets_duration%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_duration%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_duration%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.ttr.duration.buckets.${buckets_duration}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        pageId,
        buckets_duration
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='49b6b248ba6a5f6849e88fee10edc8e7'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.ttr.duration.buckets.${buckets_duration}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_duration%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_duration%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    browser,
    pageId,
    buckets_duration

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.firstScreen.metrics.ttr.duration.buckets.%24%7Bbuckets_duration%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_duration%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.ttr.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_duration%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.ttr.duration.buckets.${buckets_duration}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        browser,
        pageId,
        buckets_duration
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='87f0344939280df127296264f4e586a8'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.tti.start.buckets.${buckets_start}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_start%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_start%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    pageId,
    buckets_start

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.firstScreen.metrics.tti.start.buckets.%24%7Bbuckets_start%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_start%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_start%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.tti.start.buckets.${buckets_start}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        pageId,
        buckets_start
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='11fd55def897ccf3b4eb93c206a1d69e'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.tti.start.buckets.${buckets_start}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_start%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_start%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    region,
    pageId,
    buckets_start

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.firstScreen.metrics.tti.start.buckets.%24%7Bbuckets_start%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_start%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_start%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.tti.start.buckets.${buckets_start}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        region,
        pageId,
        buckets_start
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='08c08f46ab95317b3aebcf9090a5ce8c'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.tti.start.buckets.${buckets_start}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_start%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_start%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    browser,
    pageId,
    buckets_start

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.firstScreen.metrics.tti.start.buckets.%24%7Bbuckets_start%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_start%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_start%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.tti.start.buckets.${buckets_start}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        browser,
        pageId,
        buckets_start
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='8cce18057a9e955cadc0766118f1a5f9'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.tti.start.buckets.${buckets_start}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_start%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_start%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    pageId,
    buckets_start

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.tti.start.buckets.%24%7Bbuckets_start%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_start%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_start%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.tti.start.buckets.${buckets_start}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        pageId,
        buckets_start
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='72ae350e5128bbf11edadb391427c4d0'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.tti.start.buckets.${buckets_start}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_start%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_start%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    browser,
    pageId,
    buckets_start

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.firstScreen.metrics.tti.start.buckets.%24%7Bbuckets_start%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_start%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.start')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_start%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.tti.start.buckets.${buckets_start}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        browser,
        pageId,
        buckets_start
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='41a749529cc5ee536363fcb74f36abb4'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.tti.end.buckets.${buckets_end}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_end%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_end%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    pageId,
    buckets_end

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.firstScreen.metrics.tti.end.buckets.%24%7Bbuckets_end%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_end%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_end%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.tti.end.buckets.${buckets_end}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        pageId,
        buckets_end
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='c43b9541aa30b23c8acaee4ac5bbc113'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.tti.end.buckets.${buckets_end}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_end%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_end%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    region,
    pageId,
    buckets_end

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.firstScreen.metrics.tti.end.buckets.%24%7Bbuckets_end%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_end%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_end%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.tti.end.buckets.${buckets_end}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        region,
        pageId,
        buckets_end
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='cbbcc1c0e11817a8e95072fcd1ebf66c'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.tti.end.buckets.${buckets_end}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_end%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_end%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    browser,
    pageId,
    buckets_end

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.firstScreen.metrics.tti.end.buckets.%24%7Bbuckets_end%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_end%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_end%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.tti.end.buckets.${buckets_end}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        browser,
        pageId,
        buckets_end
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='a4802a42d02141ae493752ed8ded44ad'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.tti.end.buckets.${buckets_end}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_end%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_end%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    pageId,
    buckets_end

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.tti.end.buckets.%24%7Bbuckets_end%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_end%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_end%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.tti.end.buckets.${buckets_end}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        pageId,
        buckets_end
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='f54c373ab00def6f6170b9dae763f41a'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.tti.end.buckets.${buckets_end}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_end%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_end%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    browser,
    pageId,
    buckets_end

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.firstScreen.metrics.tti.end.buckets.%24%7Bbuckets_end%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_end%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.end')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_end%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.tti.end.buckets.${buckets_end}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        browser,
        pageId,
        buckets_end
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='16136f6678c41533da899dce05465cb2'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.tti.duration.buckets.${buckets_duration}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_duration%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_duration%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    pageId,
    buckets_duration

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.firstScreen.metrics.tti.duration.buckets.%24%7Bbuckets_duration%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_duration%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_duration%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.tti.duration.buckets.${buckets_duration}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        pageId,
        buckets_duration
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='5945f5c7801fb77c4500127c5317c564'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.tti.duration.buckets.${buckets_duration}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_duration%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_duration%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    region,
    pageId,
    buckets_duration

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.firstScreen.metrics.tti.duration.buckets.%24%7Bbuckets_duration%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_duration%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_duration%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.tti.duration.buckets.${buckets_duration}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        region,
        pageId,
        buckets_duration
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='7c428743a5c25aab18ca0badddd1f278'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.tti.duration.buckets.${buckets_duration}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_duration%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_duration%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    browser,
    pageId,
    buckets_duration

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.firstScreen.metrics.tti.duration.buckets.%24%7Bbuckets_duration%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_duration%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_duration%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.tti.duration.buckets.${buckets_duration}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        browser,
        pageId,
        buckets_duration
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='47c4cf6416e6a7145e4add057045e761'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.tti.duration.buckets.${buckets_duration}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_duration%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_duration%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    pageId,
    buckets_duration

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.firstScreen.metrics.tti.duration.buckets.%24%7Bbuckets_duration%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_duration%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_duration%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.tti.duration.buckets.${buckets_duration}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        pageId,
        buckets_duration
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='2623a8ce5d07d4508b54c93412f7d483'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.tti.duration.buckets.${buckets_duration}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_duration%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_duration%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    browser,
    pageId,
    buckets_duration

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.firstScreen.metrics.tti.duration.buckets.%24%7Bbuckets_duration%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_duration%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'page.firstScreen.tti.duration')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_duration%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.tti.duration.buckets.${buckets_duration}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        browser,
        pageId,
        buckets_duration
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='7b9d73b4f29f3cbad3e8c72f642e93bf'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.init.buckets.${buckets_init}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_init%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_init%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    pageId,
    buckets_init

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_init

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.standard.metrics.init.buckets.%24%7Bbuckets_init%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_init%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_init%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.init.buckets.${buckets_init}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        pageId,
        buckets_init
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_init
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='edac997409e1da406785aa7b1d2575cc'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.init.buckets.${buckets_init}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_init%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_init%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    region,
    pageId,
    buckets_init

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_init

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.standard.metrics.init.buckets.%24%7Bbuckets_init%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_init%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_init%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.init.buckets.${buckets_init}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        region,
        pageId,
        buckets_init
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_init
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='d8b20e3d49873734f0353185f7d36cb7'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.init.buckets.${buckets_init}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_init%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_init%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    browser,
    pageId,
    buckets_init

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_init

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.init.buckets.%24%7Bbuckets_init%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_init%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_init%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.init.buckets.${buckets_init}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        browser,
        pageId,
        buckets_init
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_init
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='3a3517940970a423d9d2a902a3294adf'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.init.buckets.${buckets_init}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_init%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_init%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    pageId,
    buckets_init

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_init

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.init.buckets.%24%7Bbuckets_init%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_init%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_init%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.init.buckets.${buckets_init}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        pageId,
        buckets_init
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_init
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='c246d9e8091cb09c6ba8d726083da5a6'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.init.buckets.${buckets_init}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_init%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_init%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    browser,
    pageId,
    buckets_init

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_init

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.init.buckets.%24%7Bbuckets_init%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_init%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'js_framework_inited')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_init%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.init.buckets.${buckets_init}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        browser,
        pageId,
        buckets_init
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_init
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='a27a8e94c6e6f5aada466aebb768f0ce'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.dcl.buckets.${buckets_dcl}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_dcl%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_dcl%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    pageId,
    buckets_dcl

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_dcl

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.standard.metrics.dcl.buckets.%24%7Bbuckets_dcl%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_dcl%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_dcl%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.dcl.buckets.${buckets_dcl}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        pageId,
        buckets_dcl
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_dcl
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='48f1a9e6148d5d3e76154252d8f5b8d9'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.dcl.buckets.${buckets_dcl}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_dcl%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_dcl%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    region,
    pageId,
    buckets_dcl

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_dcl

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.standard.metrics.dcl.buckets.%24%7Bbuckets_dcl%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_dcl%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_dcl%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.dcl.buckets.${buckets_dcl}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        region,
        pageId,
        buckets_dcl
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_dcl
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='8c2cb5d94aba9bfde1ac0f33d86f9a66'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.dcl.buckets.${buckets_dcl}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_dcl%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_dcl%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    browser,
    pageId,
    buckets_dcl

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_dcl

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.dcl.buckets.%24%7Bbuckets_dcl%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_dcl%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_dcl%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.dcl.buckets.${buckets_dcl}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        browser,
        pageId,
        buckets_dcl
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_dcl
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='f2ed954ddc5bad6c9e476b85063ad1b4'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.dcl.buckets.${buckets_dcl}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_dcl%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_dcl%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    pageId,
    buckets_dcl

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_dcl

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.dcl.buckets.%24%7Bbuckets_dcl%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_dcl%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_dcl%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.dcl.buckets.${buckets_dcl}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        pageId,
        buckets_dcl
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_dcl
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='ffc576faf8b62fec6564ac45b2054c49'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.dcl.buckets.${buckets_dcl}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_dcl%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_dcl%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    browser,
    pageId,
    buckets_dcl

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_dcl

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.dcl.buckets.%24%7Bbuckets_dcl%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_dcl%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'load')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_dcl%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.dcl.buckets.${buckets_dcl}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        browser,
        pageId,
        buckets_dcl
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_dcl
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='4fb212bbd2cdb1ae49836742b0ca3aaa'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.ready.buckets.${buckets_ready}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_ready%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_ready%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    pageId,
    buckets_ready

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_ready

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.standard.metrics.tti.ready.buckets.%24%7Bbuckets_ready%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_ready%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_ready%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.ready.buckets.${buckets_ready}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        pageId,
        buckets_ready
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_ready
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='874b2ae4ecefe8077a0a1387ec84bfa3'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.long-task-all.buckets.${buckets_long-task-all}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_long_task_all%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(long_task_all)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_all)))%20as%20buckets_long_task_all%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    pageId,
    buckets_long_task_all

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(long_task_all) > 32000, 'more_32000', toString(roundToExp2(long_task_all))) as buckets_long_task_all

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.standard.metrics.tti.long-task-all.buckets.%24%7Bbuckets_long-task-all%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_long_task_all%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(long_task_all)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_all)))%20as%20buckets_long_task_all%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.long-task-all.buckets.${buckets_long-task-all}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        pageId,
        buckets_long_task_all
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(long_task_all) > 32000, 'more_32000', toString(roundToExp2(long_task_all))) as buckets_long_task_all
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='f9a367d1f1af65863f761d55b3fa80dd'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.long-task-self.buckets.${buckets_long-task-self}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_long_task_self%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(long_task_self)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_self)))%20as%20buckets_long_task_self%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    pageId,
    buckets_long_task_self

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(long_task_self) > 32000, 'more_32000', toString(roundToExp2(long_task_self))) as buckets_long_task_self

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.standard.metrics.tti.long-task-self.buckets.%24%7Bbuckets_long-task-self%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_long_task_self%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(long_task_self)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_self)))%20as%20buckets_long_task_self%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.long-task-self.buckets.${buckets_long-task-self}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        pageId,
        buckets_long_task_self
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(long_task_self) > 32000, 'more_32000', toString(roundToExp2(long_task_self))) as buckets_long_task_self
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='6db6477738e2231adf4977f4bb08828d'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.long-task-unknown.buckets.${buckets_long-task-unknown}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_long_task_unknown%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(long_task_unknown)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_unknown)))%20as%20buckets_long_task_unknown%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    pageId,
    buckets_long_task_unknown

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(long_task_unknown) > 32000, 'more_32000', toString(roundToExp2(long_task_unknown))) as buckets_long_task_unknown

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.standard.metrics.tti.long-task-unknown.buckets.%24%7Bbuckets_long-task-unknown%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_long_task_unknown%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(long_task_unknown)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_unknown)))%20as%20buckets_long_task_unknown%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.long-task-unknown.buckets.${buckets_long-task-unknown}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        pageId,
        buckets_long_task_unknown
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(long_task_unknown) > 32000, 'more_32000', toString(roundToExp2(long_task_unknown))) as buckets_long_task_unknown
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='f6b69283b7e9fccae128fbf7c844e628'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.ready.buckets.${buckets_ready}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_ready%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_ready%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    region,
    pageId,
    buckets_ready

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_ready

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.standard.metrics.tti.ready.buckets.%24%7Bbuckets_ready%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_ready%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_ready%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.ready.buckets.${buckets_ready}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        region,
        pageId,
        buckets_ready
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_ready
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='f983d7d60f813670b648704e9f3ad17a'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.long-task-all.buckets.${buckets_long-task-all}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_long_task_all%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(long_task_all)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_all)))%20as%20buckets_long_task_all%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    region,
    pageId,
    buckets_long_task_all

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(long_task_all) > 32000, 'more_32000', toString(roundToExp2(long_task_all))) as buckets_long_task_all

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-all.buckets.%24%7Bbuckets_long-task-all%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_long_task_all%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(long_task_all)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_all)))%20as%20buckets_long_task_all%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.long-task-all.buckets.${buckets_long-task-all}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        region,
        pageId,
        buckets_long_task_all
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(long_task_all) > 32000, 'more_32000', toString(roundToExp2(long_task_all))) as buckets_long_task_all
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='9420ae3e7414f7786a0b1bee76fb0ed9'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.long-task-self.buckets.${buckets_long-task-self}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_long_task_self%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(long_task_self)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_self)))%20as%20buckets_long_task_self%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    region,
    pageId,
    buckets_long_task_self

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(long_task_self) > 32000, 'more_32000', toString(roundToExp2(long_task_self))) as buckets_long_task_self

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-self.buckets.%24%7Bbuckets_long-task-self%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_long_task_self%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(long_task_self)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_self)))%20as%20buckets_long_task_self%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.long-task-self.buckets.${buckets_long-task-self}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        region,
        pageId,
        buckets_long_task_self
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(long_task_self) > 32000, 'more_32000', toString(roundToExp2(long_task_self))) as buckets_long_task_self
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='c0ff7e275e6f120eadb7bdb3f9277f4f'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.long-task-unknown.buckets.${buckets_long-task-unknown}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_long_task_unknown%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(long_task_unknown)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_unknown)))%20as%20buckets_long_task_unknown%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    region,
    pageId,
    buckets_long_task_unknown

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(long_task_unknown) > 32000, 'more_32000', toString(roundToExp2(long_task_unknown))) as buckets_long_task_unknown

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-unknown.buckets.%24%7Bbuckets_long-task-unknown%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_long_task_unknown%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(long_task_unknown)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_unknown)))%20as%20buckets_long_task_unknown%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.long-task-unknown.buckets.${buckets_long-task-unknown}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        region,
        pageId,
        buckets_long_task_unknown
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(long_task_unknown) > 32000, 'more_32000', toString(roundToExp2(long_task_unknown))) as buckets_long_task_unknown
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='6c851b3f6838d15d6417622c4a2fd4c4'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.ready.buckets.${buckets_ready}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_ready%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_ready%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    browser,
    pageId,
    buckets_ready

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_ready

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.tti.ready.buckets.%24%7Bbuckets_ready%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_ready%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_ready%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.ready.buckets.${buckets_ready}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        browser,
        pageId,
        buckets_ready
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_ready
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='2f4858fc5908980700f74e1406559ab7'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.long-task-all.buckets.${buckets_long-task-all}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_long_task_all%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(long_task_all)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_all)))%20as%20buckets_long_task_all%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    browser,
    pageId,
    buckets_long_task_all

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(long_task_all) > 32000, 'more_32000', toString(roundToExp2(long_task_all))) as buckets_long_task_all

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-all.buckets.%24%7Bbuckets_long-task-all%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_long_task_all%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(long_task_all)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_all)))%20as%20buckets_long_task_all%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.long-task-all.buckets.${buckets_long-task-all}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        browser,
        pageId,
        buckets_long_task_all
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(long_task_all) > 32000, 'more_32000', toString(roundToExp2(long_task_all))) as buckets_long_task_all
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='db34aa78c46c414f13e207a29be05c06'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.long-task-self.buckets.${buckets_long-task-self}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_long_task_self%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(long_task_self)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_self)))%20as%20buckets_long_task_self%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    browser,
    pageId,
    buckets_long_task_self

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(long_task_self) > 32000, 'more_32000', toString(roundToExp2(long_task_self))) as buckets_long_task_self

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-self.buckets.%24%7Bbuckets_long-task-self%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_long_task_self%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(long_task_self)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_self)))%20as%20buckets_long_task_self%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.long-task-self.buckets.${buckets_long-task-self}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        browser,
        pageId,
        buckets_long_task_self
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(long_task_self) > 32000, 'more_32000', toString(roundToExp2(long_task_self))) as buckets_long_task_self
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='af48ed6b515c40795c41cd4e873dd0ef'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.long-task-unknown.buckets.${buckets_long-task-unknown}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_long_task_unknown%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(long_task_unknown)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_unknown)))%20as%20buckets_long_task_unknown%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    browser,
    pageId,
    buckets_long_task_unknown

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(long_task_unknown) > 32000, 'more_32000', toString(roundToExp2(long_task_unknown))) as buckets_long_task_unknown

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-unknown.buckets.%24%7Bbuckets_long-task-unknown%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_long_task_unknown%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(long_task_unknown)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_unknown)))%20as%20buckets_long_task_unknown%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.long-task-unknown.buckets.${buckets_long-task-unknown}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        browser,
        pageId,
        buckets_long_task_unknown
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(long_task_unknown) > 32000, 'more_32000', toString(roundToExp2(long_task_unknown))) as buckets_long_task_unknown
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='a7a7c572633c514f010e55ceb07412bf'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.ready.buckets.${buckets_ready}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_ready%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_ready%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    pageId,
    buckets_ready

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_ready

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.tti.ready.buckets.%24%7Bbuckets_ready%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_ready%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_ready%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.ready.buckets.${buckets_ready}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        pageId,
        buckets_ready
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_ready
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='1bb40da714e8701514deda5b85d32605'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.long-task-all.buckets.${buckets_long-task-all}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_long_task_all%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(long_task_all)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_all)))%20as%20buckets_long_task_all%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    pageId,
    buckets_long_task_all

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(long_task_all) > 32000, 'more_32000', toString(roundToExp2(long_task_all))) as buckets_long_task_all

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-all.buckets.%24%7Bbuckets_long-task-all%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_long_task_all%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(long_task_all)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_all)))%20as%20buckets_long_task_all%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.long-task-all.buckets.${buckets_long-task-all}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        pageId,
        buckets_long_task_all
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(long_task_all) > 32000, 'more_32000', toString(roundToExp2(long_task_all))) as buckets_long_task_all
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='10219649b6f6c785f9dad86fb91d1922'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.long-task-self.buckets.${buckets_long-task-self}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_long_task_self%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(long_task_self)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_self)))%20as%20buckets_long_task_self%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    pageId,
    buckets_long_task_self

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(long_task_self) > 32000, 'more_32000', toString(roundToExp2(long_task_self))) as buckets_long_task_self

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-self.buckets.%24%7Bbuckets_long-task-self%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_long_task_self%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(long_task_self)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_self)))%20as%20buckets_long_task_self%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.long-task-self.buckets.${buckets_long-task-self}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        pageId,
        buckets_long_task_self
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(long_task_self) > 32000, 'more_32000', toString(roundToExp2(long_task_self))) as buckets_long_task_self
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='2cc338948231ba840c841a0763fd8a09'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.long-task-unknown.buckets.${buckets_long-task-unknown}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_long_task_unknown%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(long_task_unknown)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_unknown)))%20as%20buckets_long_task_unknown%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    pageId,
    buckets_long_task_unknown

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(long_task_unknown) > 32000, 'more_32000', toString(roundToExp2(long_task_unknown))) as buckets_long_task_unknown

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-unknown.buckets.%24%7Bbuckets_long-task-unknown%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_long_task_unknown%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(long_task_unknown)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_unknown)))%20as%20buckets_long_task_unknown%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.long-task-unknown.buckets.${buckets_long-task-unknown}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        pageId,
        buckets_long_task_unknown
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(long_task_unknown) > 32000, 'more_32000', toString(roundToExp2(long_task_unknown))) as buckets_long_task_unknown
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='f1553c671bd06b6b6d92a1502661bab0'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.ready.buckets.${buckets_ready}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_ready%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_ready%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    browser,
    pageId,
    buckets_ready

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_ready

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.tti.ready.buckets.%24%7Bbuckets_ready%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_ready%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_ready%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.ready.buckets.${buckets_ready}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        browser,
        pageId,
        buckets_ready
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_ready
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='7670a02ff53ab7f476b468784223dc8a'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.long-task-all.buckets.${buckets_long-task-all}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_long_task_all%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(long_task_all)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_all)))%20as%20buckets_long_task_all%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    browser,
    pageId,
    buckets_long_task_all

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(long_task_all) > 32000, 'more_32000', toString(roundToExp2(long_task_all))) as buckets_long_task_all

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-all.buckets.%24%7Bbuckets_long-task-all%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_long_task_all%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(long_task_all)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_all)))%20as%20buckets_long_task_all%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.long-task-all.buckets.${buckets_long-task-all}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        browser,
        pageId,
        buckets_long_task_all
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(long_task_all) > 32000, 'more_32000', toString(roundToExp2(long_task_all))) as buckets_long_task_all
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='aa9d356acf804ea6d43c1756cad533d0'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.long-task-self.buckets.${buckets_long-task-self}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_long_task_self%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(long_task_self)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_self)))%20as%20buckets_long_task_self%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    browser,
    pageId,
    buckets_long_task_self

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(long_task_self) > 32000, 'more_32000', toString(roundToExp2(long_task_self))) as buckets_long_task_self

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-self.buckets.%24%7Bbuckets_long-task-self%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_long_task_self%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(long_task_self)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_self)))%20as%20buckets_long_task_self%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.long-task-self.buckets.${buckets_long-task-self}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        browser,
        pageId,
        buckets_long_task_self
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(long_task_self) > 32000, 'more_32000', toString(roundToExp2(long_task_self))) as buckets_long_task_self
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='83d7c67c67ea28797971770c996b9f50'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.long-task-unknown.buckets.${buckets_long-task-unknown}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_long_task_unknown%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(long_task_unknown)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_unknown)))%20as%20buckets_long_task_unknown%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    browser,
    pageId,
    buckets_long_task_unknown

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(long_task_unknown) > 32000, 'more_32000', toString(roundToExp2(long_task_unknown))) as buckets_long_task_unknown

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-unknown.buckets.%24%7Bbuckets_long-task-unknown%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_long_task_unknown%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(long_task_unknown)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(long_task_unknown)))%20as%20buckets_long_task_unknown%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.long-task-unknown.buckets.${buckets_long-task-unknown}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        browser,
        pageId,
        buckets_long_task_unknown
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(long_task_unknown) > 32000, 'more_32000', toString(roundToExp2(long_task_unknown))) as buckets_long_task_unknown
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='a1e07d1319604a1bf9c3961cf29a4e2f'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.fp.buckets.${buckets_fp}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_fp%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_fp%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    pageId,
    buckets_fp

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fp

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.standard.metrics.paint.fp.buckets.%24%7Bbuckets_fp%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_fp%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_fp%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.fp.buckets.${buckets_fp}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        pageId,
        buckets_fp
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fp
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='336a488560981335346cad59f5f956b0'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.fp.buckets.${buckets_fp}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_fp%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_fp%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    region,
    pageId,
    buckets_fp

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fp

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.standard.metrics.paint.fp.buckets.%24%7Bbuckets_fp%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_fp%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_fp%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.fp.buckets.${buckets_fp}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        region,
        pageId,
        buckets_fp
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fp
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='36061a198d6e239bc894d7843b163995'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.fp.buckets.${buckets_fp}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_fp%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_fp%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    browser,
    pageId,
    buckets_fp

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fp

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.paint.fp.buckets.%24%7Bbuckets_fp%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_fp%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_fp%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.fp.buckets.${buckets_fp}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        browser,
        pageId,
        buckets_fp
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fp
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='fc3893a2a2802ff8c94ca45075f38c05'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.fp.buckets.${buckets_fp}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_fp%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_fp%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    pageId,
    buckets_fp

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fp

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.paint.fp.buckets.%24%7Bbuckets_fp%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_fp%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_fp%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.fp.buckets.${buckets_fp}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        pageId,
        buckets_fp
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fp
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='7c6639754352e60790f46e70dc0b0b0a'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.fp.buckets.${buckets_fp}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_fp%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_fp%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    browser,
    pageId,
    buckets_fp

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fp

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.paint.fp.buckets.%24%7Bbuckets_fp%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_fp%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_fp%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.fp.buckets.${buckets_fp}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        browser,
        pageId,
        buckets_fp
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fp
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='c9ac2d03e2d1c110d8ae19077e61f1c5'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.fcp.buckets.${buckets_fcp}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_fcp%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_fcp%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    pageId,
    buckets_fcp

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fcp

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.standard.metrics.paint.fcp.buckets.%24%7Bbuckets_fcp%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_fcp%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_fcp%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.fcp.buckets.${buckets_fcp}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        pageId,
        buckets_fcp
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fcp
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='ca10e12860e35e2104cd1ed77f905510'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.fcp.buckets.${buckets_fcp}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_fcp%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_fcp%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    region,
    pageId,
    buckets_fcp

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fcp

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.standard.metrics.paint.fcp.buckets.%24%7Bbuckets_fcp%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_fcp%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_fcp%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.fcp.buckets.${buckets_fcp}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        region,
        pageId,
        buckets_fcp
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fcp
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='530e868695263c255282e50c7f6e5f72'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.fcp.buckets.${buckets_fcp}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_fcp%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_fcp%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    browser,
    pageId,
    buckets_fcp

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fcp

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.paint.fcp.buckets.%24%7Bbuckets_fcp%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_fcp%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_fcp%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.fcp.buckets.${buckets_fcp}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        browser,
        pageId,
        buckets_fcp
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fcp
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='ee8ac3db71523d06b8c0c31a86dae921'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.fcp.buckets.${buckets_fcp}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_fcp%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_fcp%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    pageId,
    buckets_fcp

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fcp

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.paint.fcp.buckets.%24%7Bbuckets_fcp%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_fcp%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_fcp%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.fcp.buckets.${buckets_fcp}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        pageId,
        buckets_fcp
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fcp
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='aa9a5208e833f1bb7fbb4c9ed8b7be00'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.fcp.buckets.${buckets_fcp}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_fcp%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_fcp%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    browser,
    pageId,
    buckets_fcp

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fcp

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.paint.fcp.buckets.%24%7Bbuckets_fcp%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_fcp%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'paint.first-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_fcp%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.fcp.buckets.${buckets_fcp}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        browser,
        pageId,
        buckets_fcp
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fcp
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='bba035c63bc48a222a3e95a62034f0e0'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.lcp.buckets.${buckets_lcp}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_lcp%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_lcp%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    pageId,
    buckets_lcp

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_lcp

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.standard.metrics.paint.lcp.buckets.%24%7Bbuckets_lcp%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_lcp%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_lcp%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.lcp.buckets.${buckets_lcp}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        pageId,
        buckets_lcp
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_lcp
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='04af62756864ec14c1bc1c7b498e8519'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.lcp.buckets.${buckets_lcp}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_lcp%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_lcp%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    region,
    pageId,
    buckets_lcp

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_lcp

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.standard.metrics.paint.lcp.buckets.%24%7Bbuckets_lcp%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_lcp%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_lcp%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.lcp.buckets.${buckets_lcp}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        region,
        pageId,
        buckets_lcp
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_lcp
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='f264257d641ea78dc3d0b2e12e2cc10f'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.lcp.buckets.${buckets_lcp}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_lcp%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_lcp%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    browser,
    pageId,
    buckets_lcp

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_lcp

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.paint.lcp.buckets.%24%7Bbuckets_lcp%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_lcp%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_lcp%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.lcp.buckets.${buckets_lcp}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        browser,
        pageId,
        buckets_lcp
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_lcp
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='36e94177065c349b3cab7050407d1d23'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.lcp.buckets.${buckets_lcp}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_lcp%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_lcp%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    pageId,
    buckets_lcp

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_lcp

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.paint.lcp.buckets.%24%7Bbuckets_lcp%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_lcp%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_lcp%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.lcp.buckets.${buckets_lcp}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        pageId,
        buckets_lcp
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_lcp
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='ef31c122e412b815b6ee8e511c26502b'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.lcp.buckets.${buckets_lcp}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_lcp%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_lcp%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    browser,
    pageId,
    buckets_lcp

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_lcp

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.paint.lcp.buckets.%24%7Bbuckets_lcp%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_lcp%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-contentful-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_lcp%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.lcp.buckets.${buckets_lcp}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        browser,
        pageId,
        buckets_lcp
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_lcp
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='e90077419330a05c73a0bc203e5634b0'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.llep.buckets.${buckets_llep}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_llep%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_llep%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    pageId,
    buckets_llep

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_llep

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.standard.metrics.paint.llep.buckets.%24%7Bbuckets_llep%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_llep%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_llep%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.llep.buckets.${buckets_llep}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        pageId,
        buckets_llep
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_llep
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='2d5e88b394a630b43b7a42674101903c'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.llep.buckets.${buckets_llep}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_llep%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_llep%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    region,
    pageId,
    buckets_llep

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_llep

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.standard.metrics.paint.llep.buckets.%24%7Bbuckets_llep%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_llep%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_llep%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.llep.buckets.${buckets_llep}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        region,
        pageId,
        buckets_llep
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_llep
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='9d899df5b7c083bf572a1730048f1af5'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.llep.buckets.${buckets_llep}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_llep%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_llep%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    browser,
    pageId,
    buckets_llep

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_llep

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.paint.llep.buckets.%24%7Bbuckets_llep%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_llep%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_llep%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.llep.buckets.${buckets_llep}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        browser,
        pageId,
        buckets_llep
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_llep
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='1c6cd43732a9b526bbe68412f2591279'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.llep.buckets.${buckets_llep}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_llep%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_llep%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    pageId,
    buckets_llep

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_llep

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.paint.llep.buckets.%24%7Bbuckets_llep%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_llep%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_llep%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.llep.buckets.${buckets_llep}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        pageId,
        buckets_llep
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_llep
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='c35b32e79a6c6720f883e3d060de9cc0'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.llep.buckets.${buckets_llep}

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%2C%0A%20%20%20%20buckets_llep%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_llep%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    count() / 60 as value_0,
    service_blue,
    requester,
    browser,
    pageId,
    buckets_llep

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
    if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_llep

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.paint.llep.buckets.%24%7Bbuckets_llep%7D'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20count()%20%2F%2060%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%2C%0A%20%20%20%20%20%20%20%20buckets_llep%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'largest-loading-elem-paint')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%2C%0A%20%20%20%20%20%20%20%20if(roundToExp2(time)%20%3E%2032000%2C%20'more_32000'%2C%20toString(roundToExp2(time)))%20as%20buckets_llep%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.llep.buckets.${buckets_llep}' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        count() / 60 as value_0,
        service_blue,
        requester,
        browser,
        pageId,
        buckets_llep
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId,
        if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_llep
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='58e6913e05571df983a67b6838d41e1a'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.long-task-all.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_all%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
    service_blue,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.standard.metrics.tti.long-task-all.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_all%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.long-task-all.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
        service_blue,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='da471c0c489028429128e16650c29df0'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.long-task-all.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_all%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
    service_blue,
    region,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-all.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_all%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.long-task-all.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
        service_blue,
        region,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='43c1f4f2e1b1f76cb1a4b2376d462957'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.long-task-all.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_all%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
    service_blue,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-all.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_all%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.long-task-all.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
        service_blue,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='3afc9557246000e82cd2a19c18c69a40'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.long-task-all.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_all%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
    service_blue,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-all.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_all%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.long-task-all.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
        service_blue,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='7119b57d15e23571297d73cd2a4f1fac'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.long-task-all.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_all%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
    service_blue,
    requester,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-all.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_all%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.long-task-all.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
        service_blue,
        requester,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='4e9dce3da795f86568ac6a6549c08959'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.tti.long-task-all.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_all%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') as value_0,
    service_blue,
    expFlags,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.splits.%24%7BexpFlags%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-all.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_all%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.tti.long-task-all.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') as value_0,
        service_blue,
        expFlags,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='5ab05186bd1fc8b2eec45691d5fcdbb0'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.tti.long-task-all.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_all%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') as value_0,
    service_blue,
    expFlags,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.requester.splits.%24%7BexpFlags%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-all.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_all%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.tti.long-task-all.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') as value_0,
        service_blue,
        expFlags,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='e4de888028d9428e1a3f4b14226e86ca'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.tti.long-task-all.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_all%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-all.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_all%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.tti.long-task-all.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='9d1104701e01d24c57f2c82049c52d2f'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.long-task-all.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_all%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-all.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_all%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.long-task-all.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='ab10d08a965fe333162f4c8212006269'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.tti.long-task-all.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_all%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-all.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_all%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.tti.long-task-all.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='4882c0691f29afe8fc0d2d245aab4c9c'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.long-task-all.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_all%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-all.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_all%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.long-task-all.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='a3749a1b90861d6f45d16f0729a995d7'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.long-task-self.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_self%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
    service_blue,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.standard.metrics.tti.long-task-self.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_self%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.long-task-self.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
        service_blue,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='69e977e68a0a6510a11f27cb2b420c02'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.long-task-self.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_self%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
    service_blue,
    region,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-self.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_self%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.long-task-self.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
        service_blue,
        region,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='2f251c5f3554d9c2cfb4367b4eda552f'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.long-task-self.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_self%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
    service_blue,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-self.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_self%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.long-task-self.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
        service_blue,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='f4aea31c651a2123e05bf106483ff9b5'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.long-task-self.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_self%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
    service_blue,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-self.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_self%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.long-task-self.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
        service_blue,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='5ddff44d8b5bbd9a35262fa61edb2415'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.long-task-self.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_self%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
    service_blue,
    requester,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-self.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_self%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.long-task-self.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
        service_blue,
        requester,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='7d11654808afd60a805c92a067d0e825'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.tti.long-task-self.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_self%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') as value_0,
    service_blue,
    expFlags,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.splits.%24%7BexpFlags%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-self.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_self%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.tti.long-task-self.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') as value_0,
        service_blue,
        expFlags,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='f015979811798dda515cff446271050d'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.tti.long-task-self.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_self%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') as value_0,
    service_blue,
    expFlags,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.requester.splits.%24%7BexpFlags%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-self.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_self%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.tti.long-task-self.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') as value_0,
        service_blue,
        expFlags,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='5de2eb12e83fdac0b6e795b3691355af'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.tti.long-task-self.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_self%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-self.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_self%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.tti.long-task-self.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='560b462e6a135a9e9735531596681bee'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.long-task-self.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_self%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-self.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_self%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.long-task-self.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='db08317b8b58f01c6163b04c61dd553f'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.tti.long-task-self.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_self%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-self.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_self%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.tti.long-task-self.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='a58f6c49667d968248b7b3d24094b44f'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.long-task-self.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_self%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-self.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_self%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.long-task-self.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='4168b75efe7718071d7746c5bc255b8e'></a>market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.long-task-unknown.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_unknown%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
    service_blue,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.total.%24%7BpageId%7D.standard.metrics.tti.long-task-unknown.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_unknown%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.long-task-unknown.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
        service_blue,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='97cd9025840f664b5686c1f012d8b991'></a>market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_unknown%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20region%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
    service_blue,
    region,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.region.splits.%24%7Bregion%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-unknown.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_unknown%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(regionToName(regionToCountry(region)%2C%20'en')%2C%20'%20'%2C%20'_')%20as%20region%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
        service_blue,
        region,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='21d04e8692b9b6bb9e7777847930532d'></a>market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_unknown%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
    service_blue,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.browser.splits.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-unknown.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_unknown%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
        service_blue,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='fd96c7cdb3c46d0bc2e487cadb410651'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_unknown%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
    service_blue,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.splits.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-unknown.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_unknown%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
        service_blue,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='5d44853fdc7993216b767fe3098a66a7'></a>market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_unknown%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20browser%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
    service_blue,
    requester,
    browser,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    concat(browser_name, '-', browser_version_major) as browser,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.requester.browser.splits.%24%7Brequester%7D.%24%7Bbrowser%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-unknown.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_unknown%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20browser%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20concat(browser_name%2C%20'-'%2C%20browser_version_major)%20as%20browser%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0,
        service_blue,
        requester,
        browser,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        concat(browser_name, '-', browser_version_major) as browser,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='40fe1778b6dfac4efa42f191bfd647df'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_unknown%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') as value_0,
    service_blue,
    expFlags,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.splits.%24%7BexpFlags%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-unknown.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_unknown%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') as value_0,
        service_blue,
        expFlags,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='ef90fd0bebc25cec9c55a2eea0152858'></a>market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_unknown%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20service_blue%2C%0A%20%20%20%20expFlags%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') as value_0,
    service_blue,
    expFlags,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti')

GROUP BY metric_ts,
    multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
    replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.%24%7Bservice_blue%7D.expFlags.requester.splits.%24%7BexpFlags%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-unknown.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_unknown%2Cenvironment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20service_blue%2C%0A%20%20%20%20%20%20%20%20expFlags%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20service_blue%20!%3D%20'undefined_service'%20and%20expFlags%20!%3D%20''%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20multiIf(%20vhost%20in%20('beru.ru'%2C'pokupki.market.yandex.ru')%2C%20'blue_desktop'%2Cvhost%20in%20('m.beru.ru'%2C'm.pokupki.market.yandex.ru')%2C%20'blue_touch'%20%2C%20'undefined_service'%20)%20as%20service_blue%2C%0A%20%20%20%20%20%20%20%20replaceAll(arrayJoin(exp_flgs)%2C%20'%3D'%2C%20'_'))%20as%20expFlags%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') as value_0,
        service_blue,
        expFlags,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti')
    
    GROUP BY metric_ts,
        multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue,
        replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='da9a866af1aaa0d7ef9fa206616f4541'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_unknown%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-unknown.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_unknown%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='77a6ad19911f23df01d0539ced12c945'></a>market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_unknown%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-unknown.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_unknown%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('beru.ru'%2C%20'pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='573604ea89fcd230b252af650b6e6dcc'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_unknown%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') as value_0,
    testId,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.%24%7BtestId%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-unknown.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_unknown%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') as value_0,
        testId,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```
#### <a id='9b66d2eaa27450e4c449d384374786e9'></a>market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles

[Preview query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%0A%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_unknown%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20testId%2C%0A%20%20%20%20requester%2C%0A%20%20%20%20pageId%0A%0AFROM%20market.timemark%0A%0AWHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%0AGROUP%20BY%20metric_ts%2C%0A%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A%0AORDER%20BY%20metric_ts%20LIMIT%2010)
```SQL
SELECT
    multiply(intDiv(timestamp, 60), 60) AS metric_ts,
    quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') as value_0,
    testId,
    requester,
    pageId

FROM market.timemark

WHERE date = today() and timestamp > now() - 60 * 60
    AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti')

GROUP BY metric_ts,
    arrayJoin(test_ids) as testId,
    arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
    arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId

ORDER BY metric_ts LIMIT 10
```

[Diagnostic query:](https://yql.yandex-team.ru/?query_type=CLICKHOUSE&query=use%20marketclickhouse%3B%0A%0ASELECT%20%0A%20%20%20%20'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.%24%7BtestId%7D.%24%7Brequester%7D.%24%7BpageId%7D.standard.metrics.tti.long-task-unknown.quantiles'%20AS%20title%2C%20%0A%20%20%20%20count()%20AS%20cnt%0A%20%20%20%20%20%0AFROM%20(%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20multiply(intDiv(timestamp%2C%2060)%2C%2060)%20AS%20metric_ts%2C%0A%20%20%20%20%20%20%20%20quantilesTimingIf(0.5%2C0.6%2C0.7%2C0.80%2C0.90%2C0.95%2C0.97%2C0.99%2C0.995%2C0.997%2C0.999%2C1)(long_task_unknown%2Cenvironment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%20as%20value_0%2C%0A%20%20%20%20%20%20%20%20testId%2C%0A%20%20%20%20%20%20%20%20requester%2C%0A%20%20%20%20%20%20%20%20pageId%0A%20%20%20%20%0A%20%20%20%20FROM%20market.timemark%0A%20%20%20%20%0A%20%20%20%20WHERE%20date%20%3D%20today()%20and%20timestamp%20%3E%20now()%20-%2060%20*%2060%0A%20%20%20%20%20%20%20%20AND%20(environment%20%3D%20'PRODUCTION'%20and%20vhost%20in%20('m.beru.ru'%2C%20'm.pokupki.market.yandex.ru')%20and%20name%20%3D%20'tti')%0A%20%20%20%20%0A%20%20%20%20GROUP%20BY%20metric_ts%2C%0A%20%20%20%20%20%20%20%20arrayJoin(test_ids)%20as%20testId%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B%20'any-requester'%2C%20multiIf(%20is_robot%20%3D%201%2C%20'robot'%2C%20indexOf(kv_keys%2C%20'puid')%20%3E%200%2C%20'logged-in'%2C%20'anonymous'%20)%20%5D)%20as%20requester%2C%0A%20%20%20%20%20%20%20%20arrayJoin(%5B'any-page'%2C%20replaceAll(page%2C%20'%3A'%2C%20'_')%5D)%20as%20pageId%0A)%0A%0AGROUP%20BY%20metric_ts%0AORDER%20BY%20cnt%20DESC%0ALIMIT%201)
```SQL
SELECT 
    'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles' AS title, 
    count() AS cnt
     
FROM (
    SELECT
        multiply(intDiv(timestamp, 60), 60) AS metric_ts,
        quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') as value_0,
        testId,
        requester,
        pageId
    
    FROM market.timemark
    
    WHERE date = today() and timestamp > now() - 60 * 60
        AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti')
    
    GROUP BY metric_ts,
        arrayJoin(test_ids) as testId,
        arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester,
        arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId
)

GROUP BY metric_ts
ORDER BY cnt DESC
LIMIT 1
```


## Overall Diagnostics

### Portion #1

```SQL
SELECT * FROM (
    SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.ttr.start.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') as value_0, service_blue, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.ttr.start.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') as value_0, service_blue, region, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.ttr.start.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') as value_0, service_blue, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.ttr.start.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') as value_0, service_blue, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.ttr.start.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') as value_0, service_blue, requester, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.ttr.end.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') as value_0, service_blue, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.ttr.end.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') as value_0, service_blue, region, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.ttr.end.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') as value_0, service_blue, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.ttr.end.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') as value_0, service_blue, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.ttr.end.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') as value_0, service_blue, requester, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.ttr.duration.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') as value_0, service_blue, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.ttr.duration.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') as value_0, service_blue, region, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.ttr.duration.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') as value_0, service_blue, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.ttr.duration.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') as value_0, service_blue, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.ttr.duration.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') as value_0, service_blue, requester, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.tti.start.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') as value_0, service_blue, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.tti.start.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') as value_0, service_blue, region, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.tti.start.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') as value_0, service_blue, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.tti.start.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') as value_0, service_blue, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.tti.start.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') as value_0, service_blue, requester, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
) ORDER BY cnt DESC
```
### Portion #2

```SQL
SELECT * FROM (
    SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.tti.end.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') as value_0, service_blue, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.tti.end.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') as value_0, service_blue, region, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.tti.end.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') as value_0, service_blue, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.tti.end.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') as value_0, service_blue, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.tti.end.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') as value_0, service_blue, requester, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.tti.duration.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') as value_0, service_blue, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.tti.duration.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') as value_0, service_blue, region, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.tti.duration.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') as value_0, service_blue, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.tti.duration.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') as value_0, service_blue, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.tti.duration.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') as value_0, service_blue, requester, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.init.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') as value_0, service_blue, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.init.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') as value_0, service_blue, region, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.init.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') as value_0, service_blue, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.init.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') as value_0, service_blue, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.init.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') as value_0, service_blue, requester, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.dcl.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') as value_0, service_blue, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.dcl.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') as value_0, service_blue, region, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.dcl.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') as value_0, service_blue, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.dcl.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') as value_0, service_blue, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.dcl.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') as value_0, service_blue, requester, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
) ORDER BY cnt DESC
```
### Portion #3

```SQL
SELECT * FROM (
    SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.ready.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0, service_blue, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.ready.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0, service_blue, region, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.ready.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0, service_blue, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.ready.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0, service_blue, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.ready.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0, service_blue, requester, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.fp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') as value_0, service_blue, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.fp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') as value_0, service_blue, region, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.fp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') as value_0, service_blue, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.fp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') as value_0, service_blue, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.fp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') as value_0, service_blue, requester, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.fcp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') as value_0, service_blue, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.fcp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') as value_0, service_blue, region, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.fcp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') as value_0, service_blue, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.fcp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') as value_0, service_blue, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.fcp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') as value_0, service_blue, requester, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.lcp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') as value_0, service_blue, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.lcp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') as value_0, service_blue, region, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.lcp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') as value_0, service_blue, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.lcp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') as value_0, service_blue, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.lcp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') as value_0, service_blue, requester, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
) ORDER BY cnt DESC
```
### Portion #4

```SQL
SELECT * FROM (
    SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.llep.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') as value_0, service_blue, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.llep.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') as value_0, service_blue, region, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.llep.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') as value_0, service_blue, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.llep.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') as value_0, service_blue, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.llep.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') as value_0, service_blue, requester, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.firstScreen.metrics.ttr.start.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.start') as value_0, service_blue, expFlags, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.start') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.firstScreen.metrics.ttr.start.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.start') as value_0, service_blue, expFlags, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.start') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.firstScreen.metrics.ttr.end.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.end') as value_0, service_blue, expFlags, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.end') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.firstScreen.metrics.ttr.end.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.end') as value_0, service_blue, expFlags, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.end') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.firstScreen.metrics.ttr.duration.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.duration') as value_0, service_blue, expFlags, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.duration') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.firstScreen.metrics.ttr.duration.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.duration') as value_0, service_blue, expFlags, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.ttr.duration') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.firstScreen.metrics.tti.start.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.start') as value_0, service_blue, expFlags, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.start') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.firstScreen.metrics.tti.start.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.start') as value_0, service_blue, expFlags, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.start') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.firstScreen.metrics.tti.end.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.end') as value_0, service_blue, expFlags, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.end') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.firstScreen.metrics.tti.end.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.end') as value_0, service_blue, expFlags, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.end') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.firstScreen.metrics.tti.duration.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.duration') as value_0, service_blue, expFlags, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.duration') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.firstScreen.metrics.tti.duration.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.duration') as value_0, service_blue, expFlags, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'page.firstScreen.tti.duration') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.init.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'js_framework_inited') as value_0, service_blue, expFlags, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'js_framework_inited') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.init.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'js_framework_inited') as value_0, service_blue, expFlags, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'js_framework_inited') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.dcl.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'load') as value_0, service_blue, expFlags, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'load') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
) ORDER BY cnt DESC
```
### Portion #5

```SQL
SELECT * FROM (
    SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.dcl.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'load') as value_0, service_blue, expFlags, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'load') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.tti.ready.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') as value_0, service_blue, expFlags, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.tti.ready.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') as value_0, service_blue, expFlags, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.paint.fp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-paint') as value_0, service_blue, expFlags, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.paint.fp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-paint') as value_0, service_blue, expFlags, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.paint.fcp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-contentful-paint') as value_0, service_blue, expFlags, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-contentful-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.paint.fcp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-contentful-paint') as value_0, service_blue, expFlags, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'paint.first-contentful-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.paint.lcp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-contentful-paint') as value_0, service_blue, expFlags, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-contentful-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.paint.lcp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-contentful-paint') as value_0, service_blue, expFlags, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-contentful-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.paint.llep.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-loading-elem-paint') as value_0, service_blue, expFlags, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-loading-elem-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.paint.llep.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-loading-elem-paint') as value_0, service_blue, expFlags, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'largest-loading-elem-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.firstScreen.metrics.ttr.start.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.ttr.start.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.firstScreen.metrics.ttr.end.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.ttr.end.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.firstScreen.metrics.ttr.duration.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.ttr.duration.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.firstScreen.metrics.tti.start.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.tti.start.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.firstScreen.metrics.tti.end.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
) ORDER BY cnt DESC
```
### Portion #6

```SQL
SELECT * FROM (
    SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.tti.end.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.firstScreen.metrics.tti.duration.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.tti.duration.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.init.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'js_framework_inited') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'js_framework_inited') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.init.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'js_framework_inited') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'js_framework_inited') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.dcl.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'load') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'load') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.dcl.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'load') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'load') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.tti.ready.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.ready.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.paint.fp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-paint') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-paint') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.fp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-paint') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-paint') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.paint.fcp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.fcp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.paint.lcp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-contentful-paint') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-contentful-paint') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.lcp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-contentful-paint') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-contentful-paint') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.paint.llep.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.llep.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.firstScreen.metrics.ttr.start.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.ttr.start.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.start') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.firstScreen.metrics.ttr.end.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
) ORDER BY cnt DESC
```
### Portion #7

```SQL
SELECT * FROM (
    SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.ttr.end.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.end') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.firstScreen.metrics.ttr.duration.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.ttr.duration.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.ttr.duration') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.firstScreen.metrics.tti.start.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.tti.start.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.start') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.firstScreen.metrics.tti.end.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.tti.end.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.end') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.firstScreen.metrics.tti.duration.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.firstScreen.metrics.tti.duration.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'page.firstScreen.tti.duration') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.init.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'js_framework_inited') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'js_framework_inited') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.init.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'js_framework_inited') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'js_framework_inited') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.dcl.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'load') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'load') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.dcl.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'load') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'load') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.tti.ready.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.ready.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.paint.fp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-paint') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-paint') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.fp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-paint') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-paint') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.paint.fcp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.fcp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'paint.first-contentful-paint') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.paint.lcp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-contentful-paint') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-contentful-paint') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
) ORDER BY cnt DESC
```
### Portion #8

```SQL
SELECT * FROM (
    SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.lcp.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-contentful-paint') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-contentful-paint') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.paint.llep.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.paint.llep.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(time,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'largest-loading-elem-paint') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.ttr.start.buckets.${buckets_start}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, pageId, buckets_start FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.ttr.start.buckets.${buckets_start}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, region, pageId, buckets_start FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.ttr.start.buckets.${buckets_start}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, browser, pageId, buckets_start FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.ttr.start.buckets.${buckets_start}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, pageId, buckets_start FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.ttr.start.buckets.${buckets_start}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, browser, pageId, buckets_start FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.start') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.ttr.end.buckets.${buckets_end}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, pageId, buckets_end FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.ttr.end.buckets.${buckets_end}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, region, pageId, buckets_end FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.ttr.end.buckets.${buckets_end}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, browser, pageId, buckets_end FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.ttr.end.buckets.${buckets_end}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, pageId, buckets_end FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.ttr.end.buckets.${buckets_end}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, browser, pageId, buckets_end FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.end') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.ttr.duration.buckets.${buckets_duration}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, pageId, buckets_duration FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.ttr.duration.buckets.${buckets_duration}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, region, pageId, buckets_duration FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.ttr.duration.buckets.${buckets_duration}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, browser, pageId, buckets_duration FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.ttr.duration.buckets.${buckets_duration}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, pageId, buckets_duration FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.ttr.duration.buckets.${buckets_duration}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, browser, pageId, buckets_duration FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.ttr.duration') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.tti.start.buckets.${buckets_start}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, pageId, buckets_start FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.tti.start.buckets.${buckets_start}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, region, pageId, buckets_start FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
) ORDER BY cnt DESC
```
### Portion #9

```SQL
SELECT * FROM (
    SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.tti.start.buckets.${buckets_start}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, browser, pageId, buckets_start FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.tti.start.buckets.${buckets_start}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, pageId, buckets_start FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.tti.start.buckets.${buckets_start}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, browser, pageId, buckets_start FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.start') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_start ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.tti.end.buckets.${buckets_end}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, pageId, buckets_end FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.tti.end.buckets.${buckets_end}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, region, pageId, buckets_end FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.tti.end.buckets.${buckets_end}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, browser, pageId, buckets_end FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.tti.end.buckets.${buckets_end}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, pageId, buckets_end FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.tti.end.buckets.${buckets_end}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, browser, pageId, buckets_end FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.end') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_end ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.firstScreen.metrics.tti.duration.buckets.${buckets_duration}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, pageId, buckets_duration FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.firstScreen.metrics.tti.duration.buckets.${buckets_duration}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, region, pageId, buckets_duration FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.firstScreen.metrics.tti.duration.buckets.${buckets_duration}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, browser, pageId, buckets_duration FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.firstScreen.metrics.tti.duration.buckets.${buckets_duration}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, pageId, buckets_duration FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.firstScreen.metrics.tti.duration.buckets.${buckets_duration}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, browser, pageId, buckets_duration FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'page.firstScreen.tti.duration') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_duration ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.init.buckets.${buckets_init}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, pageId, buckets_init FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_init ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.init.buckets.${buckets_init}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, region, pageId, buckets_init FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_init ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.init.buckets.${buckets_init}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, browser, pageId, buckets_init FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_init ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.init.buckets.${buckets_init}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, pageId, buckets_init FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_init ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.init.buckets.${buckets_init}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, browser, pageId, buckets_init FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'js_framework_inited') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_init ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.dcl.buckets.${buckets_dcl}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, pageId, buckets_dcl FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_dcl ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.dcl.buckets.${buckets_dcl}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, region, pageId, buckets_dcl FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_dcl ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
) ORDER BY cnt DESC
```
### Portion #10

```SQL
SELECT * FROM (
    SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.dcl.buckets.${buckets_dcl}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, browser, pageId, buckets_dcl FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_dcl ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.dcl.buckets.${buckets_dcl}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, pageId, buckets_dcl FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_dcl ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.dcl.buckets.${buckets_dcl}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, browser, pageId, buckets_dcl FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'load') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_dcl ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.ready.buckets.${buckets_ready}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, pageId, buckets_ready FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_ready ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.long-task-all.buckets.${buckets_long-task-all}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, pageId, buckets_long_task_all FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(long_task_all) > 32000, 'more_32000', toString(roundToExp2(long_task_all))) as buckets_long_task_all ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.long-task-self.buckets.${buckets_long-task-self}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, pageId, buckets_long_task_self FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(long_task_self) > 32000, 'more_32000', toString(roundToExp2(long_task_self))) as buckets_long_task_self ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.long-task-unknown.buckets.${buckets_long-task-unknown}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, pageId, buckets_long_task_unknown FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(long_task_unknown) > 32000, 'more_32000', toString(roundToExp2(long_task_unknown))) as buckets_long_task_unknown ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.ready.buckets.${buckets_ready}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, region, pageId, buckets_ready FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_ready ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.long-task-all.buckets.${buckets_long-task-all}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, region, pageId, buckets_long_task_all FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(long_task_all) > 32000, 'more_32000', toString(roundToExp2(long_task_all))) as buckets_long_task_all ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.long-task-self.buckets.${buckets_long-task-self}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, region, pageId, buckets_long_task_self FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(long_task_self) > 32000, 'more_32000', toString(roundToExp2(long_task_self))) as buckets_long_task_self ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.long-task-unknown.buckets.${buckets_long-task-unknown}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, region, pageId, buckets_long_task_unknown FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(long_task_unknown) > 32000, 'more_32000', toString(roundToExp2(long_task_unknown))) as buckets_long_task_unknown ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.ready.buckets.${buckets_ready}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, browser, pageId, buckets_ready FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_ready ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.long-task-all.buckets.${buckets_long-task-all}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, browser, pageId, buckets_long_task_all FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(long_task_all) > 32000, 'more_32000', toString(roundToExp2(long_task_all))) as buckets_long_task_all ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.long-task-self.buckets.${buckets_long-task-self}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, browser, pageId, buckets_long_task_self FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(long_task_self) > 32000, 'more_32000', toString(roundToExp2(long_task_self))) as buckets_long_task_self ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.long-task-unknown.buckets.${buckets_long-task-unknown}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, browser, pageId, buckets_long_task_unknown FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(long_task_unknown) > 32000, 'more_32000', toString(roundToExp2(long_task_unknown))) as buckets_long_task_unknown ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.ready.buckets.${buckets_ready}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, pageId, buckets_ready FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_ready ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.long-task-all.buckets.${buckets_long-task-all}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, pageId, buckets_long_task_all FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(long_task_all) > 32000, 'more_32000', toString(roundToExp2(long_task_all))) as buckets_long_task_all ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.long-task-self.buckets.${buckets_long-task-self}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, pageId, buckets_long_task_self FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(long_task_self) > 32000, 'more_32000', toString(roundToExp2(long_task_self))) as buckets_long_task_self ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.long-task-unknown.buckets.${buckets_long-task-unknown}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, pageId, buckets_long_task_unknown FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(long_task_unknown) > 32000, 'more_32000', toString(roundToExp2(long_task_unknown))) as buckets_long_task_unknown ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.ready.buckets.${buckets_ready}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, browser, pageId, buckets_ready FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_ready ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
) ORDER BY cnt DESC
```
### Portion #11

```SQL
SELECT * FROM (
    SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.long-task-all.buckets.${buckets_long-task-all}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, browser, pageId, buckets_long_task_all FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(long_task_all) > 32000, 'more_32000', toString(roundToExp2(long_task_all))) as buckets_long_task_all ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.long-task-self.buckets.${buckets_long-task-self}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, browser, pageId, buckets_long_task_self FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(long_task_self) > 32000, 'more_32000', toString(roundToExp2(long_task_self))) as buckets_long_task_self ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.long-task-unknown.buckets.${buckets_long-task-unknown}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, browser, pageId, buckets_long_task_unknown FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(long_task_unknown) > 32000, 'more_32000', toString(roundToExp2(long_task_unknown))) as buckets_long_task_unknown ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.fp.buckets.${buckets_fp}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, pageId, buckets_fp FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fp ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.fp.buckets.${buckets_fp}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, region, pageId, buckets_fp FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fp ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.fp.buckets.${buckets_fp}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, browser, pageId, buckets_fp FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fp ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.fp.buckets.${buckets_fp}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, pageId, buckets_fp FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fp ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.fp.buckets.${buckets_fp}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, browser, pageId, buckets_fp FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fp ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.fcp.buckets.${buckets_fcp}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, pageId, buckets_fcp FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fcp ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.fcp.buckets.${buckets_fcp}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, region, pageId, buckets_fcp FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fcp ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.fcp.buckets.${buckets_fcp}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, browser, pageId, buckets_fcp FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fcp ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.fcp.buckets.${buckets_fcp}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, pageId, buckets_fcp FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fcp ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.fcp.buckets.${buckets_fcp}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, browser, pageId, buckets_fcp FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'paint.first-contentful-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_fcp ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.lcp.buckets.${buckets_lcp}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, pageId, buckets_lcp FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_lcp ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.lcp.buckets.${buckets_lcp}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, region, pageId, buckets_lcp FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_lcp ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.lcp.buckets.${buckets_lcp}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, browser, pageId, buckets_lcp FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_lcp ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.lcp.buckets.${buckets_lcp}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, pageId, buckets_lcp FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_lcp ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.lcp.buckets.${buckets_lcp}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, browser, pageId, buckets_lcp FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-contentful-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_lcp ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.paint.llep.buckets.${buckets_llep}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, pageId, buckets_llep FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_llep ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.paint.llep.buckets.${buckets_llep}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, region, pageId, buckets_llep FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_llep ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
) ORDER BY cnt DESC
```
### Portion #12

```SQL
SELECT * FROM (
    SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.paint.llep.buckets.${buckets_llep}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, browser, pageId, buckets_llep FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_llep ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.paint.llep.buckets.${buckets_llep}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, pageId, buckets_llep FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_llep ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.paint.llep.buckets.${buckets_llep}' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, count() / 60 as value_0, service_blue, requester, browser, pageId, buckets_llep FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'largest-loading-elem-paint') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId, if(roundToExp2(time) > 32000, 'more_32000', toString(roundToExp2(time))) as buckets_llep ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.long-task-all.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0, service_blue, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.long-task-all.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0, service_blue, region, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.long-task-all.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0, service_blue, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.long-task-all.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0, service_blue, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.long-task-all.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0, service_blue, requester, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.tti.long-task-all.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') as value_0, service_blue, expFlags, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.tti.long-task-all.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') as value_0, service_blue, expFlags, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.tti.long-task-all.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.long-task-all.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.tti.long-task-all.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.long-task-all.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_all,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.long-task-self.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0, service_blue, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.long-task-self.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0, service_blue, region, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.long-task-self.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0, service_blue, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.long-task-self.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0, service_blue, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.long-task-self.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0, service_blue, requester, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.tti.long-task-self.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') as value_0, service_blue, expFlags, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
) ORDER BY cnt DESC
```
### Portion #13

```SQL
SELECT * FROM (
    SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.tti.long-task-self.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') as value_0, service_blue, expFlags, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.tti.long-task-self.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.long-task-self.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.tti.long-task-self.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.long-task-self.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_self,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.total.${pageId}.standard.metrics.tti.long-task-unknown.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0, service_blue, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.region.splits.${region}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0, service_blue, region, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(regionToName(regionToCountry(region), 'en'), ' ', '_') as region, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.browser.splits.${browser}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0, service_blue, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.splits.${requester}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0, service_blue, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.requester.browser.splits.${requester}.${browser}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') as value_0, service_blue, requester, browser, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, concat(browser_name, '-', browser_version_major) as browser, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.splits.${expFlags}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') as value_0, service_blue, expFlags, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.${service_blue}.expFlags.requester.splits.${expFlags}.${requester}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') as value_0, service_blue, expFlags, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and service_blue != 'undefined_service' and expFlags != '' and name = 'tti') GROUP BY metric_ts, multiIf( vhost in ('beru.ru','pokupki.market.yandex.ru'), 'blue_desktop',vhost in ('m.beru.ru','m.pokupki.market.yandex.ru'), 'blue_touch' , 'undefined_service' ) as service_blue, replaceAll(arrayJoin(exp_flgs), '=', '_')) as expFlags, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.splits.${testId}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_desktop.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('beru.ru', 'pokupki.market.yandex.ru') and name = 'tti') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.splits.${testId}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') as value_0, testId, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
    UNION ALL SELECT 'market-front-unified.rum_timemark.v1.blue_touch.testId.requester.splits.${testId}.${requester}.${pageId}.standard.metrics.tti.long-task-unknown.quantiles' AS title, count() AS cnt FROM ( SELECT multiply(intDiv(timestamp, 60), 60) AS metric_ts, quantilesTimingIf(0.5,0.6,0.7,0.80,0.90,0.95,0.97,0.99,0.995,0.997,0.999,1)(long_task_unknown,environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') as value_0, testId, requester, pageId FROM market.timemark WHERE date = today() and timestamp > now() - 60 * 60 AND (environment = 'PRODUCTION' and vhost in ('m.beru.ru', 'm.pokupki.market.yandex.ru') and name = 'tti') GROUP BY metric_ts, arrayJoin(test_ids) as testId, arrayJoin([ 'any-requester', multiIf( is_robot = 1, 'robot', indexOf(kv_keys, 'puid') > 0, 'logged-in', 'anonymous' ) ]) as requester, arrayJoin(['any-page', replaceAll(page, ':', '_')]) as pageId ) GROUP BY metric_ts ORDER BY cnt DESC LIMIT 1
) ORDER BY cnt DESC
```

