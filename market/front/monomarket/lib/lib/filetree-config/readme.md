# filetree-config

Пакет для организации работы с конфигами для разных окружений. Позволяет разбивать конфиги по разным файлам и хранить отдельные конфигурации для каждого окружения. Плюс к тому предоставляет возможность переопределять значения с помощью переменных окружения.

## Использование

```(javascript)
const configs = require('@yandex-market/configs');

// Все параметры опциональные, здесь указаны их дефолтные значения.
module.exports = configs({
    root = Path.resolve(process.cwd(), 'configs'), // - путь к директории с конфигами
    environment = process.env.YENV || 'current', // - название текущего окружения
    envPrefix = 'appConfig', // - префикс переменных окружения для переопределения конфигов
    nestedRoot = true, // - см. особенности
    nestedEnv = true, // - см. особенности
})
```

## Особенности

Опции `nested(Root|Env)` говорят о том, каким образом будет происходить слияние файлов конфигурации. Если этот флаг false - происходит простой мёрж. Если true, то каждый файл записывается в отдельную секцию в соответствии со своим названием и директорией. Например содержимое `node/server.js` будет доступно в итоге как `config.node.server`. При этом есть специальное правило для файлов `index.*` - `node/index.js` будет доступен как `config.node`, т.е. имя `index` просто выкидывается из итогового пути. Соответственно `nestedRoot` - применяет эти правила к базовому конфигу, `nestedEnv` - к конфигу окружения

Перед подключением список файлов сортируется по алфавиту (исключение `index.*` - эти файлы всегда стоят первыми в своих каталогах).

Сначала загружается базовый конфиг, затем поверх него загружается конфиг конкретного окружения.

Если файл конфигурации экспортирует функцию, она будет вызвана с объектом описания переменных окружения. Результат исполнения будет использован в качестве конфигурации данного файла.

## Переменные окружения

С помощью переменных окружения можно переопределить любое значение конфигурации. В коде следует указать некий префикс, который будет использоваться для поиска нужных ключей. Далее в переменных окружения можно создавать записи вида `<envPrefix>_<path>_<to>_<config>_<property>`. Значения переменной окружения такого вида будет записано в `config[<path>][<to>][<config>][<property>]`. При этом если любоей из частей пути не существует - она будет создана.

В качестве значений можно передавать не только строковые и числовые значения, но и любые JSON-объекты.

Все переменные с указанным префиксом читаются в отдельный объект описания переменных окружения, который можно получить, если из файла конфигурации экспортировать функцию.
