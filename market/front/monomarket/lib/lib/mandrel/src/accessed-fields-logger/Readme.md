# Accessed Fields Logger (AFL)
AFL - это утилита, которая поможет собрать список полей, которыми фронт действительно пользуется.

## Управление утилитой
Утилита управляется экспом `accessed_fields_logger`

## Концепция работы утилиты
На результат вызова бэкенда (в основном это нормализованная коллекция) вешается детектор. Детектор обнаруживает любое обращение к полям своей коллекции и логирует это.
За счет этого, мы можем понять к каким полям действительно было обращение, а какие мы зря храним.

## Техническое описание работы
### Детектор
Когда детектор навешивается на нормализованный результат бэкенда, утилита рекурсивно пробегается по всем полям коллекции и заменяет все объекты на их проксированные копии.
У проксированного объекта определен метод `get`, который и фиксирует факт обращения к полю и логирует это.

### Инициализация
К конфигу (схеме) ресурса добавляется новое поле 
```
afl?: boolean
```
затем в method (src/utils/resource/bcm.js), мы проверяем наличие этого флага и вешаем детектор.

### Инициализация клиента
Для инициализация клиента создан виджет src/widgets/core/AFLClientInitializer. Он проверяет наличие экспа, после чего записывает это в переменную на клиенте.
Утилиты клиентской части перед выполнением своей логики проверяют значение этой переменной.

#### Концепция работы клиента
На клиенте мы так-же вешаем детекторы на результаты remote-resolver-ов. Но теперь при обращении к полям с детекторами, мы вместо логирования записываем эту информацию в специальный объект.
Затем при переходе на другую страницу (или при закрытии страницы) собранные данные (содержимое объекта) отсылается на сервер резолвером src/resolvers/report-accessed-fields
Этот резолвер пробегается по собранным данным и логирует их уже с серверной стороны.
