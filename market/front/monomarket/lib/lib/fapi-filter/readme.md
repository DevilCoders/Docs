# Фильтрация данных по схеме для ФАПИ

## Описание схемы

В качестве формата описания схемы используется JSON.

Допустимы элементы 3х типов:

- **Объект**. В качестве ключей указываются поля, которые необходимо включить в ответ. В качестве значений - дочерняя
  схема которую требуется применить к данным в этом поле. Если в качестве названия поля указать `"*"`, будут включены
  все поля, к ним будет применена схема указанная в данном ключе.
- **Массив**. В качестве элементов массива указываются либо строки, либо объекты
  вида `{"key": string, "fields": schema}`. В ответ будут включены все поля, перечисленные в массиве. Если указано
  поле `fields`, указанная в нём схема будет применяться к значению поля. Если передать строку `"*"` или объект с таким
  ключём, все поля будут включены в ответ.

Пример:

```json
{
  "collection-1": [
    "field-1",
    "field-2",
    {
      "key": "field-3",
      "fields": {
        "sub-field-1": [
          "a",
          "b"
        ],
        "sub-field-2": [
          "*",
          {
            "key": "image",
            "fields": [
              "url"
            ]
          }
        ],
        "sub-field-3": {
          "*": [
            "params",
            "data"
          ],
          "error": [
            "message"
          ]
        }
      }
    }
  ]
}
```

В данном примере в ответ будет включено только поле "collection-1"

- в котором будут включены поля field-1, field-2 целиком
- поле field-3, в нём будут включены поля
    - sub-field-1, в котором будут включены поля a, b целиком
    - sub-field-2, в котором будут включены все поля целиком, кроме поля image - для него будет включён только url
    - sub-field-3, в котором
        - будут включены все поля, в них будут включены params, data целиком
        - кроме поля error, для него будет включено только поле message целиком

Например это может выглядеть вот так:

```json
{
  "collection-1": [
    {
      "field-1": "some text"
    },
    {
      "field-1": "other text",
      "field-2": 123
    },
    {
      "field-2": 452
    },
    {
      "field-3": {
        "sub-field-1": {
          "a": "AAA!",
          "b": "boom!"
        },
        "sub-field-2": {
          "description": "some big text",
          "size": {
            "x": 100,
            "y": 100
          },
          "image": {
            "url": "http://.../..."
          }
        },
        "sub-field-3": {
          "request-1": {
            "params": {
              "a": 1,
              "b": 2
            },
            "data": "some-text-data"
          },
          "request-2": {
            "params": {
              "q": "q",
              "w": "w"
            },
            "data": {
              "some": "object"
            }
          },
          "error": {
            "message": "Too much requests"
          }
        }
      }
    }
  ]
}
```
