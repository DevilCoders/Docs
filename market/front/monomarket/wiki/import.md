Импорт пакетов в монорепу
======================

Для импорта пакета в монорепу следует использовать команду `yammy import <repo> <category> <alias>`

```
yammy import --help
Импортировать внешний репозиторий во монорепу   

Usage:
 > yammy import <repo> <category> <alias>

Arguments:
 * <repo>  -  Урл репозитория для импорта. Поддерживаются любые протоколы доспустимые в команде git clone
 * <category>  -  Директория для импорта
 * <alias>  -  Название директории проекта
```

При этом будет создана ветка `import/<category>/<alias>`. В неё будет загружен требуемый репозиторий в нужную директорию и сделаны первые подготовительные работы для встраивания в монорепу.

Линковка и зависимости
--------------------

Первым делом нужно почитать лог команды `yammy validate deps`. Нужно найти все пакеты, в которых данный пакет является зависимостью и заменить версию пакета в них на путь до пакета в формате `file:../bla-bla`. Для этого можно использовать команду `yammy link` (читайте доку, не забывайте выставлять правильный тип зависимости).

После того как в логе пропадут сообщения о том что локальный пакет установлен как фиксированная версия без фриз-тикета, нужно проверить другие расхождения зависимостей. Возможно некоторые из них следует "заморозить" прописать фриз-тикет. После того как все нужные зависимости будут заморожены стоит прогнать `yammy validate deps fix` чтобы автоматом уровнять версии остальных пакетов во всех пакетах.

Адаптация к монорепе
------------------

1. Внимательно читаем раздел [тестирование](testing.md)
2. Для всяких стандартных тестов и сборки нужно использовать пакеты `@yandex-market/eslinter`, `@yandex-market/jest`, `@yandex-market/typescript`, `@yandex-market/flow`. См. примеры в уже существующих пакетах. В целом большую часть задачи должен выполнить `yammy setup auto`, запускаемый при импорте, но это не гарантируется. Рекомендуется прочитать код команд `yammy setup ...` для лучшего понимания что конкретно требуется проделать.
3. Нужно удалить всякие лишние файлы типа `.veendor.js`, `package-lock.json`, `.npmrc`, `sandbox-ci.json`, `devexp.json` и т.д.
4. Удалить любые команды для публикации в npm. Публикация в npm происходит только средствами монорепы. Вся подготовка к публикации должна происходить в скрипте сборки. В случае если в исходном проекте при публикации делается что-то типа `cd dist && npm publish`, это значит что требуется настроить пакет как генератор. См. примеры уже существующих пакетов, например mandrel.

Проверки
-------

1. Нужно проверить руками что работают все стандратные локальные сценарии - `build`, `test`
2. Нужно сделать ПР и в нём проверить что нужные ci тесты были запущены, отработали успешно и опубликовался вменяемый отчёт.
3. Для пакетов которые никогда не публиковались в npm, но публикация планируется нужно запустить `yammy ci publish <pkg> init`
