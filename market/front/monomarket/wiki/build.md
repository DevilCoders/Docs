Сборка пакетов
============

Чтобы настроить сборку пакета требуется в scripts секции добавить скрипт build, который будет запускать сборку. В случае
если в для сборки в CI требуются какие-то дополнительные манпуляции со сборкой (например оптимизация картинок,
brottli-сжатие и т.д), можно настроить отдельный скрипт ci:build, который будет запускаться только в CI-задачах.
Разумеется из ci:build можно свободно вызвать сам оригинальный билд `{"ci:build": "yarn run build && ..."}`

Важно! Сборка пакета не предполагает упаковку ресурса, какую-либо публикацию пакета куда-либо и т.д. Этот этап просто
выполняет подготовку файлов к дальнейшим действиям.

Локальная сборка
--------------

Для локальной сборки иногда бывает актуально настроить отдельные шаги сборки и при необходимости запускать их
селективно. Для этого следует подобные шаги сборки описывать как `build:<stage-name>`. Для вызова сборки отдельного шага
следует использовать переменную окружения `YAMMY_BUILD` (можно указать через запятую сразу несколько последовательных
шагов), например

```shell
YAMMY_BUILD=flow,typescript yammy build mandrel 
```

Множественная сборка в CI
-------------------------

Для некоторых случаев может потребоваться собирать несколько независимых артефактов в CI. Например делать прод и дев
сборку, которые будут использоваться в разных окружениях. Для этого скрипты сборки нужно назвать `ci:build:<name>`.

**Важно:** артефакты всех подобных сборок будут существовать в одной файловой системе, так что стоит для каждой подобной
сборки указать свою директорию в которую требуетя её производить.

По мере возможности и необходимости эти сборки будут запускаться в параллельных сендбокс тасках. В случае необходимости
можно указать зависимость подобных сборок друг от друга. Например первая сборка может выкачивать какие-то данные из
танкера/бункера, а затем остальные сборки будут использовать их. Для этого требуется в конфиге создать секцию конфига
сборки и указать зависимости сборки. Например:

```json
{
  "config": {
    "build": {
      "ci:build:client": {
        "dependsOn": [
          "ci:build:bunker",
          "ci:build:tanker"
        ]
      },
      "ci:build:server": {
        "dependsOn": [
          "ci:build:bunker",
          "ci:build:tanker"
        ]
      }
    }
  }
}
```
