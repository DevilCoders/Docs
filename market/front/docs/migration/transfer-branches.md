# –ú–∏–≥—Ä–∞—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç—ã—Ö –≤–µ—Ç–æ–∫ –∏ PR

### –ú–æ—è –≤–µ—Ç–∫–∞ –±—ã–ª–∞ —Ü–µ–ª–∏–∫–æ–º –∑–∞–ø—É—à–µ–Ω–∞ –≤ –≥–∏—Ç

1. –ù–∞—Ö–æ–¥–∏–º —Å–≤–æ—é –≤–µ—Ç–∫—É –≤ –∞—Ä–∫–∞–¥–∏–∏ (–æ–Ω–∞ "—á—É–∂–∞—è" –∏ –ø—Ä–∞–≤–∏—Ç—å –µ—ë –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ)
2. –û—Ç–≤–æ–¥–∏–º –æ—Ç –Ω–µ—ë —Å–≤–æ—é –∫–æ–ø–∏—é –≤–µ—Ç–∫–∏
3. –†–µ–±–µ–π–∑–∏–º –Ω–∞ —Å–≤–µ–∂–∏–π —Ç—Ä–∞–Ω–∫
4. –û—Ç–∫—Ä—ã–≤–∞–µ–º PR (+ –ø—É–±–ª–∏–∫—É–µ–º –µ—Å–ª–∏ PR –≥–æ—Ç–æ–≤ –∫ —Ä–µ–≤—å—é)

```
arc fetch external/github/<owner>/<repo>/<branch>
arc checkout -b <branch> external/github/<owner>/<repo>/<branch>
arc pull trunk
```
```
arc rebase trunk
```

{% note tip %}

–ï—Å–ª–∏ —Ç—É—Ç –Ω–∞—á–∞–ª–∞—Å—å zhopa (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–µ—Ç–∫–∞ —Å–∏–ª—å–Ω–æ –æ—Ç—Å—Ç–∞–ª–∞ –æ—Ç –º–∞—Å—Ç–µ—Ä–∞ –≤ –≥–∏—Ç–µ –∏ —Ä–µ–±–µ–π–∑ –∏–¥—ë—Ç –æ—á–µ–Ω—å –¥–æ–ª–≥–æ), —Ç–æ –ª—É—á—à–µ —á–µ—Ä–µ–∑ –ø–∞—Ç—á. –°–º. [—Å—é–¥–∞](#perenosim-cherez-patch)

{% endnote %}

```
arc push -u users/<login>/<branch>
arc pr create  // —Å–æ–∑–¥–∞–Ω–∏–µ PR –≤ trunk
```

#### –ù–∞ –ø—Ä–∏–º–µ—Ä–µ
–í–µ—Ç–∫–∞ `MARKETFRONT-77113-gemini` –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ `marketfront` –¥–ª—è —é–∑–µ—Ä–∞ `lengl`, —ç—Ç–æ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

```
arc fetch external/github/market/marketfront/MARKETFRONT-77113-gemini
arc checkout -b MARKETFRONT-77113-gemini external/github/market/marketfront/MARKETFRONT-77113-gemini
arc pull trunk
arc rebase trunk
arc push -u users/lengl/MARKETFRONT-77113-gemini
arc pr create
```

### –ü–µ—Ä–µ–Ω–æ—Å–∏–º —á–µ—Ä–µ–∑ patch
> –ú–æ–∏ –Ω–∞—Ä–∞–±–æ—Ç–∫–∏ –æ—Å—Ç–∞–ª–∏—Å—å –ª–æ–∫–∞–ª—å–Ω–æ, –≤ –≥–∏—Ç –∑–∞–ø—É—à–∏—Ç—å –Ω–µ —É—Å–ø–µ–ª. –ß—Ç–æ –¥–µ–ª–∞—Ç—å?

–°–ø–∞—Å–∏–±–æ [@ruvata](https://staff.yandex-team.ru/ruvata34) –∑–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é

–í—ã—Ö–æ–¥ –µ—Å—Ç—å - –∏—Å–ø–æ–ª—å–∑—É–µ–º "–ø–∞—Ç—á —Ñ–∞–π–ª" git –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –≤–∞—à–∏—Ö –∫–æ–º–º–∏—Ç–æ–≤ –∏–∑ —Ü–µ–ª–µ–≤–æ–π –≤–µ—Ç–∫–∏ –≤ –Ω–æ–≤—É—é –≤–µ—Ç–∫—É –≤ –≤–∞—à–µ–º –∫–∞—Ç–∞–ª–æ–≥–µ Arc.

–ù–∞–¥–µ—é—Å—å —á—Ç–æ —Ç—É—Ç –Ω–µ –Ω—É–∂–µ–Ω —Ç—É—Ç–æ—Ä–∏–∞–ª –ø–æ —Ç–µ–º–µ —Ç–æ–≥–æ –∫–∞–∫ –≤ git –¥–µ–ª–∞—é—Ç—Å—è –ø–∞—Ç—á–∏ (–µ—Å–ª–∏ —á—Ç–æ, —Å–º–æ—Ç—Ä–∏–º –¥–æ–∫—É –ø–æ –∫–æ–º–∞–Ω–¥–µ **[git format-patch](https://git-scm.com/docs/git-format-patch)** –∏ "—è–Ω–¥–µ–∫—Å–∏–º" - ["–∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å –ø–∞—Ç—á —Ñ–∞–π–ª –≤ –≥–∏—Ç–µ"](https://yandex.ru/search/?lr=213&text=%D0%BA%D0%B0%D0%BA+%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C+%D0%BF%D0%B0%D1%82%D1%87+%D1%84%D0%B0%D0%B9%D0%BB+%D0%B2+%D0%B3%D0%B8%D1%82%D0%B5), —Ç–∞–∫-–∂–µ –≤—ã –º–æ–∂–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ –ª–µ–≥–∫–æ –∏ –Ω–µ–ø—Ä–∏–Ω—É–∂–¥–µ–Ω–Ω–æ –∏–∑ UI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ VCS –≤ –≤–∞—à–µ–π IDE)

{% note warning %}

–ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –ø–∞—Ç—á–∞ - —Å–¥–µ–ª–∞–π—Ç–µ **rebase** (onto) –≤–∞—à–µ–π –≤–µ—Ç–∫–∏ –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ/–ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ **master** (upstream)

{% endnote %}

- –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ø–æ-–∫–æ–º–º–∏—Ç–Ω–æ, **–¥–µ–ª–∞–µ–º patch-—Ñ–∞–π–ª –Ω–∞ –∫–∞–∂–¥—ã–π –æ—Ç–¥–µ–ª—å–Ω—ã–π commit**, –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º –∏—Ö –ø–æ—Ç–æ–º –≤ –∏–∑–≤–µ—Å—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (_—Ç.–µ. –≤—ã —Å–∞–º–∏ –¥–æ–ª–∂–Ω—ã –∑–Ω–∞—Ç—å –≤ –∫–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ –∏–¥—É—Ç –ø–∞—Ç—á–∏_)
- (_—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±_) –ï—Å–ª–∏ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç **—Ç–æ–ª—å–∫–æ –∏—Ç–æ–≥–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ** –∏/–∏–ª–∏ –≤—ã –º–æ–∂–µ—Ç–µ/—Ö–æ—Ç–∏—Ç–µ –≤ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–∏ —Å–∞–º–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ commit-–∞–º (_–¥–µ–ª–∞—è —ç—Ç–æ —É–∂–µ –≤ arc –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ change list –∞—Ç–æ–º–∞—Ä–Ω–æ_) —Ç–æ –≤—ã –º–æ–∂–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å –æ–¥–∏–Ω –ø–∞—Ç—á –∏–∑ –≤—Å–µ—Ö commit-–æ–≤ –≤–∫–ª—é—á–∞—é—â–∏—Ö –≤–∞—à–∏ –Ω–∞—Ä–∞–±–æ—Ç–∫–∏

–î–∞–ª–µ–µ...
- –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –≤ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –ø—Ä–æ–µ–∫—Ç **marketfront** –≤ **arcadia**
- –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –≤ —Ç—Ä–∞–Ω–∫ –∏ –ø–æ–ª—É—á–∞–µ–º –∞–∫—É—Ç–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
```shell
arc checkout trunk; arc pull
 ```
- —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –≤–µ—Ç–∫—É –≤ **arc**, –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤–∞—à–µ–≥–æ –ø–∞—Ç—á–∞
```shell
arc checkout -b my-feature
```
- –ø—Ä–∏–º–µ–Ω—è–µ–º –ø–∞—Ç—á, –í–ù–ï–ó–ê–ü–ù–û **git**-–æ–º ‚Üí
```shell
git apply -p2 --reject --ignore-whitespace --ignore-space-change --unidiff-zero < {{—Ç—É—Ç –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –¥–æ —Ñ–∞–π–ª–∞ —Å —Ü–µ–ª–µ–≤—ã–º –ø–∞—Ç—á–µ–º}}
```
{% note tip %}

–í—Å—è–∫–∏–µ –¥–æ–ø.–∞—Ä–≥—É–º–µ–Ω—Ç—ã —Ç—É—Ç –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫ üòÄ ...

{% endnote %}
- PROFIT!!!

–ú–æ–∂–µ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—Ç–µ–π—Ç–µ **arc**

```shell
arc status
```

–î–∞–ª–µ–µ –∫–æ–º–º–∏—Ç–∏–º —É–∂–µ –≤ **arc** –∫–∞–∫ –≤–∞–º –±—É–¥–µ—Ç —É–¥–æ–±–Ω–æ/—É–≥–æ–¥–Ω–æ, –∫–∞–∫ —Ç–æ–ª—å–∫–æ "–Ω–∞–∫–æ–º–º–∏—Ç–µ—Ç–µ—Å—å" –≤–¥–æ–≤–æ–ª—å - –¥–∞–ª—å—à–µ –≤—Å—ë –ø–æ —à—Ç–∞—Ç–Ω–æ–º—É —Å—Ü–µ–Ω–∞—Ä–∏—é, —Å–æ–∑–¥–∞–µ–º PR, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ ship (code review) –∏ —Ç.–¥.

–ü—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ç—á–∞, **–º–æ–≥—É—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∏**, –Ω–∞–ø—Ä–∏–º–µ—Ä:
```shell
...
error: patch failed: SOME_FILE.js:1
error: removal patch leaves file contents
error: SOME_FILE.js: patch does not apply
...
```
–∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ —Ç–∞–∫–æ–µ –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –¥–ª—è —É–¥–∞–ª—è–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤, –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏, —á—Ç–æ –∫–æ–Ω—Ç–µ–Ω—Ç —É–¥–∞–ª—è–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –æ—Ç–∫—É–¥–∞ –≤—ã –¥–µ–ª–∞–ª–∏ –ø–∞—Ç—á –∏ –µ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç –≤ —Ç–µ–∫—É—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Ç—Ä–∞–Ω–∫–∞ - —É–∂–µ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è.
–£–≤—ã - —Ç–∞–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã –≤–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è –æ—Ç—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ä—É—á–Ω—É—é.

#### –ù–∞ –ø—Ä–∏–º–µ—Ä–µ
[https://github.yandex-team.ru/market/marketfront/pull/11306](https://github.yandex-team.ru/market/marketfront/pull/11306)

–í–µ—Ç–∫–∞ –Ω–∞ 3000+ –∫–æ–º–º–∏—Ç–æ–≤ –ø–æ–∑–∞–¥–∏ –º–∞—Å—Ç–µ—Ä–∞, + –µ—Å—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å –º–∞—Å—Ç–µ—Ä–æ–º

–í **–≥–∏—Ç–æ–≤–æ–º** –ø—Ä–æ–µ–∫—Ç–µ, –≤ –≤–µ—Ç–∫–µ 15 –∫–æ–º–º–∏—Ç–æ–≤ –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–¥–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏. –Ø —Ä–µ—à–∏–ª, —á—Ç–æ –Ω–µ —Ö–æ—á—É 15 –∫–æ–º–º–∏—Ç–æ–≤ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –∏ —Ö–æ—á—É –∑–∞—Å–∫–≤–æ—à–∏—Ç—å –∏—Ö –≤ –æ–¥–∏–Ω –∫–æ–º–º–∏—Ç –≤ –Ω–æ–≤–æ–π –≤–µ—Ç–∫–µ.

```shell
git checkout MARKETFRONT-77113-gemini
git fetch
git rebase origin/master
git format-patch HEAD~15..HEAD --stdout > MARKETFRONT-77113-gemini.patch
```

**–ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –≤ –ø—Ä–æ–µ–∫—Ç marketfront –≤ –∞—Ä–∫–∞–¥–∏–∏**
```shell
arc co trunk
arc pull
arc co -b MARKETFRONT-77113-gemini
```

–ü—Ä–∏–º–µ–Ω—è–µ–º –ø–∞—Ç—á:

```shell
git apply -p2 --reject --ignore-whitespace --ignore-space-change --unidiff-zero < /home/lengl/WebstormProjects/marketfront/MARKETFRONT-77113-gemini.patch
```

{% note info %}

–Ø —Å–æ–∑–¥–∞–≤–∞–ª –ø–∞—Ç—á –∏–∑ –ø–∞–ø–∫–∏ `~/WebstormProjects/marketfront` –∏ –ø—Ä–∏–º–µ–Ω—è–ª –ø–∞—Ç—á –≤ –ø–∞–ø–∫–µ `~/arc/arcadia/market/front/apps/marketfront`, –∏ —É –º–µ–Ω—è –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å (–ø–∞—Ç—á –ø—Ä–∏–º–µ–Ω–∏–ª—Å—è –∫—Ä–∏–≤–æ, —Ñ–∞–π–ª—ã –Ω–µ –Ω–∞—à–ª–∏—Å—å).
–ü–∞—Ç—á –ø—Ä–∏–º–µ–Ω–∏–ª—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ —è —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É –≤—ã–ø–æ–ª–Ω–∏–ª –≤ –ø–∞–ø–∫–µ `marketfront/market` (`~/arc/arcadia/market/front/apps/marketfront/market`)

–ü–æ—á–µ–º—É —Ç–∞–∫ (–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –æ—Ç [@ruvata](https://staff.yandex-team.ru/ruvata34)): 

‚Üí —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω–∏—è **git**-–ø–∞—Ç—á–∞ (*–≤ —Ç.—á. –ø—Ä–µ—Å–µ—Ç—ã IDE –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–æ–µ–∫—Ç–∞, –µ—Å–ª–∏ –≤—ã –¥–µ–ª–∞–µ—Ç–µ –ø–∞—Ç—á –∏–∑ UI –≤–∞—à–µ–π IDE*), —Ç–∞–∫-–∂–µ –º–æ–≥—É—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ **git** –∏ —Ä–µ–∑–æ–ª–≤–∏–Ω–≥–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è **\$HOME** / **\$WORKDIR** / **\$GIT_DIR** (*–º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞–∑–Ω—ã–µ —á–∞—Å—Ç–Ω—ã–µ —Å–ª—É—á–∞–∏*) -

–ò–∑-–∑–∞ —á–µ–≥–æ –≤ —Ñ–∞–π–ª–µ –ø–∞—Ç—á–∞ –±—É–¥—É—Ç —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å—Å—è —Ä–∞–∑–Ω—ã–µ —Ü–µ–ª–µ–≤—ã–µ –ø—É—Ç–∏ **diff**-–∞ –∫ —Ñ–∞–π–ª–∞–º

–í –≤—ã—à–µ—É–∫–∞–∑–∞–Ω–Ω–æ–π –∫–æ–º–º–∞–¥–µ –µ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä ``-p2`` –æ–Ω –∫–∞–∫ —Ä–∞–∑ –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫—É –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º, —É–∫–∞–∑—ã–≤–∞—è –∫–∞–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ "—É—Ä–æ–≤–Ω–µ–π" –Ω–∞–¥–æ –æ—Ç—Å–µ—á—å –æ—Ç –ø—É—Ç–∏ (–∏–∑ —Ñ–∞–π–ª–∞ –ø–∞—Ç—á–∞) –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ç—á–∞ –∫ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä—Ä–µ–∫—Ç–æ—Ä–∏–∏.

–ï—Å–ª–∏ –≤ –≤–∞—à–µ–º —Å–ª—É—á–∞–µ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –ø—Ä–∏–º–µ–Ω–∏—Ç—å –ø–∞—Ç—á —Å ``-p2`` –≤–∞–º —Å—Ç–æ–∏—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å ``-p1`` –∏–ª–∏ –≤ –æ—Å–æ–±–æ —ç–∫–∑–æ—Ç–∏—á–µ—Å–∫–∏—Ö —Å–ª—É—á–∞—è—Ö ``-p0`` / ``-p3``

{% endnote %}


```shell
arc commit
arc push -u users/lengl/MARKETFRONT-77113-gemini
arc pr create
```


–ï—Å–ª–∏ –±—ã —è —Ä–µ—à–∏–ª –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –ø–æ–∫–æ–º–º–∏—Ç–Ω–æ, –±—ã–ª–æ –±—ã

```shell
git format-patch -15 HEAD
```

–ò —É –º–µ–Ω—è –±—ã–ª–æ –±—ã 15 —Ñ–∞–π–ª–æ–≤ –ø–∞—Ç—á –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –Ω–∞–¥–æ –±—ã–ª–æ –±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏ –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∞—Ä–∫–µ.
