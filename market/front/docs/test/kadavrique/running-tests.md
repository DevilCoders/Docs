# Запуск тестов с Кадавриком

**Важно! Запуск тестов необходимо проводить под NodeJS v16!**

Для того, чтобы при прогоне автотесты ходили в Кадаврик, необходимо сконфигурировать правильно их запуск.

По умолчанию автотесты будут ходить на один из общих серверов - [подробнее тут](https://a.yandex-team.ru/arc_vcs/market/front/apps/kadavrique/plugin/index.js?rev=r9319959#L8).

## Настройка запуска приложения

Не требуется. Достаточно просто его запустить сервер.

## Настройка запуска тестов (на примере marketfront)

Шаги 2-8 можно выполнять со своего рабочего ноута (так будет даже лучше - меньше нагрузки на logrus).

1. [Запускаем Кадаврик](https://docs.yandex-team.ru/marketfront/test/kadavrique/start), если планируется разработка новых тестов.
2. Включить поход тестов в Кадаврик: `export KADAVR=1`.
3. Указать адрес нужного Кадаврика (например, вашего на логрусе): `export KADAVR_HOSTS="<host1>:<port1>"`. Указывать без протоколов http, https и т.д.
4. Указать энву TUS_OAUTH_TOKEN. Что такое TUS - см [сюда](https://wiki.yandex-team.ru/test-user-service). Токен можно получить [тут](https://oauth.yandex-team.ru/authorize?response_type=token&client_id=9052de6e4cf142039a7ee44ac03e4614)
5. При необходимости донастраиваем ginny конфиг в платформенной папке, например: `market/platform.desktop/configs/development/ginny.conf.js`. В `baseUrl` можно проставить урл развернутого маркетфронта (например, на логрусе). В `mochaOpts` в параметр `fgrep` можно проставить название или часть названия теста для запуска.
6. Запускаем selenium: `npm run selenium` из папки `market`.
7. Запустить тесты (например, `make autotest`).
8. Если вы получаете ошибку `is unavailable atm`m то попробуйте прокинуть переменную, которая увеличит время запроса в кадаврик - `export KADAVR_IS_HOST_UP_TIMEOUT=20000`.
