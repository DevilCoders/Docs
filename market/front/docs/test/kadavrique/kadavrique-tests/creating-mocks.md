# Создание мока

После того, как стало ясно, какой бекенд и как вызывается, можно приступать к написанию мока (если он еще не написан).

## Шаги по написанию мока

### Изучить работу бекенда

Понять, какие данные должен возвращать мок и исходя из какой логики. Какого-то универсального рецепта здесь нет - необходимо исходить из предметной области бекенда и логики работы реального запроса.

### Написать класс мока и его методы

Пример реализации класса мока:
```javascript
const Mock = require('../lib/Mock');

class MyMock extends Mock {
  constructor(state) {
    // Конструктор мока принимает объект стейта текущей сессии.
    super(state);
  }

  // Все методы мока принимают два аргумента — объекты запроса и ответа.
  getShopById(request, response) {
    // Из метода можно получить стейт сессии через свойство экземпляра state:
    return this.state.get(`shops.${request.params.shopId}`);
  }
}
```

### Задекларировать мок

Необходимо указать в [конфиге](https://a.yandex-team.ru/arcadia/market/front/apps/kadavrique/options/mocks.js) новый мок. Для этого нужно добавить туда объект с ключами:

- `class`: Ссылка на класс мока.
- `hosts`: Массив хостов реального бекенда.
- `routes`: Массив роутов. Каждый роут описывает какой-либо метод мока. Имя роута соответствует имени этого метода.

Например:
```javascript
{
  class: require('../mocks/MyMock'), // Ссылка на класс
  hosts: ['mymock.tst.vs.market.yandex.net'], // Хост реального бекенда
  routes: [{ // Роут для метода
    name: 'getShopById', // Имя метода класса
    data: {method: 'GET'}, // Параметры запроса
    pattern: '/mymock/getShopById', // Путь запроса
  }],
}
```

Таким образом в кадавризированном тесте `GET`-запрос к серверу `mymock.tst.vs.market.yandex.net` по пути `/mymock/getShopById` будет перенаправлен в Кадаврик и вызван метод `getShopById` написанного мока `MyMock`.
