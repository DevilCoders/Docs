# Arcadia Flow

Прежде Фронтенд Маркета использовал `git` и GitHub. Теперь весь код лежит в Arcadia (внутренняя альтернатива `git`), а используемый интерфейс — Arcanum (внутренняя альтернатива GitHub).

- [Документация Аркадии](https://docs.yandex-team.ru/devtools)
- [Документация Арканума](https://docs.yandex-team.ru/arcanum)
- [Команды Arc](https://docs.yandex-team.ru/arc/ref/commands)

Внешне обе технологии похожи на `git` и `Arcadia`, поэтому если вы знакомы с этими технологиями, сложностей возникнуть не должно.

## Разработка в Аркадии

Разработка проекта предполагает наличие постоянной ветки `trunk`, а также произвольного количества веток.

{% note info %}

Ветки в Аркадии бывают пользовательскими или групповыми. В случае пользовательских веток другой коллега не сможет долить коммит в персональную ветку другого коллеги.

{% endnote %}

{% note info %}

В Аркадии нельзя сделать мерж не в `trunk`. Как следствие, нельзя отбранчеваться от пользовательской ветки и сделать пулл-реквест туда.

Мерж сделать нельзя. Можно сделать ребейз.

{% endnote %}

## Правила работы с ветками

1. В ветку `trunk` разрешено мержить коммиты только роботу. Для мержа веток необходим релизный механизм.
2. Ветка `trunk` должна всегда находиться в состоянии deployable, т.е. содержать только рабочий протестированный код.
3. Каждая задача или багфикс(ы) делаются в отдельной ветке. Имя ветки должно содержать айдишник тикета и необязательное название, например: `MARKETFRONT-12345-card-redesign`.
4. Код, залитый в Arcadia, считается общим, поэтому имена веток и коммит-месседжи должны быть структурированными и человекопонимаемыми. Каждый коммит-месседж должен содержать номер тикета.
5. Merge из `feature`-ветки в `trunk` осуществляется только для фичей/багов, запланированных к следующему релизу. Для этого необходимо:
  - Актуализировать feature-ветку оносительно `trunk`.
  - Провести тестирование задачи на автоматически созданном демо-стенде. Вручную стенд поднять можно в ЦУМе.
  - Совместно с тестировщиком принять решение о необходимости проведения регресс-тестов в ветке.
  - После одобрения задачи к релизу отправить заявку релиз-мастеру с указанием PR.

## Групповые ветки

Все наши обычные ветки для PR создаются с префиксом `users/<username>/test/MARKETFRONT-...` - префикс это `users/<username>/`, где `<username>` - имя пользователя.
Нельзя менять ветки другого пользователя.

Для того чтобы иметь возможность разрабатывать что-то вместе или объединять ветки можно использовать Групповые ветки.

Групповые ветки для фронта имеют префикс `groups/marketfront/`, на ветки с таким префиксом есть доступ у [всего фронтенда Маркета](https://abc.yandex-team.ru/services/yandexmarketfrontend/).

Для создания подобных веток нужно запросить доступы в IDM:

- [Prefix Admin](https://idm.yandex-team.ru/group/173893/roles#f-status=all,sort-by=-updated,f-is-expanded=true,f-role=arc-vcs,role=68072871) - для выдачи прав на префикс
- [Create](https://idm.yandex-team.ru/group/173893/roles#f-status=all,sort-by=-updated,f-is-expanded=true,f-role=arc-vcs,role=68074614)
- [Fast Forward Push](https://idm.yandex-team.ru/group/173893/roles#f-status=all,sort-by=-updated,f-is-expanded=true,f-role=arc-vcs,role=68074617)
- [Force push](https://idm.yandex-team.ru/group/173893/roles#f-status=all,sort-by=-updated,f-is-expanded=true,f-role=arc-vcs,role=68074611)
- [Delete](https://idm.yandex-team.ru/group/173893/roles#f-status=all,sort-by=-updated,f-is-expanded=true,f-role=arc-vcs,role=68074613)

### Как использовать групповые ветки

{% note info %}

С точки зрения релизной машины фронта Маркета групповые ветки ничем не отличаются от пользовательских.

Точно так же создаётся PR в транк, все проверки проходят, после релиза PR мёржится в транк.

В блейме конечно же будет только автор PRа.

Пример: https://a.yandex-team.ru/review/2639224/details

{% endnote %}

- создаем ветку как обычно - `arc co -b feature/MARKETFRONT-...`
- cherry-pick'ом переносим коммиты из нужных веток
- пушим в групповую ветку - `arc push -u groups/marketfront/feature/MARKETFRONT-...`
- в такую ветку может коммитить/пушить любой фронт
