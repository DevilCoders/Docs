# Код-ревью

## Автору пул-реквеста

1. После завершения разработки задачи (или целостной функциональности в рамках крупной задачи), тебе нужно провести код-ревью. Не торопись переводить тикет в статус Resolved.
2. Опубликуй пулл-реквест в Arcanum во всех репозиториях, где необходимо код-ревью. Заголовок PR должен начинаться с названия тикета `MARKETFRONT-12345: Короткое описание` чтобы он подцепился в тикет.
3. После того как Pull Request был создан и ревью начато, задача будет переведана в статус Need Code Review.
4. В интерфейсе Арканума можно указать ревьюверов, иначе они будут выбраны автоматически.
5. Жди результатов код-ревью, вноси правки по замечаниям, доводи задачу до состояния, когда "QA-Reviewer" одобрит её к дальнейшим этапам.
6. Если "QA-Reviewer" отписался в комментах задачи, что "все ОК", это означает, что код-ревью пройдено успешно и задача готова к дальнейшим этапам.
7. Если "QA-Reviewer" запросил изменения, то после исправления верни задачу в ревью, тогда ревьюверу придет уведомление, а статус ревью изменится.
8. Если получено уже 2 ОКа (ships), но при этом есть еще ревьювер, который поставил неОК, то нужно добиться ОКа от всех ревьюверов.
9. Статус `Resolved` комментариям выставляет ревьювер.
10. Пул-реквесты не следует делать слишком большими (>1000 строк изменений). Ревьвер может попросить (а лучше если еще и посоветует как) разбить PR на части.

## QA-Reviewer / ответственный ревьювер

SLA на ревью 1 рабочий день.
1. Если тебе выпала роль "QA-Reviewer" (ответственного ревьювера), то для начала нужно настроить фильтр тех задач, которые стоят в ожидание твоего ревью. [Просто скопируй это и сохрани в ST](https://st.yandex-team.ru/filters/filter?query=Followers%3A%20me%28%29%20QA-Reviewer%3A%20me%28%29%20Status%3A%20%22Need%20Code%20Review%22).
2. Также информация о изменениях статусов задача будут падать к тебе на почту.
3. После проведения ревью необходимо сообщить свой вердикт разработчику. Для этого оставь комментарий в PRе, измени его статус:
  - если ревью прошло успешно, то используй кнопку апрува в интерфейсе Арканума;
  - если ревью прошло неуспешно, то используй кнопку блокировки мержа в интерфейсе Арканума, разработчик увидит замечания, а ты готовься к прохождению процедуры сначала;
  - если комментариев было оставлено несколько, то укажи, какие из них критичные для получения апрува, а какие - миноры.
4. Для ускорения процесса ревью, у нас есть договоренность, что нельзя оставлять кодревью в "подвешенном состоянии".
  - Если нет возможности в ближайшее время провести ревью, то попроси автора заменить тебя
  - Если начал ревьювить, то обязательно надо вынести вердикт ок/неок. Если все замечания минорные, то можно окать, и попросить автора внести исправления.
5. Если вопрос решен, то обсуждению надо выставить статус `Resolved`.

## Как резолвить открытые обсуждения ревьюров

Это рекомендации, не регламент, в мелких PR с маленьким количеством не критичных обсуждений (2-3) толку от нижеизложенного будет немного, используем здравый смысл.
1. Автору в каждом открытом обсуждении в PR следует написать резолюцию. Если не согласен с замечанием, конструктивно написать почему. Это помогает автору не упустить замечания - могут быть 2 отдельных на одну строчку, бывают случаи когда какие-то замечанию не обрабатываются просто потому, что Outdated замечания после очередной правки попросту "сворачиваются", привычка писать резолюцию помогает избегать таких случаев
2. Ревьюеру следует резолвить те обсуждения, с резолюцией которых он ознакомлен и согласен. **Внимание:** галочки в замечаниях не для автора PR, а для автора обсуждения. Использование резолва обсуждений автором облегчает жизнь и автору и ревьюерам, потому что именно эти обсуждения не надо разворачивать при очередном "раунде" ревью, чтобы убедиться, что замечание обработано. Ревьюеру лучше ставить ok PR-у, после резолва всех своих открытых обсуждений, чтобы тоже чего-то не пропустить


## Внешний ревьювер

1. Если есть время поревьювить, бегай по Pull Request (или по специальным приглашениям) и пиши полезные замечания в Аркануме, также на основание твоих замечаний "QA-Reviewer" будет делать выводы, можно ли задачу считать прошедший код-ревью.

## Полезности

- [@ya_arcanum_bot](https://t.me/ya_arcanum_bot) — Очень полезный бот в телеграме, который присылает изменения статусов ревью.
- [Дашборд](https://developer-dashboard.yandex-team.ru) со всем ревью, в которых ты автор или ревьювер.
- [Фильтр](https://st.yandex-team.ru/filters/filter?query=Followers%3A%20me%28%29%20QA-Reviewer%3A%20me%28%29%20Status%3A%20%22Need%20Code%20Review%22) тех задач, которые стоят в ожидание твоего ревью.
