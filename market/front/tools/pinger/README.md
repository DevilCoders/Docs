# Pinger

## Использование

### Запуск

Скрипт: `run.bash`.

Аргументы:

-   `--help` - выводит справку
-   `--dataTable` - часть пути для таблицы с данными вики, без домена, например: '/testirovanie/functesting/market/marketservice/autotests/testdata/pinger/partnerweb'
-   `--baseUrl` - базовый url тестов
-   `--output` - Путь для сохранения отчета. Абсолютный или относительно запущенного процесса. Имя файла опционально (по-умолчанию `pinger-report.json`)
-   `--log` - Следует ли выводить в консоль логи результатов в процессе прогона
-   `--headless` - включает/выключает headless режим
-   `--instances` - Количество одновременно запущенных инстансов браузера
-   `--retries` - Количество перезапусков теста при ошибке
-   `--defaultTimeout` - Таймаут по умолчанию. Применяется к каждой проверке.
-   `--urls` - Урл тестов которые нужно проверить. Метод search. Если не указано проверяет все.
-   `--name` - Имена тестов которые нужно проверить. Строгое соответствие. Можно указывать несколько раз. Если не указано проверяет все.
-   `--logLevel` - trace|debug|info, уровень вывода отладочной информации (не результатов, для их просто --log)

Все аргументы опциональны. Дефолтные значения берутся из конфига.

### Пример

```bash
$ ./run.bash --dataTable='testirovanie/functesting/market/marketservice/autotests/testdata/pinger/partnerwebmanagers' --name='Менеджерский раздел' --name='Лог партнерского апи'
```

### Конфиг

Расположение: `__data__/config.json`.

Поля:

-   `suiteRemapScheme` - описывает ремап заголовков wiki-таблицы в поля TestParams
-   `defaultArgs` - дефолтные аргументы скрипта

## Структура кода

-   `runPinger.ts` - функция запускающая пингер
-   `getTestParams.ts` - функция запрашивающая и подготавливающая все TestParams
-   `runTest.ts` - функция прогоняющая тест
-   `cache.ts` - кэш приложения
-   `report.ts` - формирование и сохранение финального отчета
-   `types.ts` - общие типы
-   `constants.ts` - общие константы
