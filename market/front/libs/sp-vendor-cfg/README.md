# sp-vendor-cfg
Конфиги для спец. проекта вендоров

# Как пользоваться

## Установка (только 1 раз)
1. Получаем права на чтение-запись на s3mds здесь
https://wiki.yandex-team.ru/users/crewman/Jandeks-Market-S3-mds/

2. Создаем два профиля aws: `production` и `development`

3. `npm ci` установка необходимых пакетов

## Запуск генератора

1. `next dev --- запуск тестового генератора, работает с тестовым s3.mdst`
`ENV=production next dev --- запуск продового генератора, работает с продовым s3.mds`

2. Идем `http://localhost:3000`

### Принцип: 

1. Кампании с инструментами заполняются в CMS. Материал называется Маркет Кампания
2. Тут забираем Кампании оттуда, обрабатываем и сохраняем в s3

В s3 есть 2 пространства: preview/public. Сохраненные Кампании в CMS попадают в preview. Опубликованные в public.

### Разработка:

У каждого инструмента есть описание в трех местах:

1. В CMS-схемах
2. В этом проекте (их два)
3. На фронте

Тут нужно понимать, что в генераторе имеются сразу 2 описания одного инструмента. Первый консистентный с CMS-описанием,
а второй с описанием на фронте. Генератор как раз занимается конвертацией с первого типа на второе.
Выглядит так:
```
 -------                      ---------------                    -------
|       |                    |               |                  |       |
|  CMS  | --> CMSFeature --> | sp-vendor-cfg | --> Feature ---> | Front |
|       |                    |               |                  |       |
 -------                      ---------------                    -------
```
 !!! Важно схемы в CMS <-> CMSFeature, Feature <-> схемы на фронте держать в консистентности.

#### Версия проекта

При каждом изменении в коде важно поднимать версию, и загружать новые docker-image в регистр.
Для этого после поднятия версии, достаточно выполнить
```
sudo npm run upload-production
```
