# swagger-diff-checker

Сравнивает две swagger-схемы (по умолчанию /v2/api-docs от MBI и market/partner-swagger-versions/swag.json из github, см. src/staff/config.ts).

Если будут найдены критичные с нашей точки зрения изменения, процесс завершится с ненулевым кодом и описанием критичных изменений в консоли.

Функции поиска критичных изменений лежат в src/rules.

## Архитектура

Библиотека скачивает две swagger-схемы и передаёт их и список типов критичных изменений в утилиту для сравнения.
Утилита для сравнения сама получает дифф двух схем и по списку типов критичных изменений возвращает описание
найденных критичные изменения. Получив список найденных критичных изменений, библиотека завершает процесс
с нулевым (критичных изменений нет) или с ненулевым кодом (критичные изменения есть).

Таким образом, приложение состоит из двух "слоёв": внешний слой скачивает swagger-схемы, передаёт их
во внутренний слой для сравнения схем и обрабатывает результат сравнения, внутренний слой
получает две схемы, сравнивает их и генерирует отчёт о результате сравнения. Логика сравнения схем
и генерации отчёта инкапсулирована во внутреннем слое, позволяя минимизировать код, который нужно
изменить при замене библиотеки сравнения swagger-схем (сейчас используется
[swagger-diff](https://github.com/civisanalytics/swagger-diff)).

## Типы критичных изменений

См. src/rules.

## Start

Для запуска детектора изменений нужно выполнить

```bash
npm start
```

## Test

Для запуска тестов нужно выполнить

```bash
npm test
```

## Env settings

Опционально можно задать настройки через переменные среды
- SWAGGER_SPEC_URL_LEFT - урл до базового описания Swagger-схемы
- SWAGGER_SPEC_URL_RIGHT - урл до проверяемого описания Swagger-схемы
- EXCLUDED_CHECKS - проверки, которые нужно отключить, через запятую, см. src/rules/*.ts имена в ```rule```.

## Сборка и деплой

### Перед сборкой

Выполните ```npm login``` и залогиньтесь в npm.yandex-team.ru.

### Сборка и деплой

Выполните ```npm publish``` - сборка и деплой пройдут автоматически.
