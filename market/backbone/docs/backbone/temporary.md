# Буфферная зона
Буферная зона – это два сервиса переходного периода: Frontend Adapter & Backend Adapter, которые выполняют трансформацию API между старым и новым форматом.

**Frontend Adapter** выставляет всем фронтендам Маркета (Frontend, FAPI, CAPI, ...) API в старом формате, т.о. не потребуется править логику на стороне фронтов. Запрос проксирует в два сервиса: старый бекенд и новый бекенд, далее смерживает ответы в старом формате. Будет удален в целевой архитектуре.

**Backend Adapter** выставляет агрегированный (собранный под один сервис) новый интерфейс, вызовы которого трансформирует к существующим старым бекендам (Репорт, Каталогер и т.п.). Будет оставлен в целевой схеме.

[miro](https://miro.com/app/board/uXjVOePqSzs=/?moveToWidget=3458764519760220412&cot=14)
![](../_assets/buffer_zone.png)

Профиты:
1. **Независимость разработки фронтенда и бекенда** – вынос новых микросервисов во слое фронтенда и бекенда зависят только от правок в адаптерах, что должно быть тривиально (просто перекладывание полей)
2. **Быстрый профит от выноса новых микросервисов** – новые микросервисы с обеих сторон могут быть сразу же быть подведены под нагрузку с получением профита по ТТМ, Стабильности и Эффективности. ТТМ обеспечивается более быстрой разработкой в микросервисе, а не в текщих монолитах, Стабильность обеспечивается возможностью частичного формирования ответа фронтенду (если монолит сдох, а микросервисы ответили), Эффективность обеспечивается снятием нагрузки с монолита и переводом ее на более мелкие сервисы, репликация которых требует меньше ресурсов.

Недостатки:
1. **Снижение эффективности в переходный период** – Backend Adapter возможно будет делать больше запросов в легаси бэкенд, чем нужно, чтобы заполнить ответ по новому формату, Frontend Adapter наряду с запросом в легаси бэкенд, также будет делать запросы в новый сервис.

## Процесс калибровки бизнес-метрик
При разделении сценариев на продуктовый (fastbone) и инфраструктурный (backbone) возникает проблема просадки бизнесовых метрик (кол-во заказов), влияющих на цели инфраструктуры (Стабильность) при использовании голого Backbone, т.к. Backbone лишен большинства фичей, присущих Fastbone-у.

Предлагается решить эту проблему внедрением следующего процесса:
- каждый квартал команда инфраструктуры запускает эксперимент, заключающийся в сравнении бизнес-метрик между backbone- и fastbone-сценариями (разные rearr-флаги)
- если бизнес-метрики отличаются больше, чем оговоренная с бизнесом дельта, то команда инфраструктуры запускает проекты для "подтягивания" бизнес-метрик: создание новых backbone-сервисов, обновление различных формул от бизнеса и т.п.
