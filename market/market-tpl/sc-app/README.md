# sorting-center-android

Это исходники приложения Сортировочных Центров для Android

## Установка

1. Register your SSH key on Staff

2. Скачать Android Studio (не ниже 4.1.1)

3. Запустить сборку главного можуля `app` через ide или написать в консоли `./gradlew`

4. Установить сертификат на эмулятор или устройство [YandexInternalRootCA](https://nda.ya.ru/3S7n2k)

## Полезная информация

В директории `app/docs` есть дополнительная информация, которая может быть полезна для более
глубокого понимания кода приложения.

* [Особенности архитектуры](./app/docs/architecture.md)
* [Особенности реализации](./app/docs/implementation.md)

## Именование сборок

В данный момент мы поддерживаем 2 типа устройств

* camera: смартфоны
* tsd: ТСД Zebra, ТСД Honeywell, ТСД M3

и 3 вида сборок

* debug: локальные сборки на тестовых устройствах разработчиков или эмуляторах
* qa: сборки для тестировщиков, загружаются в beta, можно выбрать тестовое или продовое окружение
* release: сборки для выкладки пользователям, локально не собираются

Выбрать/сменить комбинацию (тип устройства + сборка) можно в нижней правой панели (Build Variants)

При обновлении ПР (покоммитный пайплайн) автоматически генерируются сборки для каждого типа
устройств, загружаются в beta и ссылки прикрепляются в тикет. Если этого не происходит, но при этом
проект собирается локально -- проверьте unit-тесты

Версионирование приложения идет по схеме |major.minor.patch| При каждом релизе поднимаем minor
версию и versionCode в gradle файле(не забываем скидывать patch до 0)
, при необходимости фиксов поднимаем patch версии и versionCode
(NB: Android устройства не могут обновиться на более низкий versionCode, чем текущий)

## Development pipeline

Мы придерживаемся подхода [trunk based development](https://trunkbaseddevelopment.com).

Основные принципы можно лаконично сформулировать следующим образом:

* существует только одна ветка `master`; ветка `develop` отсутствует
* вечнозелёный `master`: на любом коммите из этой ветки приложение должно работать
* долго-живущих feature-веток у нас нет. Мы стараемся максимально быстро влиться в `master`, не
  ломая его
* pull request'ы должны быть небольшими и частыми
* ревью pull request'ов следует выполнять по принципу as soon as possible, не задерживая коллегу,
  который этот реквест создал
* коммиты внутри реквеста должны быть атомарными: один коммит = одно изменение

Message для коммита должен соответствовать
следующему [паттерну](https://www.conventionalcommits.org/):

Ex:
`fix(scannerBottomSheet): flash toggle for camera devices`

## AppMetrica

Дебаг и релизное приложение ходит в разную AppMetrica, чтобы не засорять события
[Dev](https://appmetrica.yandex.ru/statistic?appId=3813721)
[Prod](https://appmetrica.yandex.ru/statistic?appId=3813709)

## AT

Локальный Allure отчет после прогона тестов
`./gradlew allurePull allureReport allureServe`


