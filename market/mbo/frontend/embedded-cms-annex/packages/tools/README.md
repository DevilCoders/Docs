# `tools`

> Пакет с набором dev хелперов

Что уже есть:
- DeployS3 - Загрузка булдов в S3

TODO:
- nodejs server - Вынести сервер с pm2 из cms-front сюда.


## DeployS3
Имеет 2 основных метода:
- `collectBuildFilesByPath`
- `deploy`

Оба метода являются ассинхронными. Если запустить `deploy` во время `collectBuildFilesByPath`
последствия непредсказуемы.

Первоначальный шаг создание инстанса DeployS3. В конструктор он принимает `bucket`, `url`(полный домент 
без http приставки, в случае яндекса к примеру s3.mdst.yandex.net), `certPath`(опциональны,
путь до сертификата. Нужен только при деплое в тестинг), `options`
(объект. Значение по умолчанию isProd: false. Если false, то подставляется https нодовский
агент с указанным сертификатом, если true оставляет дефолтную конфигурацию s3, которая работает с
s3.mds.yandex.net)

После нужно подгрузить папку с абсполютовым путем которую нужно выложить (метод `collectBuildFilesByPath`)
И запустить deploy. В результат deploy возвращается промис со всеми загруженными и удаленными файлами.

Выкладка осуществляется без downtime. Т.е. сперва заливаются ассеты, потом подменяются html-ки и в конце
удаляются старые ассеты смаченные по загруженным. Желательно все html-ки хранить в корне build папки.
