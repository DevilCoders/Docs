# Внутреннее устройство МДМ

## Кратко о команде

В МДМе команда состоит не только из разработчиков, есть и другие роли.

- Дата-стюарды (ДС) — аналитики качества данных. Строят запросы и рисуют метрики по различным критериям. Например, насколько сильно ожидаемые мастер-данные в А отличаются от реальных в Б. Основные пользователи наших UI. Нередко выступают в роли бизнес-заказчиков, либо в роли "переговорщиков" с более удалёнными от нас заказчиками, ибо лучше всех понимают, как всё устроено. Многие проблемы и расхождения в данных умеют решать собственными силами без разработки. Золото, а не люди.
- Техлид — инициатор или аппрувер технических решений, мастер по груммингу бэклога, представитель контура с технической стороны при верхнеуровневой проработке проектов, куратор разработки и инцидентных активностей, может выделять юнитов рамочкой и отправлять строить зиккураты.
- Руководитель контура — фактически, основной драйвер продуктового развития контура, "самый главный дата-стюард". Активно участвует в постановке и проработке новых проектов.
- Разработчик — мастер на все руки. Может добывать золото и рубить лес, а также строить новые здания и ремонтировать поврежденные. При необходимости способен взяться за оружие, записавшись в дежурство. Производится в Ратуше.

  ![Разработчик](../../_images/mdm_internals_1.png "Разработчик" =32x32)

Более скрупулёзное и детализированное описание ролей можно прочитать [тут](../../contour/team/roles.md).

## Старый и новый МДМы {#old_new_mdm}

Наш сервис условно состоит из двух блоков. Это *старый* МДМ, написанный на Java, в котором пока живёт почти вся бизнес-логика, и новый (*большой*) МДМ на Kotlin, в котором живут некоторые хранилища, схема данных и новые развивающиеся UI для дата-стюардов.

### Старый МДМ

[Путь в Аркадии](https://a.yandex-team.ru/arc/trunk/arcadia/market/mbo/mbo-category), к проекту МДМ относятся модули:

```
mbo-mdm
mbo-mdm-common
mbo-mdm-db
mbo-mdm-integration-tests
mbo-mdm-tms
mboc-base (общий с КИ)
mboc-db (общий с КИ)
```

{% note warning %}

Исторически МДМ задумывался как небольшой кусочек функциональности в Категорийном Интерфейсе. Тогда никто не знал, как глубока эта кроличья нора. Поэтому сейчас старый МДМ до сих пор живёт в одной папке с кодом КИ. Мы двигаемся в сторону отделения, просьба понять и простить.

{% endnote %}

Что в нём происходит:

- Приём серебра
- Варка золота
- Раздача потребителям
- Хранение данных в PostgreSQL
- Бэкенд для UI-редакторов [SSKU](https://mdm-testing.market.yandex-team.ru/mdm/ssku/), [MSKU](https://mdm-testing.market.yandex-team.ru/mdm/msku), категорийных настроек и дерева [ТН ВЭДов](https://mdm-testing.market.yandex-team.ru/mdm/tnved-categories)

То есть практически вся бизнес-логика живёт именно там. Весь код пишем на Java. Описанные выше процессы чаще всего реализуются как потоковая фоновая обработка, либо как запускающиеся по крону джобы.

### Новый "большой" МДМ { #bmdm }

[Путь в Аркадии](https://a.yandex-team.ru/arc/trunk/arcadia/market/mbo/mdm)

Также часто называем его "БМДМ". Что в нём происходит:

- Хранение данных в Yt
- Создание и редактирование схемы метаданных в [Конструкторе](https://mdm-testing.market.yandex-team.ru/constructor/mdm-entity-types/0)

  *Этот интерфейс позволяет создавать новые типы сущностей в нашей системе или менять атрибуты существующих. Речь идёт именно об описании сущностей. То есть, мы можем добавить на тип сунощности SSKU числовой атрибут "размер ноги", и теперь во всех SSKUшках Маркета мы сможем заполнять чиселками это новое поле.*

- Поиск и редактирование самих данных через [АРМ](https://mdm-testing.market.yandex-team.ru/arm) — рабочее место дата-стюарда.
- Слой авторизации для всего UI, включая UI старого МДМа
- Аудит (история изменения) данных

При этом в отличие от монолитного старого МДМ, под каждый блок функциональности выделен свой микросервис.

![Микросервисы БМДМ](../../_images/mdm_internals_2.png)
