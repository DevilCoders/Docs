# Общая информация по дежурствам МДМ

[График дежурств](https://abc.yandex-team.ru/services/mbo-mdm/duty/)

Раз в несколько месяцев разработчик МДМ заступает на недельное дежурство. В обязанности дежурного входит:

- Следить за мониторингами и поддерживать сервисы МДМ в рабочем состоянии
- Реагировать на запросы и вопросы в Хотлайне
- Следить за графиками очередей и реагировать на проблемы с очередями
- Курировать инцидентные активности и решать эти инциденты
- Быть на связи, отвечать на звонки Железной Тёти

{% note info %}

Железная Тётя (ЖТ) - робот, звонящий на мобильный телефон со staff дежурному в случае срабатывания критических мониторингов. Если вам позвонила ЖТ, выберите опцию "остановить эскалацию" (обычно это цифра 4) и проверьте мониторинги МДМ. Действуйте по обстоятельствам.

{% endnote %}

Обычно после завершения "горячего" недельного дежурства следует так называемое "ниндзя-дежурство", когда разработчик пребывает в тени и спокойно без нервов попиливает баги из бэклога поддержки. Ниндзя не обязан реагировать на звонки, графики и мониторинги, но в случае крупных инцидентов или большой загрузки основного дежурного может быть переброшен в помощь на горящую проблему. В остальном ниндзя мало чем отличается от обычной проектной деятельности, поэтому дальше речь пойдёт только об основном дежурстве.

## Чеклист перед началом дежурства

1. Проверьте, что работают [подключения](../../db/db_connect.md) ко всем окружениям в БД.
2. Размьютьте чаты [Мониторинги MDM](https://t.me/joinchat/IKQtVUvYhTKtFTa-czrung), [MDM Hotline](https://t.me/joinchat/F3u32P1OHaM66Vye)
3. Разблокируйте на телефоне номера ЖТ
4. Запиньте и проверяйте [метрики очередей](https://grafana.yandex-team.ru/d/j-XNxOpGz/market-mbo_mdm_production) МДМ
5. Запиньте и следите за срабатыванием новых [мониторингов](https://juggler.yandex-team.ru/dashboards/mdm/)
6. Создайте свежий дежурный тикет по аналогии с предыдущими под [общим тикетом](https://st.yandex-team.ru/MBO-28541)
7. Обсудите приоритетные задачи с предыдущим дежурным

## Чеклист по курированию инцидентов

В Маркете есть специальная команда ответственных за инциденты. По сути от дежурного МДМ требуется просто создать чат, призвать туда текущего Инцидентного Менеджера (ИМ) и создать заготовку инцидентного тикета. Для большинства этих действий написан телеграм-бот, упрощающий рутинные операции.

Последовательность действий:
1. Создаём чат в ТГ
2. Добавляем в чат [бота](https://t.me/MarIncABot), делаем его суперадмином
3. Создать инцидентный тикет командой `/create_ticket`
4. Командой `/im_onduty` выводим список дежурных Инцидентных Менеджеров (ИМ). Добавляем ИМ в чат.
5. Командой `/status [текст]` передаём текст в тикет для фиксации статуса работы с инцидентом (крайне полезно для подготовки к ARR и защите на еженедельной встрече по инцидентам).

Далее советуемся с коллегами и действуем по обстоятельствам. Не забывайте время от времени репортить в тикет статусы, с терпением относитесь к негодующим обращениям от смежников и по завершении инцидентных активностей заполните все поля в шаблоне MARKETINCIDENTS-тикета.

{% cut "Подробнее" %}

[Команды бота](https://wiki.yandex-team.ru/market/reliability/instrumenty/incidentnyjj-bot-marketa/botcommands/)

[Общая информация про бота](https://wiki.yandex-team.ru/market/reliability/instrumenty/Инцидентный-бот-Маркета/)

[Пример инцидентного тикета](https://st.yandex-team.ru/MARKETINCIDENTS-10566)

{% endcut %}

# Передача дежурства
## Чеклист подготовки к передаче дежурства
1. В четверг меняется состав еженедельной [встречи по передаче дежурства](https://calendar.yandex-team.ru/event/64995488?applyToFuture=1&event_date=2022-06-06T08%3A30%3A00&isEditing=1&show_date=2022-06-06&uid=1120000000413667): Добавляет следующего дежурного и себя.
2. В недельном тикете на дежурство сгруппированы тикеты по схожим проблематикам.
3. Отмечены выполненные тикеты.
4. В тикетах, которые выполненны частично, есть комментарий: что сделано, что осталось, какие есть идеи по ситуации.
5. В тикетах, которые даже не смотрели, есть комментарий "не успел посмотреть".

## Встреча передачи дежурства
1. Обсуждаются незакрытые тикеты (нужна информация, в работе, ревью). Принимается решение, что:
   1.  переводим в ниндзю. Для этого заносим их в [бэклог ниндзи](https://wiki.yandex-team.ru/market/mdm/projects/2022/bjeklog/#bjeklognindzja2022) и скорим
   2.  отдаем на приоритезацию с ДС. Для этого заносим их в [бэклог багов и призывов](https://wiki.yandex-team.ru/users/s-vasilchikov/mdmkontur2/projects/texnicheskijj-dolg--fichi-dlja-obsuzhdenija-s-razrabotkojj/grid-2021-09-30t182809/)
2. Проверяется наличие комментариев в незакрытых тикетах 
3. Дежурные добавляются во встречу [скоринга бэклога багов и призывов](https://calendar.yandex-team.ru/event/59264049?applyToFuture=1&event_date=2022-06-06T09%3A30%3A00&isEditing=1&show_date=2022-06-06&uid=1120000000413667)
   
## После встречи передачи дежурства
1. Закрываем тикет прошедшего дежурства
2. Участвуем в скоринге багов и призывов
3. После скоринга получаем приоритеты для нового дежурного

