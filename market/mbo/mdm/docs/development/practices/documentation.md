# Разработка документации

Для составления этой документации мы используем сервис [Документации](https://docs.yandex-team.ru). Страницы оформляются в формате Yandex Flavored Markdown. Это почти настоящий Markdown, но с некоторыми свистелками. Минимально рабочие примеры можно посмотреть [здесь](https://docs.yandex-team.ru/docstools/examples).

## Моя первая страница

1. В смонтированной Аркадии идём в папку [market/mbo/mdm/docs](https://a.yandex-team.ru/arc/trunk/arcadia/market/mbo/mdm/docs).
2. Добавляем свою страницу в формате Markdown в наиболее подходящее место.
3. Добавляем свою страницу в оглавление — это файлик `toc.yaml` в корне документации. Просьба уложить свою главу ровно в то же место, куда вы физически положили страничку в структуре папок и файлов.
4. Находясь в папке `docs`, запустите `./run.sh` (если ругается на права, сделайте `chmod +x`).
5. Документация будет доступна локально по адресу `http://localhost:8888`.

{% cut "Что делает run.sh" %}

Если скриптик не взлетел, можно проделать это руками. Делает он следующее:

- Запускает `ya make -v`. Результатом должен быть непустой `tar.gz` файл в этой же директории.
- Создаёт папку под побилженную документацию. Например, `mkdir build`.
- Разархивирует туда побилженную доку командой `tar -xzf mbo-mdm-docs.tar.gz -C build`.
- Запускает локальный веб-сервер, куда захостится сбилженная документация: `python3 -m http.server 8888 -d build`.

{% note tip "Oneliner" %}

`ya make -v && mkdir -p build && tar -xzf mbo-mdm-docs.tar.gz -C build && python3 -m http.server 8888 -d build`

{% endnote %}

{% note info %}

Если на macos при вызове run.sh падаете следующим образом
```
xcrun: error: invalid active developer path (/Library/Developer/CommandLineTools), missing xcrun at: /Library/Developer/CommandLineTools/usr/bin/xcrun
```
Надо установить xcode:
- открываем терминал
- Выполняем команду:
`xcode-select --install`

{% endnote %}

{% endcut %}


{% note info %}

Если ваш документ нацелен на разработчиков, то лучше положить под папку docs/development. Если это больше похоже на описание бизнес-процесса или чего-то, что интересно внешникам, смежникам или прочим не-разработчикам, то в папку docs/contour.

{% endnote %}

## Деплой и релиз изменений в документации

Итак, вы создали и проверили локально свои свежие статьи. Чтобы зарелизить их, делаем обычный ПР с автомержом и автопубликацией.

И в общем-то всё. Дальше он сам смёржится и выкатится без ревью. Готовый результат можно будет наблюдать в продовой документации [https://docs.yandex-team.ru/market-mdm](https://docs.yandex-team.ru/market-mdm) минут через 15, в зависимости от скорости работы Арканума и CI.

Если интересно понаблюдать за релизным процессом, или же если в ПРе есть ошибки билда (редко, но бывает), то:

1. Переходим в ПР в Аркануме
2. В списке активностей в Аркануме будет ссылка на [деплой](https://a.yandex-team.ru/projects/mbo-mdm/ci/actions/launches?dir=market%2Fmbo%2Fmdm%2Fdocs&id=docs). Кубик деплоя должен завершиться успешно.
3. После мержа ПР следует найти свежий релиз в [списке релизов](https://a.yandex-team.ru/projects/mbo-mdm/ci/releases/timeline?dir=market%2Fmbo%2Fmdm%2Fdocs&id=release-docs).
4. Ждём зелёного кубика выкладки в тестинг.
5. Опционально проверяем полученный результат в [тестинговой документации МДМ](https://testing.docs.yandex-team.ru/market-mdm).
6. Если всё ОК, то получаем итоговый результат по продовому адресу: [https://docs.yandex-team.ru/market-mdm](https://docs.yandex-team.ru/market-mdm). Если ваши изменения совсем страшные, вы можете поставить Гендальфа перед кубиком прода в релизном пайплайне. Тогда выкатка в прод будет ручной.

## Рекомендации

* Просьба не делать ручных переносов строк на странице,
  а то получается
  вот такое вот
  хокку.
  Такое возникает из-за YFM, который в отличие от настоящего Markdown переносы строк учитывает. В любом случае, YFM сам сделает word-wrap, а при написании из IDEA можно просто сделать Soft Wrap.

* Также желательно соблюдать опрятность. Писать не "сску", а SSKU. Да, это больно, но всё-таки в отличие от вики, здесь мы пробуем создать доку, близкую к идеалу. В том числе по визуальной чистоте. К тому же новичку, который не намылил глаз об аббревиатуры, может быть неочевидно, что "лб" - это Логброкер, а "сску" - это SSKU оффер.

* Если вы добавляете на вашу страницу изображение или диаграмму, то лучше избегать прямых ссылок в интернет. Положите картинки и отрендеренные диаграммы в папку `_images`, а исходники диаграмм (например, xml-ка для draw.io) в `_diagrams` в корне проекта. Так гарантируется, что они всегда будут под рукой и ссылки не протухнут.

* Не стоит писать в доку страницы, постоянно подвергающиеся переработке. Например, требования при проработке проекта. Вы просто замучаетесь постоянно делать коммиты, не говоря уже о соблюдении красоты, ведь нередко такие вики-странички заполняются на бегу прямо на встречах, состоят на одну половину из ссылок к вороху тикетов, а на вторую половину — из неотсортированных минуток. Короче говоря, в документации отдаём предпочтение более статичной, готовой и красиво оформленной информации. Просто ради экономии наших же нервов и сил.

  *(Но если вы готовы поддерживать активно меняющуюся страницу прямо в доке - то флаг в руки, это будет супер!)*
