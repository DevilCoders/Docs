TODO:
-----
+ стартующее приложение
+ настроенная tms-ка
+ накатывающийся liquibase (в тестах - тоже)
+ окружение для тестов
+ основные таблицы для иерархии данных тасков (ядро)
+ доработать task_result
+ работа с Янгом:
    - спроектировать структуру таблиц/классов для работы с Янгом/Толокой (наверное прям в пакете yang, рядом с core, отдельная схема?)
        - нужно уметь создавать таски
        - как-то трекать пулы, создавать новые
        - плюс трекать связь taskId -> yangTaskId
        - учесть работу с дублями (см. ниже)
    - сделать получение результатов Янга + доставку сообщения в нужный таск
    - продумать и сделать API для переприоритезации тасков в толоке
    - научиться получать данные о связи пользователь Янга - логин/uid
+ спроектировать внутреннее API для тасков:
    + создание
    + получение информации
    + отмена тасков
+/- минимальные метрики - создание/запуск/ошибки тасков/месседжей
- подтянуть данные по категориям (из YT-я? hahn/arnold переключение?) - а зачем?
+ ядро:
    + написать executor для тасков
    + научиться вести лог выполнения тасков
    + сделать api для работы с результатами заданий
+ hello world задание, чтобы крутилось и писало в логи себя
- добавить multitenancy - пригодится и для dev-а, чтобы разнести людей и для шардирования заданий по группам инстансов
+ запустить приложение в Ya.Deploy-е
    + просто настроить/запустить пайплайн выкладки
    + разобраться с отправкой метрик в solomon
- штуки для отладки:
    + api-шка со списком таск-групп
    + api-шка с поиском по заданиям - таскгруппы, упавшие/нет, в работе и т.п., надо подумать - в простом виде
    + api-шка для убер-информации по таску: id таска => всё про него - события, логи их обработки,
    - добавить диагностику янга в ручки
    - api-шка для перепинания событий, которые зафейлились
- модерация для КИ внутри маркапа - спроектировать систему данных для работы с данными КИ
    - придумать хранение информации о тасках
    - реализовать синк - выдачу/отмену/переприоритезацию задания
    - реализовать получение информации и пуш в КИ
- регулярные таски:
    - сделать очистку истории (потому что всяких логов может писать очень много)
- система метрик и мониторингов:
    + метрики:
        + количество заданий созданных/исполненных/активации
        + количество сообщений созданных/исполненных/ретраи/фейлы
        + количество результатов заданий созданных/забранных
    - тмс-ные метрики (через пуш в соломон):
        + количество активных заданий
        + количество активных событий
        + количество зафейленных событий
        + количество необработанных результатов заданий
        - количество необработанных результатов Янга
        + количество событий с ретраем > 1
    - мониторинги:
        - на события с ошибкой (надо как-то научиться их докатывать)
        - событие не обработано в течении 10-ти минут (будем уточнять мониторинг, если решим, что это норма)
        - на долго необработанные результаты Янга (как, по событиям?)
        - как детектировать то, что сломался забор из Янга? (как-то по метрике полученного?)
        - как детектировать то, что сломалось получение/переприоритезация из КИ?
        - как детектировать то, что не шлём назад в КИ?
        - !!выпишите, что ещё у нас обычно ломается!!
    - системные (т.е. Ya.Deploy):
        - разобраться с 500-ками для API
        - ping-и, как это тут работает
        - oom/hprof
        - slot-oom, как это выглядит, как об этом узнавать
- спроектировать и сделать внешнее API
- научиться работать с Толокой тоже


Доведение напильником СПОК-а:
-----------------------------
- надо создать dev-базу для разработки
- в конфиге tms-ки не проставлен checkin интервал, без этого она начнёт делать конкурентные запуски на долгом FullGC
- отдельный пул коннектов для tms-ки
- &prepareThreshold=0 - довольно спорная штука, я бы где-то обсудил (кажется, это ритуал от непонимания работы pgbouncer-а)
- поднятие liquibase-а локально/в тестах
- базовый тест с БД + инициализация (примерно в каждом проекте у себя делаем)

Работа с дублями
----------------
Дубли - это больно. Как они могут получаться:
1. Проблемы с API и идемпотентностью => решается через уникальность task-ов по (taskGroupId, taskKey).
2. Проблемы с логикой распределения item-ов task-ам => решается через уникальность (taskGroupId, taskUniqueKey) - с таском можно передать много ключей уникальности.
3. Дубли при вызовах API Янга - ???
    - есть ли что-то для идемпотентности в самом Янге?
    - можно управлять Янгом так, чтобы гарантировать уникальность (taskId, poolKindId) - т.е. 1 пул на задание, или 2-3, но не давать прямо на уровне подсистемы Янга по умолчанию завести много
    - можно изолировать работу с API Янга в свою отдельную транзакцию, которая:
        - создаёт пустую новую связку в БД
        - делает её select for update - чтобы залочить таблицу/индекс, куда запишет янг-таск
        - создаёт задание
        - и сохраняет связи с таском в БД
        - так мы изолируем падение транзакций (и забывание тасков) по вине пользовательского кода + сокращаем вероятность проблем уровня БД (таску в Янге сделали, а к себе по какой-то причине не записали)



