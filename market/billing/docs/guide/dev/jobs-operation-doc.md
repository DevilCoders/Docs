# Как написать эксплуатационную документацию по джобе

## Что это такое?

Эксплуатационная докуменатация по джобе должна помогать понять:
- что делает джоба;
- какая именно функциональность сломалась, когда загорелся мониторинг, и как это видят пользователи (партнеры, соседние сервисы);
- как наблюдать за состоянием джобы и как скорректировать её работу;
- какие могут быть причины поломки.

Эксплуатационная документация не должна детально объяснять алгоритм работы джобы. Подробности про алгоритмы и устройство стоит выносить в отдельные доки (разработческие).

## Общие рекомендации к написанию

Сделайте документацию простой, чтобы дежурный мог быстро сориентироваться. Если джоба заслуживает документации по разработке, лучше написать её в соответствующем разделе, а здесь оставить ссылку.

Используйте точные формулировки. Например, формулировка "джоба формирует отчет в excel..." точнее, чем "джоба показывает статистику...".

Указывайте технические имена сущностей: номер сервиса; имена env-property, с помощью которой можно регулировать работу джобы; названия топиков и т.д.

Рассчитывайте, что читатель доки (дежурный) может не знать каких-то деталей про работу Маркет-Биллинга.
Например, описание вида "данные по 613 сервису" не очень хорошее,
так как требует понимания что такое "613 сервис" и какие именно данные по нему имеются в виду в текущем контексте.
Лучше указать более конкретно: "записи в `bank_order` и `bank_order_item` с `service_id = ...`".

Пишите простыми предложениями. Одно длинное предложение почти всегда лучше поделить на два поменьше.

## Шаблон документации

Шаблон в виде md-разметки в Аркануме: [template.md](https://a.yandex-team.ru/arc/trunk/arcadia/market/billing/docs/reference/jobs/list/template.md).

**Продукт/подсистема**

К какому крупному куску Маркет-Биллинга относится джоба:
инфраструктура / синий биллинг / белый биллинг / управление выплатами / факторинг / биллинг маркетинговых услуг / ...





**Роль в работе продукта/подсистемы**

Короткий и ёмкий комментарий о том, что джоба делает для работы продукта или подсистемы из предыдущего пункта.

Примеры: 
* "Джоба забирает свежие данные из Партнерского Интерфейса" &mdash; хорошо, но непонятно, какие именно данные
* "Джоба импортирует из Партнерского Интерфейса банковскую и юридическую информацию по новым и обновившимся партнерам" &mdash; лучше


**Датафлоу**

* Откуда джоба читает данные
* куда пишет
* с какими системами взаимодействует и как (соседние сервисы, YT, LB, REST, xmlrpc и т.д.)
* кто главный потребитель данных, которые записывает джоба

Этот пункт желательно оформлять с кликабельными ссылками.
Последовательность действий лучше всего записывать в виде списка.


**Способы наблюдения за текущим состоянием**

Как можно посмотреть, чем джоба делает сейчас, что делала в прошлом, насколько успешно это получалось.

Частые варианты:
* логи
* графики
* джагглерные проверки
* env-property
* sql/yql-запросы

По возможности &mdash; с кликабельными ссылками.


**Какая функциональность пострадает от отказа джобы**

Что перестанет работать? Насколько это критично? Насколько массовым будет отказ?


**Как пользователи (или команда) заметят проблему и через какое время**

Как именно будет плохо пользователям? Как скоро это случится после поломки?

Мониторинги сюда не пишем. Они показывают факт поломки, но не объясняют, чем это плохо для пользователей. Мониторинги записываем в раздел "как наблюдать за работой джобы".

Примеры:
* асинхронные отчеты будут сами пропадать из ПИ
* магазины будут получать "подаренные" клики (страдать вероятно не будут)
* когда месяц закончится, затронутые партнеры получат закрывающие документы без отчета по реализации товаров
* проверки по новым джобам не прорастут на дашборд и когда-то джобы сломаются незаметно


**Контакты разработчиков и менеджеров**

Укажите в виде списка ссылок на staff. Так же можно указать релевантных людей из смежных команд.


**Желательное время исправления в случае поломки**

За какое время стоит починить джобу, чтобы не нарушить пользовательский опыт.

Если сомневаешься &mdash; пиши "TODO поклассифицировать". Чуть позже массово для всех таких джоб примем решение.

**Способы регулирования работы джобы**

Частые варианты:
* env-property 
* параметры конфигурации
* константы в коде
* админка

Для каждой регулирующей ручки хорошо бы записать:
* что именно она делает
* в каком случае может пригодиться

Так же полезно описать стандартные способы исправления последствий отказа джобы.
Например: ваншоты, запросы в YT/Oracle/PG, однострочники. По возможности указывайте ссылки.


**Известные причины поломок**

Исторические знания.


**Дополнительно: тонкости и подводные камни**

Любая полезная информация в свободной форме. Например, тикет на доработку, или чего точно не нужно делать.

