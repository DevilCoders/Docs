# Снизить тариф АВ, если не было выплаты

Если в определенный день не было выплат магазинам, то обычно снижаем тариф АВ до 1% для заказов, деньги за которые выплатились бы в этот день. 

1. Получить список payment order, которые выплатились бы магазинам в этот день. 

    > Получение списка зависит от того, в какой системе был сбой. Если Market Billing не создал команды на выплату или ошибка была в Балансе, то эти команды на выплату надо создать и они же и будут использоваться для создания корректировок. Если команды на выплату были в OEBS, но не ушли в Банк, то надо получить список из OEBS; причем надо взять именно те команды на выплату, которые ушли бы в Банк (например, из-за действующего взаимозачета мы бы в любом случае не заплатили бы сегодня деньги магазину, в таком случае и снижать тариф АВ для него не надо). 

2. Получить список order_id, платежи для которых вошли в эти команды на выплату. 
3. Получить суммы корректировок и согласовать их в соответствии с регламентом корректировок.
4. Для данных заказов создать корректировки, чтобы итоговый тариф АВ по заказу стал 1%. Корректировки надо создать в Postgres (чтобы они собрались в тлог услуг) и в Oracle (чтобы они отображались в отчете Услуги Маркетплейса).
5. Прикрепить в тикет выгрузку в разрезе partner_id - order_id - item_id/delivery_id - сумма корректировки - дата корректировки. 

В качестве примера можно использовать тикет [MARKETBILLING-2454](https://st.yandex-team.ru/MARKETBILLING-2454).