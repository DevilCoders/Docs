# returnOrderBillingExecutor

### Код

Код джобы - https://a.yandex-team.ru/arc_vcs/market/billing/market-billing-tms/src/main/java/ru/yandex/market/billing/order/returns/ReturnOrderBillingExecutor.java

### Продукт/подсистема

Синий биллинг

### Роль в работе продукта/подсистемы

Джоба повозвратного биллинга возвратов/невыкупов.

### Датафлоу


* Джоба получает возвраты/невыкупы из таблички в PG - `market_billing.order_service_return`,
  которые на дату биллинга находятся в статусе `READY_FOR_PICKUP`.
* Если возврат/невыкуп перешел в финальный статус, один из (`CANCELLED`, `PICKED`, `LOST`), то прекращаем биллить.
* Биллинг может быть прекращен промежуточным статусом `IN_TRANSIT`, но после того, как возврат/невыкуп снова перейдет в статус
  `READY_FOR_PICKUP`, мы продолжаем биллить с того же момента, на котором остановились.
* Обилленые данные попадают в PG в табличку `market_billing.return_order_billed`.
* Ключ в env для игнорирования возвратов/невыкупов по идентификатору логистического возврата(logistic_return_id) - `market_billing.return_order_billing.ignore.logistic_return_id`
### Способы наблюдения за текущим состоянием

- Посредством логов, мониторингов и данных в табличке биллинга.

### Какая функциональность пострадает от отказа джобы

Кратковременно - не критично (часы, несколько дней).
Долговременно и к закрытию месяца - не обиллим возвраты/невыкупы.

### Как пользователи (или команда) заметят проблему и через какое время

- Посредством мониторингов

### Контакты разработчиков и менеджеров

Разработчики: [alex997](https://staff.yandex-team.ru/alex997), [teslenko](https://staff.yandex-team.ru/teslenko)

### Желательное время исправления в случае поломки

Несколько дней в зависимости от того, что именно сломалось.

### Способы регулирования работы джобы

При помощи CRON и переменной в env, указывающей, начиная с какого числа нужно биллить данные.

### Известные причины поломок

В данный момент не имеются.

### Дополнительно: тонкости и подводные камни

