# geoImportExecutor

### Код

- [GeoImportExecutor](https://a.yandex-team.ru/arc/trunk/arcadia/market/billing/market-billing-tms/src/main/java/ru/yandex/market/billing/geo/GeoImportExecutor.java)
- [GeoImportService](https://a.yandex-team.ru/arc/trunk/arcadia/market/billing/market-billing-tms/src/main/java/ru/yandex/market/billing/geo/GeoImportService.java)


### Продукт/подсистема

Синий биллинг


### Роль в работе продукта/подсистемы

Импорт регионов из Геобазы


### Датафлоу

- Читает актуальное дерево регионов из Геобазы по http
- Фильтрует лишнее и то, что считает невалидным
- Далее в транзакции:
  - Очищает таблицу `shops_web.regions`
  - Добавляет отфильтрованные регионы
  - Удаляет с помощью рекурсивного sql-запроса регионы, не входящие в регион "Земля"


### Способы наблюдения за текущим состоянием

- Переменная окружения `geo.import.last_date` указывает на дату, в которую импорт последний раз успешно отработал.

### Какая функциональность пострадает от отказа джобы

В первую очередь, регионы перестанут переналиваться из Геобазы.

Сущность "регион" достаточно общая, поэтому потребителей может быть много. Один из примеров: биллинг магистралей.


### Как пользователи (или команда) заметят проблему и через какое время

TODO


### Контакты разработчиков и менеджеров

Разработчики: [mexicano](https://staff.yandex-team.ru/mexicano)


### Желательное время исправления в случае поломки

В реальном мире регионы не каждый день меняются, поэтому маловерятно, что при отказе джобы что-то резко сломается.
Желательное время исправления: неделя - две.


### Способы регулирования работы джобы

Отсутствуют.


### Известные причины поломок

Отсутствуют.


### Дополнительно: тонкости и подводные камни

