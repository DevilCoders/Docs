# Подготовка данных по транзитам

## Верхнеуровневая архитектура
Выделяем 3 группы транзитов:
* Нормальные, разнесенные транзиты (normal_transits.py)
* Межскладские перемещения (iwh_movement.py)
* Нерзнесенные транзты (unnormal_transit.py)

Для каждой группы транзитов своя подготовка данных, после чего они объединяются в transis_raw.py.

При этом формируется промежуточная таблица transits_raw с типом транзита и идентификаторами в AX и FF, предназначеная прежде всего для нужд поддержки

На основе transits_raw формируется итоговая таблица transits, которая идет на вход оптимизатору

 ## normal_transits.py
Нормальные поставки

 ## iwh_movement.py
Межскладские (и другие) перемещения

 ## unnormal_transit.py
Неразнесенные транзиты (REPLENISHMENT-666)

 ## transis_raw.py

 ### Формат итоговой таблицы

 | Поле (англ.)        | Поле (рус.)           | Комментарий  |
| ------------- |:-------------:| -----:|
| date      | Плановая дата поставки |  |
| warehouse_id      | Склад поставки |  |
| msku      | MSKU |  |
| supplier_id      | Ид поставщика | Используется внутрирепленишментовский идентификатор поставщика, rs_id и тип поставщика можно получить из таблички intermediate/suppliers  |
| in_transit      | Кол-во в транзите |  |
| ff_id      | Ид в ff |  |
| ax_id      | Ид в ax |  |
| actual      | Флаг дедубликации | На случай дублей поставки между разными типами и технических багов заводим флаг 1/0 для отображения той строки которую считаем актуальной  |
| type      | Тип поставки | normal - разнесенная, iwm - межсклад, unnormal - неразнесенная  |


### Алгоритм дедубликации

В рамках сочетания date,msku,supplier_id выбираем только строку с максимальной парой ax_id, ff_id

## transis.py

Группируем до msku, supplier_id, warehouse_id, date, для отправки в оптимизатор
