# Карусель промолендингов

**Смотреть [мастер-класс](https://yandex.zoom.us/rec/play/vsEqcr-v-DI3GtaTsgSDB_9xW426fKys0XNLr6IPyU_mW3IFY1ukNLsRNuMhxGTvpugB1BjRh5JeKL0a?continueMode=true) по использованию функционала** Password: 0D+@*!NV

## Общее описание и схема работы
Инструмент позволяет размещать превью промо лендингов с кратким описанием об акции на любой странице в виджете карусели.
Карусель с точками входа на промостраницы.

Примерный вид Desktop:
![image](https://jing.yandex-team.ru/files/makbet/2020-05-28_14-31-39.png)

Примерный вид Touch+App:
![image](https://jing.yandex-team.ru/files/makbet/2020-05-28_14-32-28.png)

В Desktop разместить можно на главной, скидочном хабе, промо страницах и категорийных страницах
В Touch разместить можно на главной, скидочном хабе и промо страницах
В APP разместить можно на главной и скидочном хабе

## Настройка карусели

### Создание Каруселей
На странице, где будет размещена карусель необходимо добавить:
* Виджет: **SCROLLBOX**
* Источник данных: **Входные точки cms страниц**
![image](https://jing.yandex-team.ru/files/makbet/2020-05-27_17-38-10.png)
* **Идентификатор тега связи**: Уникальный id тега связи с лендингами. Должен совпадать с полем `Id тега связи` в Excel файле (будет загружаться на лендинги). Может содержать русские символы, латинские и цифры.
* **Количество элементов**: На данный момент число не влияет на количество показанных элементов. Сделана на будущее возможность ограничения, если будут долго грузиться большие карусели.
* Для одного виджета(карусели) можно использовать только 1 источник данных и соответственно 1 тег связи с лендингами.

### Настройка Лендингов
Необходимо добавить на лендингах (которые будут указаны в файле Еxcel в поле _"Ссылка на лендинг"_) **точки входа**, которые кратко описывают данную cms страницу и будут видны в карусели.

{% note warning %}

Для корректной работы лендинги должны быть опубликованы  на момент загрузки файла в трекере

{% endnote %}

Для каждого лендинга необходимо задавать 2 точки(Desktop, Touch+App), так как для платформ необходимы разные картинки-баннеры.
* Точки входа поддерживают скрытие по платформам
   **Важно** - скрывать точку входа, а не картинку
   ![image](https://jing.yandex-team.ru/files/makbet/2020-05-27_18-10-16.png)
* Добавление точки входа находятся "в корне" страницы
   ![image](https://jing.yandex-team.ru/files/makbet/2020-05-27_18-02-08.png)
* Поля точки входа:
   ![image](https://jing.yandex-team.ru/files/makbet/2020-05-27_18-12-45.png)
* **Заголовок**: Отображается в 1 строку. Длинный текст обрезается многоточием.
* **Подзаголовок**: Отображается в 1 строку. Длинный текст обрезается многоточием.
* **Ссылка для перехода**: ссылка на текущий лендинг или туда, куда необходимо вести пользователя по клику. Должно содержать ##/special/ЧПУ## (ЧПУ=semantic_id)
* **Дата окончания**: информационная дата для пользователя. На скрытие из карусели не влияет.
* **Ссылка в новом окне**: только для WEB. Настройка открытия в новой вкладке.
* **Картинка (обязательно)**: для Desktop размер `334х212`, для Touch и App `242х154`
![image](https://jing.yandex-team.ru/files/makbet/2020-05-27_18-40-49.png)

## Загрузка Правил через трекер

{% note warning %}

На момент загрузки файла в трекер лендинги должны быть опубликованы

{% endnote %}

Тикет в трекере:
* Очередь [BLUEACTION](https://st.yandex-team.ru/BLUEACTION)
* Тег `blue_promolanding_prod`
* Шаблон можно найти на [wiki](https://wiki.yandex-team.ru/market/pokupka/projects/promo-actions/#aktualnyjjshablondljapromolendingov)
* Заполненный шаблон прикладывать в комментарий

{% note tip %}

Чтобы не зависал стартрек при открытии тикета, можно периодически закрывать тикет и открывать новый

{% endnote %}

Правила заполнения:
**Имя файла**: должно начинаться на `robot_`
**Первый лист файла**: должен называться `список промо` и содержать список semantic_id(=ЧПУ) всех промолендингов  использованных в файле.
**Второй и последующие листы** (**важно** одна карусель= 1 лист файла):
* **Адрес страницы**: Информационное поле. Место где будет размещена карусель. Может содержать любые символы.
* **Id тега связи**: Уникальный id тега связи точек входа в карусели с лендингами. Должен совпадать с тегом в настройках карусели. __Поле не может быть пустым.__ Может содержать любые символы.
* **Место**: Порядковый номер точки входа на данный лендинг в карусели. Если оставить пустым, точка входа на лендинг встанет на первое свободное место в карусели. Может содержать цифры. Формат ячейки Общий или Числовой.
* **Ссылка на лендинг**: Ссылка на лендинг, чью точку входа размещаем в карусели. Этому лендингу будет присвоена связь с тегом и место в карусели. Ссылка должна содержать ##/special/semantic_id##. Варианты заполнения `http://market.yandex.ru/special/test`, `market.yandex.ru/special/test`, `/special/test`
* **Начало**: Дата с которой начнется показ точки входа в карусели. Не может быть больше даты загрузки файла в тикет. То есть загрузить точку входа с началом показа в будущем нельзя. __Поле не может быть пустым.__ Формат даты **DD/MM/YYYY**. Формат ячейки Дата или Общий. (если Excel автоматически конвертирует дату в формат DD.MM.YYYY, нужно добавить ' перед датой 'DD/MM/YYYY)
* **Окончание**: Дата в 23:59:59 по МСК которой, точка входа на промолендинг перестанет отображаться в карусели. __Поле не может быть пустым.__ Формат даты **DD/MM/YYYY**. Формат ячейки Дата или Общий. (если Excel автоматически конвертирует дату в формат DD.MM.YYYY, нужно добавить ' перед датой 'DD/MM/YYYY)
* **Департамент**: Информационное поле. Может содержать любые символы или быть пустым.
* Для одной ссылки на лендинг в рамках одного листа файла(одной карусели) периоды показа (Начало-Окончание) не должны пересекаться

### Режим работы робота
1 раз в 10 минут робот придет в тикет с тегом `blue_promolanding_prod` в очереди `BLUEACTION` и заберет файл. В случае если в файле будут обнаружены ошибки, робот оставит в комментарии к тикету их список и призовет человека, загрузившего файл.
Об успешной загрузки файла, робот также сообщит в комментариях к тикету. После этого он проставит `Id тега связи` в Связи страницы всем лендингам, указанным в файле, предварительно удалив теги, которые были на странице до этого момента.
На странице, где настроена карусель, она появится примерно через 1-5 минут, после успешной загрузки файла.
Скрытие точки входа на лендинг произойдет посредством удаления роботом `Id тега связи` с лендинга в 00:10 ночи по МСК, в день следующий за указанным в поле `Окончание`. (фактически удаление произойдет в 23:59:59, но на проде изменения могут доезжать до 10-15 минут).

## Для разработки
Техническая информация по работе робота лендингов по [ссылке](../components/landing_robot.md)
