# Товар + подарок (generic-bundle, GENERIC_BUNDLE)
1. [Общее описание механики](#general)
2. [Особенности для dbs](#dbs)
3. [Информация для разработчиков](#dev)

## Описание {general}
Купи товар и получи к нему подарок.
При покупке одного товара, пользователь получает дополнительный товар в подарок, бесплатно.

[Корневой продуктовый тикет](https://st.yandex-team.ru/BMP-841)

![image](https://jing.yandex-team.ru/files/eandreyf/2022-04-13_16-56-28.png)

{% include [design](../_includes/design.md) %}

### Способы заведения
1. Описание акции [через ки](../create/ciface.md), ассортимент [через трекер](../create/tracker.md)
FBY✅️ FBS✅️ DBS✅️ Экспресс✅️

### Места отображения
Все сниппеты и места выдачи (виджеты/выдачи/карточка/корзина)

### Настройки акции
1. Можно указать процент размазывания скидки между основным товаром и подарком

### Общие ограничения
- Основной товар не может пересекаться ни с другими основными, ни с подарками. Подарки могут быть одинаковые у разных основных товаров.
- Основной товар и подарок к нему должны быть разными. (Купи телефон X и получи в подарок такой же НЕЛЬЗЯ) Почему? Потому что подарочные комплекты собираются в корзине в жесткий комплект. Корзина настроена таким образом, что ей будет непонятно почему один то же товар является и подарком и основным.)
- Подарок в одной связке НЕ может быть основным товаром в другой связке
- Контроль скидок отсутствует. Цены на сайте могут меняться динамически, если цена после размазывания будет меньше 1р, то акция на товаре выключится.

### Как будет обрабатываться разные кейсы с размазыванием?
Товар А (основной) 1000 руб, Товар Б (подарок) 100 руб

1. не ставим воообще процент - у подарка будет фикс. цена 1 руб, этот рубль вычтется из цены осн. товара
в чеке товар А 999 руб, товар Б 1 руб
2. ставим процент 99 - цена подарка станет равной 99% своей цены, и новая цена вычтется из цены осн. товара
в чеке товар А 901 руб Товар Б 99 руб
3. ставим процент 100 - цена подарка останется без изменений, и вычтется из цены осн. товара
в чеке товар А 900 руб товар Б 100 руб
5. ставим ноль - акция работать не будет, т.к. цена подарка получится меньше 1 рубля
4. ставим процент 120 - некорректное значение, система заведения не должна пропустить это значение
6. отрицательное значение или не число - некорректное значение, система заведения не должна пропустить это значение

### Можно ли указать в одной акции товары с разных складов?
Нет, нельзя.
1) потому что есть риск, что UE таких комплектов будет очень невыгодная - мы везем товары в один заказ с разного склада
2) пользователь ожидает получение товара с подарком, в случае разной складовости комплект может приехать разными посылками и в разное время

## Подарок за покупку для DBS { #dbs }

### Размазывание для акций DBS
Так как акции запускаются от имени партнера, и пользователь в случае претензий и возвратов будет коммуницировать напрямую с партнером,  размазыванием **желательно** не пользоваться во избежании рисков по обработке возвратов и расхождению в чеке и накладной от партнеров.

**Пример:** мы выставили в акции размазывание 70/30% покупатель предоплатил товар на Маркете и ему мы сразу выбили чек в соответствии с настройками размазывания.

В случае, если пользователь захочет вернуть один из товаров комплекта, могут возникнуть споры, какую сумму партнер должен вернуть, тк не все партнеры могут поддержать у себя в CRM сложные схемы расчетов и в большинстве случаев подарок идет бесплатно.
В случае, если мы размазывание не ставим, в крайнем случае спор может возникнуть из-за 1 руб, в случае возврата основного товара.

Размазывание для акций DSBS технически возможно, но только, если партнер сам обратиться с данной просьбой или условием акции.

### Юридические особенности
* Для акция DBS обязательно должны быть собственные юридические правила
* Правила для акции берем общие сервиса меняя пункт про организатора, если партнер не прислал свои, и согласие с ними должно быть подтверждено партнером в явном виде.

## Информация для разработчиков { #dev }
**Название:** `generic-bundle`

На подарки репортом вешается акция `generic-bundle-secondary`

Генерится во время парсинга промо `generic-bundle` для подарка `generic-bundle-gift`

### Checkouter
{% include [checkouter](../components/checkouter/_includes/generic_bundle.md) %}

### Report
Для проверки наличия подарка используется [кеш вторичных оферов](../components/report/index.md#secondary-cache).

