# Заведение через трекер (робота)
Механизм загрузки акций путём создания тикета в очереди [blueaction](https://st.yandex-team.ru/blueaction) и прикладывания excel шаблона описания акции.

Для получения доступа к очереди обратитесь к своему руководителю. Для получения доступа для новых групп пользователей - [@alagutinskaya](https://staff.yandex-team.ru/alagutinskaya).

Робот с определённой периодичностью проходит все тикеты, валидирует файлы, проверяет на дублирование ssku с другими акциями и загружает акцию в систему.
Для связанных комплектов дополнительные товары так же участвуют в проверке уникальности ssku.

Для изменений в автоматических уведомлениях и согласовании акций в трекере  - обратитесь к [@alagutinskaya](https://staff.yandex-team.ru/alagutinskaya)

## Шаблоны акций
Актуальные шаблоны с примерами лежат на [вики](https://wiki.yandex-team.ru/market/pokupka/projects/promo-actions/)

### Общие правила заведения акции
1. Заводим тикет  в очереди **blueaction** по форме **"Создание акций"**
![image](https://jing.yandex-team.ru/files/eandreyf/2022-04-18_12-27-51.png)
2. Проходим согласование акции
3. Прикладываем к комментарию файл с акцией по шаблону
4. Переводим тикет в статус **"Утверждён"**
5. В течение 15 минут робот придёт со статусом обработки файла
![image](https://jing.yandex-team.ru/files/eandreyf/2022-04-18_12-31-05.png)
6. Когда все акции в файле закончатся, робот автоматически переведёт тикет в статус "Завершен"

### FAQ

#### Если необходимо изменить акцию?
Вносим изменения в файл акции, грузим новым комментарием

#### Если необходимо завершить акцию досрочно?
Меняем в файле дату окончания акции на актуальную

#### Если необходимо экстренно отключить акцию?
В файле в столбце "статус акции" ставим "выкл" - выключение до 20 минут.
Если нужно ещё быстрее (теряем миллионы в минуту) - обратиться хотлайн акций

#### Если робот не приходит
Воспользуйся [инструкцией](https://st.yandex-team.ru/PROMOGUIDE-7)

#### Если робот написал ошибку
Из текста ошибки должно быть понятно, что необходимо исправить, если непонятно, то воспользуйся [инструкцией](https://st.yandex-team.ru/PROMOGUIDE-46)

#### Почему нет акции на оффере?
Для расследования, воспользуйся [инструкцией](https://st.yandex-team.ru/PROMOGUIDE-30)

### Изменение шаблонов акций { #change_template }
Имя файла шаблона формуируются по правилу: **robot_<код акционной механики>_<№ типа акционной механики>.<номер версии шаблона>**
Пример _robot_blue_set_v4.3.xlsx_ - шаблон для механики №4 blue_set версии 3

1. По завершению тестирования, после выезда задачи в прод
2. Опубликовать новый шаблон на [вики](https://wiki.yandex-team.ru/market/pokupka/projects/promo-actions/)
3. Необходимо проинформировать заказчика в [канале промо](https://t.me/joinchat/iy0KeJg_viA5YjRi).
В тексте сообщения сформулировать сделанные изменения и дать ссылку на опубликованный на вики шаблон

## Ограничения при заведении акции { #restrictions }
1. Один ssku, может участвовать только в одной акции
2. Для акции есть ограничение на максимальное количество строк в акции.
Актуальное значение можно посмотреть [в настройках робота](https://sandbox.yandex-team.ru/scheduler/17417/view), раздел `Custom parameters`.
Текущее значение: прямая скидка, флеш, 2=3 - 500к, остальные 30к. При этом для комплектных акций считаются все ssku, как основные, так и подарочные,
т.е. для акции товар+подарок можно загрузить максимум 15к строк

## Особенности заведения отдельных акций
### Товар + подарок
Если склад пустой, то акция дублируется на все склады. При этом сохраняется правило, что товар и подарок должны быть с одного склада.

### Вместе дешевле
Для комплектов с выбором дополнительного товара.

На втором листе:
1. в поле "Связаны на всех КМ?" всегда выбирать **НЕТ**
2. в поле "Является ли вариацией комплекта…" - надо указывать в нем **Да**

см. отдельный шаблон для этого вида акции на странице шаблонов

### Вместе дешевле (комплектный товар по выбору)
**Как заводить акцию**
* первый лист стандартная форма
* второй лист: 
   - указываем ID акции Анаплан
   - указываем основной товар
   - указываем дополнительный товар 1
   - указываем дополнительный товар два
   - в поле "Связаны на всех КМ?" всегда выбирать **НЕТ**
   - «Является ли вариацией комплекта…» - для комплекта с выбором надо указывать в нем «Да»
   
![image](https://jing.yandex-team.ru/files/alagutinskaya/Снимок%20экрана%202022-05-24%20в%2015.45.58.png)
  
В примере, **10129** это основной товар и у него есть три дополнительных **10126, 10127, 10128** из которых пользователь может выбрать 2 товара самостоятельно.
- он может заменить 10126 на 10127 или 10128
- он может заменить 10128 на 10127
Если пользователь заменит 10126 на 10127, то 10128 он уже изменить не сможет
* На фронте, на карточке модели покажется:
 Комплект из 10129, 10126, 10128 на товарах 10126, 10128 появится кнопка можно заменить


### Прогрессирующая скидка за количество
Принцип заполнения шаблона акции немного отличается от остальных акций, заводимых через трекер, для корректного заведения достаточно указать:
1. список магазинов, кто участвует в акции
2. список магазинов, кто исключается из акции
3. список складов, на которые распространяется акция
4. список msku

Для каждого msku по отдельности прописывать условия магазин и склад - **не надо**. См. пример в шаблоне

### Прогрессирующая скидка за чек
Принцип заполнения шаблона акции немного отличается от остальных акций, заводимых через трекер, для корректного заведения достаточно указать:
1. список магазинов, кто участвует в акции
2. список магазинов, кто исключается из акции
3. список складов, на которые распространяется акция
4. список msku
5. список брендов, участвует в акции

Или
1. писок hid и исключить из них какие-то msku и бренды
2. список hid и условия по мин стоимости товара в акции (если цена опустится ниже, товар из акции исключится)

Для каждого msku по отдельности прописывать условия магазин и склад - **не надо**. См. пример в шаблоне

Робот проверяет на корректность рост скидки и количества:

#|
|| Ожидаемое поведение|шт 1| % скидки 1|шт 2|% скидки 2||
|| Можно |3| 4%|5|7%||
|| Нельзя |3| 4%|2|7%||
|| Нельзя |3| 4%|5|3%||
|#

## Для разработки
Техническая информация по работе трекерного робота по [ссылке](../components/promo_robot.md)
