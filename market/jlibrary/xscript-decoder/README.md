# xscript-decoder

##Что это?
Парсер файлов и выполнение инструкций в xscript5 формате
https://doc.yandex-team.ru/XScript5/interface-developer-guide/ 

##Преимущества по сравнению с cpp xscript
* своя рубашка ближе к телу. Можно сделать веб-сервер в спринге. 
* можно кешировать шаблоны (в cpp вроде только результаты)
* быстрее отвечает (за счет того, что может жить на той же ноде что и основной бекенд; кеширования шаблонов)  
* возможность локального дебага - с подгрузкой на лету
* логи теперь могут располагаться в основном бек-веб сервере
* csrf можно проще прикрутить - есть пример в або
* это можно использовать в спринге (да, еще раз)! Ведь какие это возможности! фильтры, секьюрность, боле тонкое кеширование, скоупы и пр.
* можно писать юнит-тесты (формировать ответ в виде plain xml или после шаблонизатора и сравнивать его с ожидаемым)
* можно прикрутить другой шаблонизатор - конвертиование в json, thymeleaf и пр.
* Можно уже начать использовать **xslt 2.0** :)

##Как прикрутить?
Декодер преобразует файлы xml в формате xscript в формат java объектов.
Дальше можно выбрать что сделать - по умолчанию реализованы два варианта: серилизовать в xml и наложить xslt шаблон.
Что сделать любое другое преобразование нужно реализовать интерфейс ru.yandex.xscript.decoder.resolver.ViewResolver.
Источником данных является EntityResolver. И по дефолту есть одна реализация - CPEntityResolver, читающая файлы из класпаса.

**Таким обазом, чтобы прикрутить к своему проект нужно:**
* покласть xml+xsl файлы в класспас.\\
В market-java/abo и в market-java/pers-grade сделано так:\
в модуле с ресурсными файлами создан build.gradle файл с одной строчкой
`sourceSets.main.resources.srcDirs "${project.projectDir}"`
* настроть веб-сервер, если еще нет.
* В зависимости от вида веб-сервиса сделать обработку запросов нужных путей и направить обработку в r.y.x.d.XscriptParser.handle()\
Пример spring-mvc контроллера можно подсмотеть в классе XsltController в репозиториях https://github.yandex-team.ru/market-java/abo и https://github.yandex-team.ru/market-java/pers-grade 
* Понять, все ли теги и xsl extensions, используемые вами, реализованы в библиотеке. Для это есть питон скрипт stat/stat.py и grep
* за любой консультацией можно смело обратиться к 0x40@y-t.ru

##Сборка в teamcity
Сборку и деплой новой версии можно делать тут (Gradle Release Plugin)- 
https://teamcity.yandex-team.ru/viewType.html?buildTypeId=Market_Tools_XscriptDecoder

##Кто использует:
https://github.yandex-team.ru/market-java/abo
https://github.yandex-team.ru/market-java/pers-grade
https://github.yandex-team.ru/market-java/mbo