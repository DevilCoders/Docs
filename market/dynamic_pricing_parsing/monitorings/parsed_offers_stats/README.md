# Процесс сбора статистик парсинга.

Собриаем статистики по результатам парсинга цен в быстрых обходах через самовар и ватсон.
* Считаем статистики
* Публикуем их на статфейсе
* Сравниваем с историей
* Если текущие статистики сильно отличаются от исторических, кидаем сообщение в джаглер

## Как запускается, где живет.

Запускается [хитман процесоом](https://hitman.yandex-team.ru/projects/EDLP/PARSED_PRICES_STATS)

Так же есть [тестовый процесс](https://hitman.yandex-team.ru/projects/EDLP/PARSED_PRICES_STATS_TESTING)

Живет в нирване. Зпускается в воркфлоу клонированных с продового(или тестового) внутри проекта Dynamic Pricing Parsing.
* [тестинг воркфлоу](https://nirvana.yandex-team.ru/flow/d16ca6fc-9c03-4c3a-a3a6-c6c3f8b5b504)
* [прод воркфлоу](https://nirvana.yandex-team.ru/flow/c9b727f4-c765-484d-a47d-80fe0f627f2f)

## Как запустить сборку графа в деве или выкатить на прод/тестинг

Билдим `market/dynamic_pricing_parsing/monitorings/parsed_offers_stats/graph`

На выходе бинарь который умеет строить граф.

Опции запуска
* `--mode development` - default. строит какой-то дефолтный граф. ворк дир проставляет в `//home/market/users/YOUR_NAME/...` если у вас нет прав на запись туда, то поменяйте директорию в коде, или запрасите права. В деве процесс ожидает 2 дополнительных обязательных параметра `--yt-token`, `--yql-token` с именами секретов нирваны содержащих ваши токены. Так же опционально, можно указать конкретный воркфлоу через опцию `--custom-workflow`.
* `--mode testing` - выкатывает сборку в тестинг.
* `--mode production` - выкатывает сборку в прод.

При запуске потребуется nirvana_token. Его можно передать одним из 3х способов
* через парамерт `--nirvana-token`
* через переменную окружения `NIRVANA_TOKEN`
* через файл `~/.nirvana/token`

Если у вас нет прав выкатить граф, то убедитесь что оно вам надо, обратитесь в команду ценообразования маркета.
