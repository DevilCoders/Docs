# Мониторинг потери утрлов при обходе Самоваром и Зорой.

## Процессы
* [Обход через Зору в Хитмане](https://hitman.yandex-team.ru/projects/EDLP/DP_ZORA_PROD)
* [Обход через Самовар в Хитмане](https://hitman.yandex-team.ru/projects/EDLP/DP_SAMOVAR_PROD)

## Что происходит
А разрезе доменов считается соотношение входных урлов к урлам на выходе.
* Статистики заливаются на статфейс.
* Фильтруются критические потери по доменам(см. `yql/GetByDomainCritLosses.yql`). Если на выходе не пустая таблица, то шлется сообщение в джаглер.
* Собираюся все полери больше 30% и если количетсво хостов пробивает критическое количество, то шлется сообщение в джаглер.

### Нотификации
Сравниваем количество урлов во входной и выходной таблице по доменам. Если разница пробивает критический уровень, то кидаем сообщение Dyn_Pricing_Fuckups через juggler.

### Отчеты
Заливаем отчеты по доменам на статфейс:
* Отчет для Зоры
* Отчет для Самовара

## Раскатка, запуски

### Запуски:
* Исполняемся в нирване в [проекте `Dynamic Pricing Parsing`](https://nirvana.yandex-team.ru/project/dynamic_pricing_parsing)
* Запускаемся через [Хитман](https://hitman.yandex-team.ru/projects/EDLP/UrlCompleteness).

### Раскатка:
* Чтобы выкатить, убедитесь, что у вас есть права на редактирование, [продового воркфлоу](https://nirvana.yandex-team.ru/flow/69bee4a3-a183-4a92-bcc9-8008c0d65a7b)
* Если прав нет, но вам по какой-то причине нужно катнуть изменения обратитесть в группу ценообразования монетизации маркета.
* Для раскатки из корня дерните `ya make -DNIRVANA_TOKEN='{YOUR_NIRVANA_TOKEN}'`

## Навигация по коду
- graph - конструктор графа в нирване с использованием vh
    * ya.make тут собирает PY3_PROGRAM котрая собирает нирвана граф.
    * чтобы запустить `./graph --nirvana_token {YOUR_TOKEN} --workflow {WORKFLOW_ID}`
- yql - Директория с yql запросами.
    Подтягиваются в бинарь как ресурсы.