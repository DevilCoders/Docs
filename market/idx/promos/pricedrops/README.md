### DailyPrices

Собирает цены и прочие данных офферов из всех дневных логов в одну дневную таблицу, чтобы использовать для дальнейших рассчетов

### HistoryPrices

Вычисляет максимальную честную историческую цену, от которой можно отсчитывать скидку
Точные диапазоны дат настраиваются, но общая схема работы такая:
- Берем дневные цены за последние 30 дней
- Разбивает эти цены на перекрывающиеся пятнидневные окна, т.е. 26 окон
- Для каждого пятидневного окна считаем минимальную цену оффера. Если оффер не был в продаже какой-то из дней, все окно инвалидируется
- Из результатов каждого валидного окна выбираем максимальное. Это и будет наша историческая цена

### PriceDrops

Процесс разбит на 4 шага:

### 1. ClicksStatsCalcer

Собираем все клики за последний месяц (feed_id, offer_id, offer_price + поля-маркеты антифрода)
Схлопываем их по feed_id + offer_id, попутно обогащаем актуальными cluster_id и model_id из генлога.
Сам генлог тоже делим и сортируем чтобы потом этим не заниматься.

После этого схлопываем по model_id и cluster_id (простые оставляем так) (в случае огромного числа кликов по модели или кластеру (больше 1000) сжимаем их).

На выходе 5 таблиц с кликовой статистикой (по модельным офферам, по кластерным офферам, по обычным офферам, по моделям, по кластерам) и 3 с генлогами (на каждый тип офферов)

### 2. TentopPercentCalcer

Тут всё просто - добавляем к модельным статистикам данные tentop_percent.
Для этого берем генлоги из 1-го шага, схлопываем оттуда все актуальным цены на оффера, и вычисляем эту tentop_percent

На выходе 2 таблицы: по моделям и кластерам. содержат model_id, prices (актуальные цены на оффера модели из генлога), и этот tentop_percent

### 3. OfferDataCollector

Там всё очень плохо. В 2 словах - собираем все данные в кучу, и вычисляем всякие pricedrops_max_price, pricerange_max_price, recommended_price, valid_history_price

### 4. ResultFiltering

Эта часть не покрыта yatf-тестами (потому что логика там довольно примитивная)
Берем все насчитанные статистики, джойним на историческую цену
Eсли рекомендованая цена выше текущей в генлоге - pricedrops_tests_passed = false
Если историческая цена выше valid_history_price - history_price_is_valid = false
Попутно пишем все статистические данные в табличку pricedrops_partner_report (она для просмотра глазами, индексатор её не читает)
