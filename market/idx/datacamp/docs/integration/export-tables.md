# Экспортные выгрузки на YT

| Выгрузка | Путь на yt | Описание | Регулярность построения |
|----------|------------|----------|-------------------------|
| ecom-export | [директория](https://yt.yandex-team.ru/hahn/navigation?path=//home/market/production/ecom/export/offers/merged) | Все валидные офферы из DataCamp. [Формат](https://a.yandex-team.ru/arc/trunk/arcadia/market/idx/datacamp/proto/api/ExportMessage.proto?rev=r9297025#L9): для большей части полей b2b (a.k.a original) данные - т.е. принесенные партнером. Для некоторых полей также есть b2c (a.k.a. actual) данные - обогащенные маркетными пайплайнами; те, которые едут на выдачу. Часть b2c данных (напр. регионы) не хранятся в DataCamp и подмерживаются при создании выгрузок. Используются сервисами яндекса (директ / товарная вертикаль / едадил / etc). | Раз в 4ч |
| mstat | [hahn](//home/market/production/mstat/logs/market-offers-stratocaster), [arnold](https://yt.yandex-team.ru/arnold/navigation?path=//home/market/production/mstat/logs/market-offers-gibson) | Информация об офферах в разных поколениях индекса. Также в [mstat](https://yt.yandex-team.ru/arnold/navigation?path=//home/market/production/mstat) есть различные выгрузки для аналитики (в т.ч. поофферной), BI: клики, показы, скрытия офферов, etc (ниже некоторые конкретные примеры) | Раз в сутки |
| mstat | [mbo/all_vendors](https://yt.yandex-team.ru/hahn/navigation?sort=asc-false,field-name&path=//home/market/production/mstat/dictionaries/mbo/all_vendors) | Список известных вендоров | Раз в сутки |
| mstat | [mbo/category_tree_with_names](https://yt.yandex-team.ru/hahn/navigation?sort=asc-false,field-name&path=//home/market/production/mstat/dictionaries/mbo/category_tree_with_names) | Товарное дерево категорий | Раз в сутки |
| mstat-dumper | [директория](https://yt.yandex-team.ru/arnold/navigation?path=//home/market/production/indexer/datacamp/export/filtered) | Выгрузка CPA офферов хранилища в mstat. Подробнее описано [тут](../components/routines/mstat-dumper.md) | 5 раз в сутки |
| ecom-export (old) | [все кроме merged](https://yt.yandex-team.ru/hahn/navigation?path=//home/market/production/ecom/export/offers) | **Deprecated** ||

# ecom-export
ecom-export выгрузка пытается сдампиться консистентно. Если за 10 раз не получается подобрать timestamp'ы для консистентной выгрузки, то дампится неконсистентная выгрузка.

Отключить дамп консистентного снэпшота можно через флажок [dump_consistent_snapshot](https://a.yandex-team.ru/arcadia/market/idx/datacamp/routines/etc/conf-available/testing.white.ini?rev=r9526419#L416)
Изменить количество попыток сдампить консистентный снэпшот можно через [consistent_snapshot_max_attempts](https://a.yandex-team.ru/arcadia/market/idx/datacamp/routines/etc/conf-available/testing.white.ini?rev=r9526419#L417)

## Графики:
### Получилось ли сдампить консистентный ecom-export:
[Production](https://monitoring.yandex-team.ru/projects/datacamp/explorer/visualization?q.0.s=%7Bproject%3D%22datacamp%22%2C%20cluster%3D%22%2A%22%2C%20service%3D%22%2A%22%2C%20env%3D%22production%22%2C%20sensor%3D%22ecom_export_dump_consistent%22%7D&from=1653397820353&to=1654072932509&refresh=off&legend.offers_direct_processing_24h_or_more.name=больше%20суток&legend.offers_direct_processing_24h_or_more.color=cc0000&legend.offers_direct_processing_1h_to_2h.name=от%20часа%20до%20двух&legend.offers_direct_processing_1h_to_2h.color=99ff99&legend.offers_direct_processing_2h_to_24h.name=от%20двух%20часов%20до%20суток&legend.offers_direct_processing_2h_to_24h.color=ea9999&legend.offers_direct_processing_1h_or_less.name=меньше%20часа&legend.offers_direct_processing_1h_or_less.color=32ff32&normz=off&colors=auto&type=area&interpolation=linear&dsp_method=auto&dsp_aggr=default&dsp_fill=default&vis_labels=off&vis_aggr=avg)
[Testing](https://monitoring.yandex-team.ru/projects/datacamp/explorer/queries?q.0.s=%7Bproject%3D%22datacamp%22%2C%20cluster%3D%22%2A%22%2C%20service%3D%22%2A%22%2C%20env%3D%22testing%22%2C%20sensor%3D%22ecom_export_dump_consistent%22%7D&from=1653397820353&to=1654072932509&refresh=off&legend.offers_direct_processing_24h_or_more.name=больше%20суток&legend.offers_direct_processing_24h_or_more.color=cc0000&legend.offers_direct_processing_1h_to_2h.name=от%20часа%20до%20двух&legend.offers_direct_processing_1h_to_2h.color=99ff99&legend.offers_direct_processing_2h_to_24h.name=от%20двух%20часов%20до%20суток&legend.offers_direct_processing_2h_to_24h.color=ea9999&legend.offers_direct_processing_1h_or_less.name=меньше%20часа&legend.offers_direct_processing_1h_or_less.color=32ff32&normz=off&colors=auto&type=area&interpolation=linear&dsp_method=auto&dsp_aggr=default&dsp_fill=default&vis_labels=off&vis_aggr=avg)

### Cколько попыток сдапить консистентный ecom-export было сделано:
[Production](https://monitoring.yandex-team.ru/projects/datacamp/explorer/queries?q.0.s=%7Bproject%3D%22datacamp%22%2C%20cluster%3D%22%2A%22%2C%20service%3D%22%2A%22%2C%20env%3D%22production%22%2C%20sensor%3D%22ecom_export_dump_retries%22%7D&from=1653397820353&to=1654072932509&refresh=off&legend.offers_direct_processing_24h_or_more.name=больше%20суток&legend.offers_direct_processing_24h_or_more.color=cc0000&legend.offers_direct_processing_1h_to_2h.name=от%20часа%20до%20двух&legend.offers_direct_processing_1h_to_2h.color=99ff99&legend.offers_direct_processing_2h_to_24h.name=от%20двух%20часов%20до%20суток&legend.offers_direct_processing_2h_to_24h.color=ea9999&legend.offers_direct_processing_1h_or_less.name=меньше%20часа&legend.offers_direct_processing_1h_or_less.color=32ff32&normz=off&colors=auto&type=area&interpolation=linear&dsp_method=auto&dsp_aggr=default&dsp_fill=default&vis_labels=off&vis_aggr=avg)
[Testing](https://monitoring.yandex-team.ru/projects/datacamp/explorer/queries?q.0.s=%7Bproject%3D%22datacamp%22%2C%20cluster%3D%22%2A%22%2C%20service%3D%22%2A%22%2C%20env%3D%22testing%22%2C%20sensor%3D%22ecom_export_dump_retries%22%7D&from=1653397820353&to=1654072932509&refresh=off&legend.offers_direct_processing_24h_or_more.name=больше%20суток&legend.offers_direct_processing_24h_or_more.color=cc0000&legend.offers_direct_processing_1h_to_2h.name=от%20часа%20до%20двух&legend.offers_direct_processing_1h_to_2h.color=99ff99&legend.offers_direct_processing_2h_to_24h.name=от%20двух%20часов%20до%20суток&legend.offers_direct_processing_2h_to_24h.color=ea9999&legend.offers_direct_processing_1h_or_less.name=меньше%20часа&legend.offers_direct_processing_1h_or_less.color=32ff32&normz=off&colors=auto&type=area&interpolation=linear&dsp_method=auto&dsp_aggr=default&dsp_fill=default&vis_labels=off&vis_aggr=avg)

### Как долго дампился ecom-export:
[Production](https://monitoring.yandex-team.ru/projects/datacamp/explorer/queries?q.0.s=%7Bproject%3D%22datacamp%22%2C%20cluster%3D%22%2A%22%2C%20service%3D%22%2A%22%2C%20env%3D%22production%22%2C%20sensor%3D%22ecom_export_dump_time%22%7D&from=1653397820353&to=1654072932509&refresh=off&legend.offers_direct_processing_24h_or_more.name=больше%20суток&legend.offers_direct_processing_24h_or_more.color=cc0000&legend.offers_direct_processing_1h_to_2h.name=от%20часа%20до%20двух&legend.offers_direct_processing_1h_to_2h.color=99ff99&legend.offers_direct_processing_2h_to_24h.name=от%20двух%20часов%20до%20суток&legend.offers_direct_processing_2h_to_24h.color=ea9999&legend.offers_direct_processing_1h_or_less.name=меньше%20часа&legend.offers_direct_processing_1h_or_less.color=32ff32&normz=off&colors=auto&type=area&interpolation=linear&dsp_method=auto&dsp_aggr=default&dsp_fill=default&vis_labels=off&vis_aggr=avg)
[Testing](https://monitoring.yandex-team.ru/projects/datacamp/explorer/queries?q.0.s=%7Bproject%3D%22datacamp%22%2C%20cluster%3D%22%2A%22%2C%20service%3D%22%2A%22%2C%20env%3D%22testing%22%2C%20sensor%3D%22ecom_export_dump_time%22%7D&from=1653397820353&to=1654072932509&refresh=off&legend.offers_direct_processing_24h_or_more.name=больше%20суток&legend.offers_direct_processing_24h_or_more.color=cc0000&legend.offers_direct_processing_1h_to_2h.name=от%20часа%20до%20двух&legend.offers_direct_processing_1h_to_2h.color=99ff99&legend.offers_direct_processing_2h_to_24h.name=от%20двух%20часов%20до%20суток&legend.offers_direct_processing_2h_to_24h.color=ea9999&legend.offers_direct_processing_1h_or_less.name=меньше%20часа&legend.offers_direct_processing_1h_or_less.color=32ff32&normz=off&colors=auto&type=area&interpolation=linear&dsp_method=auto&dsp_aggr=default&dsp_fill=default&vis_labels=off&vis_aggr=avg)