
## Использование shopsdat в DataCamp

MBI периодически поставляет в хранилище выгрузки с информацией о свойствах партнеров. Эти выгрузки доступны в виде файликов на контейнерах некоторых сервисов, а также загружаются в динамическую [таблицу партнеров](https://yt.yandex-team.ru/markov/navigation?offsetMode=key&path=//home/market/production/indexer/datacamp/united/partners)

## Определение цвета оффера по shopsdat

Сейчас у каждого оффера в датакемпе есть [цвет](https://a.yandex-team.ru/arc/trunk/arcadia/market/idx/datacamp/proto/offer/OfferMeta.proto?rev=r8865156#L323) - параметр, который в т.ч. определяет маршрутизацию потоков обработки, то на какие витрины оффер выставляется. Цвет вычисляется из партнерских свойств размещения по следующим правилам:

* `is_lavka`, `is_eats` - офферы лавки и еды
* `is_site_market` - партнер размещается на маркете
  * если есть `blue_status REAL` - синий оффер
  * иначе - белый оффер
* `direct_goods_ads`, `direct_search_snippet_gallery`, `direct_standby`, `direct_site_preview` (есть хотя бы один)
  * если есть `is_site_market` - маркетный партнер, который захотел рекламу в директе. см предыдущий пункт
  * иначе - чисто директовый оффер (между `direct_*` флагами есть приоритезация. итоговый цвет зависит от нее)
* `vertical_share` - партнер размещается в товарной вертикали
  * если есть `is_site_market` или флаги `direct_*` из предыдущего пункта, то цвет определяется по правилам выше
  * иначе - чисто-ТВ партнер
* `direct_status REAL`
  * если есть какие-либо другие флаги `direct_*` или `is_site_market`, цвет определяется по правилам выше
  * иначе это чисто-ТВ партнер. при этом, если флага `vertical_share` нет, это значит, что на данный момент для партнера выключено размещение в ТВ

## Некоторые другие свойства shopsdat

* `cpa / cpc` - имеет смысл только для белых маркетных офферов. для остальных типов обращать внимание на этот параметр не стоит (директ всегда cpc, лавка/еда всегда cpa, etc). параметр нужен например для маршрутизации и разной логики в индексаторе

## Параметры в таблице партнера
```
echo {shop_id=465852} | yt lookup-rows //home/market/production/indexer/datacamp/united/partners --format yson --proxy hahn
```

