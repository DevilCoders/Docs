# Единая теория Датакемпа
https://wiki.yandex-team.ru/Market/Development/Indexer/Arxitektura-Marketnogo-Indeksatora/Offer-Repository

## Поддиректории

### offer
- Описание офера, необходимое для хранения и доставки инструкций по изменению
- Используется в HTTP протоколах, сообщениях логброкера, хранении офера в YT таблицах
- Имеет копии в гитовом репозитории

### external
- Формат взаимодействия со внешними сервисами (Директ, Товарная Вертикаль, etc)
- Используется в логброкере и табличных выгрузках хранилища на YT
- Оффер денормализован

### promo
- Модель хранения описания акции

### api
- Интерфейсы синхронного контроллера между MBI и индексатором
- Используются только для пуш-партнеров
- Имеет копии в гитовом репозитории

### tables
- Схемы и форматы таблиц хранилища
- Используется только в индексаторе
- Не собирается в Java артефакт

## Особенности
Стандартный генератор Java кода в гитовом репозитории не умеет работать с протосообщениями, которые совпадают с именем модуля.
Во всех файлах с потенциальными конфликтами следует использовать опцию вида
```
option java_outer_classname = "DataCampOfferBids";
```

---

Парсер протосхемы, используемый фронтами, не поддерживает комментарии внутри описания поля. Поэтому вместо
```
message Msg {
    optional int field = 1  // field description
        [(Market.partner_data) = true];
}
```

следует писать
```
message Msg {
    // field description
    optional int field = 1 [(Market.partner_data) = true];
}
```

Есть тест, проверяющий стиль [tests/test_js_compatibility.py](https://a.yandex-team.ru/arc/trunk/arcadia/market/idx/datacamp/proto/tests/test_js_compatibility.py).
