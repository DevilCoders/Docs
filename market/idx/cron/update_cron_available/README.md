# Генератор кроновых джобов и мониторингов для них

По сути перечисление запускаемых по расписанию задач **SchedulerItem**
Имеет два независимых режима запуска:
1. Генерация кроновых джобов
2. Генерации конфигов для мониторингов кроновых джоб, включается флагом --monitors.

Новые таски нужно добавлять [сюда](https://a.yandex-team.ru/arc/trunk/arcadia/market/idx/cron/update_cron_available/src/generator.py)

Каждый *item* описывается:
1. Запускаемой задачей
2. Интервалом запуска
3. Ограничением запуска (см. **Важно**)
4. Параметрами запуска мониторинга, если таковой имеет место быть

## Task (ExternalTask, MindexerCltTask)

Сейчас поддержаны два вида тасок:
- Условно *внешние* **ExternalTask** (задача по запуску произвольного бинарника)
- Условно *внутренние* **MindexerCltTask** (задача по запуску */usr/lib/yandex/marketindexer/mindexer_clt.py*)

Для внешних задач необходимо указать **binary**  - запускаемый бинарь (строка).

Опционально можно передать:
- **args** - аргументы запуска бинарника (строка)
- **user** - из под какого пользователя запускается бинарник (строка), важно для крона, по умолчанию ***corba***

## Interval

Происходит из крона.

По умолчанию вызов *Interval()* эквивалентен вызову *Interval(minute=Any(), hour=Any(), day=Any(), month=Any(), dow=Any())*.

Т.е. любую минуту, любого часа и т.д. (в контескте крона равнозначно расписанию `* * * * *`)

Каждый аргумент может принимать одно из значений:
- **Any()**
- **On(a, b, c...)** запускать строго на моменте *a*, *b*, *c* (`a,b,c`) может принимать одно или несколько значений
- **Every(a)** запускать каждые *a* (`*/a`)
- **FromTo(a, b)** запускать в промежутке от *a* до *b* (`a-b`)

Интервалы, в которых указана одна из верхних позиций и не указаны все нижние запрещены.

Примеры [тут](https://a.yandex-team.ru/arc/trunk/arcadia/market/idx/cron/update_cron_available/tests/test_interval.py)

## Restrictions

Ограничение на среду запуска.

Каждый *item* так же характеризуется средой запуска.

По умолчанию вызов *Restrictions()* эквивалентен вызову *Restrictions(envs=ALL_ENVS, dcs=ALL_DCS, idxs=ALL_IDXS, colors=ALL_COLORS)*.

Конструктор описывает перечисление, на котором задача будет выполняться.

Допустимые варианты смотреть [тут](https://a.yandex-team.ru/arc/trunk/arcadia/market/idx/cron/update_cron_available/src/enums.py)

## Важно

- На текущий момент не существует ***синего*** мастера. Поэтому джобы нужны для работы синего нужно добавлять и в ***белое***
- Если таск не нужно выполнять на PS нужно добавить ограничение `restrictions=Restrictions(idxs=IdxType.Main)`