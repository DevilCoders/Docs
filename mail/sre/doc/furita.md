### Что делает сервис
**furita** (почтовые фильтры) управляет правилами обработки писем по определенным критериям: перемещение писем в заданные папки, проставление статусов и меток, автоответы и т.п. Отвечает за доступ к фильтрам (конфигурации правил) в метабазе; умеет инициировать применение фильтра к существующим письмам посредством поиска (запрос в **msearch**) и обработки (запрос в **mops**).

### Импакт на пользователей от отключения сервиса
При недоступности сервиса не будет складываться входящая почта из-за невозможности применения потенциальных фильтров,
также пользователи не смогут добавлять, удалять и применять правила.

### Импакт остановки тачки/ДЦ
Балансер должен перенаправить нагрузку на другие тачки/ДЦ, нагрузка на них возрастет пропорционально.

### Особенности деплоя
Катим canary, смотрим на графики. При отсутствии проблем катим основной компонент.

### Критичные метрики
#### furita_5xx / furita-corp_5xx
Количество 5xx кодов ответа.

#### <service>_furita_errors / <service>_furita-corp_errors
Количество ошибок при походах в *service* (mops, msearch)

### Куда ходит
#### sharpei (clusterclient)
Определяет шард пользователя в метабазе по его uid'у.
#### mdb (macs_pg)
Получает и сохраняет информацию о почтовых фильтрах, правилах обработки писем пользователя.
#### mops
Для выполнения операций заданных фильтрами: удаление и перемещение писем, проставление статусов и меток писем. Например, когда запрашивается операция "применить фильтр" к существующим письмам.
#### so
В редких случаях, если в правилах фильтра задается автоответ, для проверки письма-ответа на спам.
#### msearch
Для поиска писем, отвечающим условиям некоторого фильтра, если требуется данный фильтр применить. Т.е. фактически за списком mid-ов, которые надо будет передать в **mops** для последующей обработки.
#### smtp (yaback)
В редких случаях, если в правилах фильтра задается пересылка письма на другой ящик, для отправления письма со ссылкой валидации принимающего ящика.
