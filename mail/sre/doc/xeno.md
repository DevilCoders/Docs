### Что делает сервис
Сервис позволяет использовать внешние почтовые системы (mail, google, yahoo, etc...) через приложение яндекс почты.
Выполняет фоновую синхронизацию ящиков, обслуживает мобильное апи.

### Импакт на пользователей от отключения сервиса
Пользователи не могут получить доступ к своим почтовым ящикам.

### Импакт остановки тачки/ДЦ
Шарды/бакеты перераспределяются между другими доступными инстансами сервиса.

### Особенности деплоя
Катим canary, смотрим на графики. При отсутствии проблем катим основной компонент.

### Критичные метрики
#### send_errors
Ошибки отправки/сохранения черновиков.
#### store_errors
Ошибки складывания писем через smtpgate.
#### missing_users
Для части пользователей не работает синхронизация и модифицирующие операции.
#### shards_in_sync
Распределение шардов по инстансам сервиса.
#### user_operations
Статус выполнения операций над пользовательскими ящиками.

### Куда ходит
#### lease (ymod_lease)
Захватываем диапазон пользователей (bucket).
#### sharpei (http_client)
Получаем информацию о шардах.
#### mdb (macs_pg)
Выполняем все операции с почтовой базой.
#### imap (ymod_imap_client)
Взаимодействие с чужими почтами, выполнение модифицирующих операций, фоновая синхронизация.
#### smtp (ymod_smtpclient)
Взаимодействие с чужими почтами, отправка писем.
#### social broker (http_client)
Получаем refresh_token; получаем/обновляем access_token по refresh_token для авторизации в чужих почтах.
#### rcache (cluster_client)
Используется для кэширования токенов (дополнительный слой перед social broker).
#### autoconfig.thunderbird.net (http_client)
Получаем настройки imap/smtp для чужих почт.
#### blackbox (http_client)
По uid получаем информацию о пользователе (method=userinfo), по xtoken проверяем его валидность и получаем информацию о пользователе (method=oauth)
#### passport-internal (http_client)
Регистрируем/авторизуем mailish пользователей.
#### mail.yandex.ru (http_client)
Проксируем читающие запросы в мобильное api большой почты.
#### sendbernar (http_client)
Формируем тело письма для отправки, сохранения черновиков.
#### hound (http_client)
Получаем attach_sid для аттачей.
#### webattach (http_client)
Получаем ссылку для загрузки аттача (message_part_real).
#### smtpgate (http_client)
Складываем письма (store), проверяем письма на спам перед отправкой (check_spam).
#### xiva (http_client)
При инвалидации авторизационных данных отписываем пользователя от пушей по uuid (/v2/unsubscribe/app).
