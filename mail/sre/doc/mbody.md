### Что делает сервис
**mbody** (message_body) читает письмо из MDS и выполняет предобработку: санитайзинг, обрезка слишком длинного письма, "оборачивание" опасных ссылок, подсветка email'ов и т.п.

### Импакт на пользователей от отключения сервиса
Пользователи перестанут видеть содержимое писем. Сам ящик, списки папок/писем, "первые строчки" писем и другие данные могут быть доступны. 

### Импакт остановки тачки/ДЦ
Балансер должен перенаправить нагрузку на другие тачки/ДЦ, нагрузка на них возрастет пропорционально.

### Особенности деплоя
При деплое обычно наблюдается небольшой всплеск по таймингам, отсутствие пятисоток обеспечивается посредством nginx.

### Критичные метрики
#### mbody_5xx и mbody_4xx

### Куда ходит
#### sharpei (clusterclient)
Для каждого входящего запроса определяет шард пользователя по его uid'у.
#### mdb (macs_pg)
Для каждого входящего запроса получает информацио о письме и его id-шник (stid) в MDS.
#### MDS (clusterclient)
Получает содержимое (тело и/или заголовки) письма, возможно, частями.
#### sanitizer (clusterclient)
Если тело письма это text/html (или text/plain) оно отправляется на обработку в санитайзер для поиска/удаления "опасного" содержимого. В зависимости от параметра конфига ```sanitizer_strategy```, возможна работа без санитайзера, через "тыкву" (грубое удаление HTML-ной разметки): пользователь увидит плохо отформатированное письмо.
#### fact-extractor (clusterclient)
В fact-extractor'е выполняется поиск "фактов" из интересующего списка (контакты, адреса, подписка/отписка и др.). При недоступности факты не подсвечиваются, пользователь видит нормальное письмо.
