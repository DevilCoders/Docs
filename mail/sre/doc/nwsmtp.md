### Что делает сервис
**nwsmtp** - центральный компонент Доставки, состоящий из нескольких кластеров и осуществляющий прием и отправку, а также обработку, в том числе проверку на SPAM и вирусы посредством смежных сервисов, проверку адресатов, добавление DKIM-подписи и/или ее проверку, проверку и дополнение различных заголовков, передачу письма в очередь доставки или отправки, маршрутизацию почты.
    * **mxback** (mxbackcorp) - кластер для отправки писем через HTTP-интерфейс и по SMTP-протоколу, приема и отправки писем с использованием сборщиков и xeno, а также обслуживания некоторых других потоков писем (автоответы, баунсы и др.).
    * **mxfront** (mxcorp) - кластер для приема писем от внешних почтовых систем, основной кластер приема почты по протоколу SMTP (mx.yandex.ru, mx.yandex-team.ru).
    * **smtp** (smtpcorp) - кластер для отправки почты с помощью SMTP-клиентов (почтовых приложений).
    * **yaback** - кластер для отправки писем от внутренних сервисов Яндекса (passport, startrek и другие).

### Импакт на пользователей от отключения сервиса
При отключении сервиса пользователи и прочие системы не смогут отправлять и получать почту, сохранять черновики. Отключение отдельных кластеров влияет на соответсвующие группы пользователей и подсистемы.

### Импакт остановки тачки/ДЦ
Балансер должен перенаправить нагрузку на другие тачки/ДЦ, нагрузка на них возрастет пропорционально.

### Особенности деплоя
Катим canary, смотрим на графики. При отсутствии проблем катим основной компонент. Компонент canary реализован в отдельном окружении.

### Критичные метрики
#### *_smtp_4xx
#### *_smtp_5xx

### Куда ходит
#### blackbox (http_client)
Для получения информации о пользователе, определения принадлежности, проверки авторизации при выполнении SMTP-запросов.
#### rbl (cluster_client)
Для проверки IP-адресов отправителя на благонадежность по специальной базе.
#### so (cluster_client)
Для проверки входящих и исходящих писем на SPAM, определения типов писем (например, рассылки) и получения другой информации.
#### yavs (ICAP)
Для проверки входящих и исходящих писем на вирусы.
#### beagle/ml (cluster_client/http_client)
За информацией о адресах-рассылках (prod/corp).
#### fouras (http_client)
За приватным ключом домена для вычисления DKIM-подписи отправляемых писем.
#### MDS (http_client)
В некоторых случаях для сохранения письма в MDS.
#### notsolitesrv (cluster_client, LMTP)
Для сохранения письма в MDS и/или подготовки и сохранения метаинформации о письме в метабазе (MDB).
#### yarm (http_client)
За данными о логине/пароле необходимыми при отправке писем от имени внешних SMTP-систем (например, через smtp.mail.ru).
#### ratesrv (http_client)
Для проверки различных ограничений (лимитов): количества коннектов, количества отправляемых и получаемых писем с учетом отправителей/получателей, размеров писем и т.п.
#### settings (cluster_client)
При попытках авторизации SMTP-клиентов для проверки допустимости работы по протоколам POP3/IMAP.
#### postfix/forward (SMTP)
Postfix-очередь доставки/отправки писем (поддерживает ретраи и используется в качестве фолбэка).
