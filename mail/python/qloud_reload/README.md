### Обоснование

Данный скрипт был создан в связи с тем, что Qloud не совсем корректно производит остановку приложения, точнее, отключение инстанса от балансера. Отсюда и этот скрипт. Что он делает?

* Слушает порт 23456, обращение к этому порту приводит к тому, что скрипт блокирует ручку приложения, которую слушает балансер. Через 10 секунд после этого балансер перестанет лить трафик на этот инстанс. При этом все остальные ручки приложения будут доступны.
* Скрипт рассчитывает на путь в инстансе /etc/nginx/includes/lock_ping, на основе которого он создаёт символическую ссылку /etc/nginx/includes/lock_ping.safe. После чего nginx получает сигнал плавной перезагрузки конфигурации. При этом ручка проверки сразу начинает отдавать 503.
* После сигнала перезагрузки ссылка удаляется. Т.е. при повторных перезапусках приложения ручка заблокирована не будет, чтобы не вызвать внезапный перманентный блок приложения с точки зрения балансера.

### Пример скриптов nginx

Данные скрипты не совсем возможно формализовать, поскольку в зависимости от фреймворка и прочих обстоятельств балансер может проверять различные ручки. Поэтому я лишь приведу пример того, что должно быть в образе, на основе mail/caldavos. Вот что записано в /etc/nginx/includes/lock_ping:

```nginx
location = /health {
    return 503;
}
```

А вот что записано в /etc/nginx/sites-available/app.conf:

```nginx
location ~ ^/(ping|health)$ {
    proxy_pass http://localhost:8080;
}
```

Поскольку проверка на точное совпадение имеет приоритет перед регуляркой, при подключении этого файла в конфигурацию ручка /health начнёт отдавать балансеру 503.