# Миграция с версий до 37

В версии 37 произошли следующие изменения:
- Добавлен новый интерполятор `ydb` (`import ru.yandex.vertis.ydb.skypper.syntax._`) с улучшенной типизацией. Старый интерполятор (`YdbInterpolatorUtils`) больше не поддерживается.
- Реорганизованы методы-обёртки. Вместо отдельных методов работающих со строкой, `PreparedQuery` и новым типом `Fragment` теперь можно использовать одно и то же наименование метода. Например, вместо `queryPreparedAsync[...](...)(...)` теперь можно писать `queryAsync[...](...)(...)`.
- Основные методы над которыми были эти обёртки переименованы и сделаны `protected`.

## Примерный план миграции

### Обязательная часть

Без этого использующий код просто не соберётся.

- Отрабатываем переименование основных методов. Если в каком-то из использующих
  классов переопределялись методы `query`, `queryAsync`, `update`, `updateAsync`
  (например, в целях логирования), то их нужно переименовать в `queryImpl`,
  `queryAsyncImpl`, `updateImpl`, `updateAsyncImpl` соответственно. **Важно:**
  вызовы вида `super.query` тоже необходимо переделать - иначе получим переполнение стека.

### Опциональная часть

Этим можно заниматься после первичной миграции, в спокойном режиме.
- Заменяем использование `queryPrepared` на `query`, `queryPreparedAsync` на `queryAsync` и т. д..
- Заменяем использование `YdbInterpolatorUtils` на `import
  ru.yandex.vertis.ydb.skypper.syntax._`. Следим за типами интерполируемых
  значений - `Int` теперь отображается в `Int32` а не в `UInt32` как ранее,
  аналогично с другими числовыми типами. При необходимости можно явно указать
  SQL-тип: `ydb"SELECT ${intValue as uint32}"` - `uint32` импортируется из
  `Put`. Выражения вида `ydb"INSERT INTO ... VALUES $values"` превращаются в
  `ydb"INSERT INTO ... ${Fragment.values(values)}"`. Вместо типа `PreparedQuery`
  используем `Fragment`.
