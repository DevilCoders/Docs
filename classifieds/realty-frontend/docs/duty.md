# Дежурство

Для новичков проводится курс лекций про общую инфраструктуру и дежурство, актуальный список презентаций можно посмотреть [здесь](https://wiki.yandex-team.ru/users/romanpoleguev/kmb/).

Каждую неделю назначается дежурный из команд, ответственный за своё направление.

[График дежурств B2C](https://abc.yandex-team.ru/services/realty/duty/?role=3521).

[График дежурств MNZ](https://abc.yandex-team.ru/services/realty/duty/?role=3522).

## Первое дежурство

Первое дежурство назначается только спустя три месяца с момента выхода на работу.

В начале первого дежурства нужно:
* Добавить телеграм канал [verticals-duty](https://t.me/joinchat/AjIsiT5M0IofbqAG5ElBEg),
чтобы быть в курсе факапов или сообщать о них.
* Добавить телеграм канал учений [verticals-tech-warroom](https://t.me/joinchat/AjIsiRnjgfZXiNKgednCgQ).
* Добавить телеграм канал [багов в недвижимости](https://t.me/joinchat/RsCvSzOPNzkNWkAq).
* Добавить себя в [настройки alert'ов](https://juggler.yandex-team.ru/notification_rules/?query=rule_id=5d13994fdcc66c0068fa64d4).
* Добавить бота `@JugglerSearchBot` для получения alert'ов.
* Добавить бота `@VertisAnnouncementBot` для получения анонсов.
* Научиться работать с [серверными логами](./logs.md#серверные-логи).
* Научиться анализировать [графики метрик](./metrics/metrics.md).

## Обязанности дежурного

* Реагировать на [алерты](./alerts.md);
* Разбираться с проблемами на сервисе, которые появляются во время дежурства;
* Реагировать/разбирать/делать таски с тегом duty и таски жучка на [доске дежурств REALTYFRONT](https://st.yandex-team.ru/agile/board/15021);
* Быть на месте с 10:00 до 19:00 (Если в это время недоступен и заранее не предупредил, то будем ругать).

> Если случился факап, а дежурного нет на месте, то пробуем связаться с его руководителем, потом с руководителем руководителя и т.д.

> Если дежурный во время своего дежурства не успевает разобраться с таском из разряда "Разобраться в причинах выросшего фона пятисоток",
> то таск переходит к следующему дежурному, при этом нужно детально описать в таске какие шаги уже были проделаны и что не получилось.
> Если же дежурный близок к решению, но дежурство уже закончилось, то добивает задачу самостоятельно, а не передает следующему.

## Релизный процесс

* Тикеты релиза версионируются по дате релиза тестировщиком, например, `front_01_01_2019`;
* Тестировщик смерживает тикеты релиза в мастер через интерфейс github, переводит таски в статус `Merged`;
* Если при смерживании тикетов есть конфликты, то на помощь призывается автор PR;
* Тестировщик собирается пакеты в тестинг;
* Тестировщик отсматривает таски, прогоняет автотесты. Меняет статус задач на "Готово к релизу";
* Тестировщик раскатывает релиз;
* Тестировщик отписывается в [телеграмм-чат](https://t.me/joinchat/ADHYsVBFCdYv_xGt53zC6g) о выкатке или переносе релиза и закрывает задачи.

> Если в результате тестирования понимаем, что какой-то таск вызывает проблемы, то можно или сделать `git revert`(через интерфейс github) таска
или создать бранч без проблемного таска и пересобрать релиз.

Пример формата для отписки в чат
```
#релизфронта

* REALTYFRONT-1: Сделать фичу 1
* REALTYFRONT-2: Сделать фичу 2

https://st.yandex-team.ru/REALTYFRONT/order:updated:false/filter?fixVersions=83534
```

## Тайминги сборки и выкатки релизов

* Мержим в мастер до 16:00, но лучше начать раньше
* В 16:00 запускаем сборку изменившихся проектов
* Выкатываем в прод до 18:00

Если до 18:00 релиз не успели выкатить, катим на следующий день до 13:00.
Если опять не успели, то до 18:00.

Из любых правил бывают исключения, но нужно заранее договориться.

> Выкатываемая версия должна соотвествовать текущей дате, если докатывается вчерашний релиз необходимо поменять версию у задач.
Если в 1 день планируется несколько релизов, нумеруем их `front_01_01_2019-1`, `front_01_01_2019-2` и т.д.
