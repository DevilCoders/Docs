# Рекомендации по TBD

- Разработка больших задач происходит итеративно. Большие задачи бьются на подзадачи. При декомпозиции задач следует руководствоваться принципами INVEST (1).
- Подзадачи вливаются в транк под флагом фичи, либо вливаются без использования в коде.
- Каждая подзадача перед залитием в транк должна пройти код-ревью. Чтобы ревью проходило быстрее декомпозируйте задачи в соответствии с принципами INVEST (1). Приоритет ревью задач обсуждаем в рамках команд разработки.
- Каждая подзадача перед залитием в транк должна быть покрыта тестами, как минимум на основные кейсы, если имеется техническая возможность их написания или нет других веских и исключительных причин не писать тесты для подзадачи.
- Каждая задача под фича-флагом должна быть максимально локализована, чтобы в наименьшей мере затрагивать места проекта, не связанные с самой задачей.
- Подзадачи должна иметь в названии задачи и в коммите отметку [FF]. Пример: “REALTYFRONT-12345: [FF][CLASSIFIED][desktop] Чипсы над квартирографией”, чтобы в истории транка была индикация мержа задачи без тестирования.
- Изменения на сервере в рамках подзадач должны быть полностью обратно совместимы, либо закрыты флагами для локализации логики в рамках одной фичи.
- После закрытия всего набора подзадач, необходимого для публичного релиза, задача переводиться в тестирование, включается фича-флаг для тестового окружения. После необходимых правок в транк в результате тестирования задачи происходит доставка задачи до прода с включением фича-флага для продового окружения.
- Фича-флаги задачи удаляются после выкатки задачи в продакшн, если в проде не возникло проблем. Если же в проде случились проблемы с фичей, то фичу есть возможность выключить.
- Фича-флаги удаляются из продакшна как можно скорее, чтобы не было увеличения сложности кода за счет чрезмерного ветвления. В качестве исключения, для фич, где необходимо иметь возможность выключения фичи на длительном периоде времени, допускается отложенное по времени удаление флага. Для удаления флага заводится отдельная подзадача, прилинкованная к основной задаче.
- Важно различать A/B-флаги экспериментов и feature-флаги. При необходимости проведения экспериментов для задачи, которая разрабатывается под фича-флагами, нужно завести отдельно A/B-флаги и feature-флаг.
- Для работы в фича-флагами используем специальный фронтовый инструментарий. См. @realty-front/feature-toggles. Типы для фич: https://a.yandex-team.ru/arcadia/classifieds/realty-frontend/realty-core/app/lib/feature-toggles/types.ts?from_pr=2621805&rev=r9585510.
- Для именования фича-флагов используем следующее соглашение, по аналогии с экспериментальными флагами: “<ключ задачи>_<краткое_название_фичи_латиницей>”. Пример: “REALTYFRONT-555_new_great_feature”.

## Декомпозиция по INVEST (1):

- Independent — независимая (подзадачи должны стараться быть как можно более независимыми между собой, чтобы каждая из них могла быть разработана параллельно).
- Negotiable – обсуждаемая (каждую подзадачу можно конкретно описать и конструктивно обсудить).
- Valuable – ценная (каждая подзадача должна вносить какую-то ценность).
- Estimatable – поддающаяся оценке (каждой подзадаче можно дать реальную оценку).
- Small – небольшая (каждая подзадача должна быть небольшой и иметь короткий срок разработки).
- Testable – тестируемая (каждую подзадачу можно удобно поревьюить, покрыть тестами и потестировать руками).
