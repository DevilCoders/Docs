## Условия оказания услуг

В системе существует 2 типа услуг, с которыми может согласиться пользователь:

1. Базовые условия сервиса (с ними соглашаются все пользователи, поле `terms_of_use` в `UserData`)
2. Условия сервиса для жильца (поле `tenant_terms_of_use` в `UserData`)

Условия жильца различаются версиями. Каждая новая версия условий содержит в себе некоторый набор изменяемых полей.
Добавление версии условий для жильца осуществляется силами бэкенд разработки.

Жилец соглашается с последними условиями сервиса согласно следующей логике:

1. В момент подписания договора аренды.
2. При инициализации первого платежа.

В момент подписания договора условия, с которыми пользователь подписал договор сохраняются в договор.

Если выходят новые условия сервиса, обязательные к подписанию, то при инициализации платежа за АП пользователь подпишет
эти условия. Если жилец не хочет подписывать эти условия, то он может обратиться в поддержку и админ может скрыть эти
условия от пользователя. Аналогично, поддержка может снова включить отображение. Скрытые условия не подписываются
пользователем при инициализации платежа. Проверка на такие условия есть в классе пользователя:

`ru.yandex.realty.rent.model.User.shouldUpdateAcceptedTenantTerms`

Основная логика находится в классе:

`ru.yandex.realty.managers.rent.DefaultTermsManager`

Вся история принятых условий хранится у пользователя. В момент расторжения договора аренды эти условия чистятся.
Впоследствии зафиксированные условия в договоре и у пользователя позволяют определить текущие условия, по которым
осуществляется аренда.

### Шаблон условий

Условия хранятся в виде класса `ru.yandex.realty.rent.model.ContractTerms` с полями:

- `version` - номер версии. Должен быть на единицу больше предыдущего
- `url` - актуальная версия всегда хранится по https://yandex.ru/legal/realty_lease_tenant/
- `isPaymentSchemaChanged` - меняется ли схема платежей в этой версии
- `publicationDate` - дата публикации версии
- `effectiveDate` - дата вступления в силу версии
- `isSigningRequired` - обязателен ли к подписанию текущими жильцами
- `comment` - комментарий

### Как добавлять новые версии?

Шаблон задачи по добавлению новой версии: https://st.yandex-team.ru/REALTYBACK-8477

При добавлении новой версии необходимо:

1. В качестве поля `version` новой версии нужно использовать `version`+ 1 из текущей версии
2. Поле `url` текущей версии с https://yandex.ru/legal/realty_lease_tenant/ меняется
   на `https://yandex.ru/legal/realty_lease_tenant/ddMMyyyy`, где `ddMMyyyy` есть дата вступления в силу этой версии.
   Например, если дата вступления в силу 16.06.2022, то ссылка для текущей версии должна
   стать `https://yandex.ru/legal/realty_lease_tenant/16062022`. Новая версия **всегда** добавляется с
   ссылкой `https://yandex.ru/legal/realty_lease_tenant/`
3. Если в новой версии меняется схема платежей, то со стороны бэкенда требуется поддержка новой схемы для новых
   договоров: в зависимости от версии, с которой заключается договор, необходимо использовать нужную схему платежей. Не
   смотрим на то, что подписал жилец.
4. Если в новой версии меняется схема платежей и в задаче также указано, что она должна примениться для текущих жильцов,
   то со стороны бэкенда требуется поддержка новой схемы как для новых договоров, так и для тех договоров, где жилец уже
   принял эту новую версию. В таком случае, проверяем, не подписал ли жилец нужную версию.