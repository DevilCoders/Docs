## API сервиса

Сервис предоставляет gRPC API, включающее методы:

1. `createOrderWithItems` - Ручка создания нового ордера с услугами.

   _**Функционал**_: Ручка принимает на вход orderId, entityId, тип ордера и множество добавляемых услуг. Ручка создаёт
   события в следующем порядке: сначала события открытия ордера, а после события добавления услуг в последовательности
   из запроса.

   **_Идемпотентность_**: Присутствует. Если существует открытый ордер с таким orderId и таким же набором _действующих_
   услуг, то ручка завершится без ошибок и не добавит новых событий.

   **_Ошибки_**: Если ордер отклонен, то ручка вернет ошибку с кодом `409`. Если уже существует ордер с другим набором
   действующих услуг или с другим типом или с другим `entityId`, то ручка вернет ошибку с кодом `409`. Если среди
   добавляемых услуг некоторые услуги имеют одинаковый `orderItemId`, то ручка вернет ошибку с кодом `400`

2. `updateOrder` - Ручка обновления ордера и услуг, через которую можно отменять и добавлять услуги в ордер.

   _**Функционал**_: Ручка принимает на вход orderId, содержимое типа ордера, множество `orderItemId` отменяемых услуг и
   множество добавляемых услуг. Через тип ордера можно _опционально_ изменить общие параметры ордера. Например, для
   ордера на АП можно поменять дату платежа и тип ордера (полный или короткий). Ручка создаёт события в следующем
   порядке: сначала событие изменения ордера, потом события отмены услуг в последовательности из запроса, а после
   события добавления услуг в последовательности из запроса. Таким образом можно обновить услугу с `orderItemId` в
   ордере, если через эту ручку сразу отменить эту услугу и добавить её заново с новым `orderItemId` (при обновлении
   услуга меняет `orderItemId`).

   **_Идемпотентность_**: Присутствует. Ручка отменит только действующие услуги (отмененные проигнорирует) и добавит
   только отсутствующие услуги в ордер (добавленные проигнорирует).

   **_Ошибки_**: Если ордер не найден, то ручка вернет ошибку с кодом `404`. Если ордер отклонен, то ручка вернет ошибку
   с кодом `409`. Если меняем тип ордера на другой тип, то ручка вернет ошибку _409_. Если стоимость добавляемых услуг
   отрицательна, то ручка вернет ошибку с кодом `400`. Если добавляются услуги с тем же `orderItemId`, что и отменяются,
   то ручку вернет ошибку с кодом `400`. Если отменяются услуги, которых нет в ордере, то ручка вернет ошибку с
   кодом `404`. Если среди множества отменяемых услуг есть дубликаты `orderItemId`, то ручка вернет ошибку с кодом `400`
   . Если среди добавляемых услуг некоторые услуги имеют одинаковый `orderItemId`, то ручка вернет ошибку с кодом `400`.

3. `declineOrder` - Ручка отмены ордера. Позволяет отменить ордер и скрыть его от отображения (мягкое удаление)

   _**Функционал**_: Ручка принимает на вход orderId. Если ордер был открыт, то он отклонится

   **_Идемпотентность_**: Присутствует. Если мы попытаемся отклонить отклоненный ордер, то ручка завершится без ошибок и
   не добавит новых событий.

   **_Ошибки_**: Ожидаемые отсутствуют

4. `restoreOrder` - Ручка восстановления ордера из отклоненных.

   _**Функционал**_: Ручка принимает на вход orderId. Если ордер был отклонен, то он может быть восстановлен через эту
   ручку.

   **_Идемпотентность_**: Присутствует. Если существует открытый ордер с таким orderId, то ручка завершится без ошибок и
   не добавит новых событий.

   **_Ошибки_**: Если ордер с таким `orderId` не существует, то ручка вернет ошибку с кодом `400`.

5. `getOrder` - Ручка получения ордера
   _**Функционал**_: Ручка принимает на вход orderId и отдаёт сконструированный ордер.

   **_Идемпотентность_**: Не требуется, ручка не меняет состояние

   **_Ошибки_**: Если ордер с таким `orderId` отсутствует, то ручка вернет ошибку с кодом `404`.

6. `getOrders` - Ручка получения ордеров
   _**Функционал**_: Ручка принимает на вход entityId и отдаёт сконструированные ордеры, отсортированные по началам
   периодов в услугах этих ордеров. А именно берется минимум среди `period_start_date` всех услуг в каждом оредере и по
   ним осуществляется сортировка. Сделано для поддержки Аренды.

   **_Идемпотентность_**: Не требуется, ручка не меняет состояние

   **_Ошибки_**: Ожидаемые отсутствуют