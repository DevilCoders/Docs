## Терминология по платежам

### Основные сущности {#entities}

![entities](img/entities.png)

- **Договор** (`RentContract`, ДА) - документе о договоре аренды, содержит набор параметров (дата сдачи, сумма арендной платы и т. п.), на основе которых генерируются платежи.
- **Доп. соглашение** (`ContractualAgreement`, ДСка) - документ, меняющий параметры договора в середине его жизни (начиная с момента изменения платежи генерируются иначе).
- **Платёж** (`Payment`) - соответствует определённому периоду аренды (обычно полному месяцу, но иногда хвостику), который жилец оплачивает целиком и который целиком переводится собственнику; содержит информацию о транзакциях через Тинькофф.
- **Транзакция** (`TenantPaymentTransactionInfo`, `OwnerPaymentTransactionInfo`) - разовая попытка перевести деньги - от жильца к нам (платёж) или от нас к собственнику (выплата), удачная или неудачная.

### Виды доп. соглашений

- Сдвиг даты платежа (`PaymentDayOfMonthMovement`) - заменяет значение `payment_day_of_month` в договоре,
  приводит к созданию одного платежа-хвостика и дальнейшей генерации раз в месяц с новой датой.
- Изменение арендной платы (`RentChange`) - изменение АП на новую сумму - либо на постоянную,
  либо на временную (на несколько первых месяцев после заключения ДС) и дальнейшую постоянную.

### Параметры договора аренды {#rent-contract-attributes}

Ниже перечислены только те параметры договора, которые участвуют в генерации платежей.

#### Основные параметры {#rent-contract-main-attributes}

- Дата начала действия ДА (`rent_start_date`) –
  день, когда формально договор вступает в силу, с этой даты начинают генерироваться платежи.
- День платежа (`payment_day_of_month`) –
  день месяца, в которое жилец должен оплачивать аренду.
- Сумма арендной платы (`rent_amount`, АП) –
  сумма, которую раз в месяц получает собственник.
- Сумма страховки (`insurance_amount`, S) –
  сумма, которую раз в месяц перечисляем в страховую компанию по данному договору
- Временные суммы (`temporary_amounts`) –
  суммы АП и страховки отличные от обычной АП,
  установленные по договору на несколько месяцев после начала аренды
  или после начала действия ДС. Как правило, это скидка на несколько месяцев.
- Процент комиссии (`commission`, K) –
  процент от суммы АП, который снимаем с жильца и оставляем на своём счёте.

#### Параметры, влияющие на завершения аренды {#rent-contract-termination-attributes}

- Дата фактического съезда (`termination_date`) –
  дата в которую жилец покидает арендуемую квартиру
- Дата уведомления о расторжении (`notification_date`) –
  дата в которою жилец оповещает о дате съезда,
  может быть как раньше даты съезда, так и позже(жилец сбежал)
- собственник согласовал съезд без доплат(`check_out_without_additional_payments`) –
  разрешает не выплачивать 30 дней
  (подробнее в [описании генерации платежей](./rules-for-payment-generation.md#last-condition-period-end))
- Жилец не согласился оплатить 30 дней(`tenant_refused_pay_for_30_days`) –

### Параметры платежа {#payment-attributes}

Ниже перечислены основные параметры платежа, участвующие в его жизненном цикле и
процессе оплаты (на самом деле параметров больше).

- `start_date` и `end_date` - даты начала и конца соответствующего периода аренды.
- `payment_date` - дата, до которой включительно жилец обязан оплатить данный платёж
  (сейчас всегда совпадает со `start_date`).
- `type` - тип платежа (аренда квартиры или ЖКХ).
- `status` - текущий статус оплаты и выплаты за данный период.
- `tenant_payment_amount` - сумма, которую платит жилец (включает комиссию и страховку наряду с АП).
- `owner_payment_amount` - сумма, которую переводим собственнику (совпадает с АП).
- `insurance_payment_data` - суммы страховки, включённые в данный платёж.
- `fullness_type` - тип "полноты" платежа: полный (т. е. за целый месяц), либо хвостик
  (по какой-либо из причин).
- `is_paid_out_under_guarantee` - признак, был ли данный платёж выплачен собственнику
  по поручительству (т. е. до того, как его оплатил жилец).

### Статусы платежа {#payment-statuses}

![payment statuses](img/payment-statuses.png)

- `FuturePayment` - будущий платёж, который ещё нельзя оплачивать
  (до его `start_date` осталось более 10 дней).
- `New` - платёж, который ждёт оплаты жильцом.
- `PaidOutUnderGuarantee` - платёж выплачен собственнику по поручительству,
  но ещё не оплачен жильцом.
- `PaidByTenant` - платёж оплачен жильцом, но ещё не выплачен собственнику.
- `PaidToOwner` - платёж успешно выплачен собственнику.
