# Чаты в Недвижимости

Есть четыре вида чатов, каждый из них устроен немного по-разному:

- чаты с техподдержкой (ТП);
- чаты с владельцами объявлений (они же P2P-чаты, они же C2C-чаты);
- чаты с застройщиками (developer chats, devchats, девчаты);
- чаты по офферам Я.Аренды (ЧПО).

Все эти чаты объединены тем, что используют одно и то же хранилище — сервис [chat-backend](./chat-backend.md). Помимо общего хранилища, клиентская сторона, реализованная в нашем фронте и приложениях, во всех этих случаях общается с бэком через gateway. А вот логика бэкэнда во всех случаях реализована по-разному.

Чаты с владельцами никакой хитрой логики не имеют вообще. Это просто комната в ч-б с двумя участниками, которые переписываются друг с другом, используя каждый свое приложение. Владелец объявления имеет возможность контролировать через свой ЛК, могут ли другие пользователи писать ему в чат по объявлениям.

Чаты с ТП не имеют почти никакой логики в нашем репозитории, за исключением немного необычного способа добавления ссылки на этот чат в список других чатов. Передача сообщений операторам ТП и назад, а также все дополнительные фичи (бот, опросы и так далее) реализованы полностью силами команды модерации. Контактное лицо — [Леша Половинкин](https://staff.yandex-team.ru/awethon).

Девчаты и чаты Аренды архитектурно похожи. Исторически сначала делались девчаты, их архитектура была слизана с чатов ТП с некоторыми изменениями; после этого чаты Аренды сделали по аналогии с девчатами. В отличие от бота ТП, который должен уметь только водить пользователя по сценарию (задавать вопросы и предлагать варианты ответов), практически каждый пункт сценария этих двух чатов включает в себя какие-то особые действия и проверки, которые требуют специальной разработки на бэке. Поэтому и граф переходов бота этих чатов реализован почти полностью в коде, а не в виде большого JSON с описанием графа, как в ТП; продуктовым менеджерам Классифайда и Аренды доступны для прямого изменения только некоторые параметры таких чатов, в основном тексты сообщений и пресетов ответов, отправляемых в тех или иных случаях.

Со стороны Недвижимости контактные лица:

- По чатам ТП — примерно кто угодно, но больше всего понимают [Руслан Мужиков](https://staff.yandex-team.ru/rmuzhikov) и [Леша Лукашев](https://staff.yandex-team.ru/kerfitd).
- По чатам Классифайда — P2P и девчатам — лучше ходить к Руслану, но можно к Леше.
- По чатам Аренды больше всего знает Леша, можно также обращаться за помощью к [Косте](https://staff.yandex-team.ru/lyubortk) и в самом крайнем случае к Руслану.
