# chat-backend

Метаданные чат-комнат и история переписки всех наших чатов хранится в общевертикальном сервисе `chat-backend` (чат-бэк или просто ч-б).

Код ч-б лежит [в Аркадии](https://a.yandex-team.ru/arcadia/classifieds/chat-backend). Из этого кода собирается один докерный образ, который потом раскатывается на две разные инсталляции (с разными базами данных, балансерами и т. д.): одна для Авто.ру, другая для Недвижимости. Деплой приложения для Недвижимости осуществляется через бота в [чате в Телеграме](https://t.me/+F1fm6WHuuF9DE8wa).

Писал всю эту радость изначально [Андрей](https://staff.yandex-team.ru/aborunov), и он же частично поддерживает код сервиса (и инсталляцию для Авто.ру). Однако все изменения, которые нужны Недвижимости, нам нужно делать самостоятельно. На обсуждение и ревью стоит приглашать Андрея, а с нашей стороны — [Руслана](https://staff.yandex-team.ru/rmuzhikov) и [Лешу](https://staff.yandex-team.ru/kerfitd).

Общение с сервисом происходит тремя способами. Во-первых, у него есть [HTTP API](http://chat-api-realty.vrts-slb.test.vertis.yandex.net/swagger/?url=/api/1.x/), через которое можно производить все поддерживаемые действия с чатами (создание комнат и сообщений, получение информации по существующим, изменение метаданных). Во-вторых, сервис пишет в Кафку топик со всеми событиями. В-третьих, для особо сложных случаев можно встроить в код походы в вебхуки других сервисов; в частности, так сделано для Недвижимости, чтобы быстро отправлять уведомления о новых сообщениях (и некоторые другие).
