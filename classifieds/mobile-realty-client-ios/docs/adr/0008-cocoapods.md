# Пакетный менеджер

* Статус: Принято
* Ответственные: [coreshock](https://staff.yandex-team.ru/coreshock), [pavelcrane](https://staff.yandex-team.ru/pavelcrane), [maniak](https://staff.yandex-team.ru/maniak)
* Дата: A long time ago

## Контекст

Для простоты поддержки проекта и ускорения инкрементальной сборки его стоит разбивать на пакеты и модули.<br/>
Для управления зависимостями пакетов, их развертыванием и сборкой лучше всего использовать готовый инструмент.

## Рассматриваемые варианты

* [CocoaPods](https://cocoapods.org/)
* [Carthage](https://github.com/Carthage/Carthage)
* [Swift Package Manager (SPM)](https://swift.org/package-manager/)
* [Bazel](https://bazel.build/)
* [Buck](https://buck.build/)
* [Ninja](https://ninja-build.org/), [GN (Generate Ninja)](https://fuchsia.dev/fuchsia-src/concepts/build_system/intro)

## Принятое решение

Выбран вариант: "CocoaPods", потому что он удовлетворяет следующим критериям:
* является пакетным менеджером
* является стандартом де-факто
* поддерживает локальные пакеты
* предоставляет возможности интеграции скриптов в процесс установки и сборки

Изначальный выбор был сделан в 2015 году, когда альтернатив было недостаточно. В дальнейшем, с разделением проекта на модули (2018-2020 гг), принятое решение не было пересмотрено в связи с указанными выше причинами.  

### Позитивные последствия

* может быть заменен на другой аналогичный по возможностям пакетный менеджер (например, на SPM)

### Негативные последствия

* неповоротливый (время установки пакетов – линейно, время запуска проекта – нелинейно)
* не предоставляет возможности кэширования артефактов сборки

## Плюсы и минусы вариантов

### CocoaPods

Исторический стандарт.<br/>
Первый пакетный менеджер для iOS. Написан на Ruby.

Хороший, потому что:
* стандарт де-факто; хорошо себя показал за все время существования
* практически все библиотеки предоставляют пакет в формате CocoaPods
* есть возможность расширять скриптами через хуки установки, через плагины, скрипт-фазы, встраиваемые в сборку, или средствами monkey-patching Ruby
* есть поддержка локальных пакетов
* есть поддержка ресурсов через bundle
* есть поддержка под-пакетов (включая тесты и ресурсы)

Плохой, потому что:
* сложно правильно развернуть (решено)
* морально устарел, новые версии выходят редко
* отсутствует система кэширования сборок пакетов
* медленный на достаточно больших проектах
* нет поддержки ресурсов через xcassets
* генерирует очень большой файл проекта (особенность Xcode)

### Carthage

Пакетный менеджер, пришедший на смену CocoaPods, для поддержки динамических библиотек без необходимости держать описание библиотеки. Написан на Swift.

Хороший, потому что:
* быстрый
* библиотеки предсобираются на этапе установки
* есть поддержка ресурсов

Плохой, потому что:
* поддерживает только GitHub, Git и локальные бинарные (предсобранные) библиотеки
* нет поддержки скриптов для развертывания

### Swift Package Manager (SPM)

Нативный пакетный менеджер, предоставляемый Apple.

Хороший, потому что:
* решение от разработчика языка и сборочных инструментов
* есть поддержка локальных пакетов
* хорошая система кэширования

Плохой, потому что:
* очень долго добавляются новые фичи (например, поддержка ресурсов)
* меньший (по сравнению с CocoaPods) объем библиотек, предоставляющих поддержку SPM
* долгая проверка/скачивание зависимостей при открытии проекта

### Buck, Bazel, Ninja

Не являются пакетными менеджерами. Это инструменты сборки и кэширования артефактов сборки.

Невозможно быстро и в полном объеме оценить все положительные и отрицательные стороны каждого из них. Далее в списке приведены общие доводы в контексте проекта.

Хороший, потому что:
* масштабируемый
* поддерживает скрипты
* разрабатывается крупными игроками: Google (Bazel, GN), Facebook (Buck)

Плохой, потому что:
* не является пакетным менеджером
* есть частичная поддержка пакетов CocoaPods, однако в основном требуется либо дублирование описания пакета, либо ручные правки автогена
* сложен для перевода всего проекта на новую систему сборки
