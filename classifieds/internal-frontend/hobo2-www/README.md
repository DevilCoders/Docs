# hobo2-www
Hobo - сервис, позволяющий производить асессорам ручную модерацию объявлений для вертикальных сервисов.
Hobo реализует очередь для объявлений, подлежащих модерации.

## С чего начать разработку?
1. Выполняем `npm i` (установит все зависимости и соберет проект)
2. Запускаем `npm run dev` для разработки

## Разработка

### Команды
* `npm run dev` watch изменений, вывод логов и запуск node
* `npm run build` сборка клиентского приложения в /build
* `npm start` запуск node (используется для продакшна)

## Ссылки
* [dev](https://hobo2.test.vertis.yandex-team.ru)
* [prod](https://hobo2.vertis.yandex-team.ru)

## Бизнес-процессы
### Снепшоты (слепки) данных

Хобо сохраняет ответы бэкендов во view задач. 
Собираются данные в хелпере `internal-core/server/data-providers/hobo/task-view.js`.
Сохранение их во view происходит в 2х случаях: взятие задачи в работу и явный вызов updateView.

Процесс следующий:

1. При взятии задачи в работу есть проверка на то, что задача — проверочная (`type !== 'ORIGINAL'`). 
Если это так, в её view сохраняется view исходной задачи (по ключу `initialTaskKey`).
Если это не так, то view формируется из ответов бэкендов хелпером `task-view`. 
При этом, если очередь — проверочная, view вообще не сохраняется для такой задачи, а просто достаётся из одной из исходных задач.
   
2. При открытии задачи:

    а) Если задача — проверочная, загружается её view (сформированное ранее из исходной).
   
    б) Если нет, view формируется заново, походами в бэкенд (при каждом запросе задачи).

3. В процессе работы над задачей оператор может обновить данные (например, через форму в Автоцентре). В этом случае:
   
    а) Если задача — проверочная, запрос в бэкенд на обновление не уходит, вместо этого view задачи обновляется,
   "фейковыми" данными, чтобы в дальнейшем отображать изменения при обновлении страницы.
   
    б) Если нет, запрос на обновление уходит в настоящий бэкенд.
