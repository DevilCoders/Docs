# Доступы
Основа ограничений доступов внутренних сервисов. Каждый авторизованный пользователь имеет связь логин пользователя - набор `rolePath`. Данную логику реализует [idm-api](https://github.com/YandexClassifieds/internal-frontend/tree/master/idm-api). Список ролей и их связей описывается в [манифестах](#user-content-manifestsjson-манифесты). Каждая конкретная роль может включать список других ролей (includedRoles).

На уровне nodejs приложения на каждый запрос к конкретному route идет проверка на наличие связи между набором разрешений пользователя и требуемым rolePath для доступа (логика [check](https://github.com/YandexClassifieds/internal-frontend/blob/upddocs/internal-core/server/middlewares/check-permission.js)).

На уровне react приложения проводим аналогичные проверки. Скрывая / блокируя доступ к функциям к которым нет разрешения.

> `rolePath` - полный уникальный идентификатор роли

## `getByService` вернуть роли для сервиса
Получаем `rolePath` по имени роли: При вызове передаем id сервиса (по имени манифеста, напр. `EDITORWWW`), получаем обьект, в котором ключи - группы ролей, за каждым ключом обьект с парами `[roleKey]: rolePath` (где `roleKey` это мнемоника по имени конкретной роли)

```js
const { FEATURENAME } = getByService('EXAMPLEWWW');

console.log(FEATURENAME.ROLE);
// /internal/EXAMPLEWWW/feature/FEATURENAME/role/ROLE/
```

## `rolesHasPermission` <userRoles, rolePath>
Возвращает `True`, если в списке ролй пользователя есть доступ к указанной `rolePath`. И `False` если нет.

## `getByRolePath` <rolePath>
Возвращает список связанных (includedRoles) по указанному rolePath.

## `manifests/*.json` манифесты
Каждый манифест [описывается структурой](./manifests). Каждый сервис имеет свой манифест. Каждый раздел сервиса описывается группой "Возможностей" (Model), где каждая возможность это конкретная роль за которой закрепляется доступ к функции сервиса. Роль может иметь связь с другими ролями (включает в себя набор других ролей).

Для удобной выдачи доступов среди манифестов описываются [группы пользователей](./manifests/user-groups.json), в которых обьявляемые роли это лишь ссылки на настоящие роли сервисов. **Пожалуйста не завязывайся на эти роли в коде!**
