# Тестирование

**Локальная разработка Unit тестов**

Запуск только тестов на измененных файлах в режиме "watch" (тесты будут перезапускаться
при изменении файлов)

```sh
npm run test:unit:watch
```

Запуск конкретного теста

```sh
npm run test:unit path/to/file
```

**Локальная разработка E2E тестов**

Для запуска тестов приложение должно работать с NODE_ENV=test.

В е2е-тестах используются фикстуры - сохранённые (предподготовленные) ответы реальных бэкендов.

У тестов есть 3 режима работы - PLAY, UPDATE, CREATE:
* В режиме PLAY (default) тесты прогоняются с использованием сохранённых файлов фикстур.
* В режиме UPDATE тесты работают аналогично режиму PLAY, дополнительно сохраняя недостающие фикстуры.
* В режиме CREATE происходит перезапись всех фикстур и работа с реальными ответами бэкендов.
  **Важно**: в этом режиме происходит очистка всех фикстур в директории теста.

Режим управляется env-переменной TEST_RUN_TYPE, которую использует сервер, запускающийся внутри тестов.
То есть, с этой переменной нужно запускать jest.

Перед запуском тестов нужно запустить приложение

```sh
cd ${project-name}
npm ci
NODE_ENV=test npm run dev
```

Затем нужно запустить тесты в нужном режиме (в отдельном окне консоли)

```sh
TEST_RUN_TYPE=CREATE jest
```

Вместо запуска jest напрямую можно использовать алиасы (пример - admin-www):
* npm run test:e2e:play - режим PLAY
* npm run test:e2e:debug - режим PLAY + дебаг
* npm run test:e2e:create - режим CREATE
* npm run test:e2e:update - режим UPDATE

Запуск конкретного теста

```sh
npm run test:e2e:play path/to/file
```
