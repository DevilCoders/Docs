# Соглашения

### Об именовании
```
Classname === cn
Classname.bind === cx

Request context === req
Response context === res
Error object === error
Event native === event

Page number === pageNum
Page size === pageSize
```

### О работе с данными

- **Ответы бэкендов** отправляются с ноды на клиент в изначальном виде, **без преобразований**. Преобразования в этом случае делаются на клиенте. На сервере допустимы минимальные трансформации вроде деструктуризации объекта для уменьшения вложенности и установки дефолтных значений (`const = { items = []: response } = originalResponse;`);
- **Данные форм** с клиента на ноду отправляются **без преобразований**. Трансформация запроса для бэкенда происходит на сервере.

### О клиентском коде

#### Сторонние библиотеки и хелперы
Все хелперы из "внешнего мира" **желательно** оборачивать своими. Это позволяет зафиксировать контракт и не зависеть от изменений извне, а также дает возможность последующей "бесшовной" замены одного инструмента другим.
На текущий момент исключения составляют следующие пакеты (они импортятся в react-компонентах и серверном коде напрямую):
* `lodash`
* `moment`
* `humanize-duration`
* `qs`
* `classnames`
* `fuse.js`

#### React-компоненты
- Компоненты - **функциональные** (не классовые).
- Каждый компонент хранится в **отдельном файле**.
- Все компоненты - **именованные** функции.

Предпочтителен **именованый** экспорт с function declaration:
```javascript
export function MyComponent({}) {}
```
В случае, когда нужны `PropTypes`:
```javascript
export function MyComponent({}) {}

MyComponent.propTypes = {};
```

#### Формы (компонент Form)
- Использование значений формы вне самой формы **нежелательно**. Для сихнронизации состояний форм следует использовать `react-router` (как часть поведения компонента `Form`). Для использования зависимости одних значений формы от других следует использовать объект `values` в коллбеке `getInputProps` или опцию `resetOnChange`.

#### Локализация и константы
- Все локали хранятся в файлах `i18n.js` в директориях компонентов. В этих файлах допустимы как константные значения, так и функции. Тут же следует использовать различные хелперы локализации - например, `pluralize.js`. В компоненте импортируем файл локализаций так: `import t from ./i18n;`
- Кроме файлов локализации в компонентах также используются файлы локализации из директорий `@/constants` в проектах. В константах хранятся преимущественно **справочники**. В константы помещаются файлы локализации, относящиеся к области знаний какого-то конкретного бэкенда. Предполагается последующая замена (почти) всех файлов констант на автогенерируемые файлы из `schema-registry`.

### Стили
- Стили храним в файле `style.module.css` в директории компонента
- В компоненте импортируем стили так: `import style from ./style.module.css;`

#### Сетевые запросы
- Для `GET`-запросов следует использовать хук `useHttp`. Для `POST`-запросов - хелпер `http`. Исключение для `GET` - случай, когда нужна цепочка вызовов и/или `GET` запрос в каком-то коллбеке - для этих случаев есть `http.get()`.

#### Тесты
- При написании тестов **крайне желательно** использовать только `page-object`-ы стандартных компонентов и избегать использования api puppeteer-а напрямую (например, объекта `page`).
- Каждый блок `describe` должен быть снабжен коллбеком `beforeEach` с вызовом `reporter`-а для корректной группировки результатов тестов в отчетах allure.

### О серверном коде

#### Контроллеры
- Используются только методы `GET`и `POST`, последний - для всех операций, кроме получения данных.
- На уровне **контроллера** реализуется вся **бизнес-логика**: поход в другие бэкенды, обогащение данных, проверки прав.

#### Ресурсы
- На уровне **ресурса** происходят все необходимые **трансформации и преобразования** данных в нужный бэкенду формат. Здесь же инкапсулирована логика обработки ошибок, общая для всех ответов конкретного эндпоинта (например, извлечение ответа ошибки из JSON-а по пути вроде `response.data.error.errorMessage`).

