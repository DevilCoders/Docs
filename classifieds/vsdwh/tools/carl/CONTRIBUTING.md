# Contributing

`carl` во многом создаётся примерно для того же, для чего создавалась [`lama`](https://a.yandex-team.ru/arc/trunk/arcadia/maps/analytics/tools/lama).
Предполагаемые сценарии использования тоже похожие, большинство команд `lama` в том или ином виде планируются к разработке и в `carl`.
Поэтому файловая структура проекта и архитектура во многом позаимствованы из `lama`, но с некоторыми упрощениями из-за того,
что `carl` взаимодействует только с Nirvana.

## Файловая структура проекта
```
carl
|
|- bin/              # директория сборки бинаря
|  |- commands/      # обработка аргументов и вызов команд
|  |- carl.py        # входная точка, main
|
|- examples/         # примеры
|
|- lib/              # основной код взаимодействия с Nirvana и vh3
|  |- commands/      # код реализующий сами команды CLI
|  |- config/        # вспомогательные объекты конфигурации графов и их глобальных опций
|  |- operations/    # реализованная библиотека операций
|  |- presets/       # реализованная библиотека пресетов
|- resources/        # вспомогательные ресурсы, описывающие глобальные опции и конфигурации графов в YAML
|
|- schemas/          # схемы для валидации ресурсов и прочих конфигов
|
|- scripts/          # вспомогательные скрипты, линтер и прочее
```




## Архитектура

1. Работа с командной строкой инкапсулирована в папке [bin](bin), код в [lib](lib) ничего не должен знать про CLI.
2. Код в [bin/commands](bin/commands) должен быть максимально простым. Весь основной код должен лежать в `lib`. В `bin` лишь парсятся аргументы командной строки, парсеры вызывают соответствующие команды из `lib`, которые и реализуют исполнение.

Эти пункты унаследованы от `lama` и останутся в дальнейшем в таком же виде. 

В данный момент реализована лишь одна команда `sync` и всё взаимодействие с `vh3` реализовано прямо внутри [lib/commands/sync.py](lib/commands/sync.py). Поскольку непосредственно это взаимодействие простое, а само описание графа в `.py` файлах уже содержит исполняемый код, с которым не надо производить никаких манипуляций, пока вынесение взаимодействий с Nirvana в отдельные провайдеры (по аналогии с `lama`) не требуется, однако, возможно в будущем в случае усложнения этих взаимодействий.




## Внесение изменений

Все правки в `carl` вносятся в отдельных ветках и добавляются в trunk через Pull Request с ревью @dm-bushkov или @glinkindd.

Правила добавления новых операций и пресетов описаны в README соответствующих директорий.

