## Registry

### Таблицы в YDB

При старте приложения создаются 4 таблицы:

|    Таблица     |                                           Хранимая сущность                                           |                                             Описание                                              |                                   Как заполняется                                    |                        Как используется                        |                                               Storage класс                                               |                                                      Statements                                                      |
|:--------------:|:-----------------------------------------------------------------------------------------------------:|:-------------------------------------------------------------------------------------------------:|:------------------------------------------------------------------------------------:|:--------------------------------------------------------------:|:---------------------------------------------------------------------------------------------------------:|:--------------------------------------------------------------------------------------------------------------------:|
|   field_meta   |      [FieldMeta](./../../services/vs/registry/src/main/scala/vs/registry/domain/FieldMeta.scala)      |                Аналог маппинга: имена полей и <br>их типы в соответствующей эпохе                 | в producer при валидации документа: <br>если в документе появляется что-то новенькое |        в producer для валидации <br>существующих полей         |   [FieldMetaStorage](./../../services/vs/registry/src/main/scala/vs/registry/db/FieldMetaStorage.scala)   |                                                          -                                                           |
|    elements    |     [QueueEvent](./../../services/vs/registry/src/main/scala/vs/registry/domain/QueueEvent.scala)     | Очередь событий: pk документа и метаинформация(эпоха, версия и т.д.) и состояние активности офера |                          в producer - если документ валиден                          | в consumer при потреблении совместно с index/registry таблицей |       [QueueStorage](./../../services/vs/registry/src/main/scala/vs/registry/db/QueueStorage.scala)       |    [QueueEventStatements](./../../services/vs/registry/src/main/scala/vs/registry/db/QueueEventStatements.scala)     |
| index/registry | [RegistryRecord](./../../services/vs/registry/src/main/scala/vs/registry/domain/RegistryRecord.scala) |                            Само содержимое документа и метаинформация                             |                          в producer - если документ валиден                          |          в producer для валидации актуальности офера           |    [RegistryStorage](./../../services/vs/registry/src/main/scala/vs/registry/db/RegistryStorage.scala)    | [QueueDocumentStatements*](./../../services/vs/registry/src/main/scala/vs/registry/db/QueueDocumentStatements.scala) |
|    offsets     |    [QueueOffset](./../../services/vs/registry/src/main/scala/vs/registry/domain/QueueOffset.scala)    |           Прогресс чтения, на котором сейчас определенный consumer определенного шарда            |      в consumer: как только прочитал порцию - положил закладку, где остановился      |              в consumer: с чего продолжать читать              | [QueueOffsetStorage](./../../services/vs/registry/src/main/scala/vs/registry/db/QueueOffsetStorage.scala) |   [QueueOffsetStatements](./../../services/vs/registry/src/main/scala/vs/registry/db/QueueOffsetStatements.scala)    |

Statements - preparerStatements для некоторых часто повторяющихся скриптов.

Скрипты `QueueDocumentStatements` объединяют таблицы `elements` и `index/registry`, чтобы сформировать целый документ. 