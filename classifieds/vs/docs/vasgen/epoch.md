### Про эпоху и динамический мапинг  

Между saas и vasgen динамический мапинг полей.
Он проверяется (и может меняться) для каждого пришедшего документа.
Версия маппинга полей между saas и vasgen называется эпохой (epoch).

Изменения в мапинге могут быть обратносовместимыми и обратнонесовместимыми.

#### Пример (единственно возможный) обратносовместимого изменения:
Добавление нового поля. В этом случае новое поле будет не у всех документов, но оно будет в мапинге с текущей эпохой.
Как будет работать запрос к saas c фильтрацией/сортировкой/группировкой по полю которое есть не у всех документов ?
При фильтрации документ у которого нет поля по которому происходит фильтрация просто не попадет в выдачу.
Сортировка по конкретному атрибуту нужна редко, но вообще в такой ситуации будет UB.
В случае группировки, если поле отсутствует у многих документов может быть ошибка в рантайме.

#### Пример обратнонесовместимого изменения:
У поля меняется тип. Т.е. поле сохранено в мапинге, например, как число, а пользователь хочет сделать его строкой (например превратить ID из LONG в GUID).
При попытке проиндексировать документ в котором это поле - строка, пользователь получит ошибку валидации от ресивера.
Но пользователь может послать этот документ с другой эпохой (эпоха передается в каждом документе),
при этом:
- поле сохранится в мапинге для новой эпохи отдельно (старый мапинг не удаляется)
- документ попадет в индекс saas
- в saas изменится имя этого поля для данного документа, так как в нем кодируется тип (например s_field_name / i_field_name)
  Что будет при попытке использовать старый тип поля, например сортировать по числовому полю при том что для некоторых документов это уже строка ?
  На самом деле у документов у которых новое поле - строка, нет старого поля вообще, у них есть только новое поле с другим типом и другим именем.
  Поведение saas при этом такое же как для отсутствующего поля (см. выше).

Сёрчер всегда ищет документы для которых epoch >= currentEpoch.
currentEpoch - хранится в ZK и его можно поменять через нашу grpc-ручку.
После того как пользователь перепослал все документы с новой эпохой, он может (сам или через нас) поднять эпоху и забыть про старую.

В индексе saas всегда хранится только одна версия каждого документа. Уникальный ключ формирует и посылает пользователь.
Т.е. при поднятии эпохи индекс не задваивается.
Чистка старых эпох в saas не нужна, они просто вытесняются новыми.
Чистка старых эпох в мапинге не нужна, там не так много данных и мы можем хранить и все.
