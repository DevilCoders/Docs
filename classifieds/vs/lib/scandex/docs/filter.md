# Фильтрующий индекс

Позволяет фильтровать документы по значениям поля. 

Фильтрующий индекс бывает двух типов:
- Каждый документ содержит строго одно значение данного поля
- Каждый документ может содержать набор значений данного поля

Наличие значения у поля документа опционально.
 
Реализует операции равенство, принадлежность к множеству и отсутствие значения.

```scala
import scala.collection.BitSet

trait FilterIndex[T] {
  def equalsTo(bitSet: BitSet, v: T): Unit
  def notSet(bitSet: BitSet): Unit
}
```

## Внутреннее устройство различных реализаций 

### SingleValueFilterIndex

Реализация, в которой каждому документу соответствует ноль или одно значение.

Содержит в себе следующие сегменты:  
- [Прямой индекс](glossary.md#segment-forward), отвечающий на вопрос, какой `ValueIdx` соответствует 
заданному `DocumentId`
- [Инвертированный индекс](glossary.md#segment-inverted), отвечающий на вопрос, какие `DocumentId` 
соответствуют заданному `ValueIdx`
- [Кодификатор значений](glossary.md#segment-values-lookup), отвечающий на вопрос, какое `ValueIdx` соответствует 
значению поля документа

#### Реализация прямого индекса

Реализация описана в документе [ForwardSegment](segment_forward.md)

#### Реализация инвертированного индекса

Реализация описана в документе [InvertedSegment](segment_inverted.md)

#### Сериализация и десериализация

***TODO*** Описать сериализацию и десериализацию структуры

### MultiValuesFilterIndex
Реализация, в которой каждому документу соответствует ноль или несколько значений для данного поля(мульти-индекс).

Состоит из сегментов:
- [Прямой индекс](glossary.md#segment-forward), отвечающий на вопрос, какие `ValueIdx` соответствуют 
заданному `DocumentId`
- [Кодификатор значений](glossary.md#segment-values-lookup), отвечающий на вопрос, какое `ValueIdx` соответствует 
  значению поля документа

[cardinality]: glossary.md#cardinality
[JEP-370]: https://openjdk.java.net/jeps/370