# О код-ревью

Цель код-ревью — не допустить ухудшения качества кода и продукта.

## Чем НЕ является
- не способ шарить знания о проекте как продукте — для этого мы проводим продуктовые демо-встречи и хуралы Авто;
- не способ шарить знания о проекте как коде  — если ты написал какой-то хелпер или общий компонент, расскажи об этом команде — в чате или документации. Если это что-то глобальное, как дескрипт, собери ещё и встречу;
- не инструмент обучения новичков. Способ решения задачи нужно проговорить до сдачи в код-ревью со своим руководителем, ментором или техлидом.


## Что проверять
1. Есть [тесты](./jest-cookbook.md) на компоненты, дескриптовые блоки и другой код, в котором есть логика с ветвлением. Писать тесты на вызов метрики или на то, что просто отправляется запрос не нужно.
2. Есть [браузерные тесты](./jest-puppeteer-react.md) на компоненты с вёрсткой,
3. Важно проверять, что артефакты тестов — снепшоты и скриншоты — правильные.
4. Не подключаются сторонние скрипты с чужих доменов напрямую. см [счётчики маркетинга](https://wiki.yandex-team.ru/users/alivander/autoru/marketing/counters/)
5. Без особой надобности не увеличивается время загрузки критичных страниц проекта — листинга и карточки объявления — в контроллерах не происходит дополнительных запросов, никакие новые блоки не рисуются синхронно, вместо использования IntersectionObserver и ajax.
6. Если добавляются новые npm-модули, проверь, что они действительно необходимы и нельзя переиспользовать текущий код.
7. На опечатки в комментариях можно забить, но опечатки в именах функций и переменных нужно исправлять.
8. CSS-переменные для цветов. Если добавляется новая переменная, убедись, что нельзя было обойтись существующими. [Гайд по цветам в CSS](https://a.yandex-team.ru/arcadia/classifieds/autoru-frontend/docs/css.md#работа-с-цветами)

Всё вышеперечисленное должно браться в расчёт ещё на этапе разработки и проверяться исполнителем перед тем, как отдать PR на ревью. Это обязательные, но не достаточные критерии. Не стоит забывать о проверке бизнес-логики и архитектуры фичи.

О чеках: разработчик не хочет ждать чеков после создания комита, он хочет нажать In Review и пойти пить кофе. Поэтому можно отдавать в ревью тикет с идущими проверками — пока до PR доберётся ревьюер и почитает код — они или позеленеют, или покраснеют. После чего ревьюер отправит тикет в тестирование или на пересдачу.


## Что не проверять
1. Не нужно запускать код и писать о багах или нюансах бизнес-логики. Для этого есть менеджерское и дизайнерское ревью и тестирование. При этом, если из кода видно потенциально узкое место — нужно об этом написать, но заниматься ручным тестированием не стоит;
2. Всё, что можно проверить линтерами: стиль, отступы, названия селекторов. На это можно указывать, но лучше написать правило для линтера и вынести на обсуждение.


## Как разруливать спорные моменты
Критичность правок определяется ревьюером. Некритичные замечания и советы тоже стоит оставлять с ремаркой “править на усмотрение автора”, за это не бьют. Если есть критичные правки — отправляй на доработку. Заодно и менее критичные поправить можно. А если есть только некритичные — можно апрувить PR, а дальше на усмотрение автора. Если в PR завязался спор, стоит обсудить проблему устно или вынести в [чат AUTORUFRONT_TECH](https://t.me/joinchat/Q4AQemTUt9TALxSd) и результаты обсуждения написать в PR. По возможности, отразить в документации и правилах линтеров. 


## Этикет код-ревью
Не забывай, что код-ревью — это диалог инженеров в публичном пространстве, нацеленный на улучшение качества кода. Ревьюер и автор PR — не оппоненты и должны помогать друг другу.

- Обсуждай код и решение, а не автора;
- Не допускай эмоциональных замечаний, которые могут быть восприняты автором в свой адрес;
- Хвали автора за классные решения;
- Если автор кода и ревьюер не могут прийти к общему мнению, призывайте 3-ю сторону для разрешения спора.


## Кто ревьюит
Джуны+, которые работают на проекте больше полугода. Выбирается [ботом](https://a.yandex-team.ru/arcadia/classifieds/autoru-frontend-review-assigner). Бот дёргается триггером в StarTrek при переводе тикета в In Review. Если этого не произошло или хочется добавить ещё ревьюеров, можно дёрнуть бота руками: `curl -X POST "http://af-review-assigner-web.vrts-slb.test.vertis.yandex.net/assign?issue_id=AUTORUFRONT-xxxxx"`.

Для больших или сложных PR нужно выбрать второго. Если хочешь, чтобы кто-то конкретный (например, тот, кто лучше всех знает эту часть проекта) посмотрел PR, добавь его в ревьюеры руками и киньте ему ссылку на PR. Переводить из In Review в Ready For Test можно после одного апрува, если не оговорено иного в теле PR или в таске.

SLA на ревью — сутки, исключая выходные. Пока у нас нет инструмента, который это контролирует, поэтому автор задачи должен сам пинговать ревьюеров. Если ты понимаешь, что не успеешь провести код-ревью, скажи об этом автору и попроси найти другого ревьюера.
