# Как мы готовим descript

Все базовые блоки, ресурсы и методы лежат в папке `auto-core/server/resources`

# Базовые http-блоки

В папке `auto-core/server/resources` лежат базовые http-блоки.
Эти блоки ничего не знают про конкретные бекенды (за исключением `baseHttpBlockPublicApi`) и ручки.
Эти блоки нужны, чтобы во все запросы добавить базовые заголовки и т.п.

# Ресурсы (бекенды)

В файлах `auto-core/server/resources/<resourceName>/getResource` лежит декларация конкретного бекенда.
В этой декларации указаны хост, порт, протокол, общие заголовки для всех методов (ручек) этого бекенда,
а также дефолтные таймауты и ретраи. 
В этой декларации не должно быть никаких знаний про конкретные запросы в бекенды.

# Методы (ручки)

В файлах `auto-core/server/resources/<resourceName>/methods/*.js` лежат декларации конкретных ручек этого бекенда.
Один файл - одна ручка. В методе можно указывать path, method, переопределять таймауты и ретраи, если надо.

Что не должен делать метод:
- `cancel.v` и вообще любое прерывание обработки запроса, редиректы и т.п. Это должны делать конкретные блоки или страничные контроллеры.
- производить какие-либо вычисления с ответом бекенда. Метод может вернуть ответ как есть, либо вернуть сабсет, т.е вырезать часть ответа, оставив остальную без изменений.
У этого правила скорее всего будут оговорки. Например, ответ publicapi/session приводится к формату publicapi/user, потому что бекенд почему-то решил иметь две модели ответа данных пользователя.

В общем виде надо делать так, чтобы сущности/модели в ответах были всегда одинаковые. 
Например, "объявление" в любом ответе, неважно из какой ручки, всегда должно быть "объявление".

# preparer (обработчики ответа)

Лежат в `auto-core/server/preparers/`. Важно понимать, что это не препареры конкретных ручек,
а препареры конкретных сущностей (объявление, подписка, параметры поиска и т.п.). Методы, в основном, используют препареры отсюда.

# Составные блоки

Лежат в `auto-core/server/blocks`.
Тут лежат блоки, которые состоят из более чем одного метода или сильно меняющие ответ бекенда (например, `indexSearchHistory` отрезает большую часть ответа, а `getFavoritesInOctopusFormat` полностью меняет модель данных).  
