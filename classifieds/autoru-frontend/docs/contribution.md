# Процесс работы над задачей

1. Каждое изменение должно сопровождаться отдельной задачей в стартреке. Задача должна быть создана исключительно в
очереди `AUTORUFRONT`, если задача изначально сформулирована кем-то в иной очереди,
она должна быть **перенесена** (не продублирована) в очередь `AUTORUFRONT`. При переносе сохраняется история, комментарии и список наблюдателей.
2. Под каждое изменение заводится отдельная фича-ветка, ответвленная от текущей релизной ветки — как правило, это `master`.
3. Разработчик пишет код. Что нужно принять во внимание, описано [тут](./code-review.md#что-проверять).
4. По окончании разработки, тикет переводится в `Решен/Resolved`.
Если нужно ревью от менеджера или дизайнера, разработчик призывает его в комменты со ссылкой на стенд.
5. Разработчик создаёт пулл-реквест с названием задачи.
Если всё хорошо: PR чеки зелёные, у менеджера/дизайнера больше нет замечаний, переводит тикет в `В ревью/In Review`.
6. Происходит [ревью кода](./code-review.md), при необходимости он отдается на доработку, а задача в стартреке переводится ревьюером в статус `Нужны правки/Need Improvement`. Разрабочик вносит правки отдельным коммитом. **Не нужно сквошить правки** по PR с остальным кодом. До завершения стадии ревью запрещено использовать `git push --force`.
7. После того как последний ревьювер одобрит `PR`, он переводит одноименную задачу в стартреке
    в статус `Можно тестировать/Ready For Test` или в `Протестировано/Tested`, если у PR есть соответствующая метка.
8. Если во время тестирования были обнаружены баги, то QA-инженер переводит задачу в статус `Нужны правки/Need Improvement`. Разработчик снова вносит правки отдельным коммитом, **без сквоша**.
9. Когда тестирование пройдено и задача готова к регрессу, **коммиты нужно посквошить в один**, который в итоге и попадет в релизную ветку, а затем в ветку `master`. Если задача очень большая, то можно посквошить не все коммиты, а хотя бы схожие по смыслу.
PR закрывать руками не нужно, он закроется сам, когда ветка попадёт в мастер. Открытый PR после код-ревью нужен, чтобы смотреть чеки для коммитов, появившихся после код-ревью (правки от тестирования, например).

### Важные замечания
- в тестирование (`Можно тестировать/Ready For Test` и `Протестировано/Tested`) можно отдавать только задачи с зелёными чеками;
- после начала тестирования задачи или регресса релиза, в который попала задача, нельзя вносить правки в ветку задачи. Если нужно внести правки или подмёржить мастер, предупреди тестировщика, чтобы ему не пришлось проводить тестирование заново с самого начала.

Компонент `billing` находится под [PCI DSS](https://wiki.yandex-team.ru/users/naumov-al/security/vertispcidssdraft/), а значит через код-ревью должен проходить весь код, включая правки тестирования в задаче и в релизной ветке.

<a name="branch_name"></a>
### Именование веток

Имя фича-ветки должно **полностью совпадать** с идентификатором задачи в стартреке из очереди `AUTORUFRONT`.
Название тикета в Стартреке: `%issue_number% - %projects% %issue_title%`, где:
 * `%issue_number%` - идентификатор задачи,
 * `%projects%` - это имена пакетов, которые затрагивает тикет: `desktop, desktop-lk, mobile, chat, forms, poffer` (`auto-core` не указывается) и т.д.,
 * `%issue_title%` - заголовок задачи.

Например:
имя ветки - `AUTORUFRONT-10421`,
название тикета - `AUTORUFRONT-10421: [desktop][mobile] Правки промо проверки и выкупа`.

<a name="commit_msg"></a>
### Текст сообщения коммита

Текст сообщения итогового коммита, попадающего в релизную ветку, должен соответствовать шаблону:
```
[task_name]
[desc]
```
 * `task_name` -- название задачи в трекере
 * `desc` -- более подробное описание (не обязательно).

 Если изменения ОЧЕНЬ минорные и не хочется мешать их с задачами, эти изменения можно залить в мастер без тестирования с названием `TRIVIAL: описание`.

<a name="advices"></a>
### Рекомендации

Чтобы при мерже фича-ветки в релизную ветку не получить конфликтов, рекомендуется не реже чем раз в 2 дня обновлять
фича-ветку изменениями из релизной ветки (`git rebase`). Разумеется, это можно сделать и в конце работы с задачей, но есть вероятность, что придется погрязнуть в аду разруливания конфликтов.

Еще один момент - помимо названий пакетов (`[desktop][mobile]`) иногда также указывают `[bunker]`.
Это не пакет, но таким образом обозначается, что в задаче есть данные, которые лежат в [бункере](./bunker.md) и перед выкаткой задачи в прод их нужно **опубликовать**. Как правило, за это отвечает QA-инженер.

Если в задаче планируется трогать текущие роуты, то желательно поставить в известность дежурного из Группы интерфейсов инструментов извлечения трафика, чтобы они были в курсе [График дежурств](https://wiki.yandex-team.ru/vertis-traffic-interfaces/)
