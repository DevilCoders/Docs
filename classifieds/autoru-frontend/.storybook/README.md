# Storybook

прод версия живет тут - http://autoru-front-storybook-web.vrts-slb.test.vertis.yandex.net

дев версию можно развернуть так - `npm run storybook`

## Структура

тут все разложено по папочкам

**первый уровень**

отвечает за платформу/пакет
- common - общие компоненты для всех платформ/пакетов
- desktop - общие компоненты для десктопа
- mobile - общие компоненты для мобилки
- www-* - компоненты для конкретного пакета

 **второй уровень**

 отвечает за тип компонента
 - controls - контролы форм/страниц
 - portals - всякие всплывающие штуки (модалы, тултипы, шторки, попапы, и пр), триггером которых является пользовательское действие
 - information - инфо блоки; отображают информацию о чем-либо (позиции, рейтинге, и тд); обычно содержать числовые данные
 - messages - сообщения для пользователей (нотификации, баблы), блоки содержащие сообщения
 - navigation - навигация между/внутри старницы (ссылки, табы, пагинация, крошки и тд)
 - indicators - индикаторы состояния блока/страницы (лоадеры, прогресс бары и тд)
 - media - медиа-блоки (картинки, браззерс, плееры, видео, панорамы)
 - snippets - большие компоненты/блоки, объединяющие в себе много мелких блоков, но работающие как единое целое
 - content - какие-то контентные штуки, встречающиеся внутри блоков (бейджики, аватарки, и тд)
 - variables - css-переменные
 - icons - спрайт с иконками

если ты добавляешь новый компонент и не знаешь в какую категорию его положить, создай новую, но обязательно опиши ее тут, что ты под ней понимаешь, чтобы другие могли ей также пользоваться

## Как писать истории

все истории живут в файлах вида `*.stories.js`, к ним при необходимости можно добавлять стили `*.stories.css`.

есть несколько компонентов-хэлперов призванных сделать жизнь проще

#### `<Story/>`
по сути контейнер для истории; добавляет общий лейаут, стили и заголовок, чтобы все выглядело единообразно

#### `<StoryPropDesc/>`
дескриптор пропса; служит чтобы итеративно показать все значения, которые этот проп может принимать; лучше всего подходит для описания пропсов, значения которых являются примитивами; принимает в себя:
- `Component` - сам компонент для истории
- `propName` - имя пропса
- `samples` - массив возможных значений пропса
- `description` - описание данного пропса, если нужно что-то пояснить

#### `<StoryModule/>`
почти то же самое, что и дескриптор пропса, только без привязки к конкретному пропсу; тут можно самому решать какой контент будет в итоге
- `heading` - заголовок модуля
- `description` - описание модуля
- `className` - имя класса, если нужно переопределить какие-то стили
- `samples` - массив сэмплов; каждый элемент должен содержать два свойства: 
    - content - отрендеренный в каком-то виде компонент
    - caption - то что будет использовано для описания кейса
    - testValue (optional) - если хочется, чтобы сэмпл попал в стори-тесты, нужно добавить в этот параметр краткое описание кейса, оно должно быть уникальным для компонента 

Пример использования можно посмотреть в `auto-core/react/components/common/DonutChart/DonutChart.stories.js`

#### `StoryPlaygroundHoc`
хок для создания плейграунда с компонентом; принимает в себя
- `Component` - сам компонент для истории
- `initialProps` - начальные значения пропсов, с которыми будет открыт плейгранд
- `children` - дети компонента
- `handlers` - обработчики для обновления внутреннего стейта плейграунда; используются для реакции на события и изменения пропов компонента; должны возвращать объект с новыми пропами

Если указанные хэлперы не подходят для твоего конкретного кейса, всегда можно написать что-то своё, что покажет различные варианты использования компонента

## Стори-тесты

Необходимо создать файлик `<MyComponent>.story.browser.js`, заинклюдить в него стори и хэлпер и передать в хэлпер стори.

```
const Stories = require('./DonutChart.stories');
const testStory = require('storybook/utils/testStory.js');

testStory(Stories);
```

__!! "что делать я если я тупой"__ - возможно ты забыл сделать импорт своей стори в файлике `<MyComponent>.story.js`

Кейсы для стори-тестов автоматически формируются для пропсов-примитивов, описанных через `StoryPropDesc`, а также в случаях если в `StoryModule` для сэмпла было передано значение `testValue`
