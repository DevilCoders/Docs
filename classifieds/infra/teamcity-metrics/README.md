# teamcity-metrics

Teamcity-metrics - сервис, предназначенный для перекладывания метрик о тимсити-агентах и тимсити-билдах в prometheus. Сервис выполняет следующие действия:
* Ходит в разные ручки teamcity-сервера и собирает с них необходимую статистику;
* Конвертирует эту статистику в метрики с лейблами;
* Отдает их по ручке /metrics прометеусу.

Сервис рекомендуется запускать в продакшен-среде в формате батч-джобы, использование прокси не требуется.

Для работы сервиса необходимо использовать авторизационный токен для доступа в API тимсити, для этого в качестве переменной окружения `TEAMCITY_TOKEN` используется токен робота [robot-optimus-prime](https://yav.yandex-team.ru/secret/sec-01cykkhw6fmeqdvfn6h2e8k7k3/explore/versions).
Для локального запуска нужно положить токен в файл `local.env` в корне проекта в формате `TEAMCITY_TOKEN=<токен>`.
