# auto-scaling

Сервис для перекладывания метрик из Prometheus в Yandex-Monitoring (YM) для работы с автоскейлингом

1) Читается конфиг с перечнем метрик и названий инстранс-групп, получается IAM-токен для YM;
2) Сервис ходит в Prometheus и получает необходимые метрики;
3) Получает необходимую информацию об инстанс-группе (zone_id, число запущенных машин);
4) Перекладывает метрику в YM.

## Конфигурация

Переменная окружения _DEPLOY_LAYER указывает на среду запуска сервиса. 
Для локального запуска сервиса указание _DEPLOY_LAYER не требуется.
Для работы с тестовым фолдером YM _DEPLOY_LAYER=test, с продовым - _DEPLOY_LAYER=prod.

JSON-конфиг с указанием необходимых метрик для перекладывания должен лежать в переменной окружения JSON_CONFIG.
Он содержит имя метрики для YM, имя метрики в Prometheus, название инстанс-группы в облаке.
Пример и структура такого конфига представлена в файле test_env.json.

В переменной окружения PRIVATE_PEM должен лежать приватный ключ сервис-аккаунта в base64 для соответствующей среды. Информацию о сервис-аккаунтах и ключах можно узнать [здесь](https://wiki.yandex-team.ru/vertis-admin/klaster-nomada-v-jandeksoblake/#prod)

## Запуск 

Тесты - make test

Сборка - make build



