### Сервис автоматической валидации ПР-ов в schema-registry

Вдохновленные админским shiva-роботом, мы завели своего
### Behold Anubis
_взвешивает сердце, определяет, достоин ли ты загробной жизни_


![Pic](./docs/anubis.jpg)


Он приходит при создании пулл-реквеста в schema-registry и на каждый новый коммит. 

Но еще его можно призвать так же, как Шиву, написав в комментарий _/retry_

При каждой проверке все прото-сообщения в репозитории будут провалидированы в соответствии с нижеописанными правилами, а затем робот вынесет вердикт.

#### Валидация брокерных поставок

- expireInDays >= maxLag, чтобы не писать в таблицу, которая тут же поэкспайрится (проверяется только для поставок партиционированных по дню)
- все названия таблиц в кликхаусе и путей в ыте должны быть уникальными (среди других поставок)
- days_to_break_by_hour может быть только при партиционировании по дню
- repartition может быть только при партиционировании по дню
- sort_by и repartition могут быть только по существующему полю
- обязательно должно быть поле `timestamp` / поле с аннотацией `is_timestamp`
- все required поля в конфиге поставки должны быть заполнены

### Эволюция брокерных поставок
- примитивные поля верхнего не могут менять тип
- нельзя поменять primitive wrapper на примитивный тип и наоборот
- при удалении поля обязательно резервировать имя и номер
- типы вложенных и repeated полей можно менять, если содержимое совместимо (см. [доку по совместимости прото](https://developers.google.com/protocol-buffers/docs/proto3#updating))
- нельзя добавлять repeated к существующему полю верхнего уровня

[Подробнее](https://docs.yandex-team.ru/classifieds-infra/broker/schema_guide#evolyuciya-shemy)

### Валидация новых брокерных поставок
- в имени поставки могут содержаться только a-z, 0-9, '/' и '-'
