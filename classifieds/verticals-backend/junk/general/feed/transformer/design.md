# feed-transformer 

Сервис парсинга фидов.
Основаная задача сервиса – распарсить фид в одном из известных форматов и трансформировать в поток сырых офферов.

Сырой оффер – структурированное сообщение из всех возможных полей, в котором лежит сырой контент из фида.
Дальнейшей унификацией занимается feed-processor. 


## Требования

 * Определять формат фида по содержимому файла
 * обрабатывать фиды с миллионами объявлений с константным потреблением памяти
 * человеко-читаемые ошибки парсинга
   * позиция ошибки из файла до трансформаций
   * значения полей из файла до трансформаций
 * быть готовым что фиды могут быть не только в xml формате
 * быть толерантным к ошибкам пользователя: 
    пропускать невалидные объявления и пытаться распарсить то что осталось

Изменения в gost:
 * хранить оригинальную категорию из файла до трансформации
 * опционально: хранить сырой оффер полученный из трансформера внутри файла 
 * возможность запускать унификацию категории у уже созданного объявления
 
     
## API
[gRPC-API](../../../schema-registry/proto/general/feed/transformer.proto)

## Ошибки

Сервис должен выдавать ошибки так, чтобы их можно было превратить в человеко-читаемые.
В ошибке должен быть максимум контекста, который может помочь для ее исправления: 
позиция в файле (номер строки и позиция внутри строки) 
и external_id объявления, если ошибка произошла внутри контекста объявления.

Парсер по возможности является однопроходным, 
поэтому может появиться ситуация когда парсер выдал несколько объявлений, 
а потом встретил неожиданный конец файла. 
Такие случаи должен обрабатывать клиент, для этого в ошибке есть флаг `fatal`. 