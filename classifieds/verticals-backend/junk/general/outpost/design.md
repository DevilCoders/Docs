# Outpost - сервис для мультипостинга офферов через [JCat](https://www.jcat.ru)

> Multiposting - размещение объявлений на многочисленных площадках 

## Требования:
  1. Выгрузка объявлений(aka фида) в формате [xml]((https://st.yandex-team.ru/CLASSBACK-1936/attachments/38115694? jcat.xml)) 
  2. В фид попадают активные оффера, которые проходят следующие [фильтры](https://st.yandex-team.ru/CLASSBACK-1936)
  3. Максимальный размер фида = 60к, максимальное количество офферов на продавца = 10

## Как реализовано:
Multiposting это просто таска, которая выполняется каждые 3 часа.<br>
Сам фид хранится в yt таблице. Фильтрация валидных офферов происходит в yql запросе.

Как работает шедулер:
   1. Создает новую таблицу: 
      - Cначала берет отфильтрованные офферы из таблицы госта.  
      - Затем join-ом мержит эти офферы с теми что уже лежат в предыдущей табличке фида.
      - Этим join-ом обновляются или удаляются офферы из фида
   2. Из новой таблицы вычитывает обновленные данные, конвертирует их в xml формат и записывает их в файл
   3. Загружает файл в s3

Т.к. JCat скачивает файл каждые три часа, все обновления офферов будут отражены в фиде. 


