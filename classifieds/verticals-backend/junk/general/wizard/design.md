##Колдунщики General

###Продуктовые требования
Требования к MVP тут. Кратко, в первой итерации запускаем три вида колдунщиков:
- Поиск по категориям - выдача наиболее релевантных объявлений в категории
- Брендовых - выдача релевантных объявлений в случайных категориях
- Размещение объявления в категории

###Требования
Поиск по 3000 категорий и по 50 млн объявлений.
SLA 50мс
10000 rps (нагрузка в колдунщиках авто, умноженная на случайную константу 5)

###Компоненты
meta-wizard - метаколдунщик, компонент который разбирает текстовый запрос и возвращает варианты разбора запроса.

wizard - компонент который ходит в метаколдунщик за вариантами разбора, выбирает наиболее релевантный, далее идёт в Vasgen за объявлениями и возвращает контент.

###Схема взаимодействие компонент с внешними сервисами
https://wiki.yandex-team.ru/users/devreggs/Koldunshhiki-General/.files/generalwizard1.png

###Концепция разбора запроса
При разборе запроса, сначала ищем интенты, затем пытаемся найти синонимы для категорий, далее, для интента и категории пытаемся распознать подходящие атрибуты. Если категорий не было найдено в запросе, пытаемся найти атрибуты, а затем найти релевантную им категорию.

Так как один и тот же поисковый запрос можно понять по разному, на каждом шаге ищем все возможные варианты, и по-очереди передаём каждый на следующий шаг, в конце получая все возможные варианты разбора:
https://wiki.yandex-team.ru/users/devreggs/Koldunshhiki-General/.files/parsingdiagram2-1.png

В общем виде, разбор состоит из правил, каждое из которых обогащает состояние разбора - ParseState. В MVP это два правила:

Поиск в запросе интенов и обогащение ими ParseState

Поиск в запросе категорий и обогащение ими ParseState

ParseState состоит из самого запроса и разобранных категорий и интентов. В одном ParseState не могут быть разобраны одни и те же токены разным способом:

Каждый вариант, который возвращает MetaWizard состоит:
- Разобранные интенты
- Разобранная категория (опционально)
- Фильтры по атрибутам. (опционально)
- Гео-фильтр

Словари с прагматиками и стоп-словами храним в Пальме.

Словари синонимов названий категорий получаем из каталога.

Словари синонимов атрибутов и синонимов для конкретных значений аттрибутов должны храниться в каталоге.

Из Бегемота получаем нормальные формы слов из запроса.

Из geoaddr'а приходит гео-разбор запроса.

###Колдунщик
Колдунщик выбирает наиболее релевантный разбор, идёт за объявлениями в Vasgen, если нужно, и возвращает контент клиенту.
###Методы API колдунщика
`GET /wizard` - возвращает контент колдунщика, в формате модели TReport
Ручка должна принимать пользовательский запрос, информацию о geo, ответ геоаддра, ответ бегемота.

`GET /debug` - возвращает ответ от мета-колдунщика и другую информацию для дебага разбора запроса. Параметры те же самые что и wizard
Содержимое ответа колдунщиков

В модель ответа данные для СЕРПа записываем по-аналогии с колдунщиками авто и недвижимости, элементов для отрисовки:
- Заголовок
- Описание
- Грин-урл
- Список тумб с объявлениями
и т.п.

###Полнотекстовый поиск
TODO