# Удаление дублей событий

## Status

accepted

## Context

Нам нужно строить статистику с учетом возможных дублей событий.

## Decision

Дедублицируем прямо в запросах статистики из кликхауса

## Consequences

Good.
Не требуется делать exactly-once запись событий в кликхаус.
Помимо самого кода, exactly-once имеет больше рисков в поддержке. 
Баги в его реализации потребуют большие усилия для исправления.

Bad.
Дедубликация в запросах ограничивает использование мат вью. 
Запросы будут выполняться каждый раз заново, но с учетом количества данных мы ожидаем, 
что это не будет проблемой. В случае критического падения производительности планируется 
увеличивать ресурсы кликхауса и кешировать тяжелые запросы