# Как поддержать фильтрацию/группировку по ценовым сегментам

## Status

accepted

## Context
CM.Expert хочет интегрироваться с нашей финстатой.
Один из их запросов - фильтрация и группировка затрат по ценовым сегментам. Например, хочется считать статистику только для машин с ценой от 800.000 до 1.500.000 рублей.
Ценовые сегменты, естественно, могут меняться.

О каких решениях подумали

1) Поддержать в финстате более сложные фильтры и группировки. Сделать так, чтобы можно было фильтровать и группировать по интервалу какого-то целочисленного поля.

2) Разбить все цены на мелкие сектора (например по 50000 рублей) и писать в затратах номер сектора, к которому относится машина.
   Например, сmexpert будут писать в таблицу событие с полем _segment = "seg_850000"_, и это будет означать, что машина стоит от 850.000 до 900.000 рублей.
   Тогда для фильтрации событий по сегменту, нужно будет передавать фильтры с несколькими значениями через запятую (например, _segment = "seg_750000,seg_800000,seg_850000"_).
   А для группировки событий по сегментам, cmexpert сделает пост-обработку результата финстаты, агрегируя сектора в сегменты.


## Decision
Выбрали вариант 2, так как не хочется сильно усложнять апи финстаты.

## Consequences

### Good
Апи финстаты остается простым. Доработки финстаты в 1 варианте более времязатратны, чем доработки cmexpert в варианте 2.

### Bad
Такое решение приведет к не гибкому коду и потенциально может привести к непредсказуемым проблемам.
