# Принципиально другие варианты. И почему мы решили их не делать

Какие варианты ещё поднимались
1. Поместить дедупликацию и этот флоу в брокер (дедупликация после того как появились дубли в брокере)
   почему не хотят делать в брокере:<br/>
   ```касательно самой идеи - чистка уже задублированных сообщений дороже, чем изначально недублирующая запись```<br/>
   ```дедупплицировать лучше на входе. Иначе потом надо помнить, что в YT дубли, а в CH нет (например, когда вы захотите перелить счетчики).```<br/>
2. Сделать общее решение на стороне брокера (дедупликация до отправки)<br/>
   LB - что-то вроде кафки, но яндексовое.
   (цитаты Андрея)
   ```
   У логброкера две инсталляции
   – обычный – 5 независимых LB по одному в каждом ДЦ. Там хорошие тайминги, много железа, но при закрытии одного ты задублируешь данные в другом (либо будешь писать всегда в один дц и потеряешь в доступности)
   - кросс-дц – 1 LB растянутый на 5 дц. Надежно, но на порядок меньше ресурсов и хуже тайминги.
   ```
  ```
      Как вариант, у меня есть идея с exactly-once на входе через промежуточную запись в ydb (преимущественно для небольших потоков).
   Клиент пишет в отдельную ручку или как-то указывает, что ему нужно exactly-once.
   Мы записываем в 2 таблицы ydb – шардированный экспорт и таблицу с последними id с ttl.
   Потом брокер фоново выгребает из нее и пишет с нормальным sourceId и монотонными seqNo в crossDC LB
   В итоге на входе примерно exactly-once, если окно достаточно большое

   Основное узкое место – это cross dc lb на мой взгляд

   Из плюсов клиенту не надо выдумывать sourceId/seqno и группировать все записи по ним
  ```
   ```пока это звучит как довольно костыльное решение для всех```
3. Нам самим писать события через распределённый логброкер.<br/>
Почему нет,
   - producer-am удобнее писать через брокер. И события сразу попадают в yt
   - для нас это более сложная схема, нужно начинать работать с логброкером самим

Из verticals-broker в сыром виде https://paste.yandex-team.ru/5383222