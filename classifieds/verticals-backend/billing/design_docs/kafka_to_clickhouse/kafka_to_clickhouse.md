## Дизайн-док. Перекладыватель финансовых событий из кафки в кликхаус с дедупликацией

## Проблематика
Кликхаус подходит для записи событий, но он не поддерживет транзакционную запись.
Нам нужно без дублей записать данные в кликхаус. Это можно сделать, если писать батчами в кликхаус.
Брокер -> (наш перекладыватель событий) -> кликхаус
Клиенты пишут через брокер, после брокера могут появляться дубли.

## Какие проблемы не решаем
- быстрый флоу, где знаем что в каком дц запущено и разные части работают именно в своём дц.
- отправка по флоу больше одного формата события (т.е эта схема решение для нас, которое мы не распространяем ни на какие другие поставки)

## План
Какие вижу варианты:
1. [Возможно всё поместится в один поток, т.к у нас не много данных](kafka_to_clickhouse_simple.md)<br/>
2. [Что делать, если не поместится в один поток](kafka_to_clickhouse_full.md)<br/>
   
Как предлагаю делать:
Делаем вариант 1, учитываем что он может эволюционировать в более полный вариант 2.
Но вариант 2 сразу не делаем.

## Откуда черпал идеи
1. [Альтернативные варианты](kafka_to_clickhouse_alternatives.md)
2. [как делали в ebay](https://tech.ebayinc.com/engineering/block-aggregator-real-time-data-ingestion-from-kafka-to-clickhouse-with-deterministic-retries/) <br />
3. https://www.confluent.io/blog/multiple-event-types-in-the-same-kafka-topic/ <br />
4. https://www.confluent.io/blog/exactly-once-semantics-are-possible-heres-how-apache-kafka-does-it/ <br />