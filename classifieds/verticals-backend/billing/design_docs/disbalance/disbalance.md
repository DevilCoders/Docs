## Проект "Дисбаланс"

Дисбаланс -- проект по отказу от хождения потребителей биллинга в Баланс.

### Какие сейчас есть проблемы?

1) Размазанная ответственность в части взаимодействия с Балансом. Часть этой логики лежит в биллинге, часть в авто/недвижке.
Из-за этого мы часто не можем ответить на вопросы "а как все устроено", а это в свою очередь усложняет разработку и разбор багов.
К тому же авто/недвижке приходится решать задачи, которыми должна заниматься команда биллинга.
2) Сложные абстракции в биллинге. Сложно разобраться, что такое "РК" в биллинге, и тем более сложно с ней работать.
Сейчас задача завести новый сервис-потребитель биллинга является очень трудоемкой.
3) Баги в процессах, которые приходится лечить руками.
В биллинг регулярно приходят проблемы, которые приходится решать руками разработчиков биллинга и/или саппорта Баланса.
Одна из таких частых проблем - "не обновили РК при смене агентства", которая приводит к тому, что услуги клиента не обилливаются.

### Что включает в себя Дисбаланс и как это поможет?

Главная идея Дисбаланса в том, чтобы **избавить потребителей от необходимости самим ходить в Баланс.**
Вертикальный биллинг станет единой точкой входа для взаимодействия с Балансом, а значит вся ответственность и
все знания о Балансе будут сконцентрированы в команде биллинга. Авто/недвижке так же будет проще делать то, что им нужно.

Нужно заметить, что создание прокси-ручек в биллинге для хождения в Баланс, хоть и формально удовлетворяет реализации идеи Дисбаланса, но не решает вышеперечисленные проблемы.
Важно, чтобы взаимодействовать с биллингом было сильно проще, чем взаимодействовать с Балансом.
Для этого нужно упросить абстракции "РК" и "Заказ", с которыми сейчас приходится работать авто/недвижке.

В частности, нужно позволить потребителям забыть о балансовых id клиентов.
Вероятно, не получится в ближайшем будущем выпилить балансовые id везде в авто/недвижке, так как там построены очень сложные зависимости.
Но биллинг должен предоставить такое API, чтобы **можно было реализовать все процессы, используя только внутренние id потребителей биллинга**.

Итого,
- Реализуем в биллинге более простые сущности для работы с клиентами/продуктами/деньгами.
- Учим биллинг работать с внутренними id потребителей.
- Выпиливаем из авто/недвижки все хождения в Баланс.

### А как это все делать?

Делать, естественно, нужно поэтапно. Мы уже завели некоторое количество эпиков в биллинге на разные этапы. Скоро будут появляться диздоки с конкретными шагами.
- [Регистрация клиента](https://st.yandex-team.ru/VSBILLING-5456)
- [Пополнение кошелька](https://st.yandex-team.ru/VSBILLING-5580)
- [Cмена агентства у клиента](https://st.yandex-team.ru/VSBILLING-5457)
- [Оплата услуги (размещения, васы)](https://st.yandex-team.ru/VSBILLING-5458)
- [Овердрафты](https://st.yandex-team.ru/VSBILLING-4851)
