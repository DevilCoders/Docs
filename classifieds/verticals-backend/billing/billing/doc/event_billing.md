# Монетизация пользовательских событий.

**Пользовательское событие** - событие совершенное пользователем (звонок, чаты, клик).

**Факторы** - параметры не пользовательского события, которые влияют на результат обилливания. Например результат модерации Hobo.

С точки зрения Биллинга эти события обилливаются постфактум, то есть событие уже произошло и мы списываем за него деньги.

События типизированы, рядом с каждым событием лежит поле _BillingHeader_:

**domain** - домен autoru/realty/general    
**uuid** - уникальный идентификатор события 
**timestamp** - время события.  
**product** - наименование продукта 
**amount** - опциональная стоимость 
**user** - с кого списывать деньги за событие


Сервис монетизации потребляет типизированные события из истоника и сохраняет их в хранилище.

Агрегирует в себе набор типизированных факторов из внешних сервисов:
- результат модерации из Hobo
- звонок коллцентра
- жалоба пользователя
- и др

События с набором факторов отправляется в сервис формирования цены, в ответ сервис монетизации получает вердит (целевое или нецелевое событие) и цену.
Каждый новый фактор события инициирует переобилливание события.

Событие с обновленной ценой формирует запрос в Биллинг для списания средств.

![Схема взаимодействия](./user_event_monetization.jpg)

