# Обновление конфигурации Nginx

Конфигурация Nginx раскатывается через пакеты, соответственно, чтобы внести правки, нужно пересобирать пакет или несколько.

0. Определяем в какие пакеты необходимо внести правки - [здесь](packages-and-clusters.md) можно это посмотреть.
1. Создаем отдельную ветку (обычно по названию тикета), в которой вносим необходимые изменения.
2. Делаем пулл-реквест. Ждем, когда пройдут тесты и автосборка.
3. Если все ок, то проверяем текущую версию пакета в **тестинге** (проверяем в [vertis-ansible](https://a.yandex-team.ru/arc_vcs/classifieds/infra/vertis-ansible)). Если в ней содержится суффикс (например, `yandex-vertis-config-nginx-front=1.0+1651755501.pr-2525233` - здесь суффикс `pr-2525233`), то встаем в очередь на выкладку.
4. Если текущая версия в **тестинге** без суффикса (например, `yandex-vertis-config-nginx-front=1.0+1651755501`), то обновляем версию пакета в тестинге на новую.

   {% cut "Где взять новую версию" %}

   ![картинка](images/new-version.png)

   {% endcut %}

6. После проверки в тестинге, можно катить на прод. Для этого **мерджим** пулл-реквест и идем в [проект в тимсити](https://t.vertis.yandex-team.ru/project/VertisAdmin_NginxPackages?mode=builds). Находим нужные пакеты и ждем пока они соберутся (**сборка запустится автоматически**).
7. Выкатываем руками новую версию на **один хост** в проде. Ждем 20-30 минут, смотрим на графики, проверяем руками.
8. Обновляем версию пакета для тестинга и прода (на версию без суффикса).
9. Вы великолепны!

