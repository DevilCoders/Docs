# Nomad system & jobs
## Описание

Система nomad является составной частью большого комплекса вертикальной докерной архитектуры.
Nomad выступает как планировщик, оркестратор и контроллер, единый бинарник может запускаться в режимах сервер и клиент, которые постоянно общаются друг с другом по протоколу raft.
Интерфейс доступен в браузере по следующим урлам :
Тест: [https://nomad.test.vertis.yandex.net](https://nomad.test.vertis.yandex.net)
Прод: [//nomad.vertis.yandex.net](https://nomad.vertis.yandex.net)

## UI
Интерфейсы представляют собой LB, развернутые на node-minifront над всеми инстансами серверов номада.
Сам номад в бесплатной версии не предоставляет UI интерфейса, мы используем opensource проект [https://github.com/jippi/hashi-ui](https://github.com/jippi/hashi-ui)
Hashi представляет собой докер контейнер запускаемый над инстансом сервера номада и делающим визуальную надстройку над api сервера. Манифест деплоя доступен [тут](https://a.yandex-team.ru/arc_vcs/classifieds/services/deploy/nomad-ui.yml)

## Nomad servers
Представляют из себя группы из 3 машинок в разных ДЦ, с кворумом в 2.
Берут на себя управляющие обязанности, принимают через api новые джобы и изменения в старых джобах, после чего отправляют команды на изменение клиентам.
Следит за состоянием клиентов.
Тесно интегрирован с consul, пушит в него любые изменения в сервисах (заводит новые, удаляет старые)
Катится нашими пакетами, включающими в себя бинарник номада, автогенерилку конфигов для номада и мониторинг.

## Nomad client
Запущены на всех хост-машинках с docker-engine, на которых предполагается выкатывать сервисные докер контейнеры. Знают про кластер серверов, общаются с ними по протоколу raft. Клиенты непосредственно отдают команды докеру по запуску-гашению джоб, передают информацию о текущем состоянии джоб в консул и серверу.
Катится нашими пакетами, включающими в себя бинарник номада, автогенерилку конфигов для номада и мониторинг.

## Nomad jobs
Непосредственно сервисная единица в новой архитектуре, представляет из себя спецификацию для деплоя ( сколько контейнеров, где, когда и как нужно их запустить и тп. ).

## Документация
Общие доки: [https://www.nomadproject.io/docs/index.html](https://www.nomadproject.io/docs/index.html)
