# Работа с пакетами в Кондуктор

Кондуктор живет по адресу [c.yandex-team.ru](https://c.yandex-team.ru). В Вертикалях это источник правды о всех хостах и группах хостов, и с его помощью все еще деплоятся некоторые сервисы.

## Закоп сервиса в кондукторе

1. На всякий случай уточняем у команды разработчиков сервиса, что сервисом из кондуктора **никто** не пользуется и его **точно** можно закопать. После получения ок'а начинаем закоп сервиса.
2. В кондукторе во вкладке `Пакеты` ищем нужный для закопа пакет и переходим в секцию `Деплой лист` ([пример](https://c.yandex-team.ru/packages/yandex-vertis-billing-tms/deploy_list)). Получаем список всех кондукторных групп (а далее - и хостов) в тестинге.
3. Проходимся по всем хостам в тестинге последовательно и а) выполняем `service <conductor_service_name> stop` если в тикете не было указано другое, б) проверяем статус сервиса через `monrun`. Как правило, `<conductor_service_name>` соответствует имени пакета без приставки `yandex-vertis-`.
4. После остановки сервиса отписываемся об этом в тикет и оставляем выключенным на некоторое время (обычно - сутки).
5. Повторяем процедуру для прода. При этом рекомендуется оставить сервис выключенным на период от суток до недели в зависимости от его критичности.
6. Если просьб о возвращении сервиса не поступило - можно приступать к закопу. На странице пакета переходим в секцию `Редактирование пакета` и нажимаем кнопку `Удалить`. Пакет пометится удаленным и деплоиться больше нельзя будет.
7. Сначала на тестинге, затем в проде - заходим на хост и удаляем с хостов пакет сервиса. Название пакета соответствует имени сервиса в кондукторе. Отписываемся об этом в тикете.

**Рекомендованная практика после закопа**: пройтись по всем хостам и проверить `monrun` - возможно на хостах ничего не живет. Если в `monrun` нет никаких проверок кроме системных - завести тикет в `VERTISADMIN` на закоп хостов/кондукторных групп.
