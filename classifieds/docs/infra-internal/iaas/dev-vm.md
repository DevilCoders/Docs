# Виртуальные машины для разработчиков

## Основная информация

* Виртуальные машины разработчиков создаются в [qyp.yandex-team.ru](https://qyp.yandex-team.ru/).
* Виртуалки создаются в ДЦ SAS, соответственно они не будут доступны во время общеяндексовых учений и регламентных работ.
* После создания виртуалки админы не поддерживают окружение виртуалок разработчиков - они настраивают его самостоятельно. Помощь с допнастройкой виртуалки - акт доброй воли, а не обязанность админа.
* Мы не отвечаем за отказоустойчивость виртуалок. Если из-за проблем с хост-машиной виртуалка обнулится - мы ничего не сможем сделать, только переналить ее.

## Создание виртуалки

В тикете на создание виртуалки указываются логин пользователя ВМ, необходимые ресурсы и является ли разработчик фронтендером. Если разработчик **не** фронтендер, то ВМ должна создаваться в кондукторной группе `%vertis_vdev_personal`, если разработчик является фронтендером - `%vertis_vdev_personal_frontend`.

Для операций с виртуальными машинами используется скрипт [qyp-mngr.sh](https://a.yandex-team.ru/arc_vcs/classifieds/infra/admin-utils/qyp-mngr.sh). В скрипте доступен подробный `help`.

Для создания dev-виртуалки необходимо выполнить команду:

```
 bash qyp-mngr.sh create -p=<owner>-<VM index>-dev -c=<cores> -m=<memory> -d=<disk> -g=<conductor group> -o=<owner>
```

`VM index` - порядковый номер виртуалки разработчика. Проверить, есть ли уже виртуалка у разработчика, можно в [qyp.yandex-team.ru](https://qyp.yandex-team.ru/). Если виртуалки нет - `VM index = 01`, если есть - `02`, `03` и т.д.

Пример команды для создания виртуалки для разработчика `@danevge`:

```
bash qyp-mngr.sh create -p=danevge-01-dev -c=4 -m=8 -d=100 -g=vertis_vdev_personal -o=danevge
```

После создания ВМ в qyp будет запущена плейбука `provision-qyp.yml`, а после нее на машине начнет работать ansible pull и довезет оставшееся окружение. В случае, если прогон плейбуки упал с ошибкой - в консоли появится подсказка о том, как можно его перезапустить.

## Удаление виртуалки разработчика

Команда для удаления виртуалки в общем виде:

```
./qyp-mngr.sh delete -p=<owner>-<vm index>-dev -o=<owner>
```

Команда для удаления виртуалки разработчика `@danevge`:
```
./qyp-mngr.sh delete -p=danevge-01-dev -o=danevge
```
