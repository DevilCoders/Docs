# Сhangelog сервиса

В **verticals-backend** есть возможность собирать агрегированный changelog из всех PR в **classifieds/**, повлиявших на конкретный сервис.

Для чего:
- для сервисов под sox'ом обязательно наличие тикетов, привязанных к релизу
- при выкатке коммунальных сервисов хочется видеть, какие изменения попали в релиз
- можно обнаружить странные зависимости у своего сервиса

Чтобы подключить ченжлоги или связанные тикеты к своему сервису необходимо выставить в `shiva_service` соответствующие флаги **changelog** / **link_tickets** в *True* и вызвать `make gen/yaml`.

```python
shiva_service(
    service_name = "doppel-yt-controller",
    link_tickets = True, // привязать к деплою тикеты (например, по требованию SOX)
    changelog = True, // добавить к деплою changelog из всех PRов в релизе
    ...
)
```
В случае если выставлен флаг **link_tickets**, при [релизе](./intro.md#releases) вашего сервиса из транка в shiva будут автоматически проброшены тикеты, привязанные к PR'ам, затронувшим сервис.
Если выставлен флаг changelog, то к релизу так же будет добавлен комментарий, состоящий из названий этих PR'ов.

![admin](admin.png)

Примечания:
- тикеты должны быть привязаны к PR, название PR мы не парсим
- сhangelog строится между ревизией сервиса в проде и текущим транком. Сохранение пары версия сервиса / ревизия происходит в процессе релиза через CI, так что если ваш сервис не выкатывался очень давно или выкатывался иным способом, то на первом релизе changelog будет строить неоткуда (но если очень нужно, можно договориться)
- обработка новых ревизий тригеррится мержами в транк для **verticals-backend**, но при этом включает ревизии, затронувшие **classifieds/**. То есть изменения в **schema-registry** попадут в changelog, но только если вслед за ними или вместе с ними были изменения в **verticals-backend**. Из этого же следует, что обработка новых ревизий может происходить с задержкой
- непосредственно релизные тикеты в отдельной очереди мы не создаём

{% note alert %}

Изменения в WORKSPACE (обновление, добавление, удаление внешних зависимостей) всегда попадут в changelog сервиса независимо от фактического использования.

{% endnote %}
