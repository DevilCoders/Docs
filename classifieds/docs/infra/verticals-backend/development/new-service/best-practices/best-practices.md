# Best practices

Проживание в монорепе дает не только дополнительные возможности, но и накладывает отвественность.
Медленная компиляция, флапающие тесты становятся не только вашей проблемой, но и всех соседей по монорепе.
Помимо этого дублирующийся код (как дословно, так и семантически) увеличивает нагрузку на команду devtools и замедляет обновление зависимостей.
Ниже приведены правила хорошего тона для проживающих в монорепе.  

1. По возможности используйте библиотеки из `//common`. Это снижает дублирование кода и упрощает поддержку. Особенно это касается инфраструктурных вещей типа логгинга и трейсинга, которые прорастают во многие места.

2. Дробите таргеты. Это улучшает кеширование сборок/тестов, позволяет более точно управлять зависимостями. Это касается как дробления по функциональности (избегайте больших таргетов типа `common`, `utils` и т.д., предпочитайте `yt`, `clients/blackbox`), так и по слоям (отделяйте имплементацию от интерфейса).

3. Не используйте (или хотя бы ограничьте число семплов) генераторы в тестах, которые требуют подъем контейнеров/поход во внешние сервисы. Генераторы значительно замедляют выполнение таких тестов, не давая больших преимуществ. При этом использование генераторов в unit-тестах протоколов, конвертаций и т.д. не возбраняется.

4. Тесты, которые используют внешние сервисы, необходимо выносить в отдельные таргеты и помечать тегом `integration`. Такие тесты не герметичны и могут периодически падать, поэтому их прохождение не является обязательным к мержу.

5. Если вы знаете, что ваши тесты флапают, заигнорьте или почините их (особенно те, что не помечены `integration`).

Команда devtools будем следить за соблюдением этих правил и заводить тикеты на исправление.
Пожалуйста, не игнорируйте их.
