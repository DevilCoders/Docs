# Модель справочника

**Справочник** – коллекция изображений, файлов, а также protobuf–сообщений одного типа.

**Модель справочника** – прото модель со [специальными аннотациями](https://github.com/YandexClassifieds/schema-registry/blob/master/proto/palma/palma_options.proto).

**Ссылка** – направленная связь поля модели справочника и справочника другого типа, задается аннотацией.
Есть ряд требований и ограничений:
* все поля с типом справочника должны быть помечены аннотацией ссылки;
* нельзя помечать поля аннотацией ссылки, если поле, на которое ведет ссылка не справочник
* ссылка может быть указана не только из корневых полей модели справочника, но и через вложенные сообщения, [например](https://github.com/YandexClassifieds/schema-registry/blob/master/proto/palma/samples.proto#L40), такие ссылки называются **вложенными**.
* модели справочников одноранговые, поэтому нельзя задавать справочник, как вложенное сообщение.

**Индекс** – аннотация модели справочника, представляет из себя список списков строковых полей этого справочника. Позволяет фильтровать по значению этого поля. Индексы по нескольким полям не поддерживаются.

{% note warning %}

Не рекомендуется создавать много индексов

{% endnote %}

## Описание опций

Для описания модели справочника используется [набор опций](https://github.com/YandexClassifieds/schema-registry/blob/master/proto/palma/palma_options.proto).

*DictionaryOptions* – опции модели:
* name – уникальное название модели, рекомендуется использовать иерархические названия (``auto/mark/model``, ``auto/mark`` и тп)
* indexes – название полей, для которых будут построены индексы. Пока поддерживаются только одиночные строковые поля, составные будут поддержаны при необходимости
* encrypted – булевский флаг, который сигнализирует о том, что сущности данного справочника должны храниться в зашифрованном виде
* title – русскоязычное название справочника, используется для отображение в админском интерфейсе
* auto_gen_key – булевский флаг, который сигнализирует, что идентификатор справочника будет сгенерирован автоматически, если его не передать
* hidden – булевский флаг, позволяющий по дефолту не показывать справочник в админке
* listing_fields – названия полей, которые будут отображаться в листинге в админке (по дефолту показываются все поля)
* authorized_services – названия сервисов, авторизованных для работы с этим справочником

*DictionaryFieldsOptions* – опции полей:
* key – уникальный строковый идентификатор сущности в рамках модели
* link – булевский флажок, который сигнализирует, что данное поле является связью
* title – русскоязычное название поля, используется для отображение в админском интерфейсе
* as_title – булевский флаг, допускающий использование значения поля в качестве заголовка экземпляра справочника (если указано несколько таких полей – будет выбрано произвольное из них (вероятно, первое))

*ImageFieldOptions* – опции картинок:
* namespace – неймспейс в аватарницы
* aliases – поддерживаемые алиасы

*DictionaryEnumValueOptions* – опции значений enum:
* title – русскоязычное название значения для отображения в админке

## Поддерживаемые типы связей

**one_to_many** – есть два варианта представления такого типа связи:
* ссылка из дочернего в родительский справочник
* список ссылок из родительского на дочерний, дочерние сущности должны уже быть определены в справочнике
  Оба варианта имеют односторонний тип связи.

**many_to_many** связи не поддержаны

## Мутация модели справочника

На данный момент поддерживаются ограниченный набор мутаций моделей:
* добавление/удаление полей
* добавление/удаление связей
* добавление/удаление индексов

*Не поддерживается* аннотация существующего поля связью/индексом или удаление аннотации связи у существующего поля, так как в таком случае необходимо будет переиндексировать существующие сущности модели.
