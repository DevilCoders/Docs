# Заказ доступов

## Заказ ssh-доступа и прав sudo

Для ssh-доступа на сервера у вас обязательно должен быть добавлен публичный ssh-ключ на `staff.yandex-team.ru`. Ssh-доступ организуется подсистемой `cauth`, поэтому после добавления ключа на staff должно пройти какое-то время для синхронизации его в базу `cauth`.

Как сгенерить ssh-ключ можно прочитать [тут](https://wiki.yandex-team.ru/diy/macos/ssh/).

Ssh-доступ желательно организовывать не к конкретному серверу, а к кондукторной группе. Для того, чтобы понять, в какой кондукторной группе находится нужный сервер, надо зайти на `c.yandex-team.ru/hosts` и в малом окне поиска ввести его имя.

Ssh-доступ можно запросить самостоятельно через `idm.yandex-team.ru`. Вверху окна нажимаем кнопку `Запросить роль`, в строке `Система` выбираем `CAuth`, далее вписываем кондукторную группу с префиксом `conductor.*` (например `conductor.vertis_test_wizard`), в которую входит нужный нам сервер и выбираем роль `Ssh`.

Если необходимо заказать `Sudo`, то последовательность действий такая же, только роль выбираем `Sudo` и в поле ниже `role *` вписываем нужные нам `sudo`-права (обычно просто выбираем на все `"ALL=(ALL) NOPASSWD: ALL"`).

**Если вы запрашиваете доступ к серверам в `production`, то доступ по требованию SOX должен быть обязательно временный (для кратковременного debug - *несколько дней*, для работ в `prestable` - *ориентировочно 200 дней*), а в поле `"Обоснование для получения роли"` должен быть вписан тикет, в котором указано данное обоснование!**


## Заказ сетевых дырок

Вертикали живут в 2 макросах - тестинг+дев `_VERTISDEV_`  и прод `_VERTISPROD_`. Разработческие ноутбуки не входят в данные сетевые макросы, и доступ необходимо заказывать отдельно по логину пользователя (VPN + из офиса).

### Запрос статической (сервер <-> сервер) или динамической (человек <-> сервер) дырки

В этом разделе речь только про заказ дырок. Если вам нужен ssh-доступ, то его заказ происходит через IDM по инструкции в разделе выше.

**Прежде чем заказывать дырку, обязательно убедитесь что дырки действительно нет.**

Проверить наличие доступа можно следующим образом:
* Для проверки динамического доступа (`человек <-> сервер`):
    * С рабочего ноутбука выполнить команду `telnet <место назначения> <порт>`, например:
        ```
        telnet 3dc-ydb-dev-vla-003.search.yandex.net 1111
        Trying 2a02:6b8:c0e:10b::1354:dbc:a3ca...
        telnet: connect to address 2a02:6b8:c0e:10b::1354:dbc:a3ca: Operation timed out
        telnet: Unable to connect to remote host
        ```

        `Operation timed out` означает, что доступа нет и его надо заказать.

        Если утилиты telnet нет на ноуте, её можно установить:
        * macos: `brew install telnet`
        * linux: `apt-get install telnet`

    * Либо поискать дырку в поиске [puncher](https://puncher.yandex-team.ru/).

* Проверка статического доступа (`сервер <-> сервер`). Чтобы проверить, что нет доступа `сервер <-> сервер`, нужно просто поискать дырку в поиске [puncher](https://puncher.yandex-team.ru/).

### Как заказать дырку

Идем в [puncher](https://puncher.yandex-team.ru/), и нажимаем на кнопку `Создать заявку на правило`.

Если заказываем дырку `сервер <-> сервер`, то для тестинга вводим источник `_VERTISDEV_`, для прода - `_VERTISPROD_`. В качестве приемника указываем, куда хотим дырку.

Если заказываем дырку `человек <-> сервер`, то в качестве источника вводим либо яндексовый логин (доступ будет на 2 месяца), либо группу со staff, либо abc-сервис. В качестве приемника указываем, куда хотим дырку.

К заявке линкуем тикет, в рамках которой необходима дырка, или/и ее обоснование.

После создания заявки ждем аппрув от безопасников.

Документация по работе с puncher - `https://wiki.yandex-team.ru/noc/nocdev/puncher/`
