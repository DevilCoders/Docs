# hipe

https://st.yandex-team.ru/AUTORUAPI-2982

Программа ищет пользователей, которые три дня назад использовали приложение
и смотрели объявления, но с тех пор (позавчера, вчера и сегодня) больше не заходили. Пользователи ищутся по логам событий в Hive (https://tasmania.hdp.yandex.net) Этих найденных людей программа аккуратно
записывает в файлик, чтобы им всем послать пуш.

Второй компонент программы просматривает этот файл и рассылает пуши.

### Деплой:

mvn clean package -Pdeploy

В update.properties надо прописать:

ssh.host=<host, куда отправится проект>

Будет установлена в ~/dist/hipe

### Обновление:

mvn clean package -Pupdate

Будет обновлен только джарник программы, зависимости не будут перезалиты.

### Логи:

~/dist/hipe/hipe.log

~/dist/hipe/hipe.log.shell

### Генерит файлы:

~/dist/hipe/stats.txt

~/dist/hipe/send.txt

Файл send.txt - список тех, кому надо послать пуш. Формат:

    2017-08-04 10:58:23
    b0542e753c0ced95adc57623eaba3c6b LAND_ROVER|RANGE_ROVER_VELAR 6
    88351d0b81043a3d2b0d71903ab49755 MITSUBISHI|PAJERO 8
    87b7def99b08b57c1138c0ceb5306965 VOLVO|S60 7
    71d6548d35675058c1745c3d82d60691 MAZDA|3 10
    927fd8c3fd9e2afad7664a01499e6e10 VOLKSWAGEN|GOLF 11
    2cc4fff594e8ab3daf02f7bc6fa080c8 MERCEDES|C_KLASSE 10
    d7ba248916889ee4b612fdbb4b2231c6 MAZDA|CX_5 6

Первая строка - дата генерации, последующие строки:

uuid mark|model <сколько раз в этот день открывал объявления для этой марки-модели>

Файл stats.txt содержит непосредственный результат запроса в hive. Формат такой же, но там каждый uuid может быть встречаться
несколько раз, если пользователь смотрел разные марки-модели. В send.txt мы из них оставляем ту марку-модель, которую данный
пользователь смотрел чаще других.

Программа работает в фоне постоянно, делает запросы в hive каждые полчаса и перегенеривает файл.
