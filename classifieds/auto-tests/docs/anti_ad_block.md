## Немного про Anti AdBlock

Основная движуха и инфа есть в [тикете](https://st.yandex-team.ru/VERTISADMIN-21943)
и на [вики](https://wiki.yandex-team.ru/antiadb/invertedcookieschema/)

Сейчас по дефолту будет считаться, что у пользоваттеля стоит блокировщик рекламы. Если нет куки cycada или она не
валидная, то страница шифруется и имена классов превращаются из
`CardHead-module__container` в `qU3QTf3A1P5qtPb7NjibJ__container`. У нас все локаторы становятся невалидными, не можем
найти элемент на странице.

На nginx просиходит проверка валидности куки. Если `User-Agent` или `Accept-Language`
в запросе отличаются от тех, что были использованы при генерации куки, то значит она невалидна.  
Так же в куке содержится таймстемп создания кукки. И есть ttl, по прошествии которого кука считается невалидной.  
А еще при генерации куки используется [секрет](https://yav.yandex-team.ru/edit/secret/sec-01dp0t66zeygf580c2j76qjjsd)

Если `User-Agent` мы можем захордкодить в тестах, то вот на ttl мы никак повлиять не можем и поэтому нужно генерить куку
перед каждым тестом...  
Я реализовал алгоритм на Java, а админы положили секрет в TeamCity как переменную окружения.

Но для локального запуска необходимо положить этот секрет себе в `testing.properties` файлик в формате
aab_partner_key=значение из секрета. Иначе кука не сгенерится, страница зашифруется и тесты будут фейлиться. В логах
запуска будет написано если мы не смогли сгененрить куку

Когда у нас тесты перестанут запускаться на прод серверах можно будет сделать следующее - сгенерить один раз куку и в
тестинге устанавливать для тестов долгий ttl. Но пока... 
