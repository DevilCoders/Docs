---
title: LSR, разбор инцидентов
---
## Что такое инцидент?

Для быстрой проверки:

- фронт или бэк «пятисотит» на 1+ RPS в течение минуты или более
- 90 процентиль времени ответа фронта поднялась выше 3с
- неработоспособность важных кусков функциональности, примеры:
  - невозможность сделать BoY заказ
  - невозможность перейти к партнёру (Авиа, Отели, Поезда)
  - невозможность выполнить поиск (все сервисы)
  - недоступности личного кабинета
  - не доставляются уведомления в Электрички

Полный набор в конце страницы.

## Что делаем при наступлении инцидента?

- Сразу пишем в чатик [Travel Duty](https://t.me/joinchat/CEnvnFGQDcrWVrjg7A1OLg) -- это нужно для уведомления капиталистов и смежников.
- Срочно чиним.
- Заводим тикет на инцидент (см. следующий пункт) - после починики или, если починка затягивается, то во время починки.

## Правила заполнения тикета на инцидент LSR

- Портальные правила: [https://wiki.yandex-team.ru/jandekspoisk/lsr/]
- Пример большого LSR: [https://st.yandex-team.ru/LSR-297]

Тикеты создаются:
  * в очередях сервисов с тэгом `lsr`
  * название тикета `[дата] <сервис и симптомы> с <время> до <время>, <последствия в двух словах>`) (например: `"[2019.03.21] падение Расписаний с 00:00 до 24:00, все умерли"`)
  * в наблюдателей ставим:
    * кого:lorekhov
    * руководителя группы - владельца сервиса
    * руководителя сервиса

Тикет создаёт дежурный, поддерживает - руководитель группы разработки, владеющей компонентой. 

### Шаблон LSR (для Вики)

```
===Краткое описание того, что произошло
В двух-трех предложениях о том, что случилось

===Что во время инцидента видели пользователи
Описание текстом и/или скриншоты верстки

===Хронология событий
Описать шаги выкаток, основные моменты переписок, прогресса починки,
[dd.mm hh:mm] - ...
[dd.mm hh:mm] - ...

===Последствия/потери
* Цифры
* Графики
Не забыть про последствия для смежных сервисов. Например, если лежали Расписания, то как много мы потеряли продаж билетов в портале Путешествий?

===Выводы
Как не допустить повторения подобного в дальнейшем:
* Что уже сделано (предпочтительно ссылками на задачи в ST)
* Что еще нужно сделать (ссылками на задачи в ST/цели в Goals)

===Кого позвать на разбор инцидента
Список людей которых целесообразно позвать на встречу для всестороннего разбора инцидента 
(это могут быть представители пострадавших сервисов, поставщики данных, заказчики изменений и т.п.)
```

**Hint**:
Поля, в которых нечего описать лучше не пропускать, а дополнять чем-то типа "Пользователи не пострадали", или "Извне проблема не наблюдалась", или "Потерь трафика и просадки таймингов не было"

## Работы с LSR тикетам

Доска со всеми тикетами: https://st.yandex-team.ru/agile/board/7254

Воркфлоу:
* **открыт** - тушим пожар, исходное состояние любого тикета
* **требуется информация** - пожар потушен, проводим расследование и подводим итоги
* **в работе** - итоги подведены, внедряем необходимые доработки в связных тикетах
* **закрыт** - работы в связных тикетах выполнены, инцидент закрыт
Поскольку живём в нескольких очередях, то приспосабливаем подмножество общих состояний.

Тикет по воркфлоу проводит менеджер, ответственный за сервис.

## Критерии инцидента

### Быстрые критерии

- фронт или бэк «пятисотит» на 1+ RPS в течение минуты или более
- 90 процентиль времени ответа фронта поднялась выше 3с
- неработоспособность критичных кусков функциональности, примеры:
  - невозможность сделать BoY заказ 
  - невозможность перейти к партнёру (Авиа, Отели, Поезда)
  - невозможность выполнить поиск (все сервисы)
  - недоступности личного кабинета
  - не доставляются уведомления в Электрички

 (критичность определяет менеджер вертикали и/или дежурный тестировщик)

### Статистические пороги

**Важно:** - текущие пороги выставлены на основе здравого смысла. 
TODO: определить конкретный SLA для компонент, SLA должен быть определен в виде порогов алертов.

- "">=1%"" пользователей страдают от:
  - невозможно сделать заказ на Яндекса
  - невозможно перейти к партнёру для завершения заказа
  - заказ создаётся с неверными данными

- "">=5%"" пользователей страдают от:
  - недоступность контента Расписаний/Электричек
  - недостоверность контента Расписаний/Электричек
- падение конверсии в заказы у партнера на ""=>20%""
- падение количества заказов на Яндексе на "">=20%"" относительно среднего за час
- падение количества редиректов к партнерам на "">=20%"" относительно среднего за час
- "">=10%"" пользователей не могут получить доступ к заказам в личном кабинете

### Портальные критерии
Если срабатывает один из критериев [Портала](https://wiki.yandex-team.ru/jandekspoisk/lsr/), то заводим тикет на большой LSR.
