---
title: Если что-то пошло не так
---

## Восстановление кластера БД

*Если кластер упал и встать не может, база недоступна, решили смириться с потерью некоторых последних данных*

**Внимание!** Операцию стоит проводить в крайнем случае. Она занимает более 30 минут, все данные, созданные после создания автоматической копии, будут потеряны.


1. Идем в `yc.yandex-team.ru` -> `travelorchestrator` -> `Managed Service for PostgreSQL` -> `Кластеры` -> `orders_service_cluster` -> `Резервные копии` ([ссылка](https://yc.yandex-team.ru/folders/fook6nom9g5ph8gulcfu/managed-postgresql/cluster/mdb3do2jnu4mknai53in?section=backups))
2. Находим последнюю резервную копию
3. Выбираем "Восстановить кластер". **Важно:** если квоты не хватает, облако не даст создать еще один кластер. Если оргинальный кластер уже не восстановить, точно можно поотключать slave'ы.
4. Вводим данные, такие как имя, зоны доступности. Создаем кластер.
5. Ждем около 30 минут.
6. Обновляем spring.datasource.url в nanny (либо через override yml, либо через системные св-ва)
7. Ждем когда инстансы orders перезапустятся.
8. Проверяем что все работает как надо.
9. Думаем, можно ли восстановить данные из лежачего кластера.
