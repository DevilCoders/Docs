---
title: Хранилище офферов для Автобусов
---

## Требования

* сделать фронтенд тонким, чтобы скрыть механизм ценообразования;
* уйти от избыточного перекладывания данных через фронтенд лишь для того, чтобы пробросить их в Оркестратор;
* иметь возможность в будущем включить бандита;

## Терминология


* Рейс - Структура Ride из https://a.yandex-team.ru/arc_vcs/travel/buses/backend/proto/worker/ride.proto?rev=238ef65fbc00b55745c412afa944bd0260b83c4a#L59
* Оффер - структура содержащая в себе рейс, данные для вычисления yandex-fee, пользовательский контекст

## Высокоуровневый дизайн

* фронт вызывает buses-backend-api/book-params. Во время выполнения запроса создается оффер в офернице и в ответе фронту отдает offer-id
* book-params ходит в редиректилку, получает label, прикрепляет label к офферу
* фронт при book передает в оркестратор offer-id
* оркестратор запрашивает оффер в buses-backend-api
* оркестратор по данным оффера и ответу buses-backend-worker/book вычисляет yandex-fee

## План:

* В ручке buses-backend-api/book-params - реализуем синхронный сеттер ydb
* Пишем grpc хендлер buses-backend-api/getOffer(offer-id): offer. Под капотом это getter к ydb
* Структуру оффера описываем в protobuf
* Хранить офферы в YDB предлагается в формате JSON используя нативный proto маршалинг оффера
