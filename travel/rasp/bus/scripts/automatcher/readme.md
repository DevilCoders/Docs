#Автоматчеры

Автоматчеры - набор сценариев для матчинга/разматчинга точек по определенной логике.
Каждый сценарий реализует определенную логику матчинга/разматчинга.
Запуск должен производиться из задачи sandbox BUS_AUTOMATCHER с выбором необходимых партнеров и сценариев

После запуска автоматчер оставляет отчет о сматченных объектах в ресурсе sandbox, файл automatcher.csv, а также
все сценарии, которые могут сообщать дополнительную информацию - оставляют свои отчеты в файлах по имени сценария

## Сценарии

Возможен запуск одного или нескольких сценариев одновременно. При одновременном запуске к точке будет применен первый полученный результат
в порядке очередности сценариев. Текущая очередность:
- Матчинги из файла
- Станции близнецы етрафика
- Обновление идентификаторов юнитики
- Матчинг по данным расписаний
- Удаление неактуальных привязок

### Матчинги из файла
Использует полученные данные для однозначного матчинга по ключу supplier_id, supplier_point_id. Содержимое файла передается в sandbox через
текстовое поле.

Параметры: данные из файла в формате csv, разделитель запятая (имя партнера, код точки партнера, матчинг)

Отчет: нет

### Станции близнецы етрафика
Для отпределения близнецов создаем группы по title + okato, при этом okato должен быть не пустой, если в группе есть один уникальный матчинг,
то его можно использовать для матчинга несматченных объектов в группе, если в группе нет матчинга, либо несколько матчингов,
из-за чего нельзя выбрать какой применить для несматченных, то сценарий добавляет группу в отчет для ее ручной обработки

Параметры: нет

Отчет: группы, которые не имеют ни одного матчинга, который можно было бы использовать, а также группы, в которых более одного матчинга

### Обновление идентификаторов юнитики
Логика работы - сценарий пользуется ручкой Юнитиков для получения данных об изменениях идентификаторов точек партнера.
Если точка с изменившимся идентификатором была сматчена, новый идентификатор точки имеется в базе и не сматчен, то сценарий
применяет матчинг взятый у старого идентификатора.
Для сохранения номера последних взятых изменений у партнера сценарий использует S3, откуда берет при старте номер изменений,
а также сохраняет в S3 после работы номер последнего обработанного изменения

Параметры: нет

Отчет: кол-во точек в разных статусах: не найдены; найдены, но не сматчены; не найден новый идентификатор;
новый найден, но смачтен; новый найден и к нему можно применить матчинг

### Матчинг по данным расписаний
Сценарий пользуется файлом, который генерируют расписания для матчинга объектов по правилам.
Два партнера из текущих присутствуют в файле: однакасса - матчинг по кодам станций, етрафик - матчинг по названиям станций.
Так как у етрафика есть станции близнецы, то соответствие 1 к 1 имени в файле и имени у партнера производится по группе станций партнера,
у которых одинаковые title + okato, либо, если okato пуст, одинаковые title + region, либо, если регион пуст, то одинаковые title, и такая станция одна.

Параметры: конфиг, описывающий правила соответсвий между файлом расписаний и точками партнеров в автобусах

Отчет: нет

### Удаление неактуальных привязок
Сценарий удаляет неактуальные матчинги, которые удалены из базы расписаний. Использует последние ресурсы расписаний для проверки актуальности.

Параметры: нет

Отчет: нет
