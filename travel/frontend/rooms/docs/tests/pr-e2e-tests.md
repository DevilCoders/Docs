## Запуск автотестов на PR

### Билды в TeamCity

Существует 2 билда для запусков автотестов на PR:

-   [DataUI_YaTravel_YaTravelFrontend_E2ePrTests](https://teamcity.yandex-team.ru/buildConfiguration/DataUI_YaTravel_YaTravelFrontend_E2ePrTests?mode=builds#all-projects) (_главный билд_)
-   [DataUI_YaTravel_YaTravelFrontend_EndToEndFallTestsByBranchPR](https://teamcity.yandex-team.ru/buildConfiguration/DataUI_YaTravel_YaTravelFrontend_EndToEndFallTestsByBranchPR?mode=builds#all-projects) (_билд упавших тестов_)

Сборку `DataUI_YaTravel_YaTravelFrontend_E2ePrTests` (_главный билд_) в тимсити запускает ферма: [конфиг](https://a.yandex-team.ru/arcadia/data-ui/farm/src/server/configs/env/travel.ts?rev=r9761161#L14),
после успешной сборки стенда. Этот билд **не является обязательным для прохождения**.

В последнем шаге главного билда вызывается билд `DataUI_YaTravel_YaTravelFrontend_EndToEndFallTestsByBranchPR` (_билд упавших_),
который **является обязательным для прохождения**.
Этот билд запускает только упавшие тесты главного билда.
Если в этом билде все упавшие тесты пройдут, то билд пройдет успешно (даже если упавших не было).

Для корректной работы билда упавших тестов требуются артефакты главного билда,
поэтому, если главный билд упал из-за того, что упало слишком много тестов,
надо перезапустить главный билд, так как артефакты в такой ситуации не создаются.
Текущую границу количества тестов можно посмотреть [тут](https://teamcity.yandex-team.ru/admin/editBuildFailureConditions.html?id=buildType:DataUI_YaTravel_YaTravelFrontend_E2ePrTests).

### Сценарии запусков

Могут возникнуть различные сценарии при запуске автотестов:

-   Главный билд прошел успешно, упавшие - тоже успешно - все хорошо, можно мержить
-   В главном билде упали тесты, в упавших все прошли - все хорошо, можно мержить
-   Упали некоторые тесты из-за изменений в ветке - чиним тесты.
    Если сломанные тесты становятся не актуальны, тогда идем к тестировщикам и договариваемся о дальнейшей судьбе теста (удаление/изменение)
-   Упали тесты из-за упавшего/сломанного бэка - ждем пока починят бэк, после этого перезапускаем билд упавших тестов.
    В критической ситуации в этом сценарии (например хотфиксы), если задача не имеет отношения к сломанному тесту, можно смержить красной кнопкой (не рекомендуется)
-   Упали тесты по другой причине (внезапно перестал работать сценарий в автотесте, в дев случайно заехали сломанные тесты) - внештатная ситуация, решается обсуждением в [#proj-green-trunk в Slack](https://yndx-travel.slack.com/archives/C01U65R6WUA)
