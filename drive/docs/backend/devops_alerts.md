# Алерты

## Агрессия

[Мониторинги](https://monitoring.yandex-team.ru/projects/carsharing_analytics/dashboards/monilk074oeemql339lr?from=now-1w&to=now&refresh=60000&p.cluster=production)

### da.aggression.sessions_update_lag

Алерт говорит, что скоринг сессий сильно отстает (больше чем на день).

#### Порядок действий

В начале проверяем таблицу [//home/carsharing/ml/agressive_driving/v2/applier/session_scores](https://yt.yandex-team.ru/hahn/navigation?path=//home/carsharing/ml/agressive_driving/v2/applier/session_scores).

Если она не обновлялась более дня, то приходим к Кириллу Луневу.

Далее смотрим на [планировщик в DAJR](https://dajr.yandex-team.ru/planner/978/).

Если процесс выключен (Status: disabled), то приходим к Ивану Удовину или Кириллу Луневу.

Если процесс давно не запускался, то проблема с планировщиком, приходим к Ивану Удовину.

Если процесс до сих пор выполняется - пробуем его завершить досрочно через Abort. Если проблема не решилась за час, то передаем Ивану Удовину.

Если процесс завершался меньше дня назад со статусом Failed, то смотрим логи. Типичные проблемы - неответы бекенда, поломка YT. В таком случае изучаем ситуацию на этих сервисах.

Если придти к кому-то не удается:

[Исходный код](https://a.yandex-team.ru/arc_vcs/drive/analytics/gotasks/aggression/sessions.go)


### da.aggression.users_update_lag

Алерт говорит, что скоринг пользователей сильно отстает (больше чем на день).

#### Порядок действий

В начале проверяем таблицу [//home/carsharing/ml/agressive_driving/v2/applier/user_scores](https://yt.yandex-team.ru/hahn/navigation?path=//home/carsharing/ml/agressive_driving/v2/applier/user_scores).

Если она не обновлялась более дня, то приходим к Кириллу Луневу.

Далее смотрим на [планировщик в DAJR](https://dajr.yandex-team.ru/planner/979/).

Если процесс выключен (Status: disabled), то приходим к Ивану Удовину или Кириллу Луневу.

Если процесс давно не запускался, то проблема с планировщиком, приходим к Ивану Удовину.

Если процесс до сих пор выполняется - пробуем его завершить досрочно через Abort. Если проблема не решилась за час, то передаем Ивану Удовину.

Если процесс завершался меньше дня назад со статусом Failed, то смотрим логи. Типичные проблемы - неответы бекенда, поломка YT. В таком случае изучаем ситуацию на этих сервисах.

Если придти к кому-то не удается:

[Исходный код](https://a.yandex-team.ru/arc_vcs/drive/analytics/gotasks/aggression/users.go)

## YDB

### driveback.drive-ydb-storage-database-quota 

В базе заканчивается дисковая память.

WARN - осталось менее 75% свободного места.

CRIT - осталось менее 85% свободного места.

#### Порядок действий

В случае возникновения подобной ошибки идти к Ивану Удовину.

### driveback.drive-ydb-cpu-userpool-utilization  

Слишком большое потребление CPU.

WARN - используется более 75% ресурсов.

CRIT - используется 85% ресурсов.

Возможная причина - долгие ответы базы на запросы (например, где-то забыли в пачке запросов добавить вторичный индекс).

#### Порядок действий

Если потребление CPU возрастает, рекомендуется отключить базу через GVars и попытаться найти тяжёлые запросы. Более подробное описание можно найти [здесь](https://docs.yandex-team.ru/drive/backend/devops_ydb).
