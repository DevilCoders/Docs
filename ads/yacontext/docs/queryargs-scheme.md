# Cхема обработки query_args

В общем виде процесс обработки параметров URL (query_args) представлен на схеме ниже.

![](images/queryargs-scheme.png)

(1) Master Server получает от Баннерокрутилки список URL-адресов в формате `reflog`. Подробно формат `reflog` описан в разделе [Master Server: распределение URL-адресов](master-server.md). Любой URL-адрес может содержать в себе query_args.

(2) Master Server производит распределение потока URL-адресов по доменам и формирует для каждого yacobot-сервера пакет с URL-адресами приписанных этому Yacobot-серверу доменов.

(3) Пакеты с URL-адресами распределяются по карте Yacobot-серверов.

(4) Для определения значимости параметров URL-адресов предусмотрен отдельный модуль qargfilter, работающий в рамках Master Server и параллельно обрабатывающий созданную Master Server очередь, извлекая из нее список URL-адресов за определенный период.

(5) В модуле qargfilter реализованы компоненты Классификатор и Верификатор, основной задачей которых является обработка потока URL-адресов, их параметров и значений этих параметров, и определение значимости параметров. Подробнее процесс определения значимости query_args и взаимодействие Классификатора и Верификатора рассматривается в подразделе [Определение значимости query_args](queryargs-significance.md).

(6) На выходе формируется таблица `query_args`, в которой хранятся данные о значимости всех query_args, содержавшихся в составе URL-адресов из `reflog`.

Формат таблицы `query_args`:

* `<path>` — URL-адрес (все параметры отбрасываются);
* `<query_arg>` — параметр URL;
* `<timestamp>` — время последней проверки параметра на значимость;
* `<significant>` — значимость параметра (число); значение больше либо равное 0.95 означает, что параметр считается незначимым.

(7) В базу данных Yacobot-серверов из таблицы `query_args` передаются только данные о незначимых query_args. Подробно процесс записи в базу данных URL-адресов и query_args с учетом их значимости описан в подразделе [Сохранение query_args в базе данных](queryargs-database.md).

(8) Данные о незначимых query_args также передаются в Баннерокрутилку вместе с привязками и заглушками.

