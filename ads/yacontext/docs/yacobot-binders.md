# Формирование привязок

## Подраздел подробно описывает процесс создания привязок в модулях типа Binder на Yacobot-серверах {#about}

Для формирования привязок на основании информации о документе (словопозиции, веса слов, категории), полученной из MultiDoc, используются модули типа Binder. Для каждого типа привязок используется отдельный Binder:

* (1) Direct Binder — привязки для баннеров Яндекс&nbsp;Директа;
* (2) Market Binder — привязки для баннеров Яндекс&nbsp;Маркета;
* (3) MCB Binder — привязки для медийно-контекстных баннеров.

![](images/binders.png)

Каждый модуль Binder использует для работы словарь ключевых фраз и категорий, полученный от компонента Yacotools (подробнее о работе Yacotools рассказывается в разделе [Yacotools: вспомогательные инструменты](yacotools.md)):

* `direct_phrases.txt` — ключевые фразы баннеров Яндекс&nbsp;Директа и категории;
* набор файлов, составляющих словарь для баннеров Яндекс&nbsp;Маркета:
    * `queries.log` — файл, содержащий топ запросов к Яндекс&nbsp;Маркету в формате фраза + категория по каталогу Яндекс.Маркета;
    * `data.dat` — XML-файл с карточками моделей товарных предложений;
    * `prices.dat` — информация о ценах на товары в формате идентификатор предложения + цена;
    
* `mcb_phrases.txt` — словарь ключевых фраз для МКБ, получаемый из Партнерского интерфейса РСЯ.

Каждый Binder использует для работы Onrop (подробнее в разделе [Onrop](onrop.md)), технологию поиска фраз из заранее составленного словаря в документах. Также Onrop на основании данных о весах слов в документе рассчитывает релевантность найденных фраз.

Market Binder использует для формирования привязок два модуля Onrop. На первом этапе привязки формируются с использованием карточек моделей и цен (Onrop-1). Если привязки сформировать не удалось, то в качестве словаря используется лог запросов `queries.log` (Onrop-2).

В результате работы Onrop каждый Binder получает набор ключевых фраз и категорий, соответствующих контексту и категориям скачанного документа.

Для привязок МКБ реализован дополнительный фильтр по категориям на основании данных, хранящихся в файле `mcb_pages.txt` (`page_id` площадок, на которых включен показ МКБ). Для каждой ключевой фразы, отобранной Onrop MCB Binder, проверяется соответствие ее категорий категориям страниц домена, к которому относится URL-адрес, для которого формируется привязка. Привязка считается валидной и сохраняется только в случае, если более 30% страниц домена имеют те же категории, что и данная привязка.

