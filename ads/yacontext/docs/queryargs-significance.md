# Определение значимости query_args

## Данный подраздел рассказывает о процессе определения значимости параметров URL-адресов (query_args) в модуле qargfilter {#about}

Определение значимости query_args происходит в два этапа:

* классификация: определение значимости на основе данных о количестве различных значений параметра;
* верификация: повторная проверка параметров на основании сравнения контента страниц, скачанных для разных значений параметра.

Первый этап проверки позволяет достаточно быстро и точно определить значительную часть параметров как значимые и сразу записать их в таблицу `query_args`. Проверка на втором этапе, более длительном и ресурсоемком из-за необходимости скачивать веб-страницы, проводится только для параметров, которые на первом этапе были определены как возможно незначимые.

Вычисленное значение значимости хранится в поле `<significant>` таблицы `query_args`.

Схема ниже описывает процесс определения значимости и взаимодействие между Классификатором и Верификатором.

![](images/verifier.png)

(1) Для каждого query_arg выполняется проверка по количеству различных значений. Считается, что если различных значений query_arg менее десяти, то выполнять проверку значимости не имеет смысла, и параметр далее не рассматривается (не записывается в таблицу query_args).

(2) Значимость (`significant`) параметра вычисляется Классификатором по следующей формуле: (количество различных значений параметра / количество всех значений параметра). Если полученное значение `significant` >= 0.95 (то есть почти все значения данного параметра являются уникальными), то параметр опредеделяется как незначимый.

Все параметры, которые были определены Классификатором, как значимые (`significant` < 0.95), записываются в таблицу `query_args` со значением `significant` = -1. Все параметры, определенные как незначимые, передаются для проверки в Верификатор.

(3) Проверка незначимых query_args выполняется Верификатором по следующему принципу:

1. На первом этапе проверки исключается динамический контент страницы. Для этого страница скачивается дважды с одним и тем же значением query_arg. C помощью инструмента Сегнотатор (подробнее в разделе [Сегнотатор](segnotator.md)) на основании сравнения двух скачанных страниц выделяются одинаковые блоки контента страницы.
1. На втором этапе страница скачивается еще раз с другим значением query_arg. Выполняется сравнение двух страниц с учетом определенной Сегментатором неизменной части контента. Вычисляется значение similarity по формуле: (число одинаковых сегментов страниц / среднее число сегментов в документе). Если полученное значение `similarity` >=0.95 (то есть содержание нединамической части контента страницы практически не изменилось), то параметр определяется как незначимый. Значение `similarity` передается в таблицу `query_args` как значение `significant`.

Если в какой-либо момент верификатору не удалось скачать страницу, то query_arg определяется как значимый и записывается в таблицу `query_args` со значением `significant` = -2.

Описание процесса записи параметров с учетом их значимости в базу данных Yacobot-сервера приведено в подразделе [Сохранение query_args в базе данных](queryargs-database.md).

### Повторная проверка значимости query_args {#second-check}

В настоящее время повторная проверка параметра на значимость проводится не ранее, чем через неделю после последней проверки (время последней проверки хранится в параметре `timestamp` таблицы `query_args`). Если со времени последней проверки параметра прошло два месяца и параметр за это время не приходил в qargfilter, он удаляется из таблицы.

