## Как добавить новый лог в решардер?

Все новые логи должны должны быть описаны в бинарном формате, для этого:

1. Заводим новый тип сообщений с описанием протобуф схемы в [events](../libs/events).

    Важная деталь, поля `ProfileID`, `TimeStamp` и `StandVersion` являются общими для всех
    сообщений и их не нужно указывать в протобуфе для нового лога.
    Нужно перечислить только те поля, которые реально будут использоватся для добавления информации в профиль.

1. Конфигурируем чтение данных и перекладывание в протобуф данных из нового лога.

    Пример:
    ```
    {
        "alias": "advban",
        "src_topic": "adv-machine--rsya-banners-log",
        "output_queue": bigb_events_queue,
        "row_processing_params": {
            "MessageType": "ADVMACHINE_BANNERS",
            "Parser": {"FromJson": {"TimeStamp": "Timestamp", "UniqID": "UniqID"}},
        },
        "commit_period_ms": 300,
        "max_memory_usage": 80000000,
        "output_codec": "zstd_6",
        "read_rows_limit_per_second": 10000000,
    }
    ```
    Опции:
    * alias - уникальное имя для лога
    * src_topic - топик лог брокера, откуда надо читать данные
    * output_queue - пока всегда указываем `bigb_events_queue` (в будущем появится еще отдельная очередь для offline заливки)
    * row_processing_params - параметры парсера (разберем отдельно)
    * commit_period_ms - как часто коммитить данные (по умолчанию 300)
    * max_memory_usage - ограничение на размеры внутренних буферов для данных из лога (по умолчанию 1ГБ)
    * output_codec - алгоритм сжатия для данных (по умолчанию zstd_6)
    * read_rows_limit_per_second - лимит на кол-во сообщений в сек (по умолчанию 10000000000)

    Больше примеров можно найти в файле [fixtures.py](../../samogon/resharder/plugin/fixtures.py)

    Опции для `row_processing_params`:
    * MessageType - указываем название cхемы из events
    * Parser - выбираем тип парсера и его опции: поддерживаемые на данный момент парсеры:
        * FromJson - исходный лог в json формате
        * FromTskv - исходный лог в tskv формате
        * FromLogFeller - использовать парсер из logfeller-a (рекомдуемый, если для лога уже есть парсер в logfeller)

    В каждом парсере есть возможность указать соотвествие между полями в протобуфе и колонками в логе,
    есть несколько предопределенных полей:

    * TimeStamp - указывается имя колонки, откуда нужно брать временную метку
    * ProfileID - указывается имя колонки, откуда нужно брать bigb-uid (если есть)
    * StandVersion - указывается имя колонки, откуда нужно брать версию контура (если есть)

    ProfileID и StandVersion - являются служебными полями и используются только во внутренних логах.

    Также в зависимости от того какие идентификаторы встречаются в логе, указываются названия
    колонок с этими идентификаторами: `UniqID`, `Puid`, `Gaid`, `Idfa`, `Duid`, `CryptaID`, `CryptaID2`

    Подробнее про опции парсеров можно посмотреть [тут](rows_processor/proto/config.proto)

1. Заводим [PR](https://a.yandex-team.ru/review/1108695) на изменения.
