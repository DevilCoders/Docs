
### AB helping tool

(autogenerated with gen_readme subcommand)

Для работы нужны дырки до expstorage.search.yandex.net (TCP, 80 порт)

Так же нужен токен для админки в переменной окружения AB_OAUTH_TOKEN
(получить можно [тут](https://wiki.yandex-team.ru/serp/experiments/adminka/api/#oauth)).
Но он может быть получен тулзой автоматически через ssh-авторизацию.

```text
usage: ab [-h] [-v]
          {configuration,test_id,default_schema,gen_readme}
          ...

AB helping tool

ConfigurationLocator argument schema:
    adminka/<configuration>/<version>  E.g. `adminka/144/25`, `adminka/144/last` - by version
                                            `adminka/144/production`, `adminka/144/preproduction` - by tags
    expstorage/<configuration>/<tag>   E.g. `expstorage/144/production`
    <local path>                       E.g. `./exp_config.tsv`

FullTestIdLocator argument schema:
    <test_id>@<configuration_locator>  E.g. `255971@expstorage/144/production`
    default@<configuration_locator>    E.g. `default@adminka/144/31`
    predefault@<configuration_locator> E.g. `predefault@adminka/144/31`
    <test_id>                          E.g. `255971`. In this case testid is loaded directly from adminka (not from configuration from adminka)

positional arguments:
  {configuration,test_id,default_schema,gen_readme}
    configuration                       Compare/load/view configuration
    test_id                             Compare/view test_ids
    default_schema                      Update default in adminka
    gen_readme                          Just generate README.md

optional arguments:
  -h, --help                            show this help message and exit
  -v, --verbose                         Verbose level: INFO if verbose else ERROR

Command scheme:
    -v, --verbose  Verbose level: INFO if verbose else ERROR
    configuration:
        #  Compare/load/view configuration
        compare:
            #  Prints diff of configurations
            #  There are all differences in testids sets and experiment parameters experiment parameters
            #  Examples: `./ab configuration compare adminka/144/23 adminka/144/25`
            conf_old                type=ConfigurationLocator default=adminka/144/production
            conf_new                type=ConfigurationLocator default=adminka/144/last
            --type {difflib,jsondiff}
                                    type=str default=difflib
            --context CONTEXT       Limit context of diff type=int default=10
            --canonized
        check_equivalence:
            #  Checks the equivalence of configurations
            #  by comparing experiments parameters generated for many identifiers.
            #  Examples: `./ab configuration check_equivalence adminka/144/23 adminka/144/25`
            conf_old           type=ConfigurationLocator
            conf_new           type=ConfigurationLocator
            --iters ITERS      How many iterations of checks on random identifiers type=int default=1000
            --context CONTEXT  Limit context of diff type=int default=10
        load:
            #  Load configuration to stdout/file
            #  Examples: `./ab configuration load adminka/144/25 --output 25.tsv`
            conf             type=ConfigurationLocator
            --output OUTPUT  Must be .tsv or .json type=str default=/dev/stdout
        view:
            #  Prints view of configuration to stdout/file
            #  There are all experiment parameters of all testids of configuration
            #  Examples: `./ab configuration view adminka/144/25 | grep UseApps -C 5`
            conf             type=ConfigurationLocator
            --output OUTPUT  type=str default=/dev/stdout
            --canonized
        view_tree:
            #  Prints view of configuration as tree as in adminka
            conf  Only adminka configurations are supported type=ConfigurationLocator
        view_lmid_mxid_tsarid_in_tree:
            conf  Only adminka configurations are supported type=ConfigurationLocator
        analyze:
            #  Analyzes configuration. Looks at experiments placement and experiment parameters correctness
            conf  Only adminka configurations are supported type=ConfigurationLocator
        dump_sysconst:
            #  Prints info about BSServer sysconsts: which are in default and which are used on some slice
            conf  Only adminka configurations are supported type=ConfigurationLocator
    test_id:
        #  Compare/view test_ids
        describe:
            #  Prints description of testid
            test_id_locator  type=FullTestIdLocator
        view:
            #  Prints view of testid
            #  Parameters is taken from configuration, description is taken from AB API
            #  Examples: `./ab test_id view 255971@adminka/144/25`
            test_id_locator  type=FullTestIdLocator
            --canonized
        analyze:
            #  Analyze test id:
            #  1) Check that parameters are valid (applied always)
            #  2) Check that parameters is equal to theirs canonized form (json -> proto -> json) (flag: canonize)
            #  3) Shows effective diff of experiment (diff of DEFAULT vs (DEFAULT + EXP)) (flag: effective_diff)
            test_id_locator         type=FullTestIdLocator
            --default-test-id-locator DEFAULT_TEST_ID_LOCATOR
                                    type=FullTestIdLocator default=default@adminka/144/last
            --flags FLAGS           type=CommaSeparatedSet default=canonize,effective_diff
            --context CONTEXT       Limit context of diff type=int default=10
        compare:
            #  Compare testids
            #  Parameters is taken from configuration, description is taken from AB API
            #  Examples: `./ab test_id compare 255970@adminka/144/25 255971@adminka/144/25`
            #            `./ab test_id compare default@adminka/144/last 255971@adminka/144/25`
            test_id_locator_old  type=FullTestIdLocator
            test_id_locator_new  type=FullTestIdLocator default=default@adminka/144/last
            --context CONTEXT    Limit context of diff type=int default=10
        merge:
            #  Merge testids
            #  Examples: `./ab test_id merge default@adminka/144/last 255970@adminka/144/25 255971@adminka/144/25`
            test_id_locators  type=FullTestIdLocator
    default_schema:
        #  Update default in adminka
        new_predefault:
            #  Create new predefault from old predefault (base_test_id) with merged experiments (merging_test_ids)
            #  Creates QUEUED and archived experiment in adminka
            #  
            #  Without ignore_not_released_predefault flag compares parameters
            #  of base_test_id and default_test_id and fails if they are not equal.
            --base-test-id BASE_TEST_ID
                                    type=FullTestIdLocator default=predefault@adminka/144/last
            --merging-test-ids MERGING_TEST_IDS [MERGING_TEST_IDS ...]
                                    type=FullTestIdLocator default=[]
            --disable-strict-parsing
            -r, --really-run
            --default-test-id DEFAULT_TEST_ID
                                    type=FullTestIdLocator default=default@adminka/144/last
            --ignore-not-released-predefault
            --merge-manual MERGE_MANUAL
                                    Json or 'stdin' type=str
            --disable-old
            --send-notification
        release_predefault:
            #  Create new default from predefault (base_test_id).
            #  Shows diff with default (default_test_id)
            #  Creates QUEUED and archived experiment in adminka
            --base-test-id BASE_TEST_ID
                                    type=FullTestIdLocator default=predefault@adminka/144/last
            --default-test-id DEFAULT_TEST_ID
                                    type=FullTestIdLocator default=default@adminka/144/last
            -r, --really-run
            --disable-old
            --exp-stats {auto,console,ticket}
                                    type=str default=auto
            --send-notification
    gen_readme:
        #  Just generate README.md
        --output OUTPUT  type=str default=README.md

```
