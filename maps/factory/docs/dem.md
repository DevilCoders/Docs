# Digital Elevation Model

[TOC]

## Общие сведения

Термин _Digital Elevation Model_ может обозначать две разных модели. Различают _Digital Surface Model_ и _Digital Terrain Model_.

_Digital Surface Model_, _DSM_ — растровые данные, позволяющие вычислить возвышение наблюдаемой из космоса земной поверхности на уровнем некоторого модельного геоида (см. ниже). Такие данные включают в себя поверхности зданий. DSM практически непригодна для вычислений, так что обычно в области применяют её очищенный вариант.

_Digital Terrain Model_, _DTM_ (_рус._ _цифровая модель рельефа_, _ЦМР_) — _обычно_ растровые данные, позволяющие вычислить возвышение настоящей земной поверхности (то есть это _Digital Surface Model_, очищенная от рукотворных объектов). Иногда такие данные поставляются в векторных форматах (обычно в виде горизонталей — контуров и линий, атрибутированных высотой над геоидом). В дальнейшем под термином _DEM_ будем понимать именно _Digital Terrain Model_.

В случае растрового изображения, _DEM_ поставляется в формате одноканального 16-битного GEOTIFF без сжатия c целочисленным типом пикселя. Для экономии места на диске его можно сжать при помощи `gdal_translate` (использование данной утилиты критично для сохранения геопривязки прямо в файле). Модель поставляется в виде набора тайлов 1x1 градус.

Растр обычно находится в геодезической псевдопроекции ([EPSG:4326](http://epsg.io/4326)). В качестве 0 по вертикали обычно принимается модель геоида [EGM96](https://en.wikipedia.org/wiki/EGM96). Так как вода разливается в соответствии с силой гравитации, использование гравитационной модели в качестве нуля позволяет считать значение высоты в океане равным 0, что позволяет не хранить такие тайлы. _EGM96_ задаётся сеткой коэффициентов и может быть скачана [с сайта NASA](ftp://cddis.gsfc.nasa.gov/pub/egm96/).

Хотя существенная часть _DEM_, покрывающих весь мир, распространяется на коммерческой основе, часть из них доступна в сети бесплатно (с различными лицензионными ограничениями. Ниже представлен список известным нам _DEM_ с некоторыми замечаниями. _DEM_ с разрешающей способностью ниже трёх градус-секунд на пиксель не рассматриваются.

## SRTM Version 3. 1 Arc-Second _Global_

[Подробнее про датасет](http://gis-lab.info/qa/srtm.html). **Существует несколько разных версий обработки данных SRTM. Данный раздел посвящён последней, третей версии SRTM**.

Датасет находится в Public Domain согласно утверждению [здесь](https://openmaptiles.com/dem/). Юридическая проверка на стороне Яндекса проводилась в [тикете](https://st.yandex-team.ru/LEGAL-458).

Скачивается потайлово с сайта [Earth Explorer](https://earthexplorer.usgs.gov), доступно скачивание большими архивами в ручном режиме с сайта [Earth Data](https://search.earthdata.nasa.gov/) (нужно вбить в поиск фразу `NASA Shuttle Radar Topography Mission Global 1 arc second V003`).

Для скачивания требуется зарегистрировать аккаунты, это делается бесплатно.

Датасет покрывает область от 56 градусов южной широты до 60 градусов северной. Тайлы адресуются по координате своего левого нижнего угла (то есть самый северный тайл имеет координату 59). В частности, датасет не покрывает город Мурманск. Полный список отсутствующих тайлов в формате json можно найти в файле `/maps/factory/libs/common/data/dem_missing_stages_srtm.json`. Для проверки нужно использовать функцию `maps::factory::common::DemStage::isMissingIn<DemType::Srtm>();`.

По большей части, датасет имеет разрешение 1 градус-секунду на пиксель (размер тайла — `3601x3601`), тайлы ниже / выше пятидесятого градуса сжаты вдвое по горизонтали (размер тайла — `1800x3601`).

Датасет может быть скачан скриптом с [earthdata.nasa.gov](https://earthdata.nasa.gov/). Скачивание датасета автоматизировано в `maps/factory/tools/fetch-dem`, датасет залит в бакет [maps-sat-dem-srtm1s](http://s3.mds.yandex.net/maps-sat-dem-srtm1s/).

### Проблемы датасета:

* Отсутствует покрытие на северных широтах (в частности, не покрываются Мурманск и север Санкт-Петербурга).
* Имеются локальные артефакты (например, в Москве в районе стадиона Лужники и в районе дома №6 по Краснопресненской Набережной).

## SRTM Version 3. 3 Arc-Second _Global_

Те же данные, что и выше, но с более низкой разрешающей способностью.

Датасет может быть скачан скриптом с [earthdata.nasa.gov](https://earthdata.nasa.gov/). Датасет скачан и залит в бакет [maps-sat-dem-srtm3s](http://s3.mds.yandex.net/maps-sat-dem-srtm3s/).

## ASTER GDEM Version 2

[Подробнее про датасет](http://gis-lab.info/qa/aster-gdem.html).

Датасет и  нельзя распространять во внешний мир, если из него можно восстановить исходные пиксели. Юридическая проверка на стороне Яндекса проводилась в [тикете](https://st.yandex-team.ru/LEGAL-6042). Согласно текстам [здесь](https://lpdaac.usgs.gov/user_services/aster_policies) и [здесь](https://gis.stackexchange.com/questions/41543/can-i-sell-maps-produced-from-aster-global-dem-v2-data), распространять и продавать деривативы, полученные с помощью ASTER GDEM, **не запрещается**.

Скачивается потайлово с сайта [Earth Explorer](https://earthexplorer.usgs.gov), доступно скачивание большими архивами в ручном режиме с сайта [Earth Data](https://search.earthdata.nasa.gov/) (нужно вбить в поиск фразу `ASTER Global Digital Elevation Model V002`).

Для скачивания требуется зарегистрировать аккаунты, это делается бесплатно.

Датасет представлен набором тайлов размером 1x1 градус и покрывает область от 83 градусов южной широты до 83 градусов северной. Тайлы адресуются по координате своего левого нижнего угла (то есть самый северный тайл имеет координату 82). Полный список отсутствующих стейджей в формате json можно найти в файле `/maps/factory/libs/common/data/dem_missing_stages_aster.json`. Для проверки нужно использовать функцию `maps::factory::common::DemStage::isMissingIn<DemType::Aster>();`.

Датасет имеет разрешение 1 градус-секунду на пиксель (размер тайла — `3601x3601`).

Скачивание датасета автоматизировано в `maps/factory/tools/fetch-dem`.

### Проблемы датасета:

* Не самая понятная для использования лицензия.
* Датасет очень сильно зашумлён, без предварительной обработки данных использовать его практически невозможно.

## ALOS GDEM

Скачивается с сайта [eorc.jaxa.jp](http://www.eorc.jaxa.jp/ALOS/en/aw3d30/).

Для скачивания из интерфейса требуется авторизация, но для скачивания по прямым ссылками она не нужна.

Датасет представлен набором тайлов размером 1x1 градус, скачивается в виде архивов по сетке 5x5 градусов.

**Скачивание данного датасета не автоматизировано.**

Ссылка для одного мета-тайла 5x5 градусов имеет вид :

`ftp://ftp.eorc.jaxa.jp/pub/ALOS/ext1/AW3D30/release_v1804/N035E105_N040E110.tar.gz`

Перед скачиванием показывается следующее лицензионное соглашение:

```
This dataset is available to use with no charge under the following conditions.

When the user provide or publish the products and services to a third party using this dataset, it is necessary to display that the original data is provided by JAXA. You are kindly requested to show the copyright(©JAXA) and the source of data when you publish the fruits using this dataset.

JAXA does not guarantee the quality and reliability of this dataset and JAXA assume no responsibility whatsoever for any direct or indirect damage and loss caused by use of this dataset. Also, JAXA will not be responsible for any damages of users due to changing, deleting or terminating the provision of this dataset.
```

**Данный датасет не проходил сколько-нибудь серьёзной оценки качества.**

## View Finder Panoramas 3 Arc-Second

Автор сайта [Viewfinder Mountain Top Horizon Maps](http://viewfinderpanoramas.org/) взял за основу `SRTM3 3 Arc-Second _Global_` существенно дополнил его в недостающих (северных и южных) частях, очистил от артефактов и выложил в открытый доступ.

Полный список отсутствующих тайлов в формате json можно найти в файле `/maps/factory/libs/common/data/dem_missing_stages_dem.json`. Функции для проверки доступности тайла нет.

Для крайних северных и крайних южных широт были использованы карты Генштаба. Легальной возможности использования этих данных, вообще говоря, не существует.

Датасет может быть скачан в ручном режиме [отсюда](http://viewfinderpanoramas.org/Coverage%20map%20viewfinderpanoramas_org3.htm).

### Проблемы датасета

* Максимально мутная лицензионный статус: использование автором некоторых источников данных не всегда легально.
* Автор предполагает сублицензирование (вероятно, платное) своей _DEM_ для коммерческого использования. Мы не обращались к автору с вопросами о цене.
* Большинство тайлов взяты из _SRTM 3 Arc-Second_ и имеют соответствующие артефакты, хоть автор и уверяет нас в обратном.

## View Finder Panoramas 1 Arc-Second

[Датасет](http://viewfinderpanoramas.org/dem1d.html) покрывает только отдельные высокогорные районы (включая Скандинавию, Пиринеи, Альпы, но не ограничиваясь ими).

Датасет может быть скачан в ручном режиме [отсюда](http://www.viewfinderpanoramas.org/Coverage%20map%20viewfinderpanoramas_org1.htm).

### Проблемы датасеты

* Лицензионный статус (см. выше).
* Сильно неполное покрытие мира.

## Национальные _DEM_

Многие страны (в их числе Канада, США, Нидерланды) предоставляют для скачивания _DEM_, покрывающие территорию их страны. Задача составления полного списка таких датасетов пока не решена.

## Инструменты для работы с _DEM_

### anudem

`anudem` — это аналитический инструмент для редактирования _DEM_. Распространяемый на платной основе он позволяет сглаживать артефакты с хорошим качеством на выходе.

Купить лицензию можно [здесь](https://fennerschool.anu.edu.au/research/products/anudem).

### gdaldem

Визуализировать рельеф удобно при помощи hill-shade визуализации. [Вот здесь](https://github.com/clhenrick/gdal_hillshade_tutorial) описывается кейс использования инструмента `gdaldem` для получения различных визуализаций рельефа.

### mdenoise

Этот инструмент предназначен для подавления шумов в данных _DEM_. Его можно скачать [с github.com](), теоретическое обоснование его работы находится [здесь](https://personalpages.manchester.ac.uk/staff/neil.mitchell/mdenoise/). Потребуется существенная доработка, чтобы этот механизм можно было использовать для работы с растровыми данными.

Попытка очистить данные _ASTER GDEM_ при помощи данного инструмента не увенчалась особым успехом.

### Whitebox Tools

Набор инструментов для работы с данными _ДЗЗ_ можно скачать [отсюда](https://www.uoguelph.ca/~hydrogeo/Whitebox/). В частности, включает в себя инструмент для подавления шумов.

Попытка очистить данные _ASTER GDEM_ при помощи данного инструмента не увенчалась особым успехом.

## Бонус

* [Список](https://gisgeography.com/free-global-dem-data-sources) как бы пяти, но на самом деле трёх _DEM_.
* [Список](https://gisgeography.com/top-6-free-lidar-data-sources) как бы шести (не проверял) лидарных _DEM_ (не покрывают весь мир).
* [В комментариях](https://gis.stackexchange.com/questions/86514/looking-for-nearly-worldwide-elevation-data) приводится список нескольких _платных_ моделей данных.
* [10-, 5-, 1- метровая модель рельфа](https://www.intermap.com/products/nextmap/world/10). Оценка качества не проводилась. Покрытие на Москву в момент отсмотра оценивалось в $3000.
* [Список](https://grasswiki.osgeo.org/wiki/Global_datasets#Elevation_data) моделей рельефа из GRASS Wiki.
* [Список бесплатных _DEM_ от ViewFinderPanoramas](http://viewfinderpanoramas.org/dem3.html).
* [Платный _DEM_ от ArcGIS](https://www.arcgis.com/home/item.html?id=58a541efc59545e6b7137f961d7de883). Внизу страницы приводится довольно обширный список бесплатных национальных _DEM_.
