# Кастомизация/стилизация карты в MapKit/Static API

Стилизация карты позволяет подстроить стиль карты под нужды приложения/сервиса в MapKit и Static API. С помощью стилизации можно убрать или изменить внешний вид некоторых классов объектов на карте.

[TOC]

## Формат JSON
Стилизация задается JSON-строкой, содержащей массив объектов, каждый из которых описывает блоки кастомизации (стайлеры). Каждый такой блок содержит:

* **tags** — описывает, к каким объектам должна применяться стилизация. Подробно об этом в разделе "Теги"; если tags опущен, стилизация будет применяться ко всем объектам.
* **types** — массив, ограничивает типы объектов, к которым применять стилизацию. Если не указан, стилизация применяется ко всем типам. Возможные типы объектов:
  * **point** — точки. Пример: автобусные остановки, POI;
  * **polyline** — полилинии. Пример: дороги, границы, русла рек;
  * **polygon** — полигоны. Пример: парки, озера;
* **elements** - строка, определяет элементы объекта, у которых меняются свойства отображения. Если не указан, стилизация применяется ко всем элементам. Может быть использован один из следующих селекторов:
  * **geometry** - свойства меняются у всех геометрических элементов (является комбинацией geometry.fill и geometry.outline)
  * **geometry.fill** - внутренняя область (заливка) полигона или полилинии
  * **geometry.fill.pattern** - картинка, которой мостится внутренняя область полигона или полилинии
  * **geometry.outline** - обводка полгиона или полилинии
  * **label** - все элементы подписи объекта
  * **label.icon** - иконка объекта
  * **label.text** - текст подписи объекта (является комбинацией label.text.fill и label.text.outline)
  * **label.text.fill** - заливка текста
  * **label.text.outline** - обводка текста
* **stylers** — один или несколько стайлеров, описывает изменяемые свойства (подробно в разделе "Свойства"). Стайлеры применяются в порядке задания.

## Формат query string

Стилизация может задаваться строкой в формате, удобном для передачи в параметрах URL. Форматы JSON и query string взаимозаменяемы и могут быть сконвертированы друг в друга.

Стилизация в формате query string состоит из блоков, разделенных символом `~`. Каждый блок описывает кастомизацию некоторых классов объектов и состоит из списка фильтров (теги, типы объектов, элементы объектов) и стайлеров, элементы списка в блоке разделяются символом `|`.

Фильтр состоит из имени, символа `:` и списка значений, разделенных символом `;`. Поддерживаются следующие фильтры:
* `tags.all`, `tags.any`, `tags.none` — описывает, к каким объектам должна применяться стилизация, подробнее в разделе "Теги".
* `types` — ограничивает типы объектов. Возможные значения описаны в разделе "Формат JSON".
* `elements` — определяет элементы объекта, у которых меняются свойства отображения. Возможные значения описаны в разделе "Формат JSON".

Стайлер задает одно свойство (подробно в разделе "Свойства") и состоит из строки `stylers`, необязательного диапазона масштабов, символа `.`, имени свойства, символа `:` и значения свойства. Диапазон масштабов может задаваться в формате `[zoom]` или `[zmin-zmax]`. Стайлеры применяются в порядке перечисления. Значения цветов (подробно в разделе "Свойства") рекомендуется задавать без символа `#`.

## Теги
Большинство объектов на карте имеют один или несколько тегов, которые позволяют их классифицировать. С помощью тегов вы можете определить подмножество объектов, к которым применяется каждый отдельный блок кастомизации. 

```
"tags": {
  "all": ["tag1", "tag2", ...],
  "any": ["tag1", "tag2", ...],
  "none": ["tag1", "tag2", ...]
}
```

Поля **tags** имеют следующий смысл:
* **all** — множество тегов, которые обязательно должны быть у объекта;
* **any** — множество тегов, из которых хотя бы один должен присутствовать у объекта;
* **none** — множество тегов, ни один из которых не должен встречаться у объекта.

При наличии в одном из полей незнакомого текстового тега блок кастомизации не применяется. Список возможных тегов определяется слоем, к которому применяется кастомизация. В целях обеспечения совместимости тег также может быть задан соответствующим числовым идентификатором.

### Теги подложки

* road — автомобильные дороги. Цифра в тэге соответствует функциональному классу (важности) дороги.
  * road_1 — наиболее важные дороги
  * road_2
  * road_3
  * road_4
  * road_5
  * road_6
  * road_7 — наименее важные дороги
  * road_limited — дороги с ограничением движения автомобильного транспорта, пешеходные зоны
  * road_unclassified — неклассифициорованные дороги, как правило, лесные и полевые
  * road_minor — внутриквартальные проезды 
  * road_construction — строящиеся дороги 
  * path — дороги, непригодные для проезда автомобилей (тротуары, дорожки в парках и на кладбищах, велодорожки)
  * crosswalk — пешеходные и велосипедные переходы
  * traffic_light — светофоры 
* water — водные объекты
  * bathymetry - карта глубин водоемов
* landscape
  * land — земная поверхность
  * landcover — растительность, болота, ледники и т.д.
    * vegetation — растительно, включая газоны и внутриквартальную растительность
  * urban_area — кварталы
    * residential — жилые кварталы
    * industrial — промышленные кварталы
    * cemetery — территории кладбищ
    * park — сады, парки
    * medical — территории медицинских учреждений 
    * sports_ground — спортивные площадки и игровые поля
    * beach — территории пляжей
    * construction_site — стройплощадки
  * national_park — национальные парки и заповедники
  * terrain — рельеф
* poi
  * major_landmark — хорошо заметные объекты, отмеченные отдельной иконкой
  * outdoor
    * park — сады, парки
    * beach — пляжи
  * shopping — магазины, торговые центры и т.п.
  * commercial_services — организации, предоставляющие коммерческие услуги
  * food_and_drink — рестораны, бары и т.п.
  * cemetery — кладбища
  * medical — медицинские учреждения
* admin — подписи и границы АТД, полигоны населённых пунктов
  * country
  * region — области / штаты
  * locality — населённый пункт
  * district — городские районы
  * address — адресные точки
* transit — общественный транспорт
  * transit_location — объединящий тег для всех узлов сети общественного транспорта (станции, остановки, входы, и т.п.)
    * transit_stop — остановка, место посадки/высадки в/из транспортного средства
    * transit_entrance — вход/выход на станцию
  * transit_line — линия транспорта как физический объект (железнодорожные/трамвайные пути, кабельная линия на поверхности и т.п.)
  * transit_schema — схематическое изображение линий ОТ
  * is_unclassified_transit — объект ОТ, важность которого неизвестна
* structure
  * building — здания
    * entrance — входы в здания
  * fence — заборы
* is_tunnel — участок дороги или пути проходит в тоннеле

### Теги пробок

* severity_closed — перекрытия (черные/коричневые линии)
* severity_very_hard — глухие пробки (бордовые линии)
* severity_hard — пробки (красные линии)
* severity_light — затрудненное движение (желтые линии)
* severity_free — свободные дороги (зеленые линии)

### Теги парковок

* free — бесплатная парковка
* toll — платная парковка
* restricted — парковка с ограничениями (резидентная/по пропускам/для людей с ограничениями)
* prohibited — остановка и стоянка запрещена
* building — въезд на парковку, расположеную внутри здания
* parking_zone — объект относится к парковочной зоне организованной городской администрацией

## Свойства
Свойства меняют внешний вид объекта, применяются в следующем порядке:
* **zoom** — ограничивает действие стайлера диапазоном масштабов. Может принимать одно целое значение или быть массивом из двух целых значений (описывает закрытый интервал значений [zmin, zmax]).
* **visibility** — возможное значение: off. Позволяет отключить объект.
* **hue** — заменяет тон цвета, оставляя насыщенность и яркость неизменной. Задается базовым цветом в формате `#RRGGBB` (см. описание свойства **color**). При базовом цвете с неопределенным тоном (белом, сером или черном) цвет объекта не изменяется.
* **saturation** — вещественное число из диапазона [-1, 1], меняет насыщенность цвета. При -1 все цвета превращаются в оттенки серого, при 1 картинка приобретает очень высокую насыщенность цвета, при 0 цвет не изменяется. Оттенки серого не изменяются.
* **lightness** — вещественное число из диапазона [-1, 1], меняет яркость цвета. При -1 превращает все в черный, при 1 — в белый, при 0 цвет не изменяется.
* **color** — заменяет цвет (в случае иконки — ее primary цвет). Поддерживаются следующие форматы:
  * `#RGB, #RRGGBB, 0xRGB, 0xRRGGBB, RGB, RRGGBB` - строка с hex-кодом цвета
  * `#RGBA, #RRGGBBAA, 0xRGBA, 0xRRGGBBAA, RGBA, RRGGBBAA` - строка с hex-кодом цвета с альфа-каналом.
* **secondary-color** — заменяет вторичный цвет иконки. Формат такой же, как у **color**.
* **tertiary-color** — заменяет третичный цвет иконки. Формат такой же, как у **color**.
* **opacity** — задается в виде вещественного числа. Работает как scale для alpha - это значение не заменяет, а **умножается** на уже существующее значение alpha у цвета. Если нужно именно заменить значение alpha, следует использовать задание цвета при помощи color.
* **scale** — задается в виде вещественного числа. Меняет масштаб иконки, толщину контура полигона, толщину линии, размер шрифта. Не применяется к selected-иконке. Во всех случаях соответствующий размер умножается на scale.

## Пример

JSON
```
[
    {
        "types": "point",
        "tags": {
            "all": ["poi"]
        },
        "stylers": {
            "color": "#f00",
            "scale": 0.9
        }
    },
    {
        "types": "polyline",
        "elements": "geometry.fill.pattern",
        "stylers": {
            "zoom": [15, 18],
            "visibility": "off"
        }
    }
]
```

Query string
```
style=types:point|tags.all:poi|stylers.color:f00|stylers.scale:0.9~types:polyline|elements:geometry.fill.pattern|stylers[15-18].visibility:off
```
