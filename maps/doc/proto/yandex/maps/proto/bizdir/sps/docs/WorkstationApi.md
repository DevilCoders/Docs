## API для АРМ системы приёма правок

### Общее описание взаимодействия контент-менеджера и АРМ

1. Контент-менеджер нажимает кнопку "получить следующую гипотезу".
2. Фронтенд получает очередную гипотезу с помощью запроса на
   **/v1/hypothesis/find** с `UserTicket` контент-менеджера
3. СПП подбирает гипотезу, привязывает её к переданному `UserTicket` и
   возвращает фронтенду
4. Фронтенд показывает гипотезу контент-менеджеру
5. Контент-менеджер выносит вердикт по гипотезе, фронтенд отправляет его
   POST-запросом на **/v1/verdict**. Если для вынесения вердикта
   контент-менеджеру нужно посмотреть подробную историю правок, то это можно
   сделать с помощью запросов на **/v1/hypothesis/find?id=<hypothesis_id>** с
   идентификаторами гипотез из истории.
6. Фронтенд запрашивает новое состояние текущей гипотезы с помощью запроса на
   **/v1/hypothesis/find?id=<hypothesis_id>** и показывает его
   контент-менеджеру.
7. Контент-менеджер переходит к пункту 1.

В случае, когда гипотеза сложная и требует длительных разбирательств,
контент-менеджер может отложить ее разбор на потом (запрос на
**v1/hypothesis/postpone?id=<hypothesis_id>**). Отложенная гипотеза попадет в
конец очереди контент-менеджера.

Контент-менеджер может посмотреть список назначенных на него гипотез (с
поддержкой пагинации) с помощью запроса на **/v1/assigned_hypotheses/find**. В
списке назначенных гипотез присутствует минимальная информация, чтобы различать
гипотезы (название организации). Для получения более подробной информации нужно
использовать запросы на **/v1/hypothesis/find?id=<hypothesis_id>**.

С помощью запроса на **/v1/hypotheses/find** можно получить список гипотез,
соответствующих заданным фильтрам (с поддержкой пагинации). В списке найденных
гипотез присутствует минимальная информация, чтобы различать гипотезы
(название организации). Для получения более подробной информации нужно
использовать запросы на **/v1/hypothesis/find?id=<hypothesis_id>**.

С помощью запроса на **/v1/signal/find?id=<signal_id>** можно получить `id` созданной
гипотезы по id сигнала.

С помощью запроса на **/v1/stats** можно получить статистику по гипотезам.


### Требования к запросу

Во всех запросах должны передаваться TVM `ServiceTicket` и `UserTicket`.

### Заголовки запроса

* `X-Ya-Service-Ticket`
* `X-Ya-User-Ticket`
* Accept: `application/x-protobuf`(по умолчанию) или `text/x-protobuf`

### Коды ответов

| Код ответа                | Комментарий                                   |
| ---                       | ---                                           |
| 200 Ok                    |                                               |
| 400 Bad Request           | Ошибка в запросе                              |
| 401 Unauthorized          | Отсутствуют нужные TVM-тикеты                 |
| 403 Forbidden             | У пользователя нет доступа к нужному объектy  |
| 404 Not Found             | Отсутствует объект с нужным идентификатором   |
| 429 Too Many Requests     | Квота RPS превышена                           |
| 500 Internal Server Error | Повторите запрос / свяжитесь с разработчиками |

### API

#### **/v1/hypothesis/find**

**Method**        | GET                                                                            |
-------------     | -                                                                              |
**Params**        |                                                                                |
`id`              | Optional, идентификатор гипотезы                                               |
**Description**   | Получение следующей гипотезы для контент-менеджера или поиск гипотезы по `id`. |
**Response Body** | `yandex.maps.proto.bizdir.sps.Hypothesis`                                      |

#### **/v1/hypothesis/postpone**

**Method**        | POST                                                                           |
-------------     | -                                                                              |
**Params**        |                                                                                |
`id`              | Required, идентификатор гипотезы                                               |
**Description**   | Отложить рассмотрение гипотезы                                                 |
**Response Body** | Достаточно кода ответа                                                         |

#### **/v1/stats**

**Method**        | GET                                                                            |
-------------     | -                                                                              |
**Params**        | Отсутствуют                                                                    |
**Description**   | Получение статистики по гипотезам.                                             |
**Response Body** | `yandex.maps.proto.bizdir.sps.Statistics`                                      |

#### **/v1/verdict**

**Method**        | POST                                                           |
-------------     | -                                                              |
**Params**        |                                                                |
`hypothesis_id`   | Required, идентификатор гипотезы                               |
**Request Body**  | `yandex.maps.proto.bizdir.sps.Hypothesis`                      |
**Description**   | Отправка контент-менеджером вердикта для обработанной гипотезы |
**Response Body** | Достаточно кода ответа                                         |

#### **/v1/hypotheses/find**

**Method**        | GET                                                                                                                    |
-------------     | -                                                                                                                      |
**Params**        |                                                                                                                        |
`content_manager` | Optional, фильтрация гипотез по логину контент-менеджера. Пример: `content_manager=a,b,c`                              |
`status`          | Optional, фильтрация гипотез по статусу. Возможные значения берутся из `yandex.maps.proto.bizdir.sps.HypothesisStatus` |
`results`         | Optional, количество результатов в ответе, по умолчанию 15                                                             |
`offset`          | Optional, количество гипотез, которые нужно пропустить при формировании ответа, по умолчанию 0                         |
**Description**   | Получение списка гипотез, соответствующих заданным фильтрам.                                                           |
**Response Body** | `yandex.maps.proto.bizdir.sps.HypothesisInfoList`                                                                      |

#### **/v1/assigned_hypotheses/find**

**Method**        | GET                                                                                            |
-------------     | -                                                                                              |
**Params**        |                                                                                                |
`results`         | Optional, количество результатов в ответе, по умолчанию 15                                     |
`offset`          | Optional, количество гипотез, которые нужно пропустить при формировании ответа, по умолчанию 0 |
**Description**   | Получение списка гипотез, назначенных контент-менеджеру.                                       |
**Response Body** | `yandex.maps.proto.bizdir.sps.HypothesisInfoList`                                              |

#### **/v1/signal/find**

**Method**        | GET                                                                            |
-------------     | -                                                                              |
**Params**        |                                                                                |
`id`              | Required, идентификатор сигнала                                                |
**Description**   | Поиск гипотезы по `id` сигнала.                                                |
**Response Body** | `yandex.maps.proto.bizdir.sps.SignalInfo`                                      |
