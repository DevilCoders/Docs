Эта библиотека предназначена для работы с данными дорожного графа. Дорожный граф хранит в себе информацию о топологии дорожной сети, представленную наборами последовательно пронумерованных вершин и ориентированных рёбер, а также атрибуты участков дорог.

# Топология дорожной сети
Вершины графа всегда находятся в местах физического пересечения или стыковки дорог, но могут появляться и в других случаях. Например, вершины разделяют ребра там, где есть пешеходные переходы или где дороги проходят одна над другой.

*TODO: написать про вершины с нулевой степенью*

Ребра графа представляют собой участки дорог, по которым движение осуществляется в определенном направлении. Если движение по участку дороги возможно в обоих направлениях, то в графе этому участку будут соответствовать два ребра. В графе не может быть рёбер, у которых начало совпадает с концом.

# Идентификаторы вершин и ребер
И каждой вершине, и каждому ребру графа сопоставлен уникальный идентификатор. Идентификаторы являются целочисленными 32-хбитными значениями и в коде представлены непрозрачными типами данных, обеспечивающими строгую типизацию: `VertexId` и `EdgeId`. И вершины, и ребра нумеруются последовательно, начиная с нуля. Количество вершин в графе можно узнать при помощи метода `Graph::verticesNumber`, количество рёбер – при помощи метода `Graph::edgesNumber`.

Нумерация вершин и рёбер от одной версии графа к другой меняется. Чтобы получить отображение идентификаторов рёбер одной версии в идентификаторы рёбер другой версии, необходимо использовать [PersistentIndex API](https://a.yandex-team.ru/arc/trunk/arcadia/maps/libs/edge_persistent_index/include/persistent_index.h). Этот интерфейс позволяет преобразовывать идентификаторы рёбер определенной версии графа в универсальные идентификаторы, не зависящие от версии, и наоборот. Универсальный идентификатор зависит от геометрии ребра и сохраняется при обновлении графа, только если в новой версии геометрия ребра остаётся неизменной.

В пространстве имён `maps::road_graph::literals` определены операторы, позволяющие записывать константы типов `VertexId` и `EdgeId` как выражения вида `1234_v` и `5678_e`.

# Небазовые ребра и запрещённые маневры
Одному физическому участку дороги в графе может соответствовать несколько параллельных рёбер, у которых совпадают все атрибуты. Одно из таких рёбер называется базовым, а все остальные – небазовыми. Небазовые ребра нужны, чтобы запрещённые правилами дорожного движения пути, состоящие из трёх и более рёбер, представить в графе множеством запрещенных путей длины 2. Запрещённые пути, состоящие из двух рёбер, принято называть запрещенными поворотами.

*TODO: простейший пример с иллюстрацией*

Узнать, является ли ребро базовым, можно при помощи метода `Graph::isBase`. Получить идентификатор базового ребра, соответствующего небазовому ребру, можно, воспользовавшись методом `Graph::base`. Узнать по идентификатору ребра множество рёбер, которым соответствует то же базовое ребро, можно при помощи метода `Graph::sameBaseIds`.

# Манёвры, запрещаемые по расписанию
Выше рассматривались манёвры, которые всегда безусловно запрещены. Но существуют также манёвры, которые запрещены лишь в определённые интервалы времени; их называют термином «restricted manoeuvre». Чтобы узнать, существует ли запрещаемый по расписанию манёвр, который является префиксом заданного пути, следует использовать метод `Graph::lookupManoeuvreRestriction`. Метод `ManoeuvreSchedule::isAppliedAt` позволяет узнать, запрещён ли манёвр для определённых участников дорожного движения в определённый момент времени.

# Обратные ребра
В тех случаях, когда участок дороги с двусторонним движением оцифрован в редакторе двунаправленным ребром, в графе есть возможность по идентификатору ребра, которое соответствует одному из направлений, узнать идентификатор ребра, соответствующего противоположному направлению. Для этого следует использовать метод `Graph::reverse`. Этот метод преобразует переданный в качестве аргумента идентификатор в идентификатор базового ребра и возвращает идентификатор базового ребра, соответствующего противоположному направлению.

# Атрибуты рёбер
Узнать характеристики любого ребра можно при помощи метода `Graph::edgeData`. Методы класса `EdgeData` возвращают значения отдельных свойств ребра.

| Название метода | Описание |
|:---------------:| -------- |
| `accessIdMask` | Битовая маска, описывающая множество транспортных средств, для которых разрешено движение по ребру. Если движение разрешено определённому виду транспортного средства, то будет выставлен бит, соответствующий этому транспортному средству. <br/><br/> Значения для отдельных видов транспортных средств определены в перечислении `AccessId`. В автомобильном графе присутствуют только такие рёбра, проезд по которым разрешён легковым автомобилям, такси и грузовикам. |
| `category` | Целочисленное значение, обозначающее класс дороги. Описания классов см. в [документации YMapsDF](https://doc.yandex-team.ru/english/ymaps/ymapsdf/ymapsdf-ref/concepts/road_el.html#road_el__fc). |
| `type` | Тип дороги. <br/><br/> `NamedRoad` — обычная дорога <br/> `Stairs` — лестница (допустим в вариантах графа для пешеходов и велосипедистов) <br/> `Crosswalk` — пешеходный переход <br/> `Junction` — участок дороги, входящий в состав транспортных развязок, где пересечения организованы на разных уровнях <br/> `Uturn` — участок дороги, предназначенный только для разворота на дорогах, имеющих две проезжие части и оцифрованных в два ребра <br/> `FrontageRoad` — дублёр <br/> `BoatFerry` — паромная переправа <br/> `FordCrossing` — брод <br/> `AccessToPoi` — Подъезд к точкам интереса <br/> `Roundabout` — участок кругового движения |
| `structType` | Тип дорожного сооружения. См. [документацию YMapsDF](https://doc.yandex-team.ru/english/ymaps/ymapsdf/ymapsdf-ref/concepts/road_el.html#road_el__str_type).  |
| `speed` | Средняя скорость движения по ребру в м/с. |
| `speedLimit` | Ограничение скорости при движении по ребру, предусмотренное ПДД, в м/с. |
| `length` | Длина ребра в метрах. |
| `geometry` | Геометрия ломаной ребра. Длина каждого отрезка ломаной не превышает 200 м. В ломаной всегда есть хотя бы один отрезок. |
| `isToll` | Является ли ребро участком платной дороги. |
| `isPaved` | Есть ли у дороги твердое покрытие. |
| `isInPoorCondition` | Находится ли дорожное полотно в плохом состоянии. |
| `endsWithTrafficLight` | Заканчивается ли ребро светофором, который регулирует возможность дальнейшего движения. |
| `endsWithCrosswalk` | Заканчивается ли ребро на пешеходном переходе. |
| `endsWithRailroadCrossing` | Заканчивается ли ребро на пересечении с железнодорожными путями. |
| `endsWithSpeedBump` | Заканчивается ли ребро на искусственной неровности. |
| `endsWithBorderCrossingPost` | Заканчивается ли ребро пунктом пограничного контроля |
| `hasMasstransitLane` | Есть ли на участке дороги выделенная полоса для общественного транспорта. |
| `lanes` | Множество полос, по которым организовано движение. Эта информация является необязательной; в случае отсутствия данных метод возвращает пустое множество. |
| `roads` | См. следующий раздел. |
| `toponym` | Название дороги, в состав которой входит ребро. Если ребро относится к нескольким дорогам, выбирается некоторое название, которое считается названием по умолчанию. Если ребро не относится ни к одной дороге, название отсутствует. |
| `isoCode` | [Двухбуквенный ISO-код страны](https://en.wikipedia.org/wiki/List_of_ISO_3166_country_codes), которой принадлежит ребро. |
| `trafficSide` | Сторона дороги, по которой идет движение прямо, может быть `Right` - для правостороннего движения, как в России, или `Left` - для левостороннего движения, как в Великобритании. |
| `isResidential` | Принадлежит ли ребро жилой зоне. |
| `dismountBike` | Должен ли велосипедист спешиться для движения по ребру. |

# Атрибуты двухрёберных маневров
Узнать характеристики двухрёберного маневра можно при помощи метода `Graph::turnData`. Методы класса `TurnData` возвращают значения отдельных свойств манёвра.

| Название метода | Описание |
|:---------------:| -------- |
| `accessIdMask` | Битовая маска, описывающая множество транспортных средств, для которых разрешено движение по манёвру. Если движение разрешено определённому виду транспортного средства, то будет выставлен бит, соответствующий этому транспортному средству. <br/><br/> Значения для отдельных видов транспортных средств определены в перечислении `AccessId`. |
| `isForbiddenFor` | Позволяет определить, запрещен ли манёвр для заданного вида транспортного средства. |
| `isAccessPassFor` | Позволяет определить, необходим ли пропуск для выполнения маневра для заданного вида транспортного средства. |
| `accessPassSchedule` | Позволяет определить, есть ли расписание у пропускной системы, и его детали, если оно есть. Построением графа гарантируется, что если у пропускной системы есть расписание, то isAccessPassFor будет возвращать true. По умолчанию проверять ещё и расписание не нужно. |
| `countryBorderType` | Позволяет определить, является ли манёвр пересечением государственной границы. Для случаев беспрепятственного пересечения границы метод возвращает значение `Free`. Для остальных границ возвращается значение `Strict`. |

# Названия дорог
Множества рёбер графа, объединенные общим названием, составляют объекты, называемые дорогами. Одно ребро может относиться к нескольким дорогам одновременно. Например ребро, входящее в состав дороги с названием "Зубовский бульвар", входит также в состав дороги с названием "Садовое кольцо". Узнать, к каким дорогам относится ребро, можно при помощи метода `EdgeData::roads`. В графе допустимы ребра, не принадлежащие ни одной дороге.

Название дороги в графе может храниться на разных языках. Доступ к локализованным названиям дороги предоставляет класс `Toponym`. Метод `Toponym::defaultTranslation` позволяет узнать название дороги на языке, наиболее подходящем для региона, через который пролегает дорога. Метод `Toponym::closestTranslation` позволяет узнать название дороги, наиболее близкое к переданной локали.

У каждой дороги есть уникальный идентификатор, который не сохраняется между версиями графа. В графе допустимы ситуации, когда множество рёбер, образующее дорогу, не является слабо-связным графом.

# R-дерево
Для поиска рёбер графа и их сегментов в определённой области используется [Rtree API](https://a.yandex-team.ru/arc/trunk/arcadia/maps/libs/succinct_rtree/include/rtree.h).

Методы `Rtree::baseEdgesInWindow` и `Rtree::edgesInWindow` возвращают идентификаторы рёбер, геометрия которых находится внутри ограничивающего прямоугольника или пересекает его. Первый вариант возвращает идентификаторы только базовых рёбер и выполняется быстрее. Методы `Rtree::baseSegmentsInWindow` и `Rtree::segmentsInWindow` делают то же самое, но на уровне сегментов рёбер.

Методы `Rtree::nearestBaseEdges` и `Rtree::nearestEdges` позволяют находить рёбра, расположенные вблизи заданной точки. Каждый из этих методов возвращает последовательность идентификаторов рёбер, отсортированную по возрастанию кратчайшего расстояния от ребра до точки. Первый вариант возвращает идентификаторы только базовых рёбер и выполняется быстрее. Методы `Rtree::nearestBaseSegments` и `Rtree::nearestSegments` делают то же самое, но на уровне сегментов рёбер.
