# Модуль

Модуль (`module`) - набор [задач](task.md), объединенных в один исполняемый бинарный файл.

Каждому модулю соответствует отдельная страница в UI Огорода.

## Типы модулей

Модули бывают следующих типов:

* `source` - регистратор внешних ресурсов
* `map` - модуль, который имеет один сорс-билд на входе + любое число билдов конфигов
* `reduce` - модуль, который имеет несколько сорс-билд на входе + любое число билдов конфигов
* `deployment` - публикатор ресурсов

Различные типы модулей представлены в UI на различных вкладках.

## Регистрация задач

Модуль регистрирует задачи в графе задач. Подробнее на [странице](graph.md).

## Описание настроек модуля

Каждый модуль имеет описание (`module_traits`) в виде json-файла подобного вида (пример для модуля `my_module`):
```json
{
    "name": "my_module",
    "displayed_name": "My module",
    "module_maintainer": "user_name",
    "type": "reduce",
    "configs": ["config_module"],
    "sources": ["ymapsdf"],
    "build_limits": [{
        "max": 1,
        "remove_on_exceed": true
    }],
    "sort_options": [
        {
            "key_pattern": "{0.sources[0].properties[release_name]}",
        },
        {
            "sort_by_property": "region",
            "reverse": false
        }
    ],
    "autostarter": {
        "trigger_by": ["ymapsdf"]
    },
    "fill_with_empty_resources": true
}
```

Оповещения:
`module_maintainer` - логин ответственного за модули. Используется для назначения исполнителем в тикеты о падениях билдов модуля и для оповещений от команды огорода связанных с модулем.

Опции отображения в UI:

* `displayed_name` - наименование модуля как отображается в UI
* `type` - тип модуля
* `sort_options` - опциональный список шаблонных полей для упорядочивания билдов; при указании нескольких полей сортировка делается в порядке указания полей. Возможные значения:
  * `key_pattern` - паттерн для получения значения, по которому будет производиться сортировка.
  * `sort_by_property` - алиас для паттерна `{0.properties[<property_name>]}`
  * `sort_by_build_id` - алиас для паттерна `{0.build_id}`. Недопустимо для использования в source модулях со сканером ресурсов и активным автостартером.
  * `reverse` - если `false`, то порядок сортировки "по возрастанию". По умолчанию порядок "по убыванию".

Конфигурация исходных билдов:

* `configs` - наименование других модулей, версии билдов которых должны появляться в списке "configurations" в UI; при отсутствии настройки список "configurations" не появляется в UI
* `sources` - список модулей, создающих входные ресурсы; при создании билда для вашего модуля для каждого из указанных `sources` модулей можно выбирать конкретные билды, ресурсы которого будут использоваться при выполнении графа задач; по умолчанию список пустой

Настройки билда:

TODO: добавить описание `build_*` настроек.

Обработка отсутствующих ресурсов:

* `fill_with_empty_resources` - индикация того, что отсутствующие ресурсы должны заменяться `EmptyResource`; по умолчанию настройка включена

Автоматический старт и удаление билдов:

* `autostarter` - настройка автоматического запуска модулей. Подробности — на [отдельной странице](autostart.md)
* `build_limits` - ограничение количества билдов. Подробнее на [странице](build_limits.md)
