# Аутентификация

Для использования любых модифицирующих ручек API Огорода необходима аутентификация.
Подробнее о ручках Огорода можно посмотреть в [Swagger](http://core-garden-server.maps.yandex.net/api/docs/).
В Огороде возможна аутентификация с помощью [TVM2](https://wiki.yandex-team.ru/passport/tvm2/)
или же с помощью [OAuth](https://wiki.yandex-team.ru/intranet/dev/oauth/).

## Аутентификация с помощью TVM2
1. Для доступа к Огороду необходимо попросить команду Огорода добавить `tvm-service-id` вашего сервиса в
   список сервисов, кому открыт доступ к Огороду.
1. Получить `service-ticket`, в котором назначение — это необходимый инстанс Огорода, а источник — ваш сервис.
1. Получить `user-ticket` для пользователя.
1. При обращении к методу API Огорода передать в заголовках `X-Ya-User-Ticket` и `X-Ya-Service-Ticket`
`user-ticket` и `service-ticket` соответственно.

### tvm-service-id инстансов Огорода
* 2024853 - [stable](https://garden.maps.yandex-team.ru/) Огорода
* 2024855 - [testing](https://garden.tst.c.maps.yandex-team.ru/) Огорода
* 2024857 - development (песочницы) Огорода

{% note warning %}

Testing-инстанс Огорода служит только для целей разработки Огорода.
Для тестирования модулей и проверки данных служат datatesting-контур в стабильном Огороде, а так же
пользовательские [контура](experiments.md) там же.

{% endnote %}

## Аутентификация с помощью OAuth

Так же для возможности отладки возможна аутентификация с помощью OAuth.
Для этого необходимо [получить](https://oauth.yandex-team.ru/authorize?response_type=token&client_id=c75e9e0d411a4a78bf8b889c2326308b) OAuth-токен.
И его передать при запросе API Огорода в заголовке `Authorization: OAuth {access_token}`.

{% note warning %}

Служебная утилита для загрузки модулей [garden](cli.md) использует
для авторизации OAuth в обмен на ssh-ключ. Соответственно, для её корректной работы необходим работающий ssh-агент
и прописанный на Staff ssh-ключ.

{% endnote %}


# Авторизация

Роли в Огороде выдаются через [IDM](https://idm.yandex-team.ru/system/garden_roles).


## Авторизация в модулях

Роль "Пользователь модуля" дает право на запуск и удаление билдов конкретного модуля, на запуск сканирования ресурсов,
на релизы модулей через Sedem и включение/отключение автостартеров. Права пользователя на конкретный модуль проверяются только для системных контуров. В пользовательских контурах владелец контура может запускать любые билды.
