# Пользовательские задачи

## Общая информация

Пользовательские задачи компилируются в виде бинарного файла и запускаются в `YT` в качестве ванила операции.
Пример создания пользовательской задачи приведен [здесь](https://docs.yandex-team.ru/garden/module-creation#realizaciya-zadach).

## Потребление ресурсов

Так как пользовательская задача запускается на YT, нужно заранее указать максимальное потребление:
- CPU (по умолчанию задано 1)
- RAM (по умолчанию задано 1 GB)

Если указанных лимитов хватает, то можно ничего не делать, но если нужно внести изменения, то следует переопределить
метод `predict_consumption`:
```python
from maps.garden.sdk.core import Task
from maps.garden.sdk.utils import GB

class UserTask(Task):
    def __call__(self, **resources):
        # пользовательская логика задачи
        pass

    def predict_consumption(self, demands, creates):
        return {
            "cpu": 2,
            "ram": 32 * GB,
        }
```

Если задача предполагает работу с файловой системой, то по умолчанию файловая система будет располагаться на
жестком диске. В случае больших объемов данных чтение/запись могут сильно замедлить работу. Для решения данной
проблемы есть два способа:
1) Использовать SSD (рекомендуется):
```python
def predict_consumption(self, demands, creates):
    return {
        "cpu": 2,
        "ram": 4 * GB,
        "ssd": 64 * GB,
    }
```
2) Накинуть больше RAM и использовать tmpfs (не рекомендуется):
```python
def predict_consumption(self, demands, creates):
    return {
        "cpu": 2,
        "ram": 68 * GB,
        "tmpfs": True,
    }
```

{% note alert %}

Указанные параметры потребления CPU и RAM, а также настройки использования SSD и tmpfs, распространяются только
на ванила операции. Если внутри пользовательской задачи создается map/reduce операции, то для них надо все настройки
задавать самостоятельно.

{% endnote %}
