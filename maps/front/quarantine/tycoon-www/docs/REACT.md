# React
* (React|ReactDOM)@16.8.4 – на стендах реакт приезжает из статики
* redux
* redux-thunk
* @bem-react/*
* @yandex-lego/components

## .config/
Конфиги для webpacka находятся здесь. Клиентский конфиг доопределяет базовый конфиг из `react-scripts`.

### entry
В клиентской сборке есть несколько энтрипоинтов:
* `index~(desktop|touch-phone)` – SPA, отображаемый контент выбирается при помощи роутера
* `embedded~(desktop|touch-phone)` – бандл для встраивания реактовых компонентов во время bemtree-шаблонизации
* `reacted~(desktop|touch-phone)` - SPA на реакте

## src/
* `actions/` – все редаксовые экшены
* `common/` – общие, не привязанные к контексту страницы, компоненты
* `components/` – контейнерные или связанные контекстом проекта компоненты
* `entries/` – клиентские энтрипоинты
* `hocs/` – директория для [Higher-Order Components](https://ru.reactjs.org/docs/higher-order-components.html)
* `lib/` – служебные, библиотечные модули
* `reducers/` – редаксовые редьюсеры
* `root/` – рутовые компоненты, используются при SSR
  * `App` – дефолтный рут, внутри себя создаёт редактовый стор, для выбора отображаемого компонента использует `StaticRouter` из `react-router`. Если находится внутри айфрейма, то следит за своими размерами и при изменении отправляет их родителю через post-message
  * `StoreRoot` – компонент-хелпер, используется при рендере реактовых компонентов и bemhtml-шаблонов на одной странице. Создаёт стор и пробрасывает его в window. Внутри себя ничего не рендерит
  * `SingleRoot` – рут для отображения других компонентов на странице, отрендеренной bemhtml-шаблонизатором. Может рендерить любой компонент из заданных в его реестре в любом кол-ве на странице. Может создавать свой стор или брать его из window.
* `typings/` – все типы, интерфейсы и прочее
* `browser.css` – общие стили. Возвращаем кнопкам и ссылкам из `@yandex-lego/components` их первоначальный вид, т.к. внутри `@yandex-int/serp-components` стили для них переопределяются при помощи усиливания селекторов

## server/
Весь код для SSR лежит в `server/react/`.
* Если на странице будет использоваться только реакт, то чтобы отрендерить страницу нужно из модуля `server/react` заимпортировать `reactRenderer` и вызвать внутри контроллера, передав необходимые параметры.
* Если часть страницы необходимо отрендерить при помощи bemhtml-шаблонизатора, а часть реактом, то:
  * в контроллере, перед вызовом `renderer`, в data.react нужно положить данные, необходимые компонентам, которые будут использовать общий стор
  * внутри bemtree-шаблона проверить, что есть `node.data.react` и вызвать `node.data.react.renderComponent`, передав параметрами название нужного компонента и флаг(опционально), который говорит о том, что компонент должен создать свой собственный стор

## Обновление зависимостей
При обновлении пакетов `@yandex-lego/components` и/или `@yandex-int/serp-components` нужно обязательно синхронизировать версии пакетов `@yandex-lego/components`, `@bem-react/core` и `@bem-react/di` (дополнительно можно ещё `@bem-react/classname` и `@yandex-int/i18n`), и после этого выполнить команду `npm dedupe`. Это нужно для того, чтобы везде использовался один и тот же реест зависимостей, иначе могут перестать работать некоторые компоненты (например, `Select` или `Attach`). [Описание команды `dedupe`](https://docs.npmjs.com/cli/dedupe "docs.npmjs.com")

## Работа с Registry
В проекте используется единый registry с id `tycoon` (пока что есть разделение на несколько, но от него отходим).

При добавлении нового компонента, которому требуется разделение по платформам нужно сделать следующее:
* добавить его в registry для платформы [desktop](../src/registry/registry@desktop.ts) или [desktop](../src/registry/registry@touch-phone.ts)
* в файле компонента создать index.tsx, который будет доставать компонент из registry ([пример](../src/components/Difference/index.tsx))
* использовать так: `import { Difference } from 'components/Difference';` (пока что надо указывать относительный путь)
