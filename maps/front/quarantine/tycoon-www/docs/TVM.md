## TVM

### Теория

TVM — это механизм аутентификации одного сервиса перед другим сервисом. Он позволяет понять, от какого сервиса пришёл запрос. Таким образом повышается безопасность обмена данными и закрывается ряд известных критичных уязвимостей. Подробнее про TVM https://wiki.yandex-team.ru/passport/tvm2.

В основе TVM лежат Service-тикеты - https://wiki.yandex-team.ru/passport/tvm2/stbrief/.
Если коротко, Сервис А отправляет запрос в сервис В. Для того, чтобы В мог понять, кто пришёл, А отправляет в этом запросе сервисный тикет (в HTTP - в заголовке **X-Ya-Service-Ticket**). В тикете есть информация о том, какой сервис и в какой сервис отправил запрос. Информация в нём защищена от изменения с помощью криптографии.

Также существует отдельный "вид" Service-тикета - User-Ticket.
Это короткоживущий креденшел пользователя, т.е. признак аутентификации, т.е. признак того, что залогиненый пользователь сам где-то нажал кнопку.
User-тикеты нужны только сервисам, работающим с залогиновыми пользователями. Передается HTTP - в заголовке **X-Ya-User-Ticket**. Подробнее - https://wiki.yandex-team.ru/passport/tvm2/user-ticket/.
Тут хорошо рассказано зачем они вообще нужны, и почему кук не достаточно https://wiki.yandex-team.ru/passport/tvm2/usecases/#polzovatelskietikety.

Финально схема выглядит так:
- Пользователь авторизован в Яндексе (есть валидная кука Sessionid или OAuth-токен), от него пришёл запрос на FrontEnd нашего сервиса.
- Запрос в любой **разработанный в Яндексе** сервис с этого Frontend'а должен выполняться с ServiceTicket и UserTicket. UserTicket - одинаковый для всех сервисов(для 1 юзера), ServiceTicket у каждого сервиса свой.

Если почитать вики видно, что все это работает под капотом, и настроив один раз, можно про все это забыть.
Наш бэкенд сделал для нас костыль и поэтому локально мы можем ходить в тестинг без тикетов.

К сожалению нам в работе довольно часто надо сходить и в другие ручки(наш прод или смежные сервисы метрика\геосервисы и т.д.), и они уже все хотят соблюдения TVM правил, ниже инструкция как это сделать.

### Как работать локально с TVM
[Почитать тут](/docs/DEVELOP.md#dlya-lokalьnoj-razrabotki-na-https)
