# `Тестирования векторной карты`
Настройка тестового окружения автотестов - [ссылка](https://github.yandex-team.ru/maps/vector/blob/dev/tests/func/README.md), блок `About configuring the environment`

### Общий воркфлоу проекта
<details>
  <summary>Подробнее</summary>
    
1. Разработчики заводят таск на тестирование релиза версии вектора. Проставляют задачам релиза статус "можно тестировать". Удобно отследить задачи релиза на дашборде [VECTOR](https://st.yandex-team.ru/agile/board/9209).
2. В  сформированном таске перечень задач, связанных тикетов и релизная версия, в самих задачах даны описания, исправленное поведение. [Пример релизного таска](https://st.yandex-team.ru/VECTOR-695).
3. При проверке задачи, необходимо зайти на стенд прода с подключенным API и опцией `vector: true` ([например](https://jsfiddle.net/farvatertest/ckf0q48w/5/)), ввести в фильтрах запросов `vector` и просмотреть текущий бандл вектора([Скрин](./images/vector_01.png)). После чего воспроизвести баг, проблему. 
4. После поменять бандл в продовой версии на бандл релизного вектора из тестинга [basic](https://api-maps.tst.c.maps.yandex.ru/2.1.76/tests/manual/cases/vector/basic.html), добавив к URL `hosts_config[hosts][vectorIndex]=<релизный бандл вектора>`.
5. Проверить новое/исправленное поведение на релизном бандле вектора.
6. Запустить и провалидировать автотесты сравнения прода и тестинга.
7. Протестировать релизные задачи в обвязке тестовых страниц и сценариев чек-листа проверок.
8. Запустить и провалидировать автотесты расширенного сета.
9. Протестировать поведение векторной карты по дополнительным кейсам проверки.
10. При тестировании сценарии проверки чек-листа необходимо проверить в браузерах поддерживающих вектор: `Google Chrome, YaBro, FireFox, Opera, Edge`, а также `Safari c добавлением параметра pron=vector`.
11. Протестировать поведение карты в браузерах не поддерживающих вектор: `Safari, IE`.
12. Протестировать сценарии чек-листа проверок на тачах в `Android` и `iOS` девайсах.
13. По окончании тестирования поменять статусы задач релиза и релизного тикета, заапрувив релиз в случае отсуствия проблем.
</details>

### Сеты автотестов и команды для запуска
| Команда | Описание |
| --- |--- 
|`make test-vector-prod-testing` | смоук-сет|
|`make test-vector-prod-testing SET=func` | Расширенный сет автотестов|

Ссылка в meta-info на l7test неактуальна

   - или в Сэндбоксе [Sandbox vector-testing with prod tiles](https://sandbox.yandex-team.ru/scheduler/17982/view)

Запуск автотестов и интропретацию результатов [ссылка](https://github.yandex-team.ru/maps/vector/blob/dev/doc/test/design.md), блок `Процесс тестирования и интерпретации результатов отчета`

### Чек-лист тестирования
1. Проверить драг и зум карты на стенде [basic](https://api-maps.tst.c.maps.yandex.ru/2.1.76/tests/manual/cases/vector/basic.html)
2. Проверить автопан при открытии баллунов POI на стенде [indoor](https://api-maps.tst.c.maps.yandex.ru/2.1.76/tests/manual/cases/vector/indoor.html)
3. Проверить кликабельность транспортных иконок на стенде (остановки, метро, вокзалы, станции) [basic](https://api-maps.tst.c.maps.yandex.ru/2.1.76/tests/manual/cases/vector/basic.html)
4. Иконки POI и подписи топонимов не слипаются при резком отзуме.
5. Проверить страны с иероглифами, вязью.
6. Быстро включать и выключать вектор на стенде [options](https://api-maps.tst.c.maps.yandex.ru/2.1.76/tests/manual/cases/vector/options.html)
7. Включать и выключать вектор с включенными пробками, быстро их включать и выключать на стенде [options](https://api-maps.tst.c.maps.yandex.ru/2.1.76/tests/manual/cases/vector/options.html)
8. Включить пробки, зумить и драгать карту на стенде [route-autopan](https://api-maps.tst.c.maps.yandex.ru/2.1.76/tests/manual/cases/vector/route-autopan.html)
9. Отзумиться на карту мира и проверить отображение мультимиров.
10. Покинуть вкладку на этапе загрузки и вернуться через пару минут, подрагать, позумить карту.
11. Крешнуть WebGL в браузере с открытой вкладкой с вектором chrome://gpucrash/ (yabro – browser://gpucrash/)
    - растровая карта заменила векторную и корректно работает
    - (опционально: chrome://gpuhang/, chrome://gpuclean/)
12. Векторной карте не стало хуже в неподдерживаемых браузерах (IE, Safari)

### Дополнительные кейсы
1. Сравнить появление векторной карты при медленном интернете с версией в проде:
    - Шаги:
        - во вкладке Performance установить Network - Slow/Fast 3G
        - включить запись скриншотов в Performance
        - обновить страницу и включить запись
        - остановить при полном появлении карты
    - По сравнению с версией из прода:
        - по временной шкале и скриншотам карта не стала медленнее появляться
        - иконки появляются на карте не позже
        - нет пустоты при смене растра на вектор
        - CPU визуально не стал более загруженным
2. При недоступности единичных ресурсов, карта не ломается:
    - Шаги:
        - заблокировать запросы на некоторые тайлы/меши/иконки/глифы
        - зумить/драгать карту
    - Результат:
        - заблокированные ресурсы не отображаются, всё остальное работает
3. Отправляются метрики в конце сессии:
    - Шаги:
        - очистить вкладку Network
        - поставить галочку 'Preserve log'
        - обновить странцу
    - Результат:
        - есть несколько запросов в counter
        - в теле запросов есть нужные метрики и цифры адекватные (уточнить у разработчиков)
4. В оставленной надолго вкладке карта не деградирует.
5. Несколько векторных карт на одной странице [several-maps](https://api-maps.tst.c.maps.yandex.ru/2.1.76/tests/manual/cases/vector/several-maps.html)
6. Проверить применение кастомизации на стендах:[customizationUber](https://api-maps.tst.c.maps.yandex.ru/2.1.79/tests/manual/cases/vector/customizationUber.html), [customizationLigthness](https://api-maps.tst.c.maps.yandex.ru/2.1.79/tests/manual/cases/vector/customizationLigthness.html),  [vectorIconColorOptions](https://api-maps.tst.c.maps.yandex.ru/2.1.79/tests/manual/cases/vector/vectorIconColorOptions.html)
