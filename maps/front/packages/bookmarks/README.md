# yandex-maps-bookmarks
Библиотека для работы с закладками и местами, с избранными остановками и линиями транспорта, с историей маршрутов.
Подробно с концепцией закладок и мест в Яндекс.Картах можно ознакомиться <a href="https://wiki.yandex-team.ru/maps/dev/core/geobookmarks/">здесь</a>.

### Установка
```
npm install --registry=https://npm.yandex-team.ru/ yandex-maps-bookmarks
```

### Сборка
  1. Для сборки библиотеки используется <a href="http://gulpjs.com/">gulp</a>.
  2. Команды `npm run debug` и `npm run release` запускает сборку отладочной и релизной версий библиотеки соответственно. Результат помещается в папку `./build/`.
  3. Команда `npm run test` запускает сборку тестов. Результат помещается папку `./test/`.

### Выкладка
Библиотека выкладывается на CDN: <br>
```yastatic.net/s3/front-maps-static/front-maps-bookmarks/{версия}/build/yandex-maps-bookmarks.min.js```<br>
Сборка и раскатка нового пакета в продакшен происходит автоматически.<br>
Для автоматической раскатки надо запустить команду ```npm run {patch | minor | major}```.<br>
При этом будет создана новая версия в package.json и .qtools.json, проставлен соответствующий версии тэг и далее обновления будут запушены в мастер, где сборщик соберёт и выложит пакеты в yastatic.

### Подключение
Библиотека подключается как модуль при обнаружений глобальной модульной системы.
В случае использования <a href="https://github.com/ymaps/modules">YM</a> модуль будет иметь имя `yandex-maps-bookmarks`.
Если модульная система не обнаружена, то функциональность библиотеки предоставляется в глобальном нейсмпейсе `ya.bookmarks`.

### Работа с библиотекой
В неймспейсе `ya.bookmarks` предоставляются следующие методы:

#### ya.bookmarks.config
Выполняет конфигурирование параметров библиотеки.
Данный метод должен быть вызван в первую очередь, т.к. изначально не все параметры библиотеки сконфигурированы.
В качестве аргумента принимает объект `params` со следующими полями:

| Параметр                   | Тип        | Обязательный | Описание
| -------------------------- | ---------- | ------------ | --------------------------------
| `lang`                     | `String`   | да           | Идентификатор языка, используемый для определения текстовых констант, используемых при работе с БД закладок. Допустымые значения: `ru`, `en`, `tr`, `uk`, `kk`, `uz`.
| `cloudApiUrl`              | `String`   | да           | Адрес для cloud API, через который будет вестись работа.
| `useClientStorage`         | `Boolean`  | нет          | Кэшировать ли снапшот базы в клиентском браузере (используя indexedDb или сходные технологии).

#### ya.bookmarks.getBookmarksManager
Возвращает `vow.Promise` который разрешается экземпляром `BookmarksManager`.

#### ya.bookmarks.getPlacesManager
Возвращает `vow.Promise` который разрешается экземпляром `PlacesManager`.

#### ya.bookmarks.getMasstransitManager
Возвращает `vow.Promise` который разрешается экземпляром `MasstransitManager`.

#### ya.bookmarks.getRoutesPointsHistoryManager
Возвращает `vow.Promise` который разрешается экземпляром `RoutesPointsHistoryManager`.

#### ya.bookmarks.getRoutesRideHistoryManager
Возвращает `vow.Promise` который разрешается экземпляром `RoutesRideHistoryManager`.

#### Константы
Согласно концепции, ссылка на которую дана выше, некоторые записи в базах данных закладок и мест имеют фиксированные идентификаторы.
Эти идентификаторы предоставляются в виде следующих констант:

##### ya.bookmarks.ROOT_FOLDER_ID
Строковый идентификатор корневого каталога закладок.

##### ya.bookmarks.FAVORITES_FOLDER_ID
Строковый идентификатор каталога закладок "Избранное".

##### ya.bookmarks.HOME_ID
Строковый идентификатор места "Дом".

##### ya.bookmarks.WORK_ID
Строковый идентификатор места "Работа".

### Запуск тестов
Для запуска тестов откройте `./test/test.html` в браузере.
