[![oko health](https://oko.yandex-team.ru/badges/repo.svg?repoName=maps/front/services/agency-cabinet&vcs=arc)](https://oko.yandex-team.ru/arc/maps/front/services/agency-cabinet)

# `Agency Cabinet`

The agency cabinet for creating ads campaigns in Yandex.Maps.

## General information

| Key | Value |
|---|---|
| ABC | https://abc.yandex-team.ru/services/maps-front-agency-cabinet/ |
| Wiki | https://wiki.yandex-team.ru/geoadv-agency-cabinet-frontend/ |
| Y.Deploy | https://deploy.yandex-team.ru/projects/maps-front-agency-cabinet |
| Tanker | https://tanker.yandex-team.ru/project/geoadv_pins |
| Metrika | https://metrika.yandex.ru/dashboard?id=54054313 |
| Avatars | https://mds.yandex-team.ru/avatars/namespaces/geoadv-ext/overview |

## Instances

| Environment | URL |
|---|---|
| Testing | https://l7test.yandex.ru/geoadv/agency/ |
| Production | https://yandex.ru/geoadv/agency/ |
| Crowdtest | https://agency-cabinet.crowdtest.maps.yandex.ru/geoadv/agency/ |

### L7 balancers

| Environment | Namespace                                                                                                                              | Requests Stats                                                                                                                                                                                                                | Instance Stats                                                                                                                                                                                                   |
| ----------- | -------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Production  | [front-agency-cabinet.slb.maps.yandex.net](https://nanny.yandex-team.ru/ui/#/awacs/namespaces/list/front-agency-cabinet.slb.maps.yandex.net/show)         | [Dashboard](https://yasm.yandex-team.ru/template/panel/balancer_common_panel/fqdn=front-agency-cabinet.slb.maps.yandex.net;itype=balancer;ctype=prod;locations=man,sas,vla;prj=front-agency-cabinet.slb.maps.yandex.net/)             | [Dashboard](https://yasm.yandex-team.ru/template/panel/balancer_portoinst_panel/fqdn=front-agency-cabinet.slb.maps.yandex.net;itype=balancer;ctype=prod;locations=man,sas,vla;prj=front-agency-cabinet.slb.maps.yandex.net/)         |


## How to fix common problems

[How to detach instance from balancer](https://wiki.yandex-team.ru/maps/dev/ui/deploy/devops/#kakotkljuchitodininstansotbalansera)

### Restart instance

SSH into container, then:

```sh
supervisorctl restart node
```

## Monitorings

## Application

| Type | URL |
|---|---|
| Juggler | https://juggler.yandex-team.ru/aggregate_checks/?query=host%3Dmaps-front-agency-cabinet_production.app |
| Golovan | https://yasm.yandex-team.ru/template/alert/maps-front-agency-cabinet-production-app |
| Wiki | https://wiki.yandex-team.ru/geoadv-agency-cabinet-frontend/monitoring/#alerty |

## Awacs

| Type | URL |
|---|---|
| Juggler | https://juggler.yandex-team.ru/aggregate_checks/?query=host%3Dawacs.front-agency-cabinet.slb.maps.yandex.net |
| Golovan | https://yasm.yandex-team.ru/template/alert/front-agency-cabinet-slb-maps-yandex-net |

## Dashboards

| Name | URL |
|---|---|
| DataLens | https://datalens.yandex-team.ru/gb6yzbx9z0km9-main-dash |
| DataLens | https://yasm.yandex-team.ru/panel/edgarnurullin._cS0gyc?range=604800000 |
| Autogenerated | [Common panel `maps-front-agency-cabinet_production`](https://yasm.yandex-team.ru/template/panel/maps-front-common/full_env_name=maps-front-agency-cabinet_production) |
| Knoss Fast | [Common panel `geoadv`](https://yasm.yandex-team.ru/template/panel/balancer_common_panel/fqdn=knoss_fast;itype=balancer;ctype=prod;locations=man,sas,vla;prj=l7-balancer-knoss-fast;signal=geoadv;) |
| Error Counter for frontend | https://error.yandex-team.ru/projects/geoadv-agency-frontend/projectDashboard |
| Error Counter for backend | https://error.yandex-team.ru/projects/geoadv-agency-backend/projectDashboard |
| Wiki | https://wiki.yandex-team.ru/geoadv-agency-cabinet-frontend/monitoring/#monitoringi |

## Logs

| Name | URL/path |
|---|---|
| NodeJS | `/run/qloud/app.stdout`, `/run/qloud/app.stderr` <br/> https://deploy.yandex-team.ru/stages/maps-front-agency-cabinet_production/logs |
| Nginx errors | `/var/log/nginx/error.log` |
| Nginx access | `/var/log/nginx/access.log` |
| Nginx logs in YT | `//home/logfeller/logs/maps-front-production-log/` <br/> https://yt.yandex-team.ru/hahn/navigation?path=//home/logfeller/logs/maps-front-production-log |

## Vault

- [front-agency-cabinet-production](https://yav.yandex-team.ru/secret/sec-01fydtt3jp0beqz8qsa6xwrhds/explore/versions)
- [front-agency-cabinet-testing](https://yav.yandex-team.ru/secret/sec-01fydtsp2pwffz4sqfz5e5m1a5/explore/versions)

## Developing

Checkout [CONTRIBUTING.md](CONTRIBUTING.md) for tips on how to use the included dev scaffolding.

## Test plans

| Name | URL/path |
|---|---|
| Acceptance/Smoke | https://testpalm.yandex-team.ru/agency_room/testsuite/5c7673adf77a6148ec89e17c |
| Full Regression | https://testpalm.yandex-team.ru/agency_room/testsuite/5c5d999670829809cfb46cfd |
