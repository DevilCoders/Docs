## Поведение:

-   [Активный режим](#Active)
-   [Позиционирование карты](#Location)
-   [Пользовательские карты](#UM)
-   [Пробки](#Пробки)
-   [Маршруты](#Маршруты)
-   [Плейсмарки](#Плейсмарки)
-   [Поиск](#Поиск)
-   [Активные объекты](#AO)
-   [Пои](#Пои)
-   [Whatshere](#Whatshere)
-   [Общественный транспорт](#MT)
-   [Панорамы](#Панорамы)
-   [Отображение контента](#Views)
-   [Поведение карты](#Поведение)

### <a name="Active"></a> query.mode - Активный режим

Активный режим отвечает за начальное отображение контента на карте.
\
Активный режим определяется следующим образом:

-   Если есть query.mode [poi | search | whatshere | routes | stop] -> mode берется из параметра
-   Если есть search (удовлетворили условия на активацию контроллера поиска) и mode не был передан в query -> mode=search
-   Если есть masstransit[stopId] и mode не указан -> mode=stop
-   Если есть whatshere[point] и mode не указан -> mode=whatshere
-   Если есть poi[point] и mode не указан -> mode=poi
-   Если есть rtext и mode не указан -> mode=routes

### <a name="Location"></a> Позиционирование карты

Центр карты вычисляется по следующим правилам:

-   Если есть активный режим, то центр берется из соответсвующего режима
-   Если есть um и нет активного режима, позиционирование из пользовательских карт
-   Параметров урла ll, spn, bounds
-   Региона пользователя
    Зум Карты вычисляется по следующим правилам:
-   Если активен режим маршрутов, зум выставляем так, чтобы поместились все нитки маршрутов
-   Приоритет параметру z - если он есть, зум берем из него
-   Далее смотрим на пользовательские карты - если в них задан зум, берем его
-   Зум из региона пользователя

### <a name="UM"></a> Пользовательские карты

#### Описание

Отображает на карте объекты, созданные в [конструкторе карт](https://yandex.ru/map-constructor)

#### Параметры урла

-   Задается параметром урла `um`

#### Позиционирование

Позиционирование берется из конструктора

#### Пример

```
Открыть конструктор без пробок:
?um=constructor%3A43d6fe456a6197517473d2dafd2fc10e96efc40a0ceb6bbd67e3d523be164cff&amp;source=constructor
Открыть конструктор с пробками:
?um=constructor%3A43d6fe456a6197517473d2dafd2fc10e96efc40a0ceb6bbd67e3d523be164cff&amp;source=constructor
```

### Пробки

#### Описание

Добавляет на карту слой пробок и дорожных событий\

#### Параметры урла

-   Слой может быть активирован из пользовательских карт через `traffic=true`
-   Если `l=trf` -> открывает слой пробок
-   Если `l=trf,trfe`-> показывает слой пробок и дорожные события

Приоритет: [traffic в пользовательской карте -> l]

#### Пример

```
Показывает слой пробок
?ll=37.620393,55.753960&z=10&l=trf
```

### Плейсмарки

#### Описание

Добавляет на карту цветные плейсмарки-капельки или точки\
[Документация по формированию pt](https://tech.yandex.com/maps/doc/staticapi/1.x/dg/concepts/markers-docpage/)

#### Параметры урла

-   `pt`

#### Пример

На карту добавляются все точки из урла

```
?ll=37.557093,55.800569&z=15&pt=37.547566,55.800932~37.557780,55.801705
```

### Маршруты

#### Описание

Режим добавляет на карту нитки маршрутов с описанием в баллуне. Если в `rtext` указана одна точка, появляется возможность указать вторую на карте.

#### Параметры урла

-   `rtext` - point1\~point2\~....~
-   [Полный список параметров](https://wiki.yandex-team.ru/maps/dev/ui/products/maps/params/#marshruty)

#### Позиционирование

Позиционирование происходит так, чтобы нитки маршрутов полностью поместились на экран

#### Пример

Активируется построение маршрутов (если одна точка указана, активируется возможность поставить вторую точку)\

```
?ll=37.557093,55.800569&z=15&mode=routes&rtext=55.807264,37.544304~55.797209,37.564818&rtt=mt
```

### Поиск

#### Описание

Режим добавляет на карту контрол поиска, список результатов поиска и поисковые плейсмарки\

#### Параметры урла

-   `chain` | `text`
-   `sll`, `sspn`, `filter`
    На поиск влияют параметры: [`ll`, `spn`]

#### Позиционирование

Позиционирование на поисковую выдачу в ответе\

#### Пример

(Параметры урла и их работа)[https://wiki.yandex-team.ru/maps/dev/ui/products/maps/params/#poisk]

```
?ll=37.557093,55.800569&z=15&mode=search&text=кафе&sll=37.557093,55.800569&sspn=0.042486,0.017114
```

### <a name="AO"></a> Активные объекты

#### Описание

Активный объект добавляет на карту дополнительный пои/whatshere/остановку

#### Параметры урла

-   `ol`
-   `ouri` | `oid` | `oll`
-   (Поддерживаемые комбинации)[https://wiki.yandex-team.ru/maps/dev/ui/products/maps/params/#aktivnyjjobekt]

#### Позиционирование

На точку активного объекта

#### Пример

Активируется контроллер активных объектов\
Если есть параметр ol и он равен:

-   biz - поиск по oid
-   geo - поиск обнуляется и активируется контроллер активных объектов поиск по text, ouri (влияют на поиск sll, sspn)

```
?ll=37.557093,55.800569&z=15&mode=search&text=кафе&sll=37.557093,55.800569&sspn=0.042486,0.017114&ol=biz&oid=89716069688
```

### Пои

#### Описание

Открывает контент организации или топонима, позиционирование карты на эту точку.

#### Параметры урла

-   `poi[point]` / `poi[uri]`
-   `poi[byPoint]` (deprecated) / `poi[byUri] `(deprecated)

#### Позиционирование

На точку пои

#### Пример

Активируется контроллер poi

```
?ll=37.557093,55.800569&z=15&mode=poi&poi[point]=37.552128,55.801173
```

### <a name="MT"></a> Общественный транспорт

#### Описание

Открывает контент ОТ и позиционирует карту на точку.

#### Параметры урла

-   `masstransit[stopId]`

#### Пример

```
?ll=37.555065,55.802708&z=17&mode=stop&masstransit[stopId]=stop__9648371
```

### Whatshere

#### Описание

Открывает контент топонима и позиционирует карту на точку.

#### Параметры урла

-   `whatshere[point]`
-   `whatshere[zoom]`

Zoom берется из парамета whatshere[zoom] или из zoom, если первого нет - данный параметр отвечает за масштаб поиска, а не за зум Карты.

#### Пример

```
?ll=37.555065,55.802708&z=17&mode=whatshere&whatshere[point]=37.551879,55.803572&whatshere[zoom]=17
```

### Панорамы

#### Описание

Отображает плеер панорам вместо Карты

#### Параметры урла

-   `panorama[point]`
-   `panorama[id]`
-   Если есть `panorama[point]` - отображается панорама в заданной точке
-   Если есть `panorama[id]` - отображается панорама по айди, причем будет приоритетнее panorama[point]

#### Пример

```
?panorama[full]=true&ll=37.555065,55.802708&z=17&l=stv,sta&panorama[point]=37.552806,55.803209&panorama[direction]=177.697080,5.371967&panorama[span]=120.000000,70.540031
```

### <a name="Views"></a> Отображение контента

У контента поев/whatshere/маршрутов/пользовательских карт/поиска/дорожных событий есть два режима отображения - в баллуне и в панели внизу экрана

#### Режимы отображения контента

Отображать контент в баллуне или в панели каждый режим определяет самостоятельно\
На данный момент правила отображения следующие:

-   Контент маршрутов всегда отображается в баллуне
-   Контент дорожных событий и пользовательских карт отображается в баллуне, если ШиринаКарты \* ДлинаКарты >= 1600000, и в панели иначе
-   Содержимое остальных режимов отображается в баллуне, если ширина карты больше 460px, иначе отображается в баллуне
-   При ширине карты меньше 295px или при высоте менее 400px, режимы отображения контент перестает отображаться где-либо, а клики в плейсмарки объектов в случае poi/whatshere/поиска открывают результат в Яндекс Картах в новом окне и ничего не делают в случае других режимов


### <a name="Поведение"></a> Поведение карты

### Отключение событий скрола

#### Описание

Отключает события скролла на виджете.

#### Параметры урла

-   `scroll=false`

### Пример

```
?ll=37.555065,55.802708&z=17&scroll=false
```
