# Дежурство

Не все процессы удается автоматизировать, для части из них все равно нужен человек, который примет решение.
Для таких задач создано дежурство.

Состав команды: [DevDuty](https://abc.yandex-team.ru/services/maps-front-maps/?scope=dutywork).

У дежурных есть несколько основных обязательств:

-   реагирование на поломку/мигание автотестов.
-   создание и выкатка релизов.
-   реагирования на алерты/поломки сервиса.

Дежурный назначается через [Sandbox планировщиком](https://sandbox.yandex-team.ru/scheduler/20472/view).

## Автотесты

Для гарантирования качества работы сервиса мы покрываем наш проект автоматическими тестами (подробнее читайте [здесь](../tests/README.md)). Поскольку эти тесты являются интеграциионными, то с течением времени некоторые из них могут ломаться, как по зависящим от нас причинам (изменение в проекте, которые предаврительно не были проверены), так и нет (обновление бекендов, браузеров, ...).

Задача дежурного - оперативное реагирования на ложные срабатывания автоматических тестов.

Есть два независимых процесса, которые помогут дежурному поддерживать порядок:

1. после каждой проверки изменений в dev ветке, в случае обнаружения проблем, создается специальная задача на починку в очереди [MAPSUI](https://st.yandex-team.ru/MAPSUI) c компонентом [dev_duty](<https://st.yandex-team.ru/MAPSUI/filter?components=43761&resolution=empty()>) и тегом [maps_dev](<https://st.yandex-team.ru/MAPSUI/filter?tags=maps_dev&resolution=empty()>), которая автоматически назначается на дежурного. Задача дежурного выявить причину поломки, если ее можно устранить быстро (в течении получаса) - необходимо это сделать, в противном случае тест необходимо отключить ([skip](https://github.com/gemini-testing/hermione#skip)) и поставить задачу на себя о возвращении теста в строй.
2. при создании/обновлении каждого pull request происходит проверка всех автотестов, в случае если разработчик заметил ложное срабатывание автотестов на своем pull request он должен отключить ([skip](https://github.com/gemini-testing/hermione#skip)) этот автотест в dev ветке и поставить задачу в очередь [MAPSUI](https://st.yandex-team.ru/MAPSUI) c компонентом [dev_duty](<https://st.yandex-team.ru/MAPSUI/filter?components=43761&resolution=empty()>), которая автоматически будет назначена на дежурного (в случае, если нет уверенности, что срабатывание было ложное, можно обратиться к любому участнику команды дежурных для того, чтобы разобраться).

## Релизы

Ежедневные релизы обеспечивают быстрое развитие продукта, на данный момент надежность тестов и инфраструктуры не позволяют их выкатывать автоматически, поэтому для этого требуется участие дежурного разработчика (релиз инженера).

Инструкция по [созданию и выкатке релизов](./workflow.md#Создание-нового-релиза).

Мы стремимся выкатывать не меньше одного релиза в день, но качество сервиса важнее (поэтому релизы могут выкатываться и реже, если в релизе находятся ошибки, которые затрагивают значимую часть пользователей).

## Передача дежурств

Дежурство происходит в течении недели (день передачи дежурства - понедельник).
Перед передачей дежурства необходимо убедиться, что нет открытой задачи ([фильтр в стартреке](<https://st.yandex-team.ru/MAPSUI/order:updated:false/filter?components=43761&tags=maps_dev&resolution=empty()>)) с поломкой автотестов в dev ветке (если есть, ее необходимо решить).

Все задачи, которые были назначены на дежурного в течении недели остаются на нем и НЕ переносятся на следующих дежурных!

## Алерты

Случается, что в сервисе что-то ломается, для этого настроены алерты, при которых робот будет звонить дежурному.

Общее описание реагирования на звонки и алерты описано на вики: https://wiki.yandex-team.ru/maps/dev/ui/deploy/duty/#grafikdezhurstva

Основные пункты реагирования:

-   Не забываем про **Downtime** в тикете, иначе сработает эскалация и звонки пойдет дальше.
-   Смотрим на графики и логи, чтобы понять причину.
-   Если ничего не понятно, то призывайте других дежурных.

> Телефон робота переключается на дежурного в [Sandbox планировщике](https://sandbox.yandex-team.ru/scheduler/12282/view).
