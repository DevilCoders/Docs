# Язык пользователя

Для определения языка пользователя используется библиотека [langdetect](https://doc.yandex-team.ru/lib/lang-detect/concepts/lang-detect-descr.html) в различных версиях.

Доступ к библиотеке в проекте осуществляется с помощью биндинга указанной выше C++ библиотеки в node.js (данные для определения языка хранятся в отдельном txt-файле) и с помощью http-сервиса.

## Стенды, тестинг и продакшн

На указанных выше окружениях библиотека доступа в виде node-биндинга: [@yandex-int/langdetect](https://a.yandex-team.ru/arc_vcs/mail/nodejs/js/langdetect). Текстовый файл с данными поставляется вместе с биндингами в виде debian пакета.

## Разработка

Хранить и обновлять библиотеку при локальной разработке неудобно, поэтому в локальной разработке есть две опции использования библиотеки определения языка:

-   статичный мок (в объекте хранятся дефолтные языки для нескольких локалей) - **вариант по умолчанию**
-   запросы в [http-langdetect](https://github.yandex-team.ru/toolbox/http-langdetect), обернутые в пакет [sync-request](https://www.npmjs.com/package/sync-request), позволяющий сделать асинхронные http-запросы синхронными - **для включения требуется установить флаг переменной окружения HTTP_LANGDETECT**. Эти запросы кешируются локально в папке `.local-cache/lang-detect` на месяц.
