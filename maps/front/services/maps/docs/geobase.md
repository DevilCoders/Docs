# Геобаза

Для определения геолокации пользователя используется несколько инструментов.

Первый - это [LaaS](https://doc.yandex-team.ru/laas/laas-user/concepts/about.html) (location-as-a-service), определяющий местоположение пользователя. Балансеры подклеивают данные от LaaS в [заголовки](https://doc.yandex-team.ru/laas/laas-user/concepts/balancer_headers.html) ко всем запросам пользователя.

Второй - это [геобаза](https://wiki.yandex-team.ru/geotargeting/libgeobase/), хранящая в себе данные о всех регионах и их иерархии. Например, с его помощью по id региона, полученного из LaaS, можно получить объект региона.

# Различные окружения

Доступ к геобазе может осуществляться различными способами - с помощью бинарного файла, http-сервиса, web-сервиса.

## Стенды, тестинг и продакшн

На указанных выше окружениях геобаза доступна в виде бинарного файла, указанного в качестве sandbox-ресурса в окружении. Доступ к файлу из проекта осуществляется с помощью node-биндинга [geobase6-nodejs](https://github.yandex-team.ru/aandrosov/geobase6-nodejs).

## Разработка

Хранить и обновлять геобазу при локальной разработке неудобно, поэтому в локальной разработке есть две опции использования геобазы:

-   статичный мок (на любой запроса региона ответом всегда будет Москва) - **вариант по умолчанию**
-   запросы в [http-geobase](https://wiki.yandex-team.ru/http-geobase/), обернутые в пакет [sync-request](https://www.npmjs.com/package/sync-request), позволяющий сделать асинхронные http-запросы синхронными - **для включения требуется установить флаг переменной окружения HTTP_GEOBASE**. Эти запросы кешируются локально в папке `.local-cache/geobase` на месяц.

## Web-интерфейс

Для исследования геобазы можно пользоваться [web-интерфейсом](https://geoadmin.yandex-team.ru/).
