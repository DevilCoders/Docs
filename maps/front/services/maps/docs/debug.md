# Отладка

Для отладки в проекте используется query-параметр debug с различными значениям, например: `debug=foo,bar` или `debug=foo&debug=bar`.

Некоторые `debug`-параметры используются для логирования действий на сервере (доступны только из внутренней сети):

| Имя         | Функционал                                            |
| ----------- | ----------------------------------------------------- |
| `request`   | Сетевые запросы в бэкенды                             |
| `geo`       | Информация о геоданных.                               |
| `mock`      | Сохранение / запись моков                             |
| `requestId` | id некоторых сетевых запросов (используется в тестах) |
| `cache`     | Кэшированные данные из бэкендов                       |
| `system`    | Информация о системе                                  |
| `all`       | Все вышеперечисленные                                 |

Другие `debug`-параметры используются для симуляции различных браузеров и режимов:

| Имя         | Функционал                              |
| ----------- | --------------------------------------- |
| `mobile`    | Включение вида для мобильного браузера  |
| `desktop`   | Включение вида для десктопного браузера |
| `robot`     | Включение вида для поискового краулера  |
| `turbo`     | Включение режима турбоаппа              |
| `polyfills` | Включение полифиллов                    |
| `jsapi`     | Включение JS API с опцией `mode=debug`  |

Оставшиеся имеют особый функционал:

| Имя                 | Функционал                                                      |
| ------------------- | --------------------------------------------------------------- |
| `appsearch_session` | Симуляция Поискового приложения                                 |
| `login`             | Эмуляция залогиненного пользователя (только из внутренней сети) |
| `owner`             | Эмуляция владельца организации (только из внутренней сети)      |
| `rum`               | Отладка RUM счетчика                                            |
| `keep-domain`       | Отладка домена (без редиректа, только из внутренней сети)       |
| `save-cargo-to-url` | Сохранение параметров грузовика в url вместо localstorage. Нужно ребятам на бэке для отладки грузовых маршрутов       |

## Loggers

Все основные логеры прописаны в [debug.ts](../src/core/debug/debug.ts).
Для использования передавайте их в параметр `loggers`: `loggers=analytics` или `loggers=analytics,location`.

## Devtools

Для браузеров, не имеющих возможность для дебага (devtools, inspector), добавлена утилита [vorlon](http://www.vorlonjs.io/).

Для этого надо в терминале запустить три вкладки:

1 вкладка

```sh
make dev
```

2 вкладка

```sh
make devtools
// ...
// Your URL: https://sigorilla-1337-maps.ldev.yandex.ru/
```

3 вкладка

```sh
make tunneler
// Do not close this terminal to keep the url up-to-date.
// Your URL: https://sigorilla-8080-maps.ldev.yandex.ru/maps/
```

В нужном браузере открыть урл приложения с query параметром `devtools=<URL>`, где `<URL>` получен из команды `make devtools`.

Для этого примера полный урл будет таким:
`https://sigorilla-8080-maps.ldev.yandex.ru/maps/?devtools=https://sigorilla-1337-maps.ldev.yandex.ru/`

В любом браузере открываем урл `http://localhost:1337/` и можем там дебажить через `vorlon-devtools`

**Важно:**

1.  URL должен заканчиваться на '/'
2.  В некоторых браузерах (например Safari) может потребоваться сначала открыть <URL> напрямую, чтобы принять сертификат.
