# Библиотека nmaps-indoor-plan

Библиотека позволяет получить модель индора из базы НК `revision`. Модель данных не претендует на полноту, предоставляет лишь нужную информацию, но открыта к расширению.

Данные из НК получаются с помощью снапшота `revision`-базы.

## Модель данных

### Структура `TaskPath` - маршрут обхода
Маршрут обхода используется для сбора сигналов маяков и восстановления радиокарты.
Обходы бывают _позитивные_ и _негативные_.

_Позитивные обходы_ используются для добавления трансмиттеров в радикарту.
_Негативные обходы_ используются для определения пороговых значений параметров трансмиттеров, похволяющих отфильтровывать маяки, находящиеся ВНЕ радиокарты, но видимые внутри области радиокарты.

Поля:
- `id` - айдишник объекта в базе НК.
- `geoPolyline` - полилиния маршрута обхода в геодезических координатах.
- `description` - описание марштура, используется скорее как его название.

ВАЖНО: если `description` заканчивается суффиксом `_OUTDOOR`, значит обход _негативный_.
На данный момент _негативные_ маршруты фиктивным образом привязываются к какому-либо этажу в индоре, хотя и проходят вне его границ; чаще всего - к дефолтному этажу.

### Структура `IndoorLevel` - уровень индора.
Этаж в индоре, по которому может проходить несколько маршрутов обхода.

Поля:
- `id` - айдишник объекта в базе НК.
- `universalId` - обозначение этажа в реальном мире в индоре (например, на кнопке лифта или указателях).
- `taskPaths` - маршруты обхода, привязанные к данному уровню.

### Структура `IndoorPlan` - индор.
ТЦ или другой подобный объект, состоящий из уровней.

Поля:
- `id` - айдишник объекта в базе НК. Кроме того этот же айдишник используется в `indoor`-базе в качестве `indoor_plan_id`.
- `name` - название индора. Например, "Павелецкий вокзал".
- `geoPoint` - положение индора на карте.
- `indoorLevels` - уровни данного индора.

## Example binary
Загрузку данных из `revision` базы `mapspro` иллюстрирует пример в папке `example`.

### Пример запуска:
```
./example/indoor_plan_loader \
    --config $HOME/arc/arcadia/maps/wikimap/mapspro/cfg/services/services.testing.xml \
    --plan-id 2160622462
```

### Пример вывода:
```
Indoor plan:
        id: '2160622462'
        name: 'Павелецкий вокзал'
        geom: 'POINT (37.6396382572621135 55.7296734117544901)'

Levels:
IndoorLevel:
        id: '2160622456'
        universalId: '-1'

TaskPaths:
TaskPath:
        id: '2183870288'
        geom: 'LINESTRING (37.6384079874190860 55.7298115135565908, 37.6389068782958773 55.7298962733258847, 37.6393467605743197 55.7298523799000378, 37.6389041960868624 55.7297267535962320)'
        desc: 'Тест 123'
TaskPath:
        id: '2211283700'
        geom: 'LINESTRING (37.6394862354430799 55.7297736743114243, 37.6396686256561068 55.7296011268864646, 37.6396847189101891 55.7297161585882179, 37.6399690330657606 55.7296102083489870)'
        desc: 'oiuy'

IndoorLevel:
        id: '2160622458'
        universalId: '1'

TaskPaths:
TaskPath:
        id: '2205103624'
        geom: 'LINESTRING (37.6391054699210983 55.7296348033750775, 37.6392932245521266 55.7296559934326012, 37.6393307754783351 55.7295379343935053, 37.6397384712486200 55.7296075589984099)'
        desc: 'OPISANIE'
TaskPath:
        id: '2213680670'
        geom: 'LINESTRING (37.6394553386226747 55.7298124636094556, 37.6404531207545787 55.7296217530132125, 37.6414723601966372 55.7298972227087788)'
        desc: '1_1'

IndoorLevel:
        id: '2160622460'
        universalId: '2'

TaskPaths:

```
