# Генератор гипотез о перекрытии дорог на основе сообщений пользователей в инфточках

## Идея
Пользователи ставят инфоточки с текстом "дорога перекрыта" или тому подобными. Мы вычитываем все сообщения (из событий метрики МЯК/Нави в ClickHouse'е), фильтруем подходящий текст, находим кластеры, если они оказываются достаточно большими, то пишем телеграм ботом в чат. К сообщению добавляем кнопки реакции, нажимая на которые эксперты подтверждают, что разобрали сообщение. Для чтения реакции на кнопки программа должна быть всё время запущена. Есть отдельный чат для рускоязычных и турецких точек.

## Для запуска нужно
В переменных окружения передать id:token бота и логин/пароль пользователя для доступа к данным метрики в ClickHouse.
Токен бота лежит в секретнице https://yav.yandex-team.ru/secret/sec-01fwqx4wsrmedehw5nh4gsmkvz/explore/version/head
Перменные окружение: tg_bot для токена, ch_user для имени пользователя, ch_pass для пароля в Clickhouse
Далее собираем ya make -r и запускаем бинарник так, чтобы он продлжал работать постоянно.

id-шники чатов, тексты на кнопках настраиваются вверху bot_main.py, а параметры кластеризации и длина истории в find_points.py

## Особенности
1. Данные о нажатых кнопках хранятся локально в БД mysqlite. В принципе их не очень страшно потерять, но когда возможно, лучше сохранять для истории/статистики. Плюс если останутся ненажатые кнопки, то при сбросе БД на них нажать уже не получится
2. Два экземляра одновременно запускать нельзя, т.к. они начнут конфликтовать за чтение ответов (нажатий на кнопку) от telegram.
