# Balancer deployer
Система синхронизации конфигов карточных балансеров.

{% note warning %}

Если нужна помощь, то приходите в [чат поддержки](../contacts.md).
<br>Если прям совсем срочно, начинайте призывать людей из [abc](../contacts.md).

Команда инфраструктуры может отключить дальнейшую выкатку через кнопку `Apply All` в [ITS](https://nanny.yandex-team.ru/ui/#/its/locations/maps/common/) и при необходимости поможет разобраться в проблеме.

{% endnote %}

## Постановка проблемы

В настоящее время под управлением [Sedem'a](https://docs.yandex-team.ru/sedem/) больше сотни балансерных сервисов.
SEDEM регулярно и автоматически обновляет конфигурации этих балансеров.

Причины по которым sedem может изменять конфигурацию балансеров следующие:
- Команда сервиса поменяла конфигурацию сервиса и седему потребовалось изменить его балансеры в соответствии с этими конфигурациями
- Изменилось правило по которым sedem генерирует конфигурацию балансеров

То, что sedem автоматически конфигурирует и поддерживает в согласованном состоянии балансеры всех карточных сервисов — очень удобно, но и очень опасно.
<br>В случае ошибки sedem мог выкатить неправильную конфигурацию сразу на все карточные сервисы, что приведет к масштабному сбою не только карточных сервисов, но и сторонних систем.
Все усугубляется тем, что системы быстрого, а тем более автоматического откатывания этих конфигураций не существует.

Чтобы сделать процесс безопасным и не потерять в удобстве было решено генерировать [конфигурации балансеров в аркадию](https://a.yandex-team.ru/arc/trunk/arcadia/maps/config/balancer), с обязательным прохождением ревью.
<br>Это породило другую проблему: необходимо доставлять конфигурации из аркадии в awacs и делать это безопасно.

Так родился balancer deployer - система сихнронизации балансерных конфигов между awacs и аркадией.

## Что делает balancer deployer
- отслеживает изменения в аркадии и заливает их в awacs
- при заливке изменений в awacs делает паузу 1 час между датацентрами, для обеспечения безопасности
- отслеживает изменения в awacs и вытягивает в аркадию

## Чего не делает balancer deployer
- Не генерирует конфигурации балансеров
- При выкатке не смотрит на мониторинги сервисов, не знает про проблемы в вашем сервисе, а значит по умолчанию будет катить дальше, даже если что-то пошло не так. В случае проблем, необходимо вручную поставить выкатку на паузу.
