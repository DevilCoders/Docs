# Yandex.Courier Analytics Backend

Service is providing analytics for [YCB](https://a.yandex-team.ru/arc_vcs/maps/b2bgeo/ya_courier/backend/README.md) via excel-reports and raw json data.
Analytics data is generated by [export_analytics tool](https://a.yandex-team.ru/arc_vcs/maps/b2bgeo/ya_courier/backend/tools/export_analytics/README.md).

[[toc]]

## General information
| What | Who |
| ---- | --- |
| Ответственные разработчики | [abc:maps-b2bgeo-courier](https://abc.yandex-team.ru/services/maps-b2bgeo-courier/) |
| Отвественные SRE | Elena Markova (4c4d@yandex-team.ru) |
| Исходники | [maps/b2bgeo/ya_courier/analytics_backend](https://a.yandex-team.ru/arc/trunk/arcadia/maps/b2bgeo/ya_courier/analytics_backend) |
| Сервис в ABC | [maps-b2bgeo-courier](https://abc.yandex-team.ru/services/maps-b2bgeo-courier/)|

## Description

## Databases
| Staging | YC | Ya Vault secret |
|---|---|---|
| Testing | https://yc.yandex-team.ru/folders/fooooj7at8f8673omia9/managed-postgresql/cluster/mdb3411l8rning1k2loj | https://yav.yandex-team.ru/secret/sec-01fk5wxk8pae411x7c3x3hg9gr/explore/versions |
| Production | https://yc.yandex-team.ru/folders/fooooj7at8f8673omia9/managed-postgresql/cluster/mdbm76bs3nsnf7j4qjf8 | https://yav.yandex-team.ru/secret/sec-01fjyrdkdz27fc1s690hhn5dz7/explore/versions |

## Usage

```
# testing:
$ docker run -e ANALYTICS_DB_USER=$(ya vault get version sec-01fk5wxk8pae411x7c3x3hg9gr -o db_user) -e ANALYTICS_DB_PASSWORD=$(ya vault get version sec-01fk5wxk8pae411x7c3x3hg9gr -o password) -e ANALYTICS_DB_HOST=$(ya vault get version sec-01fk5wxk8pae411x7c3x3hg9gr -o hosts) -e ANALYTICS_DB_PORT=6432 -e ANALYTICS_DB_NAME=b2bgeo_courier_analytics_test --net=host -e PGPORT=6432 -e ANALYTICS_S3_SECRET_KEY=$(ya vault get version sec-01ddnqnbh2mtx5mmw5svht0vv6 -o AccessSecretKey) -e ANALYTICS_S3_ACCESS_KEY=$(ya vault get version sec-01ddnqnbh2mtx5mmw5svht0vv6 -o AccessKeyId) -e ANALYTICS_AUTH_SERVICE_URL=https://test.courier.yandex.ru-it <docker_image>

# prod:
$ docker run -e ANALYTICS_DB_USER=$(ya vault get version sec-01fjyrdkdz27fc1s690hhn5dz7 -o db_user) -e ANALYTICS_DB_PASSWORD=$(ya vault get version sec-01fjyrdkdz27fc1s690hhn5dz7 -o password) -e ANALYTICS_DB_HOST=$(ya vault get version sec-01fjyrdkdz27fc1s690hhn5dz7 -o hosts) -e ANALYTICS_DB_PORT=6432 -e ANALYTICS_DB_NAME=b2bgeo_courier_analytics_prod --net=host -e ANALYTICS_S3_SECRET_KEY=$(ya vault get version sec-01ddnqnbh2mtx5mmw5svht0vv6 -o AccessSecretKey) -e ANALYTICS_S3_ACCESS_KEY=$(ya vault get version sec-01ddnqnbh2mtx5mmw5svht0vv6 -o AccessKeyId) -it <docker_image>
```

TODO: Add usage via `local_build_and_run.sh`.
