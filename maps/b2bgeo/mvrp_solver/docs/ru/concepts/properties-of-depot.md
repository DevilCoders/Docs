# Свойства складов

Склад в Яндекс.Маршрутизации это точка, в которой начинаются и могут заканчиваться все маршруты.
Если у вас есть курьеры, которые должны стартовать не со склада, ознакомьтесь с инструкцией [Старт автомобиля не со склада](properties-of-vehicles.md).

Для определения заказов используется поле запроса `depot`.

## Идентификатор склада

Обязательным атрибутом склада является уникальный идентификатор, который задается в поле `id`. Идентификатор должен быть уникальным в пределах одного запроса.

Допускается использование любого уникального номера склада из вашей учетной системы.

{% note %}

Обратите внимание, что идентификатор склада не должен совпадать с идентификаторами заказов.

{% endnote %}


## Координаты склада
Маршрутизация поддерживает определение местоположения склада в виде географических координат в системе [WGS84](https://ru.wikipedia.org/wiki/WGS_84), соответствующих точке адреса склада. В случае если местоположение склада в вашей системе задается адресом, необходимо произвести [геокодирование](https://tech.yandex.ru/maps/geocoder/) (преобразование адреса в свободной форме в географические координаты).

Обратите внимание, что координаты `0,0` не будут обработаны корректно, и приведут к ошибке при запросе Маршрутизатора.

Для определения координат склада используется поле `point`.


## Временное окно склада
Склад определенный в запросе должен иметь временное окно, задающее часы работы склада.

Для определения времени работы склада используется поле `time_window`.

Временное окно определяется в [одном из следующих форматов](properties-of-time-window.md#otnositelnyi-format-vremennykh-okon):

- `07:00:00 - 23:00:00` для временного окна которое начинается в 7 утра и заканчивается в 23 вечера текущего дня;
- `2019-10-10T07:00:00+03:00/2018-10-10T23:00:00+03:00` для временного окна на конкретную дату и часовой пояс.

В зависимости от типа временного окна, автомобили которые должны закончить маршрут на складе могут возвращаться строго до конца времени работы склада (**жесткое** временное окно), или нарушать данный лимит (**мягкое** временное окно). Подробнее данная функциональность описана в главе [Жесткие и мягкие окна](properties-of-time-window.md#zhestkie-i-miagkie-okna).

Для управления жесткими временными окнами используется поле `hard_window`:

- `true`, временное окно будет "жестким".
- `false`, временное окно будет "мягким".

В случае определения **мягкого** временного окна можно дополнительно задать штрафы за его нарушение. Подробнее данная функциональность описана в главе [Штрафы за нарушение временного окна склада](properties-of-depot.md#shtrafy-za-narushenie-vremennogo-okna-sklada).

Старт со склада также возможен до начала временного окна. Подробно данный кейс рассмотрен в главе [Гибкое время старта](properties-of-depot.md#gibkoe-vremia-starta).

{% note %}

При указании временного окна склада требуется учитывать кейсы, когда автомобилю необходимо возвращаться на склад. Если автомобиль не успевает вернуться на склад и окно склада жесткое, часть заказов может остаться недоставленной. Если есть сомнения, лучше указывать время работы склада на все время планирования и делать его гибким.

{% endnote %}



## Сервисное время на складе
Склад в Маршрутизаторе поддерживает определение общего сервисного времени, которое любой автомобиль или курьер должен провести на складе:

- `depot.service_duration_s` — время перед началом каждого рейса;
- `depot.finish_service_duration_s` — время перед завершением каждого рейса.

Общее сервисное время на складе может использоваться чтобы учитывать время на оформление документов для водителя или чтобы усреднить время на загрузку автомобиля.

{% note %}

Можно задавать время загрузки на складе, специфичное для каждого заказа – подробнее об этом в разделе [Сервисное время на загрузку заказа на складе](properties-of-orders.md).

{% endnote %}

**Пример 1**

Зададим сервисное время в 10 минут в начале и в конце любого маршрута на складе, который начинает работу в 07:00:00.

В построенном маршруте время прибытия на первый заказ составит 07:34:15, при том что поездка до первого заказа занимает 00:24:15. Таким образом, автомобиль провел на складе 10 минут перед началом поездки.

В конце маршрута, время прибытия на склад составляет 08:07:43. К этому времени прибавляется 10 минут сервисного времени, что отражено в метрике общей длительности всего маршрута.

[Пример Excel](https://courier-admin.s3.yandex.net/doc-examples/mvrp-example-depot_service_d1.xlsx) ⋅ [Запрос API (JSON)](https://courier.yandex.ru/vrs/api/v1/log/request/e1fc8462-4795c1ab-de2ddc83-65db91af) ⋅ [Ответ API](https://courier.yandex.ru/vrs/api/v1/result/e1fc8462-4795c1ab-de2ddc83-65db91af) ⋅ [Открыть на карте](https://courier.yandex.ru/mvrp-map#e1fc8462-4795c1ab-de2ddc83-65db91af)

**Пример 2**

В данном примере 3 заказа и каждый заказ занимает 100% вместимости автомобиля, поэтому планируется 3 отдельных рейса. Видно, что время depot.service_duration_s и depot.finish_service_duration_s   добавляется соответственно в начале и в конце каждого рейса.

[Пример Excel](https://courier-admin.s3.yandex.net/doc-examples/mvrp-example-depot_service_d2.xlsx) ⋅ [Запрос API (JSON)](https://courier.yandex.ru/vrs/api/v1/log/request/6124b3fc-95d19804-3cac3658-f42350c4) ⋅ [Ответ API](https://courier.yandex.ru/vrs/api/v1/result/6124b3fc-95d19804-3cac3658-f42350c4) ⋅ [Открыть на карте](https://courier.yandex.ru/mvrp-map#6124b3fc-95d19804-3cac3658-f42350c4)


## Гибкое время старта
По умолчанию (значение `depot.flexible_start_time` FALSE), автомобили начинают движение со склада сразу после его открытия (или начала смены водителя) и окончания загрузки заказов.

Если указать значение TRUE — старт со склада сможет планироваться не с границы начала временного окна склада или смены водителя, а позже.

Примеры:

1. Смена водителя начинается в 09:00, склад начинает работать с 08:30. Параметр `depot.flexible_start_time`указан как `FALSE`. При планировании будет учитываться, что любой полученный маршрут у данного водителя должен начинаться 09:00, даже если окно первого заказа с 13:00 до 14:00, а водителю со склада до этого заказа ехать всего 15 минут.
2. Cмена водителя начинается в 09:00, склад начинает работать с 08:30. Параметр `depot.flexible_start_time` указан как `TRUE`. Если окно первого заказа будет с 13:00 до 14:00, а водителю со склада до этого заказа ехать всего 15 минут, планировщик может спланировать курьеру выезд со склада не в 09:00, а позже (например, в 12:30), если при этом не будут нарушены другие ограничения.

## Доставка с одного из нескольких складов

Иногда товар находится на нескольких складах, и при планировании нужно выбрать, с какого склада выполнять доставку. Можно использовать поле `depots`, если отгрузка допускается с любого склада из списка. Поле `depots` с единственным элементом работает так же, как `depot`. Поля `depots` и `depot` взаимоисключающие, и в запросе можно указать только одно из них.

Для транспортных средств можно задать, с [каких складов они стартуют](https://yandex.ru/routing/doc/vrp/concepts/properties-of-vehicles.html#start-s-odnogo-iz-neskolkikh-skladov).

Если известно, с какого склада должен отгружаться определенный заказ, рекомендуется применять функциональность [Прием и доставка](https://yandex.ru/routing/doc/vrp/concepts/properties-of-orders.html#priem-i-dostavka). Основной склад нужно указать в `depot`, а дополнительные — в `orders`  как точки `pickup` для конкретных заказов.

**Пример**

Даны два склада и три заказа. Два заказа доставлены с первого склада, один — со второго.

[Запрос API (JSON)](https://courier.yandex.ru/vrs/api/v1/log/request/5b9054b6-1463edc0-573fec8d-665a6eb9) ⋅ [Ответ API](https://courier.yandex.ru/vrs/api/v1/result/5b9054b6-1463edc0-573fec8d-665a6eb9) ⋅ [Открыть на карте](https://courier.yandex.ru/mvrp-map#5b9054b6-1463edc0-573fec8d-665a6eb9)


## Пропускная способность склада

В определенных случаях необходимо ограничить максимальную скорость загрузки автомобилей на складе. Для ограничения скорости загрузки используется поле запроса `depot.throughput`.

Пропускная способность склада задается в единицах веса, которые могут быть обработаны складом за один час:

- `throughput.kg_per_hour` — пропускная способность в кг/час.
- `throughput.units_per_hour` — пропускная способность в единицах/час (паллеты, коробки, кеги).

В случае если для каждого заказа задано время погрузки на складе, оно будет также учитываться в дополнение к весу заказа при проверке ограничения пропускной способности.

**Пример**

В примере ниже определен склад с общим сервисным временем в начале и конце маршрута (например, для обмена документами), а также различное время загрузки каждого заказа на складе.

{% note %}

Обратите внимание, что время прибытия на первый заказ соответствует общему времени на складе в 960 секунд + времени на поездку до первого заказа.

{% endnote %}

[Пример Excel](https://courier-admin.s3.yandex.net/doc-examples/mvrp-example-depot_service_d3.xlsx) ⋅ [Запрос API (JSON)](https://courier.yandex.ru/vrs/api/v1/log/request/ae86b55c-98db6331-e42f6ea3-73e86d8f) ⋅ [Ответ API](https://courier.yandex.ru/vrs/api/v1/result/ae86b55c-98db6331-e42f6ea3-73e86d8f) ⋅ [Открыть на карте](https://courier.yandex.ru/mvrp-map#ae86b55c-98db6331-e42f6ea3-73e86d8f)

## Штрафы за нарушение временного окна склада
Данный штраф добавляется к общей стоимости маршрута, если автомобиль выезжает со склада раньше временного окна работы склада или возвращается на склад позже временного окна работы склада.

{% note %}

Такое поведение возможно только в случае определения "*мягкого*" временного окна. Если нарушается "*жесткое*" окно, то заказ автоматически помечается как недоставленный и исключается из всех маршрутов.

{% endnote %}

Штраф за несвоевременный приезд на склад позволяет нарушать временное окно работы склада, если нет возможности загрузить заказы в автомобиль в рамках установленного временного окна.

Для управления своевременностью приезда на склад в Маршрутизаторе могут использоваться следующие объекты:

- `depot.penalty.early` — устанавливает штраф за прибытие на склад раньше временного окна;
- `depot.penalty.late` — устанавливает штраф за возвращение на склад позже временного окна;
- `depot.penalty.out_of_time` — устанавливает единые штрафы как за раннее прибытие на склад, так и за позднее возвращение.

Если `depot.penalty.early` и `depot.penalty.late` не заданы, то используются значения из `depot.penalty.out_of_time` (то есть `early` и `late` работают как переопределение `out_of_time`).

Каждый объект состоит из двух полей:

- `fixed` — фиксированный штраф за факт несвоевременного приезда на склад;
- `minute` — штраф за каждую минуту несвоевременного приезда на склад.

Если в `depot.penalty.early` или `depot.penalty.late` задано только одно значение (`fixed` или `minute`), то второе берется из `depot.penalty.out_of_time`. Например, может быть задано только `depot.penalty.late.fixed`. Тогда при опоздании на склад в качестве штрафа за каждую минуту будет использоваться `depot.penalty.out_of_time.minute`.

{% note %}

Вышеперечисленные поля имеют значения по умолчанию, которые рекомендуется использовать в качестве стартовых значений при определении пользовательских приоритетов приезда на склад.

При сомнениях, свяжитесь с аналитиками Яндекс.Маршрутизации для определения корректных коэффициентов.

{% endnote %}


<p class="p"><a href="feedback.html" class="xref button">Написать в службу поддержки</a></p>
