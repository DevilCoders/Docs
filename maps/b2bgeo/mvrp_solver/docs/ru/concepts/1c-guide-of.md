# Работа c 1С-обработкой базовой версии

Поддерживаемые версии 1С:

* Управление торговлей 10.\* и отраслевые на их основе
* Управление производственным предприятием и отраслевые на их основе
* Бухгалтерия предприятия версий 2.\* и отраслевые на их основе
* Комплексная автоматизация версий 1.\*

В зависимости от конфигурации данные выбираются из соответствующих документов:

* Заказ клиента (УТ, КА)
* Заказ покупателя (УПП)
* Реализация товаров и услуг (БУХ)

Перед началом работы, скачайте [файл конфигурации](https://courier.yandex.ru/vrs-doc/yandex-routing-of-26-05-2020.cf).

Данная реализация является типовой и может потребовать доработок в зависимости от изменений в конфигурации клиента и принятых процессов документооборота в каждой конкретной организации.

Модуль представляет собой обработку, находящуюся в подменю «Обработки».

<img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-step-0.png" />

В зависимости от конфигурации и ее версии внешний вид диалога открытия модуля может отличаться от представленного на изображении.

Пример реализации работы с сервисом Яндекс.Маршрутизация из учетных систем на базе типовых конфигураций 1С предлагает три метода:

1. Отправка запроса на маршрутизацию.
2. Получение результата и метрик маршрутизации.
3. Построение графов и диаграммы движения автомобилей по точкам доставки по результатам маршрутизации с помощью карт Яндекс.

## Шаг 1. Запуск модуля

1. Этот шаг можно пропустить, если в конфигурацию уже добавлена возможность изменения.
Для установки модуля нужно добавить возможность изменения конфигурации. Для этого нужно запустить 1С в режиме конфигуратора и с помощью пункта «Поддержка — Настройка поддержки» открыть окно настройки.

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-start-of-module-step-1-1.png" />

    В окне настройки поддержки нажмите кнопку «Включить возможность изменения», выбрав в следующем окне пункты изменения с сохранением поддержки.

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-start-of-module-step-1-2.png" />

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-start-of-module-step-1-3.png" />

    После окончания процесса изменения окно настроек можно закрыть.

2. Для установки модуля нужно открыть пункт меню «Конфигурация – Сравнить, объединить с конфигурацией из файла…» и выбрать поставляемую конфигурацию модуля.

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-start-of-module-step-2-1.png" />

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-start-of-module-step-2-2.png" />

3. Откроется окно сравнения-объединения конфигураций.

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-start-of-module-step-3-1.png" />

    В этом окне нужно снять флаг с корня конфигурации, это также снимет флаги со всех подчиненных элементов. После этого выбрать пункт меню «Действия – Отметить по подсистемам файла» и в появившемся окне выбрать «Не входящие в подсистемы».

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-start-of-module-step-3-2.png" />

    Выделятся только нужные для загрузки новые элементы конфигурации из файла. После этого нужно нажать на «Выполнить».

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-start-of-module-step-3-3.png" />

4. После получения сообщения об окончании объединения нужно обновить конфигурацию базы данных, нажав F7 или соответствующий значок на панели инструментов.

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-start-of-module-step-4-1.png" />

    После окончания обновления необходимо согласиться с изменениями в структуре.

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-start-of-module-step-4-2.png" />

5. При появлении диалогового окна с информацией о загрузке конфигурации нажать «ОК».

    Для пользователей сервиса нужно будет настроить интерфейс доступа к элементам модуля, либо отредактировать их текущие интерфейсы.

## Шаг 2. Заполнение справочников

Для формирования запроса в сервис Яндекс.Маршрутизация требуется ввести необходимые настройки модуля и заполнить справочники «Склады» и «Машины».

Доступ к справочникам по умолчанию находится в меню «Справочники».

<img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-filling-in-directories-step-0.png" />

1. Справочник «Настройки» содержит основные настройки работы модуля, такие как ключ API, адреса подключения.

    Значения основных настроек можно заполнить значениями по умолчанию по нажатию кнопки «Заполнить по умолчанию» или перезаписать ими существующие элементы, нажав на ту же кнопку (Кнопка «Заполнить по умолчанию» как создает настройки со значениями по умолчанию, так и перезаполняет существующие настройки значениями по умолчанию). Значение «Ключ API» заполняется вручную.

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-filling-in-directories-step-1.png" />

2. Справочник «Склады» должен иметь один непомеченный на удаление элемент с заполненными параметрами.

    Пример заполнения показан на изображении ниже:

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-filling-in-directories-step-2.png" />

3. Справочник «Машины» должен иметь хотя бы один непомеченный на удаление элемент с заполненными параметрами.

    Пример заполнения показан на изображении ниже:

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-filling-in-directories-step-3.png" />

## Шаг 3. Выбор периода

1. Для начала работы с модулем необходимо выбрать период, за который необходимо собрать данные по документам, нажав на кнопку «Изменить период». После этого откроется окно с выбором периода.

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-select-period-step-1-1.png" />

    После того, как необходимый период выбран, нужно нажать на кнопку «ОК».

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-select-period-step-1-2.png" />

2. После выбора периода необходимо нажать на кнопку «Заполнить список».

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-select-period-step-2-1.png" />

    Данные по документам (зависит от конфигурации) за выбранный пользователем период заполнят таблицу модуля.

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-select-period-step-2-2.png" />

    Данная таблица доступна для редактирования на форме модуля после завершения проверки и редактирования собранных данных.

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-select-period-step-2-3.png" />

## Шаг 4. Отправка запроса

1. Для отправки запроса в сервис Яндекс.Маршрутизация необходимо выбрать пункт меню «Отправка запроса» и выбрать подпункт «Отправить запрос на маршрутизацию».

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-sending-request-step-1.png" />

2. При выборе пункта «Отправить запрос на маршрутизацию» произойдет отправка запроса. Результат отправки будет отображен в окне сообщений.

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-sending-request-step-2-1.png" />

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-sending-request-step-2-2.png" />

    После этого статус запроса, его дальнейшие изменения и результат обработки можно контролировать в пункте «Запросы на маршрутизацию».

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-sending-request-step-2-3.png" />

3. Список представляет собой историю запросов на маршрутизацию с указанием их id, статусов, сообщений сервиса и времени их фиксации в учетной системе.
Сервис обработает успешно отправленный запрос и присвоит ему id, который вместе с дополнительными данными вернется в учетную систему 1С и будет зафиксирован в истории. Если при обработке запроса произойдут какие-либо ошибки, они будут зафиксированы в истории с соответствующими статусами и сообщениями.

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-sending-request-step-3.png" />

    Все запросы со статусами автоматически обрабатываются с заданным интервалом. Исключение представляют запросы со статусами «Завершен» и «Ошибка». Обновления статусов запросов также фиксируются в истории.

4. Автоматическая обработка происходит с помощью регламентного задания, настройка которого не требуется.

## Шаг 5. Получение результата

1. Получение результата и метрик маршрутизации выполняется в окне списка запросов на маршрутизацию. Для их отображения необходимо выделить строку, по которой маршрутизация успешно завершена, и нажать на кнопку «Таблица результатов маршрутизации».

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-get-results-step-1-1.png" />

    После этого откроется форма с таблицей точек доставки и параметрами движения автомобилей между ними.

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-get-results-step-1-2.png" />

2. Построение графов и диаграммы движения автомобилей по точкам доставки по результатам маршрутизации с помощью сервиса Яндекс.Карты происходит в браузере по умолчанию и выполняется при нажатии на гиперссылку со значением id в списке запросов на маршрутизацию. Маршрутизация также должна быть завершена сервисом, то есть последний статус по выбранному id должен быть «Завершен».

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-get-results-step-2-1.png" />

    При нажатии на ссылку откроется карта и параметры движения автомобилей по точкам доставки:

    <img class="step--img" src="https://courier.yandex.ru/vrs-doc/1c-guide-OF-get-results-step-2-2.png" />

<p class="p"><a href="feedback.html" class="xref button">Написать в службу поддержки</a></p>
