# Шаг 4. Интеграция

По итогам предыдущих шагов должна быть собрана информация:

 - какие настройки продукта применять;
 - какие данные нужно брать из используемых систем и какой информации сейчас не хватает;
 - требуются ли изменения на стороне смежных процессов и сервисов.

На этом шаге необходимо встроить использование продукта в свои информационные системы, чтобы можно было переходить к опытной эксплуатации. Сейчас желательно сделать только минимально необходимый набор доработок. Все требуемые доработки можно будет выявить только при реальном использовании маршрутов.

1. Если вы внедряете и сервис планирования маршрутов, и сервис выполнения заказов, рекомендуется это делать последовательно: сначала Планирование, потом [Мониторинг](https://yandex.ru/routing/doc/delivery/concepts/about.html).

1. Важный момент, который необходимо учитывать при интеграции с сервисом планирования: на стороне Яндекс.Маршрутизации не хранятся исходные данные. Каждая задача должна содержать в себе сведения о складе, доступных ресурсах (машинах/курьерах), заказах, настройках. Хранение этой информации нужно реализовать на своей стороне.

1. Выберите схему взаимодействия вашей системы и сервиса построения оптимальных маршрутов:
   - Вручную через Excel. Из вашей системы информация выгружается в Excel-шаблон. Далее логист вручную запускает планирование в веб-интерфейсе продукта и при необходимости корректирует решение. Затем выгружает результат также в формате Excel.
   - Через API c использованием UI. Ваша система отправляет запрос к API. Затем логист по специальной ссылке переходит в веб-интерфейс продукта и, если нужно, корректирует решение. Итоговый вариант маршрутизации ваша система получает через API.
   - Через API без использования UI. Если у вас есть свой интерфейс логиста, взаимодействие можно построить полностью через API: отправлять запрос и получать результат без использования UI сервиса.

1. Решите вопрос с получением координат. При планировании через веб-интерфейс (вручную через Excel) можно воспользоваться встроенным геокодером. Но при взаимодействии через API данные по координатам нужно будет получать заранее, до отправки задачи в маршрутизацию:

   - Если адреса меняются нечасто, можно провести геокодирование один раз, а потом при заведении нового адреса добавлять координаты вручную.
    - Если адреса меняются часто, потребуется подключить геокодер. Например, [сервис геокодирования Яндекс](https://tech.yandex.ru/maps/geocoder/).

   Корректность координат имеет очень большое значение для получения хороших результатов маршрутизации. Геокодер может неправильно распознавать адреса, которые введены с ошибками или содержат информацию, не относящуюся к адресу. Например, координаты будут неточными, когда есть одинаковые названия улицы и проспекта, одноименные улицы в разных городах и&nbsp;т.&nbsp;п. В итоге маршрут будет спланирован в неверную точку. Поэтому стоит уделить внимание тому, как в вашей системе появляются и хранятся адреса:

   - Если клиенты указывают адреса в форме на сайте, желательно подключить проверку ввода адресов (например, [проверку Яндекса](https://tech.yandex.ru/maps/jsbox/2.1/input_validation)).
   - Если адреса вводят сотрудники компании, рекомендуется упорядочить процесс ввода. Часто адрес набирают сплошной строкой, в том же поле сохраняют комментарий и информацию по окну доставки. Как минимум нужно отделить адрес от прочих данных, чтобы при геокодировании возникало меньше ошибок и проблем с распознаванием.

1. Если у вас несколько складов (площадок, городов), которые можно планировать отдельно, лучше внедрять сервис на них последовательно. Определите порядок внедрения по площадкам. Критерии выбора этого порядка индивидуальны. На что можно ориентироваться:

   - Объем заказов на складе. Обычно в качестве первого объекта выбирают средний по объему склад. (Небольшой будет не показателен. На крупном внедрение проходит, как правило, дольше и сложнее.)
   - Текущие показатели эффективности маршрутизации (например, количество опозданий по заказам, средняя загруженность транспорта и&nbsp;т.&nbsp;п.). Обычно начинают с площадки со средними показателями. На объекте с низкими результатами может иметь место неорганизованность процесса в целом и тогда внедрить что-то новое там будет сложнее. На объекте с отличными показателями положительный эффект может быть небольшим.
   - Особенности персонала. Внедрение лучше начинать там, где люди больше готовы к переменам (если, конечно, эти перемены их затронут) и скорее будут помогать вам в процессе внедрения, чем препятствовать.

1. Выделите ресурсы для интеграции. Важно, что разработчики должны быть доступны вам и на следующем шаге (Опытная эксплуатация). Часто в начале реального использования сервиса возникают дополнительные требования к маршрутам. Для их реализации необходимо будет воспользоваться ранее не задействованными настройками алгоритма (их нужно будет передавать в запрос к API). Если у вас нет собственных разработчиков, то учитывайте этот момент в договоренностях с подрядчиками.

1. Сформулируйте список основных доработок. Ознакомьтесь с перечнем типовых доработок, которые требуются при интеграции с Яндекс.Маршрутизацией. Возможно, некоторые пункты вашего списка будут менее критичны для начала опытной эксплуатации. Расставьте приоритеты, чтобы перейти к следующему шагу как можно раньше.

1. Ознакомьтесь со спецификацией API (в документации описаны [запрос](https://yandex.ru/routing/doc/vrp/ref/MultipleVehiclesRouting/addMVRPTask.html) и [ответ](https://yandex.ru/routing/doc/vrp/ref/MultipleVehiclesRouting/getMVRPTaskResult.html)), а также с [особенностями обработки ошибок](https://yandex.ru/routing/doc/vrp/concepts/error-handling.html).

1.	Если ваша учетная система — 1С, воспользуйтесь готовыми модулями, которые позволят ускорить интеграцию (см. разделы [Работа c 1С-обработкой базовой версии](https://yandex.ru/routing/doc/vrp/concepts/1c-guide-of.html) и [Работа c 1С-обработкой версии на управляемых формах](https://yandex.ru/routing/doc/vrp/concepts/1c-guide-uf.html)). Для их адаптации под вашу конфигурацию потребуются разработчики 1С. Для других систем (не 1С) готовые модули для интеграции в текущий момент отсутствуют.

1. Организуйте доступ к API для ваших разработчиков:

   - Если вы уже регистрировались в веб-интерфейсе продукта, для вашего аккаунта ключ к API был создан автоматически. С этим ключом можно отправлять запросы к API. Также в веб-интерфейсе можно дать доступ другим аккаунтам.
   - Если ваш ключ уже оплачен, для тестовых запросов на период интеграции лучше завести отдельный ключ для другого аккаунта. Срока действия тестового ключа чаще всего достаточно.

   Для тестирования интеграции используйте тот же API. Отдельной тестовой среды нет, поскольку тестовые и продуктивные запросы для API не отличаются.

1. Организуйте заполнение справочников, потребность в которых была выявлена на предыдущих шагах. Возможно, потребуется изменить рабочие процессы, чтобы своевременный и корректный ввод данных теперь входил в чьи-то обязанности.

1. Ознакомьтесь с типовыми ошибками, возникающими при интеграции. В ответе API кроме кода ошибки возвращается поясняющий текст. В большинстве случаев его достаточно, чтобы найти и устранить проблему в запросе самостоятельно. Если этого сделать не удается, обратитесь в техническую поддержку по электронной почте [routing-support@yandex-team.ru](mailto:routing-support@yandex-team.ru) или через форму [Обратной связи](https://yandex.ru/routing/doc/vrp/concepts/feedback.html).

1. Когда ключевые разработки будут завершены и интеграция отлажена на тестовых запросах, можно приступать к опытной эксплуатации на реальных данных. Переходите к [шагу 5](trial-operation.md).


<p class="p"><a href="feedback.html" class="xref button">Написать в службу поддержки</a></p>
