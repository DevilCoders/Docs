# Пример обработки пользовательского фидбека через пайплайн

Разберём пример обработки простого пользовательского фидбека с помощью СПП.

* Пользователь с помощью БЯК оставляет фидбек, что организация закрыта

---

* fb-api формирует уникальный идентификатор фидбека и заполняет [сообщение][01] `Signal` для СПП
* fb-api отправляет это сообщение в СПП с помощью POST-запроса на ручку `/v1/signal/add`
* В ответ fb-api получает код ответа 201 с пустым телом сообщения
* После этого fb-api периодически узнаёт у СПП статус сигнала с помощью запроса на ручку `/v1/signal/get`
* Пока сигнал не обработан, СПП возвращает код ответа 202

---

* СПП, получив сигнал, убеждается в его корректности, и формирует [сообщение][02] `BusinessDiff` для экспорта в Справочник
* СПП отправляет это сообщение с помощью POST-запроса на ручку `/v1/business_diff/add`
* В ответ СПП получает [сообщение][03] `AddBusinessDiffResponse` с идентификатором диффа
* После этого СПП периодически узнаёт статус приёмки диффа с помощью запроса на ручку `/v1/business_diff/get`
* Пока сигнал не обработан, СПП получает код ответа 202

---

* В какой-то момент Справочник обрабатывает дифф и принимает его
* После этого при очередном запросе на ручку `/v1/business_diff/get` СПП получает [сообщение][04] `BusinessDiffResult`
* СПП обновляет статус сигнала внутри системы
* На этом обработка сигнала внутри СПП завершается.

---

* После этого при очередном запросе на ручку `/v1/signal/get` fb-api получает [сообщение][05] `SignalResult`
* Теперь fb-api может уведомить пользователя о результатах проверки фидбека

[01]: ../examples/01_fb_api_to_sps.prototxt
[02]: ../examples/02_sps_to_sprav.prototxt
[03]: ../examples/03_sprav_to_sps.prototxt
[04]: ../examples/04_sprav_to_sps.prototxt
[05]: ../examples/05_sps_to_fb_api.prototxt
