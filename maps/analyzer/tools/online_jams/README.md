# Online Jams

Утилита для скачивания онлайн-пробок из ecstatic в protobuf-формате в таблицу на YT, а также последующей конвертации в офлайн-формат пробок.

## Сбор пробок
```bash
./online_jams collect -u <proto-jams-table>
```
Для остановки нажми `CTRL+C`

Аргументы:
* `--osm` — скачивать пробки OSM-пробок
* `-t`, `--testing` — скачивать пробки из тестинга

### Общее описание сбора пробок
Утилита многопроцессная. Процессы поделены на группы, каждая из групп отвечает за свой тип обработки датасета.<br>
Датасеты поделены на группы по времени, внутри группы датасеты делятся на подгруппы (12 штук - по состоянию на 2020-10-16).
Работа строится так:
1. Сканирование ecstatic на наличие новых активных dataset-ов
1. При наличии новых активных dataset-ов скачивание их в текущую папку на локальной машине (результы = дирректории с *.protobuf файлами, скачивает 1 процесс ecstatic группами dataset-ов)
1. Загрузка protobuf фалов c пробками в колонку таблицы на YT
1. Удаление данных частичных конвертированных и загруженных dataset-ов в локальной дирректории

### Текущие проблемы
[GEOINFRA-1410](https://st.yandex-team.ru/GEOINFRA-1410) - подвисает ecstatic при скачивании, это может не давать запускать ecstatic повторно

## Конвертации protobuf пробок в пробочный формат
```bash
./online_jams unpack -i <proto-jams-table> -o <jams-table>
```

### Общее описание конверсии пробок из protobuf в пробочный формат
1. по protobuf из соответствующей строки проводится обработка аналогичная утилте inspect_jams
1. выходные результаты склеиваются в результирующей таблице
