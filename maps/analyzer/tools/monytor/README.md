MonYTor
===

Тулза для вывода использования YT-ресурсов различными процессами и вывода самых долгих операций.

Использование ресурсов
===

Команда `ru`. Выдаёт информацию об использовании ресурсов. Также умеет эту информацию загружать на YT в виде схематизированной таблицы.<br>
Аргументы:
* `root` - корневая нода
* `-a/--aggregate` - агрегация по:
    * `process` - имени создавшего процесса
    * `owner` - имени владельца (надо иметь в виду, что при ночном пережатии таблиц владелец меняется)
    * `child` - по подноде
    * `date` - по дате, к которой относится таблица (дата парсится из имени ноды)
    * `total` (умолчание) - суммарное потребление корневой нодой
* `-r/--recursive` - вывести все ноды без агрегации (при этом использование ресурсов директорией будет включать содержимое)
* `-s/--sort` - сортировка вывода, по умолчанию по значению ключевой колонки (имя процесса или подноды):
    * `disk` - по использованию диска
    * `chunks` - по кол-ву чанков
    * `nodes` - по кол-ву нод (таблиц)
* `-u/--upload-to` - не печатать, а загрузить данные на YT в таблицу, где можно будет детальнее проанализироать с помощью YQL, например

Команда может пригодиться для расчёта заказа ресурсов.

Долгие операции
===

Команда `top`. Выводит список долгих операций пользователя с возможностью простой фильтрации.<br>
Аргументы:
* `user` - пользователь, например `robot-jams-testing`
* `--title` - подстрока в заголовке операции, например `prepare-matched-data`
* `--date` - день, по умолчанию вчерашний (на сегодня не все операции завершились)

ВАЖНО: API не позволяет запросить более 100 операций, потому фильтрация по заголовку необходима, иначе возвращены будет "случайные" операции, и смысла в таком top'е мало.

Доступы до директории
===

Команда `acl` выводит список пользователей/групп и их права доступов до директории и всех потомков.
Аргументы:
* `path` - путь
* `--by-subject` - группировать результаты по пользователям/группам, а не директориям

Примеры
===

Использование внутри `users`:
```bash
$ bin/monytor ru //home/maps/jams/dev/users --aggregate child --sort disk
```

Использование процессами тестинга (сортировка по чанкам):
```bash
$ bin/monytor ru //home/maps/jams/testing -a process --sort chunks
```

Суммарное использование `tmp`:
```bash
$ bin/monytor ru //home/maps/jams/testing/tmp
```

Все ноды тестинга загрузить на YT для последующего анализа:
```bash
$ bin/monytor ru -r //home/maps/jams/testing -u //home/maps/dev/tmp/testing-usage
```

Долгие операции `prepare-training-tracks`:
```bash
$ bin/monytor top robot-jams --title prepare-training-tracks
```

Доступы до `//home/maps/jams`:
```bash
$ bin/monytor acl //home/maps/jams
```
