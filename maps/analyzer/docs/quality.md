# Качество Пробок

1. [Дашборды](#Дашборды)
    1. [ETA](#ETA)
    1. [Статистика по сигналам](#Статистика-по-сигналам)
1. [Прогноз ETA](Прогноз-ETA)
1. [Сходы](#Сходы)
1. [Источники](#Источники)
1. [Офлайн-эталоны](#Офлайн-эталоны)

## Дашборды

### ETA

На дашборде [ETA](https://datalens.yandex-team.ru/5q70qk3wf8ww2-probki) находятся метрики, относящиеся к качеству прогноза:
1. [ETA](https://datalens.yandex-team.ru/5q70qk3wf8ww2-probki?tab=qbe) — онлайн и офлайн прогнозы ETA
2. [Fixprice](https://datalens.yandex-team.ru/5q70qk3wf8ww2-probki?tab=X1Z) — качество онлайн-прогноза для fixprice-запросов по заказам
3. [Манёвренные пробки](https://datalens.yandex-team.ru/5q70qk3wf8ww2-probki?tab=EPm) — качество пробок по манёврам: в сравнении с обычными + покрытие / доля
4. [Сходы](https://datalens.yandex-team.ru/5q70qk3wf8ww2-probki?tab=PaQ) — сходы с маршрута
5. [Прогноз на завтра](https://datalens.yandex-team.ru/5q70qk3wf8ww2-probki?tab=aw9) — качество беспробочной модели, прогнозирующей время поездки "завтра"
6. [ETA по пингам](https://datalens.yandex-team.ru/5q70qk3wf8ww2-probki?tab=aEq) — качество времени поездки следующего километрового участка по пингам из Карт/Навигатора
7. [Сравнение качества ETA с конкурентами](https://datalens.yandex-team.ru/5q70qk3wf8ww2-probki?tab=8Aj)
8. [Прогноз баллов](https://datalens.yandex-team.ru/5q70qk3wf8ww2-probki?tab=z57) — качество прогноза баллов
9. [Инфоточки](https://datalens.yandex-team.ru/5q70qk3wf8ww2-probki?tab=eWd) — метрики упоминаний фраз вида "Яндекс врёт" / "тут красное" в Москве и Санкт-Петербурге

### Статистика по сигналам

На дашборде [Статистик по сигналам](https://datalens.yandex-team.ru/er4gl7ioxmdi7-statistika-po-signalam) можно видеть кол-во сигналов, полезных машин и пр., расчитанных на основе сырых сигналов:
1. [Партнёры](https://datalens.yandex-team.ru/er4gl7ioxmdi7-statistika-po-signalam) — статистика по сигналам партнёров
2. [Мобильные приложения](https://datalens.yandex-team.ru/er4gl7ioxmdi7-statistika-po-signalam?tab=2Er) — статистика по сигналам из приложений Яндекса

## Прогноз ETA

Качество прогноза вычисляется через сравнение эталонного времени поездки и прогнозного времени. [Тут](/arc/trunk/arcadia/maps/analyzer/pylibs/eta_metrics) можно посмотреть основные метрики.

## Сходы

По реальной поездке и запросам на построение и перестроение маршрутов можно определять, когда пользователь с маршрута сходил. Это используется для расчёта метрик сходов: истинных и ложных (когда в реальности схода не было, т.е. приложение ошибочно перестроило маршрут).

## Источники

Для расчёта качества используются различные источники данных:
- Логи сигналов, используются для определения реальной поездки (соот-но и её продолжительности)
- Логи роутера, используются для получения прогнозов и маршрутов, предложенных пользователю; также используются, чтобы определять сходы с маршрутов
- Заказы такси, используются для получения онлайн-прогноза и эталонных событий начала и конца поездки

## Офлайн-эталоны

В офлайне есть два разных подхода:
1. Считать, что реальная поездка пользователя и есть тот маршрут, который мы бы ему предложили, и посчитать прогнозное время по нему. У этого подхода важное преимущество:
    - трек можно резать на части и считать прогнозы по его частям, в частности - можно обрезать края, где человек выезжает со дворов или паркуется
2. Объединять поездку с каким-то реальным предоженным пользователю продкашн-маршрутом. Здесь мы вынуждены мириться с проблемами на концах поездки, однако офлайн-прогнозы по таким маршрутам совпадают с онлайном, и т.о. можно заранее проверить модель
