Качество предсказания движения общественного транспорта
---

Процесс считает качество предсказания движения общественного транспорта, а именно – ошибку прогноза времени прибытия на остановку.
Для определения момента времени, относительно которого сравниваются величины прогноза и реального времени, используются события метрики, а именно – тап пользователя на остановку.

Процесс использует в качестве входных данных:
- логи прогнозов сервиса
- логи прибытия автобуса на остановку
- события метрики

Алгоритм работы:
События метрики фильтруются и в обезличенном виде сохраняются на `YT`.
Далее, все таблицы сортируются по времени и обрабатываются.
Алгоритм строит виртуальное табло прогнозов, которое обновляется при чтении новой записи.
При запросе из табло для тапнутой остановки достаются все прогнозы и складываются в очередь ожидания.
При обработке прибытия, оно "закрывает" все релевантные прогнозы в очереди.

В конечном итоге для каждого запроса у нас есть вектор прогнозов (пользователю в приложении доступны несколько прогнозов для одного маршрута) и вектор прибытий.
По этим данным можно посчитать множество метрик.
В данном процессе считаются 2 вида ошибок:
- для пары первый прогноз + первое прибытие
- для каждого прогноза первое прибытие, время которого больше либо равно времени прогноза

Первый тип ошибок покрывает кейс, когда пользователь стоит на остановке и ждет автобус, ему ок, если автобус приедет раньше.
Второй тип ошибок покрывает случай, когда пользователь смотрит прогноз прибытия заранее, например из дома, и ему важно, чтобы он не опоздал.

На `YT` сохраняются:
- фильтрованные анонимизированные события тапов пользователей по остановкам
- статистика прогнозов и прибытий по всем тапам
- агрегированные метрики ошибки

Пути и параметры обучения задаются через конфиг(см. директорию [`conf`](conf)).

### Результаты

[Тестинг](https://yt.yandex-team.ru/hahn/navigation?path=//home/maps/jams/testing/masstransit/quality)<br>
[Продакшн](https://yt.yandex-team.ru/hahn/navigation?path=//home/maps/jams/production/masstransit/quality)
