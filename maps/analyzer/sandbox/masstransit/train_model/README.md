Обучение модели предсказания движения ОТ
---

Процесс использует трейн-пул для обучения модели.

Логика работы следующая – модели обучаются на указанных пулах. Для каждой модели считается качество в зависимости от горизонта. Если абсолютная ошибка хуже заданной границы для данного горизонта, то модель никуда не загружается, остальные модели при этом не теряются. Если хотя бы одна модель зафейлилась, то, после загрузки успешных моделей, таска падает, чтобы уведомить таким образом о проблеме в процессе. Загрузка производится на `YT` и, для указанных датасетов, в `ecstatic`.

Выводит в интерфейс Sandbox сводную таблицу с результатами
```text
Succeeded models:
╒═════════╤═════════╤═══════════════════════════════╤════════════════════════════════╕
│ name    │      re │ ecstatic                      │ yt                             │
╞═════════╪═════════╪═══════════════════════════════╪════════════════════════════════╡
│ model_a │ 120.153 │ model-a-dataset=2020-12-10.00 │ //models/model_a/2020-12-10.00 │
╘═════════╧═════════╧═══════════════════════════════╧════════════════════════════════╛

Failed models:
╒═════════╤══════════════════════════════════════════════════════════════╕
│ name    │ error                                                        │
╞═════════╪══════════════════════════════════════════════════════════════╡
│ model_b │ failed quality check for horizon=5: re=120. > threshold=100. │
╘═════════╧══════════════════════════════════════════════════════════════╛
```

В процессе работы выполняет следующие действия:
- мержит таблицы из трейн-пула, подготавливаемого процессом [masstransit/prepare_training_pools](/arc/trunk/arcadia/maps/analyzer/sandbox/masstransit/prepare_training_pools), сортирует результат
- запускает обучение в Нирване (создаст воркфлоу в аккаунте, токен которого был указан)
- считает качество модели на sanity check таблице на разных горизонтах и сравнивает с пороговыми значениями
- сохраняет модели на YT и меняет линки на последние версии
- сохраняет модели в локальные директории для последующей загрузки в ecstatic

Пути и параметры обучения задаются через конфиг (см. директорию [`conf`](conf)).

### Результаты

[Тестинг](https://yt.yandex-team.ru/hahn/navigation?path=//home/maps/jams/testing/masstransit/models)</br>
[Продакшн](https://yt.yandex-team.ru/hahn/navigation?path=//home/maps/jams/production/masstransit/models)
