Подготовка датасета с маневрами
---

Регулярный процесс подготовки датасета с маневрами, которые нужны для раздельного вычисления пробок (по каждому из маневров отдельно)

Данные берутся из следующих источников:
1) travel_times - треки, используемые при построении пробок (online конфиг матчера)

Алгоритм:
0) За последние 28 дней выбираются 2 последних выходных и 5 последних будней. В типичном случае это просто последняя недели, в случае затянувшихся праздников - нечто более хитрое. Это нужно, чтобы выдавать адекватный результат после праздников, в которые было мало проездов и из-за этого - мало маневров. Числа 2, 5 и 28 - конфигурируемы.
1) Используя travel_times за эти дни, получаем так называемые slices - это последовательность ребер некоторой минимальной длины плюс следующее ребро и время въезда на него.
2) Проезды усредняются для каждого часа и слайса (с головой и без). Кроме среднего (медианного) значения считаем и оценку разброса среднего = стандартное отклонение поделить на `sqrt(кол-во проездов - 1)`. Далее вычисляем абсолютную разницу времён проезда с головой и без. Из этой разницы вычитаем суммарный разброс среднего для головы и без, помноженный на константу `sigmas_factor` (по смыслу она должна быть около 1-3). Получаем разницу времён проезда с головой и без, которая достоверно больше шума, назовём её `split`. Если `split` больше `min_avg_split_time`, то считаем расслоение в этот час значительным и прибавляем к весу манёвра `sqrt(split / avg_split_time)`. Далее считается сумма весов для всех часов. Оставляем только те манёвры, которые набрали больше `min_intervals_weight`
3) Загружаем датасет в ecstatic, сохраняем его и исходную таблицу на YT.

03.2022
Реализованы первые 4 пункта из [тикета](https://st.yandex-team.ru/MAPSJAMS-3673#615b12d4d79e6d368ea7c92b).
Пункт 5 делать не стали, так он все усложняет, а пользы приносит [не много](https://st.yandex-team.ru/MAPSJAMS-4187#622f648b70c61b705efaaf8f)

### Результаты

[Тестинг](https://yt.yandex-team.ru/hahn/navigation?path=//home/maps/jams/testing/data/manoeuvres)  
[Продакшн](https://yt.yandex-team.ru/hahn/navigation?path=//home/maps/jams/production/data/manoeuvres)
