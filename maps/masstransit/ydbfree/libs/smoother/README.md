# Smoother

_Smoother_ – это библиотека, позволяющая сглаживать прогнозы движения ОТ. Новый прогноз может значительно отличаться от старого, что приводит к резкому скачку метки на карте и прогноза прибытия в карточка остановок при его обновлении. Чтобы этого избежать, _Smoother_ склеивает части прогноза в определенный момент времени, модифицируя их таким образом, чтобы движение было плавно, а метка постепенно замедлялась или ускорялась относительно текущего (старого) положения, чтобы соответствовать новому прогнозу.</br>
Если сглаживание невозможно, _Smoother_ оставит новый прогноз, обрезанный по указанному моменту времени (либо в исходном виде, в исключительных случаях).

## Интерфейс
Интерфейс описан в [include/smooth.h](include/smooth.h)
### Параметры
- старый прогноз (optional)
- новый прогноз
- момент времени (обычно – текущий)
- параметры нитки (из статических данных)
### Возвращаемое значение
Результат выполнения сглаживания:
- **OK** – сглаживание выполнено успешно
- **MISSING_FIELDS** – в protobuf не хватает данных (вероятно, использована более старая версия формата)
- **NO_PREV** – предыдущий прогноз пуст
- **THREAD_ID_MISMATCH** – нитки у текущего и предыдущего прогноза не совпадают
- **TOO_SHORT_OR_AMBIGUOUS** – один из прогнозов слишком короток для склеивания, либо невозможно однозначно определить позицию одного прогноза относительно другого
- **TOO_DIFFERENT** – прогнозы слишком сильно отличаются

В первом случае в результат будет записан сглаженный прогноз, во втором – исходный новый (либо обрезанный новый), в остальных – обрезанный новый.
