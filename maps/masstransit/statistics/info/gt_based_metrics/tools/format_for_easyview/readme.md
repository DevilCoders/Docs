## Мотивация
Для предобработки записанных GPS треков хочется видеть их не просто как числа, а
понимать, что происходит внутри. Здесь есть 2 основных сценария:

* Посмотреть на сам трек, чтобы, понять, какие точки из него нужно вырезать.
  Обычно это "лишние" точки в начале и в конце, которые записались вне ТС. Но
  иногда бывают "выбросы" в середине.
* Посмотреть на трек в контексте каких-то других данных за время его записи.
  Например, близлежащие прогнозы предиктора, сигналы от поставщиков или прогнозы
  PGT.

## Решение
В [easyview](https://a.yandex-team.ru/arc/trunk/arcadia/maps/tools/easyview/Readme.md?rev=3687003)
с [мая 2018](https://a.yandex-team.ru/arc/commit/3640598) появилась возможность
показывать на карте анимированные объекты, а не только статические точки и
ломаные. Для анимации точки нужно передать в easyview её координаты и `timestamp` -
время начала показа, а также, например, время конца показа. Т.е., если хочется
обновлять позицию точки каждую секунду, то нужно добавлять отдельный объект на
каждую секунду.

Если просто отображать точки, которые есть в наших таблицах, то между ними может
быть большое расстояние по времени, и из-за этого точки будут перескакивать так,
что не будет понятно, какая точка куда переместилась. Кроме того, easyview
поддерживает только целочисленные `timestamp`-ы. Если просто округлить значения
из таблицы, то во-первых мы исказим траекторию - не будем показывать в начале
секунды ту позицию, где метка была в этот момент (что не критично, т.к.
погрешность маленькая, а смотреть хочется на картину в целом), а во-вторых,
можем получить несколько точек одной метки для одного `timestamp`, что выглядит
довольно некрасиво. Поэтому эта тула (в обычном режиме) "семплит" точки на
траектории в последовательные моменты времени - с заданным интервалом (`step`).

Для случая отображения GT этого было бы достаточно, т.к. GT - это одна
непрерывная траектория. В случае с PGT и FC в таблице может быть несколько ТС с
различными `clid` и `uuid`, каждое из которых может быть поделено, посредством
поля `trip_id`, на отдельные "поездки", которые не нужно соединять.  Для этого
используется параметр `group_by`. Мы считаем точки с разными значениями в
колонках из `group_by` отдельными непрерывными траекториями. Обычно `group_by` -
это `{clid, uuid, trip_id}`.

Если передать флаг `--raw`, то "семплинг" не происходит и выводятся только те
точки, которые были на входе. Нанесённая на карту точка в таком случае стоит
неподвижно, пока не отобразится новая точка из той же группы. Такой режим
полезен, чтобы визуализировать сигналы от ТС, которые приходят довольно редко.

При использовании флага `--static`, точки вовсе не будут анимироваться, а просто
изобразятся все сразу.

## Использование
Нужно помнить, что каждая промежуточная точка анимации является объектом для
easyview. Не получится его запустить, если объектов слишком много. Сколько -
зависит от устройства, но максимум - примерно `500 000`.

Анимация работает только с easyview, скомпилированным из аркадии - не с
/usr/bin/easyview. Допустим, что скомпилированный бинарь easyview лежит в
`~/bin/easyview`.

#### Визуализация GT, лежащего в таблице на YT
```bash
./format_for_easyview -i //home/yatransport/mtinfo-metrics/gt/raw/navi3488 | ~/bin/easyview
```

#### Визуализация прогнозов
Допутсим, что вы выбрали из таблицы с 2D траекториями прогнозов достаточно малую
часть, чтобы она уместилась в easyview. Например, это можно сделать с помощью YQL.
```bash
./format_for_easyview -i //home/yatransport/mtinfo-metrics/fc/2d/2018-06-06_megapage_2031203056 -g clid -g uuid -g trip_id | ~/bin/easyview
```

#### Визуализация сигналов
```bash
./format_for_easyview -i //home/yatransport/mtinfo-metrics/signals/bound/2018-08-27_yaway_5 --raw | ~/bin/easyview
```
