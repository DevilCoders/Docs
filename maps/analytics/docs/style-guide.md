## О чем этот документ?
Здесь описаны договоренности организации кода и данных **специфичные** для аналитики Карт.

**Общие** практики написания хорошего кода на SQL/Python заимствуем из существующих Style Guide и не копипастим их. Выписываем исключения, если они необходимы.


## Сode Style
#### Общие соглашения
- У расчета должен быть README.md по [примеру](https://a.yandex-team.ru/arc/trunk/arcadia/maps/analytics/datasets/basemap/README.md?rev=r9113693)

### YQL
#### Общие соглашения
- Стиль написания –`snake_case`
- Файлы в Аркадии пишем через `-` вместо `_` (наследуем правило от разработки Карт).
  - исключение: название библиотек (файлы с `-` нельзя импортировать)
- Расширение файлов с YQL-кодом – `.sql`
- Правила написания хорошего кода заимствуем из [Style Guide в Яндекс.Учебник](https://a.yandex-team.ru/arc/trunk/arcadia/education/schoolbook/analytics/yql/style/guide/README.md)
- К каждому скрипту должно быть применено YQL форматирование доступное из интерфейса YQL или cli

#### Исключения для Style Guide в Яндекс.Учебник
- Для однострочных комментариев используем `--`, а не `/* */`. Для многострочных используем также `/* */`

### Python

## Data Style
### Как храним данные в YT


##### Как храним идентификаторы пользователей
1. Название колонки содержит название типа идентификатора (`device_id`, `uuid`, `puid`, `yandexuid`, ...)
2. Поле `user_id` можно использовать только в таблице, где объединены пользователи с разными идентификаторам (например, пользователи веба и приложений). Но поля с явным указанием типа идентификатора должны остаться
   ```
   SELECT user_id, device_id, yandexuid
   FROM (
      SELECT device_id, device_id as user_id
      FROM $app_users
      UNION ALL
      SELECT yandexuid, yandexuid as user_id
      FROM $web_users
   )
   ```

##### Названия сервисов
Название колонки в данных – `service`. Возможные значения:
- `web-maps` - все веб-карт
  - `desktop-maps` - БЯК
  - `touch-maps` - все тач карт
    - `sideblock-maps` - тач карты за кликов в тач-колдунщике
- `mobile-maps` - МЯК
- `navi` - Нави
- `mobile-metro` - приложение метро
- `web-metro` - веб-метро
  - `desktop-metro` - десктопные карты
  - `touch-metro` - тач карты

##### Платформы
- `os` - поле про операционную систему в расчетах для веб-карт и приложений
- `app_platfrom` - допускается такое название для расчетов, которые возможны только для приложений
- Возможные значения: `ios, android, mac, windows`

##### Поля про географию
Название поля содержит `geo_id`. Тип поля обязательно Uint32
Если в данных несколько полей про географию, то префиксом уточняется география чего:
- `user_geo_id` - география пользователя
- `request_geo_id` - география спана запроса
- `result_geo_id` - география спана ответа

##### Как храним даты и время
- `log_date` - дата таблицы лога. Обязательное поле для дальнейшего удобства группировки.
- `event_date`, `session_date` – дополнительные поля про даты

Если датасет для даталенс, то для оптимизации фильтрации по дате нужно 
- иметь колонку даты типа `Date` 
- назвать колонку `datefield`
- сортировать таблицу по ней

##### Как храним время
Время хранится как таймстемп в секундах и название содержит `timestamp`. Если требуются миллисекунды, то `milli_timestamp`.
При возможности префиксом уточняется время чего:
- `event_timestamp` - время совершения события
- `start_timestamp` - время начала. Для датасета сессий – время начала сессии.

#### Особенные значения

Для словарных столбцов (с известным списком возможных значений):
- `_total_` - всего
- `_empty_` - пустое значение
- `_unknown_` - неизвестное значение
