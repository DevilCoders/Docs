# Датасет сессий пользователей


## Назначение
Хранит в себе сессии пользователей карт за день с длиной, количеством просмотров, кликов, дипкликов и т.д.

| Сервис | Ссылки |
|:------------- |:-------------:|
| Таблицы на YT | [//home/maps/analytics/datasets/sessions](https://yt.yandex-team.ru/hahn/navigation?path=//home/maps/analytics/datasets/sessions)
| Отчеты в Статистике | [Десктопные карты](https://stat.yandex-team.ru/Maps/datasets/sessions)

## Для каких сервисов считается

* [Веб-карты](web-maps/__main__.py)

## Источники

| Сервис | Источник | Что забираем |
|:-------------:|:-------------:|:-------------:|
| Веб-карты | Логи веб карт, очищенные внутренним антифродом [cooked-bebr-log](https://yt.yandex-team.ru/hahn/navigation?sort=asc-false,field-name&path=//home/maps/analytics/logs/cooked-bebr-log/desktop-maps/clean&)  | Все события в сессии.
| Общее | Список организаций, которые являются геопродуктом [geoproduct](https://yt.yandex-team.ru/hahn/navigation?path=//home/geoadv/export/production/priority_company_permanent_id&) | permanent_id для определения является ли организация геопродуктовой.

## Схема расчета

1. Берем все логи за какой-то период.
2. Группируем по yandexuid, сортируем по времени.
4. Для каждой группы событий формируем сессии. Считаем, что если между двумя событиями прошло слишком много времени - это уже другая сессия.
5. Внутри каждой сессии считаем количество кликов, показов, длину сессии и т.п.

**Описание полей**

|  | Поле | Физический смысл |
|:------------- |:-------------|:-------------|
| 1| session_id_by_timeout | Идентификатор сессии |
| 2| yandexuid | Идентификатор пользователя |
| 3| puid | Идентификатор в Яндекс.Паспорте |
| 4| start_timestamp | Начало сессии |
| 5| finish_timestamp | Конец сессии |
| 6| geo_id | Идентификатор региона пользователя |
| 7| test_buckets | В каких тестовых выборках был пользователь |
| 8| time_to_deep_use | Сколько времени прошло до первого deep use |
| 9| time_to_goal_deep_use | Сколько времени прошло до первого goal deep use |
|10| time_to_click | Сколько времени прошло до первого клика |
|11| deep_use_count | 1 - если был deep use, 0 - если не было deep use |
|12| goal_deep_use_count | 1 - если был goal deep use, 0 - если не было goal deep use |
|13| clicks_count | Общее количество кликов в сессии |
|14| poi_show_count | Сколько было показано пользователю уникальных организаций на подложке |
|15| geoproduct_show_count | Сколько было показано уникальных геопродуктовых организаций на подложке |
|16| poi_clicks_count | На сколько уникальных организаций на подложке кликнул пользователь |
|17| geoproduct_clicks_count | На сколько уникальных геопродуктовых организаций на подложке кликнул пользователь  |
|18| poi_deep_clicks_count | Сколько раз пользователь сделал уникальных deep use по организациям, в которые попал после клика по подложке |
|19| geoproduct_deep_clicks_count | Сколько раз пользователь сделал уникальных deep use по геопродукту, в который попал после клика по подложке |
|20| poi_goal_deep_clicks_count | Сколько раз пользователь сделал уникальных goal deep use по организациям, в которые попал после клика по подложке |
|21| geoproduct_goal_deep_clicks_count | Сколько раз пользователь сделал уникальных goal deep use по геопродукту, в который попал после клика по подложке |

## К кому можно обращаться с вопросами

Вопросы задавать можно в чат поддержки аналитики - https://t.me/joinchat/BzFEvk5zq_RILGRS03BZMw

## Примеры расчетов по датасету

* [Посчитать](https://yql.yandex-team.ru/Operations/YDDIxPMBw4rPT7K2g9Pfu5WYRHnYPOje8Bmw-CpfYvg=) среднее количество сессий на пользователя за даты проведения эксперимента;
* [Посчитать](https://yql.yandex-team.ru/Operations/YDDCrFJ2-RfYntinKYI63Xrojc7XseQNwq_B4sQgiis=) среднее количество кликов по пои на сессию за даты проведения эксперимента;

