# CTRBlocks для веб-карт – данные для дашбордов
Расчет готовит данные со статистикой по событиям bebr-лога для веб-карт. Данных хранятся в двух таблицах

| Таблица                                                                                                                     | Датасет | Дашборд | Описание                               |
|:----------------------------------------------------------------------------------------------------------------------------|:-------------:|:-------------:|:---------------------------------------|
| [totals](https://yt.yandex-team.ru/hahn/navigation?path=//home/maps/analytics/reports/ctrblocks/web-maps/dashboards/totals) | TBD | [CTRBlocks](https://datalens.yandex-team.ru/t00y2p081opyl) | статистика по всем пользователям карт  |
| [by-exp](https://yt.yandex-team.ru/hahn/navigation?path=//home/maps/analytics/reports/ctrblocks/web-maps/dashboards/by-exp) | TBD | [CTRBlocks](https://datalens.yandex-team.ru/t00y2p081opyl) | статистика в разбивки по экспериментам |

## Назначение
* Хранит в себе статистику показов и кликов событий на веб-карт
* Одна строка - аггрегированная статистика по дате, сервису, названию события, параметру события

## Для каких сервисов считается
Данные для десктопных карт и тач карт хранятся в общей таблице. Тач карты включают сайдблок (открытия из колдунщика на серпе)

## Источники
Данные, которые раньше публиковались в отчет [CTRBlocksByTestID на Статфейсе](https://stat.yandex-team.ru/Maps/Adhoc/CTRBlocksByTestID)

## Схема расчета

1. Читаем данные для десктопных и тач карт
2. Фильтруем редкие события для оптимизации скорости дашборда
3. Сохраняем отдельно статистику по всем пользователям и в разбивке по экспериментам

Данные храним в помесячных таблицах, чтобы оптимизировать чтение метаданных для chyt.

## Описание полей

|     | Поле               | Физический смысл                                                                                                      |
|:----|:-------------------|-----------------------------------------------------------------------------------------------------------------------|
| 1   | fielddate          | Дата таблицы `cooked-bebr-log`                                                                                        |
| 2   | service            | Сервис (`desktop-maps`, `touch-maps`)                                                                                 |
| 3   | path               | Полный путь события (ноды), может включать название и значение параметра (`maps_www.search_form._vars_.active.True`). |
| 4   | path_name          | Название события (ноды) (`path` из `cooked-bebr-log`)                                                                 |
| 5   | var_name           | Название параметра                                                                                                    |
| 6   | var_value          | Значение параметра                                                                                                    |
| 7   | tab_separated_path | Полный путь события, как колонка `path`, только где элементы разделены `\t`, а не `.`                                 |
| 8   | shows              | Количество показов по пути (`event_type=show` в `bebr`)                                                               |
| 9   | clicks             | Количество кликов по пути (`event_type=click` в `bebr`)                                                               |
| 10  | sessions           | Количество уникальных сессий (по `session_id`) c показом ноды                                                         |
| 11  | clicked_sessions   | Количество уникальных сессий (по `session_id`) c кликом по ноде                                                       |
| 12  | visitors           | Количество уникальных пользователей (по `yandexuid`) c кликом по ноде                                                 |
| 14  | clicked_visitors   | Количество уникальных пользователей (по `yandexuid`) c показом ноды                                                   |
| 15  | test_id            | Идентификатор выборки эксперимента                                                                                    |
| 16  | test_name          | Название выборки эксперимента                                                                                         |

## К кому можно обращаться с вопросами

Вопросы задавать можно в чат поддержки аналитики в [Slack](https://join.slack.com/share/zt-jfgq9obr-8WV8gxokWri3A1wa9TrBjg?cdn_fallback=1) или ikolodin@

