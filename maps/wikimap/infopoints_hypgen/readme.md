# Maps-Core-Infopoints-Hypgen
The service generats hypothesis about road closure based on infopoints data.

## General information
| | |
|---|---|
| Developers | https://staff.yandex-team.ru/ponomarev https://staff.yandex-team.ru/chikunov https://staff.yandex-team.ru/gradksov |
| SRE | https://staff.yandex-team.ru/ponomarev https://staff.yandex-team.ru/chikunov |
| Sources | https://a.yandex-team.ru/arc/trunk/arcadia/maps/wikimap/infopoints_hypgen |
| Tracker queue | https://st.yandex-team.ru/ARMDEV |
| ABC | https://abc.yandex-team.ru/services/maps-core-infopoints-hypgen/ |
| CI | [maps-core-infopoints-hypgen](https://a.yandex-team.ru/projects/maps-core-infopoints-hypgen/ci/actions/launches?dir=maps/wikimap/infopoints_hypgen/fastcgi) |

## Documentation
[Current state](https://wiki.yandex-team.ru/maps/dev/core/wikimap/mapspro/infopoints_analyzer/)

## What happens when service is down

No infopoints based hypotheses about road closures are generated.

## Instances

Nanny services

| Environment | URL |
|---|---|
| dashboard | https://nanny.yandex-team.ru/ui/#/services/dashboards/catalog/maps_core_infopoints_hypgen/ |
| stable | https://nanny.yandex-team.ru/ui/#/services/catalog/maps_core_infopoints_hypgen_stable |
| testing | https://nanny.yandex-team.ru/ui/#/services/catalog/maps_core_infopoints_hypgen_testing |

## Firewall

Infipoints hypgen -> social for hypotheses posting
Infopoints hypgen -> infopoints aggregator for infopoints loading

## DBaas

[Task for quota](https://st.yandex-team.ru/MDBSUPPORT-706)
projectId: 6e63c071-9c7b-46bf-a4ac-fac8e8c3baef

#### Production
clusterId: d72c96f0-a7e3-40b3-ba8b-7174ad36bb26
instance type: nano

#### Testing
clusterId: 55238d8a-d5f3-467d-ac74-99be4a3f9c56
instance type: nano

#### Development
clusterId: 5fbe1447-2252-430f-a652-64f174f482a2
instance type: nano

#### Default settings changes
> yc mdb cluster AddExtension --name postgis --clusterId <clusterId>
> yc mdb cluster UpdateOptions --clusterId <clusterId> --databaseOptions '{"pooler": {"pool_mode": "session"}}'

## Known clients

Hypotheses generated by the service are shown on [ARM2.1](https://points.maps.yandex.ru/)

Nobody uses the service via HTTP API.

## How to fix common problems
[What can go wrong in RTC](https://wiki.yandex-team.ru/users/imseleznev/whatcangowronginrtc)

## Monitorings

| Name | URL |
|---|---|
| Juggler stable | https://juggler.yandex-team.ru/aggregate_checks/?query=host%3Dmaps_core_infopoints_hypgen_stable&limit=40&view=tiles |
| Juggler testing | https://juggler.yandex-team.ru/aggregate_checks/?query=host%3Dmaps_core_infopoints_hypgen_testing&limit=40&view=tiles |


## Dashboards

| Name | URL |
|---|---|
| Yacare stable | https://yasm.yandex-team.ru/template/panel/maps-core-infopoints-hypgen-stable-panel-main |
| Yacare testing | https://yasm.yandex-team.ru/template/panel/maps-core-infopoints-hypgen-testing-panel-main |
| DBaas stable | https://yasm.yandex-team.ru/template/panel/dbaas_postgres_metrics/cid=d72c96f0-a7e3-40b3-ba8b-7174ad36bb26;dbname=maps_core_infopoints_hypgen |
| DBaas testing | https://yasm.yandex-team.ru/template/panel/dbaas_postgres_metrics/cid=55238d8a-d5f3-467d-ac74-99be4a3f9c56;dbname=maps_core_infopoints_hypgen_testing |
| DBaas development | https://yasm.yandex-team.ru/template/panel/dbaas_postgres_metrics/cid=5fbe1447-2252-430f-a652-64f174f482a2;dbname=maps_core_infopoints_hypgen_development |

## Logs
| Name | URL/path |
|---|---|
| Nginx | /var/log/nginx/* |
| Yacare| /var/log/yandex/maps/yacare/* |
| Infopoints Hypgen | /var/log/yandex/maps/infopoints-hypgen/* |
| Supervisord | /var/log/supervisor/* |
| Syslog (unfiltered) | /var/log/syslog |
| DBaas | TBD |

## SLA

Absent

## Regression Stress Testing Configurations

No need of regression tests.
