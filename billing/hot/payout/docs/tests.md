# Тестирование

## Юнит-тесты

Для всех главных [компонент](components.md) на основную логику работу и некоторые краевые случае работы написаны юнит
тесты. Тесты лежат в директории компоненты в `*_test.go` файлах.

## Системные тесты

У системы выплат есть рецепт, позволяющий запустить ее в тестах. Сейчас есть два рецепта:

1. поднимает только наши компоненты (API + reg-gate + oebs-gate) - `billing/hot/payout/recipes/api/recipe/recipe.inc`
2. поднимает вообще все - `billing/hot/payout/recipes/start.inc`:
    - logbroker с необходимыми топиками
    - систему счетов (через их рецепт)
    - нашу базу из рецептов (по аналогии с юнит-тестами)
    - нашу систему из рецепта в п.1

Для примера написан тест с использованием рецепта из п.2 (`billing/hot/payout/tests/intergation`).

Из главного:

- `PAYOUTS_API_PORT` - содержит только номер порта, на котором работает основное API
- рецепт предоставляет переменную `PAYOUTS_BASE_URL`, в которой лежит путь до нашего API, включая адрес
  сервера (`localhost`)
- `PAYOUT_LB_ENDPOINT`/`PAYOUT_LB_PORT` - для доступа к локально поднятому LogBroker-у, в которой идут сообщения о новых
  выплатах. Используется только для приложения, снаружи надо использовать `localhost` как endpoint и `LOGBROKER_PORT`
  для порта.

При интеграции написании тестов с другими рецептами следует использовать минимальный рецепт из п.1.
