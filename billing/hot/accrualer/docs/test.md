# Тестирование

В проекте есть тесты двух размеров:

- `SMALL` - здесь находятся тесты, не требующие дополнительных систем: тесты на внутренние компоненты, проверка
  некоторых инвариантов в конфигах (название топика, переопределение полей) и тесты на форматирование начислений.
- `MEDIUM` - здесь поднимается локальный YT и Logbroker, поэтому их можно запустить только на linux. В них проверяется
  базовый сценарий работы с YT.

## Проверка БЛ

Главная часть small-тестов - проверка форматирования начислений и отправки событий в акты, используется аналог
канонических тестов, но реализованный самостоятельно. Данные лежат в директории `internal/accrualer/gotest`:

- `agency_accruals` - данные для проверки агентских (доходных) начислений разбитые на директории по namespace, внутри
  которых пары файлов с исходным событием и сформированным начислением;
- `agency_acts` - данные для проверки актов без разбивки на namespace, так как все акты идут в один топик;
- `errors` - данные для проверки формирование ошибок вместе с данными для мока YT;
- `netting` - данные для проверки базовой работы с событиями взаимозачета.

В этих директориях находятся пары файлов: `input_<name>.json` и `result_<name>.json`, которые содержат исходное событие
для обработки и итог его обработки (начисление, транзакция со знаком для акта, текст ошибки, внутреннее событие
взаимозачета).

При добавлении новых namespace или фильтров в логический конфиг следует так же добавлять примеры событий для проверки.
