# yandex-balance-dcs

## Статус проекта

**Depricated** с поддержкой до конца 2020 года

## Описание проекта

Программный комплекс, позволяющий отследить нарушения консистентности данных в Балансе (полученных от других сервисов или сформированных самим Балансом).

## Сборка проекта

Для сборки проекта и выкладывания его на тест используется TeamCity: [Reports / DCS / Arcadia / Billing / dcs
](https://teamcity.yandex-team.ru/viewType.html?buildTypeId=Billing_Reports_DCS_ArcadiaBillingDcs)

Для локальной сборки проекта возможно использование команды `ya make`, но лучше использовать команду:

```sh
$ make build
```

Она обновит все используемые модули проекта и выполнит `ya make`. После выполнения этих команд в папке `bin/yb-dcs` будет создан запускаемый файл `yb-dcs` с помощью которого сверки можно будет запустить.

## Тестирование проекта

Проект подключен к автосборке, поэтому юнит-тесты запускаются при прохождении ревью. Дополнительно юнит-тесты запускаются при сборке проекта в TeamCity.

Функциональне тесты запускаются через отдельную конфигурацию в Teamcity: [Billing / Autotesting / CHECK / Shared](https://teamcity.yandex-team.ru/viewType.html?buildTypeId=Billing_Autotesting_Check_Shared). Возможен ручной запуск от одного теста, до всех тестов проекта. Автоматический запуск тестов выполняется каждый день в 04:00 MSK.

Для локального запуска тестов можно использовать команду `ya make -t`, но лучше использовать команду:

```sh
$ make tests
```

Она обновит используемые модули тестов и выполнит `ya make -t`.

## Подготовка для локального запуска

Для локального запуска требуется выполнить команду:

```sh
$ make local
```

Она попросит заполнить токены для Трекера, YT и Nirvana, а так же пользователя/пароли для Balance/Meta/OEBS, после заполнения проект можно использовать.

## Запуск проекта

Для запуска проекта в продакшене используется [PyCron](https://wiki.yandex-team.ru/balance/cron/), так же есть возможность запустить сверки через [Административный интерфейс Баланса](https://admin.balance.yandex-team.ru/dcs.xml).

Для запуска локально нужно собрать проект с помощью `make build`, подготовить конфиги для локального использования и выполнить `make run_compare`. Для передачи параметров используется аргумент `ARGS`:

```sh
$ make run_compare ARGS="bua --objects 123456"
```

## Запуск проекта в Pycharm
1. Собрать проект `make build`
2. Запустить `make python`
3. В настрйоках Pycharm  добавить конфигурацию `python`
   - Указать:
       - Module name: billing.dcs.dcs.check
       - Parametrs: <название сверки> <параметры запуска>
       - Python interpreter: <путь до файла python> (созданного на шаге 2: .../arc/arcadia/billing/dcs/python)
       - Working directory: <путь до проекта> (.../arc/arcadia/billing/dcs/)
       - Пример окна настроек: https://jing.yandex-team.ru/files/a-shumak/2020-05-06-02.png
