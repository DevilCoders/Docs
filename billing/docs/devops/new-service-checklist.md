## Ratio

Цель чеклиста
* держать планку "качества" наших сервисов
* облегчить поддержку и развитие сервисов
* облегчить эксплуатацию сервисов
* синхронизировать требования между разными подразделениями
  * необходимо при "десантировании" на соседний проект
  * необходимо при передаче проекта в соседнее подразделение
  * облегчает ротацию сотрудника между подразделениями
* снизить накопление техдолга
* закладывать необходимые работы в планирование работ

Пункты <span style="color:red">MUST</span> обязательны для прохождения чеклиста. Пункты <span style="color:blue">SHOULD</span> крайне желательны, если сервис им не соответствует - на них должен быть заведен таск, оценен и прилинкован к какой-нибудь голзе. По мере развития инфраструктуры пункты <span style="color:blue">SHOULD</span> перейдут в <span style="color:red">MUST</span>.

Сервис не допускается в боевую эксплуатацию до прохождения данного чеклиста.

Соответствие сервиса чеклисту должно быть заверено руководителем группы и руководителем службы/отдела, внутри которых сервис остается на поддержке.

Шаблон для нового сервиса: https://st.yandex-team.ru/BILLING-383

Чеклист хранится в Аркадии, согласование изменений происходит через Pull-Request.

## Код
* <span style="color:red">MUST</span> Код проекта лежит в Аркадии, собирается через %%ya make%%
* <span style="color:red">MUST</span> в OWNER-ах проекта > 1 человека (можно указывать группу в Аркадии)
* <span style="color:red">MUST</span> для API-бэкендов - в ручках присутствует TVM-авторизация
  * продакшен и тестинговый id должны различаться
* <span style="color:red">MUST</span> для исходящих HTTP-запросов передаются TVM-тикеты



## Тесты
* <span style="color:red">MUST</span> В наличие тесты на основные сценарии. К защите проекта должны быть представлены список сценариев и ссылки на тесты, проверяющие их.
* <span style="color:red">MUST</span> В наличии юнит-тесты, тестирующие код отдельных модулей/классов. Должны быть SMALL или MEDIUM
* <span style="color:red">MUST</span> В наличии системные тесты, тестирующие микросервис как "черный ящик" (используя только его внешние интерфейсы). Должны быть MEDIUM. Все сторонние компоненты либо запускаются из рецептов, либо мокаются как отдельный процесс
* <span style="color:blue">SHOULD</span> В наличии интеграционные тесты на живом prestable-контуре
* <span style="color:red">MUST</span> Для highload-сервисов - проведены нагрузочные тесты на разладку на основные сценарии, определен запас по нагрузке



## Релизы
* <span style="color:red">MUST</span> Релизный цикл настроен через Arcadia CI
* <span style="color:red">MUST</span> Релизы происходят через отдельную релизную ветку
* <span style="color:red">MUST</span> В приемку каждого релиза включены юнит-тесты, системные-тесты, 
* <span style="color:blue">SHOULD</span> В приемку каждого релиза включены интеграционные тесты (на prestable-контуре)
* <span style="color:blue">SHOULD</span> В приемку каждого релиза включены нагрузочные тесты


## Деплой
* <span style="color:red">MUST</span> Компоненты развернуты в облаках Яндекса: Я.Деплой, MDB, Nirvana, YT etc
* <span style="color:red">MUST</span> Настроены окружения production, prestable, testing
* <span style="color:blue">SHOULD</span> Настроено окружение load
* <span style="color:red">MUST</span> Сущности соответствуют правилу наименований
  * [Правила для Биллинга](https://wiki.yandex-team.ru/balance/billing30/devopsguide/namingconvention)
  * [Правила для Траста](https://wiki.yandex-team.ru/users/iandreyev/naming_convention_trust)
* <span style="color:blue">SHOULD</span> Выкладка происходит либо полокационно, либо через canary-окружение с ручным подтверждением полной раскатки
* <span style="color:red">MUST</span> Для API-бэкендов - настроены L3+L7 балансеры, есть возможность рулить весами траффика
* <span style="color:red">MUST</span> Для API-бэкендов - настроен swagger в тестинге с описанием ручек
* <span style="color:red">MUST</span> Для API-бэкендов - настроен rate-limiter
* <span style="color:red">MUST</span> Для API-бэкендов - ручки принимают запросы только по HTTPS
  * <span style="color:red">MUST</span> Балансеры настроены только на прием HTTPS-траффика
  * <span style="color:red">MUST</span> Между балансерами и Deploy-Unit-ами бэкенда запросы идут только по HTTPS
* <span style="color:red">MUST</span> Для PG@MDB кластера описываются через terraform


## Мониторинг
* <span style="color:red">MUST</span> В solomon/golovan отправляются метрики
  * системные (cpu usage, кол-во свободных воркеров, место на диске etc)
  * для API-бэкендов - коды ответов, тайминги ручек по перцентилям
  * для очередей задач - размер очереди, время нахождения задачи в очереди, время выполнения задач, кол-во новых задач в единицу времени, кол-во разобранных задач в единицу времени
  * другие, в зависимости от бизнес-логики
* <span style="color:red">MUST</span> По указанным метрикам созданы дашборды c графиками в monitoring/grafana
* <span style="color:red">MUST</span> По указанным метрикам настроены пороговые алерты в juggler
* <span style="color:red">MUST</span> Алерты приходят дежурному в личный канал и в специальный чатик для алертов
* <span style="color:red">MUST</span> Эскалация алертов настроена по принципу: дежурный - фоллбек - тимлид - рук-ль службы/отдела
* <span style="color:red">MUST</span> Эскалация алертов осуществляется путем звонка от железной тетки
* <span style="color:blue">SHOULD</span> Алерты и правила эскалации описаны в MaaC, правки мониторинга проходят code review и двойной аппрув перед выкладкой
* <span style="color:blue">SHOULD</span> Настроены дизастер-алерты, первыми на них реагирует дежсмена, дальше эскалируется как описано выше



## Логи
* <span style="color:red">MUST</span> Логи выгружаются в Logfeller/YT в отдельные топики в lb. Доступ к топикам/логам ограничен командой сервиса
* <span style="color:blue">SHOULD</span> Логи выгружаются в Сlickhouse
* <span style="color:red">MUST</span> Для отправки логов используется unified-agent (при наличии готовой клиентской либы)
* <span style="color:blue">SHOULD</span> Трассировка действий внутри сервиса отправляется в ((https://wiki.yandex-team.ru/jaeger/ Jaeger))


## Процессы
* <span style="color:red">MUST</span> В ABC настроен график дежурств по сервису
* <span style="color:blue">SHOULD</span> Дежурят по сервису >= 3 человек (в общем случае - вся группа разработки)
* <span style="color:red">MUST</span> Написана документация на сервис, содержащая:
  * описание верхнеуровневой архитектуры
  * описание окружений приложения
  * где смотреть графики/алерты/логи
* <span style="color:blue">SHOULD</span> Сервис заведен в warden, дежсмена знает про него
* <span style="color:red">MUST</span> Проведены учения с полокационным закрытием сервиса, сервис переживает -1ДЦ
* Можно развернуть dev-окружение и прогнать тесты одной командой
  * <span style="color:red">MUST</span> в QYP-виртуалке 
  * <span style="color:blue">SHOULD</span> на ноутбуке
* <span style="color:red">MUST</span> Проведена встреча с рассказом-онбордингом команде про сервис
