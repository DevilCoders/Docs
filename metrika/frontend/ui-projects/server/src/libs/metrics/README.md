# Metrics collector

Пакет предостваляет набор классов для сбора метрик. Для отделения функции сбора метрик от логики работы программы
реализованы декораторы, позволяющие измерять:

-   количество выполняющийхся в данный момент вызовов некоторой функции,
-   длительность ее вызова,
-   количество ошибок, возникающих при ее работе,
-   количество ее незавершенных вызовов. Для передачи метрик в сервис агрегации метрик Solomon реализован контроллер,
    реализующий [Pull API Solomon](https://wiki.yandex-team.ru/solomon/fastguide/#pull).

## Использование

1. Необходимо создать в сервисе синглтон реестра метрик `MetricsRegistry`: он будет использоваться для создания метрик
   (интерфейс `MetricsFactory`) и для передачи метрик в контроллер для их последующей отправки (интерфейс
   `MetricsSource`). Для реестра, который должен использоваться по умолчанию, необходимо вызвать метод
   `registerAsDefault`.
2. При импортах данного синглтона старайтесь ставить его на первое место, это поможет избежать неожиданное поведение
   регистрации метрик.
3. Необходимо создать провайдера для отправки накопленных метрик, например `SolomonProviderController`.
4. При использовании Solomon подключить контроллер к HTTP серверу.

### Пример создания и использования метрики:

```
const counter = metricsFactory.createCounter('call.count');
counter.add(1);
f();
```

### Пример использования декораторв:

```
// Указание префикса всех метрик класса
@Metrics('calls')
export class CallCreator {
    // Создание метрики `calls.active.count`
    @InvokeInProgressCount('active.count')
    public createCall() {
        // …
    }

    // Создание метрики `calls.terminal-request.count` с тегами
    @InvokeCounter({ name: 'terminal-request.count', tags: { key: 'value' } })
    public getTerminals() {
        // …
    }
}
```
