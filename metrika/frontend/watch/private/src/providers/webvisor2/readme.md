# Webvisor 2.5

## Разработка

### Подготовка
Для того чтобы записывать локальные сессии при помощи девелоперского сервера нужно установить mongodb локально.
Инструкции могут быть найдены вот [тут](https://docs.mongodb.com/manual/administration/install-community/)
Также нужно скачать [https://github.yandex-team.ru/Metrika/frontend])(https://github.yandex-team.ru/Metrika/frontend)
Затем в папке в которую вы склонировали репозиторий frontend выполнить следующую команду:
```
cd packages/webvisor
npm install
npm run build player2
```
После этого вернитесь в репозиторий кода счётчика и в файле server/src/app/controllers/player/config.ts укажите путь к собранному скрипту плеера.

### Запуск
Для того чтобы записать визиты вам потребуется сначала запустить прокси в режиме для его записи.
```
npm run proxy:webvisor
```
Эта команда поднимет прокси, но вместо отдачи скриптов напрямую будет проксировать часть трафика на локальный сервер разработки.
Собственно оттуда она будет забирать watch.js и tag.js, также запросы на mc.yandex.ru будут проксироваться на локальный сервер,
что и позволит записывать визор.
Следующим действием вам потредуется запустить сам сервер в режиме записи вэбвизора. Это тоже делается довольно просто:
```
cd server
SAVE_VISOR=1 npm run start -- --http
```
После проделанных операций можете смело приступать к разработке так, будто вы работаете просто с кодом счётчика.

### Просмотр записанных визитов
Список записанных визитов представлен по адресу localhost:3030/visits
