# Интеграционные тесты метрики

## Что используется
Тесты пишутся с использованием hermione. Подробнее можно посмотреть в гитхабе https://github.com/gemini-testing/hermione
Тесты работают с nodejs 8+

## Как запустить тесты локально
Существует два способа.
При использовании первого способа мы работает из корня всего проекта frontend
- Собрать проект
- Для запуска всех тестов используем команду: `npx lerna run hermione -- --scope=metrika-bem`
- Для запуска какого-то конкретного теста: `npx lerna run hermione ./tests/ft/e2e/test-name.js -- --scope=metrika-bem`

### Запуск тестов
При написании тестов удобно использовать локальный грид, т.к. это позволяет видеть логи селениума.
Для локального запуска нужно поднять грид:
`npx lerna run standalone  -- --scope=metrika-bem`

После этого можно запускать тесты:
`npx lerna run hermione  -- --scope=metrika-bem`

Для запуска тестов в гриде яндекса нужно в переменные окружения прописать адроес грида:
`GRID_URL={your.grid/url} npx lerna run hermione -- --scope=metrika-bem`
Или добавить переменную в .bashrc

Все команды, расположенные ниже, можно выполнять как для локального запуска, так и для запуска в гриде яндекса.

Запустить тест по имени:
`npx lerna run hermione -- --scope=metrika-bem -- --grep='Создание счетчика'`

По умолчанию тесты запускаются на ТС. Чтобы запустить на бете, нужно указать бету через переменные окружения:
`BETA_URL=https://your-beta.auto-beta.mtrs.yandex.ru npx lerna run hermione -- --scope=metrika-bem`

Количество перезапусков упавших тестов также задается через переменные окружения:
`RETRY=3 npx lerna run hermione -- --scope=metrika-bem`

Запустить тесты в headless режиме:
`HEADLESS=true npx lerna run hermione -- --scope=metrika-bem`

## Планы
За планами можно следить тут: https://st.yandex-team.ru/METRIQA-2265
Ближайшие планы:
- Добаление api-степов (нужна помощь)
- Покрытие регрессии ПС
- Покрытие регрессии ТС (что нельзя отдать асессорам)
- Добавление сравнения компонентов




