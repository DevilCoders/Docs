# assessor-proxy

Прокси сервер для тестирования асессорами кода счетчика

### Плагин

Находится в папке **plugin**. Без сборки не работает.

Для сборки ``npm run build:plugin``. После сборки появится папка ``./plugin/build``, теперь плагин готов к работе.
Во время сборки основной код формы копируется и вставляется в плагин, с помощью небольшого скрипта ``buildPlugin.js``

Установка плагина:
- Скачать папку ``plugin`` как есть (главное чтобы в ней была папка build)
- Перейти в раздел расширений, например в Яндекс.Браузере ``browser://extensions/``
- Включить режим разработчика и нажать "Загрузить распакованное расширение"
- Само расширение появится в списке расширений
- Красный квадрат (выключено), Зеленый квадрат (включено). Вкл/выкл нажатием на иконку
- После вкл/выкл перезагружать страницу
- Держать включенным опасно (выключается CSP на всех сайтах)

В разных браузерах плагины устанавливаются по-разному. В основном все гуглится.

Работает: YaBro, Chrome, Edge, Firefox, Opera

Не работает: Safari (там нельзя отключить CSP средствами плагинов, бесполезно делать отдельный плагин)

В некоторых браузерах, некоторые сайты блокируют работу плагинов.

Например YaBro блокирует плагины на zen.yandex.ru, а Firefox блокирует главные страницы yandex и google

Если данный плагин не работает, проверьте, работают ли на этом сайте другие плагины.

### Использование
Пока доступен во внутренней сети.

Для запуска необходимо в настройках сети указать **Веб-прокси (HTTP)** и **Защищенный веб-прокси (HTTPS)** на **80** порту

``testing.asessors-proxy.metrika-qa.stable.qloud-d.yandex.net``

После первого запуска нужно установить сертификат
- Заходим на http://mitm.it
- Скачиваем сертификат
- Устанавливаем сертификат по инструкции

### Разработка
Для запуска необходимо в настройках сети указать **Веб-прокси (HTTP)** и **Защищенный веб-прокси (HTTPS)** ``127.0.0.1`` на **8888** порту
- Запускаем прокси и включаем вотчер - `npm start`

После первого запуска также нужно установить сертификат с http://mitm.it
<br>
Во всех документах с типом **text/html** вставляется скрипт перед закрывающим тегом body, который собирается в папке build.

### Сборка и выкладка
Для диплоя нужен **docker**, с доступом к **registry.yandex.net**.
<br>
О том как получить доступ написано здесь → https://wiki.yandex-team.ru/qloud/docker-registry/#authorization

Проект живёт в qloud - https://platform.yandex-team.ru/projects/metrika-qa/asessors-proxy/testing

- Билдим образ - `npm run build`
- Запушим в registry - `npm run push`
- После пуша необходимо зайти на https://platform.yandex-team.ru/projects/metrika-qa/asessors-proxy/testing и нажать на Update
