# KeyCapture

Source: [lib/recorder/key_capture.js](../lib/recorder/key_capture.js)

## Описание

KeyCapture – библиотека для захвата сочетаний клавиш. В отличие от других библиотек эта не требует указания конкретных сочетаний для записи, а пытается определять их на лету.

### Особенности

Есть ряд особенностей продиктованных различными ограничениями браузеров:

* <kbd>Win</kbd> клавиша, так же как и <kbd>Command</kbd> не всегда записываются так как часто являются частью глобальных комбинаций и не передаются в браузер
* Нет адекватной возможности определять активность <kbd>CapsLock</kbd> по причине того, что доступ к свойству, отвечающиму за индикацию доступен только внутри клавиатурных событий
* Библиотека не записывает сочетания <kbd>Shift + ...</kbd> внутри текстовых полей по причине избыточности
* Библиотека не записывает нажатые и удерживаемые сочетания по причине того, что невозможно корректно отследить когда сочетание было отпущено полностью. Фиксируется только первое нажатие.

## Методы

* `constructor(elementSelector)` – принимает CSS селектор или экземпляр HTMLNode, комбинации будут отслеживаться внутри выбранного элемента
* `.onCapture(function callback(keyStroke))` – подписка на получение комбинаций
* `.offCapture(function callback(keyStroke))` – отписка от получение комбинаций
* `.addElementFilter(function callback(targetElement))` – функция фильтрации элементов, если `callback` возвращает `false` то комбинация внутри элемента прочитана не будет
* `.destroy()` – деструктор класса, удаляет события, фильтры, все незавершенные комбинации будут проигнорированы

## Клавиши-модификаторы

| ID  | Type      | Browser | Description
| :-: | :-------- | :------ | :----------
| 91  | super     | chrome  | Левый Win/Command
| 93  | super     | chrome  | Правый Win/Command
| 224 | super     | firefox | Оба Win/Command
| 18  | alt       | все     |
| 17  | ctrl      | все     |
| 16  | shift     | все     |
| 9   | tab       | все     |
| 8   | backspace | все     |
| 46  | delete    | все     |

## Как пользоваться

### Комбинации

Библиотека представляет из себя класс с конструктором не принимающим никаких начальных аргументов. Инициализация сводится к простому вызову конструктора:

```javascript
const keyCapture = new KeyCapture
```

После инициализации можно подписаться на получение сочетаний. Библиотека отправляет комбинации в момент нажатия клавиши при наличии уже нажатой клавиши-модификатора.

```javascript
keyCapture.onCapture(function callback(keyStroke){
  console.log(keyStroke)
})
```

`keyStroke` – массив клавиш комбинации, каждый элемент массива имеет следующую структуру:

```
id        – Integer, идентификатор клавиши (KeyboardEvent::keyCode)
key       – String, символ клавиши по словарю, либо полученный с помощью String.fromCharCode(id)
isMeta    – Boolean, является ли клавиша клавишей-модификатором
modifier  – String, тип модификатора
```

### Фильтры

Библиотека позволяет подключать кастомные фильтры для контроля над тем, внутри каких элементов страницы комбинации будут записаны. В примере ниже комбинации будут записаны для всех элементов страницы кроме полей ввода пароля.

```javascript
keyCapture.addElementFilter(function(htmlElement){
  if(htmlElement.nodeName === 'INPUT' && htmlElement.type === 'password'){
    return false
  } else {
    return true
  }
})
