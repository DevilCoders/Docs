# Сборщик

Сборщик представляет из себя таск-раннер и набор конфигов.

## Компиляторы

Компиляторы это небольшие (обычно) скрипты, реализующие функционал сборщика. На данный момент доступны следующие компиляторы:

- clean – компилятор, который умеет удалять указанные файлы
- copy – компилятор, который умеет копировать файлы
- decomment – компилятор, удаляющий комментарии в коде
- default – компилятор по умолчанию, если не указан иной, не делает ничего
- stylus – компилятор, который обрабатывает файлы `*.styl` (Stylus является стандартом для Вебвизора)
- svgstore – компилятор, умеющий собирать svg файлы (склеивание, сжатие, очистка файлов от лишнего мусора)
- webpack – компилятор, который использует webpack для сборки js-бандлов

## Конфиги

Конфиги это js файлы, содержащие настройки для компиляторов. Название конфига является названием соответствующего таска сборщика.

На данный момент доступны следующие таски-конфиги:

- build-clean – таск отвечает за очистку директории /build
- copy-extension-manifest – копирует manifest.json, вызывается только из таска extension
- css – занимается сборкой всех css файлов
- decomment – удаляет комментарии в указанных файлах
- extension – собирает браузерное расширение для отладки
- player-ui – собирает UI плеера вебвизора
- playlist – собирает плейлист (для локального тестирования Вебвизора)
- preview – собирает скрипты из папки /dev/client/javascripts/preview
- recorder – собирает Recorder (модуль счетчика)
- svg – собирает SVG файлы для интерфейса плеера
- ym – делает сборку для метрики (счетчик, плеер, цсс, свг, убирает комментарии)

### Устройство конфига
Конфиг является js-модулем и экспортирует (через интерфейс `module.exports`) несколько объектов настроек:

- type – используется для явного указания компилятора. Компилятор будет неявно определен в случае указания в качестве одного из параметров конфига имени компилятора. Например `exports.webpack = {}` будет указывать на то, что используется компилятор webpack, в этом случае указание `type` необязательно.
- entry – обычно входной файлы (или файлы), поддерживает glob шаблоны
- dest – путь до конечной папки, куда будут сложены все файлы после обработки компиляторами
- runBefore – список тасков для запуска ПЕРЕД началом работы основного компилятора
- runAfter – список тасков для запуска ПОСЛЕ окончания работы основного компилятора
- options – дополнительные настройки для компилятора
- watch – список файлов или glob шаблон для отслеживания изменений. При каждом изменении одного или нескольких файлов из списка компилятор таска будет перезапущен. Во время работы компилятора изменения файлов не отслеживаются.

Таски из настроек `runBefore` и `runAfter` выполняются последовательно в том порядке, в котором указаны в списке. До полного завершения работы тасков из `runBefore` основной компилятор не запустится. При возникновении ошибки в одном или нескольких тасков из `runBefore` сборщик остановится, основной компилятор так же не будет запущен.

Основной компилятор таска указывается по имени этого компилятора или по настройке `type`. Например, в случе использования webpack, настройка будет такой:

```javascript
exports.webpack = {
  // ... standard webpack config ...
}
```

Примеры использования конфигов можно посмотреть в [builder/compile-config](../builder/compile-config)
Документация и список доступных настроек есть в папке каждого компилятора [builder/compile/compilers](../builder/compile/compilers)
