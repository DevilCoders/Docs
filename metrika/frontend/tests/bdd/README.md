## Подготовка к запуску
Для работы нужно установить переменную окружения TUS_TOKEN
Токен нужно, чтобы иметь возможность забирать тестовые данные пользователей.

[Документация TUS](https://wiki.yandex-team.ru/test-user-service/)

[Как получить токен](https://wiki.yandex-team.ru/test-user-service/#autentifikacija)

Также в переменные окружения необходимо прописать `VAULT_TOKEN` для походов в секретницу. Получить его можно тут: [Документация yav](https://vault-api.passport.yandex.net/docs/)

Нужно скачать сертификат `wget https://crls.yandex.net/YandexInternalRootCA.crt -O ~/.pki/nssdb/YandexInternalRootCA.crt`

Добавить его в переменные окружения
`echo 'export NODE_EXTRA_CA_CERTS=~/YandexInternalRootCA.crt' >> ~/.bashrc && source ~/.bashrc`

## Сборка и запуск
В корне проекта необходимо выполнить `npm run build` для сборки проекта.
Для запуска тестов необходимо выполнить команду `npm run test:appmetrica`.

### Запуск тестов по тегам
`npm run test:appmetrica -- --tags='@tagname'`

### Построение отчета
Выполняем команду `npm run generate-report`. После построения отчет откроется в браузере.

## Переменные окружения
`HEADLESS` - режим запуска браузера. По умолчанию `false`.
`TIMEOUT` - общий таймаут на выполнение теста. По умолчанию 30 секунд.
`LOG_ALL` - добавлять логи во все шаги. По умолчанию добавляются только в падения, значение `false`.
`BASE_APPMETRICA_URL` - URL на котором запускать проверки. По умолчанию тестинг `https://test.appmetrica.yandex.ru`. Важно: URL указывается без слеша на конце.
`BASE_APPMETRICA_API_URL` - URL API аппметрики. По умолчанию применяется URL ТС Аппметрики `http://test.api.appmetrica.metrika.yandex.net`
`WAIT_TIMEOUT` - таймаут ожидания доступности элемента. По умолчанию 5 секунд.
`CLICK_TIMEOUT` - таймаут ожидания элемента до клика. По умолчанию 2 секунды.
`TUS_TOKEN` - токен для похода за секретами пользователей. По умолчанию отсутствует.
`VAULT_TOKEN` - токен для похода в секретницу за OAuth токенами.

## Как устроен фреймворк
tbd

### Хуки Appmetrica
Хуки построены на тегах. Данные для хуков указывают комментарием к сценарию. Комментарий должен иметь подобный вид `{"appName": "PutToFolder"}` чтобы с ним можно было работать как с JSON.
На текущий момент имеется теги:
`@createApp` - по данному тегу перед выполнением теста создается приложение с именем, указанным в окисании сценария. После выполнения данное приложение удаляется.

## todo:
- Моки данных
- тестирование в разных браузерах
- Allure, когда поддержат 7 cucumber
- Тестирование локализации
