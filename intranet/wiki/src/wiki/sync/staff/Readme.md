Tl;Dr

Datasource - это репозиторий + фильтры для получения только нужных полей для определенной модели
RepositoryMapper - маппинг словаря, полученного из Datasource в локальную модель, как по pk локальной модели получить словарь из Datasource
MapperRegistry - реестр всех RepositoryMapper с привязкой к локальным моделям

Некоторые модели маппятся на одни и те же репозитории (Department и Group) - поэтому один Datasource может быть быть использован для нескольких RepositoryMapper

Полный синк проходит по связкам Datasource-RepositoryMapper -- это добавляет только новые модели, плюс может отключить SoftDelete. Полный синк забирает модели в порядке возрастания modified_at, с точки последнего изменения и пока не закончатся модели в выдаче. Если есть модель которую нельзя создать из-за отсутствующих ForeignKey, из мы строим дерево зависимостей и резолвим от детей к предкам (для этого как раз и нужен MapperRegistry)

GroupMembership может быть еще и удален. Поэтому для того чтобы убирать из групп есть еще и sync_membership - который получает локальный слепок, слепок из репозитория и применяет bulk_update.

Есть еще и вотчдог - пинговалка которая паникует если давно не было обновлений.

---

Подключение к проекту только после разовой проверки полной синхронизации:  

1. Добавить в селери-бит две таски
    {
        'task': 'wiki.sync_staff_models',
        'schedule': crontab(minute='*/4'),
    },

    {
        'task': 'wiki.sync_staff_membership',
        'schedule': crontab(minute=5, hour='3,18'),
    }, 

2. Заменить урл в джагглере на /ping_sync_staff

