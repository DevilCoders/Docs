# hr-tech-duty-robot

Робот для призыва в тикет текущего дежурного https://st.yandex-team.ru/STAFF-15703.

У робота должны быть права на редактирование комментария и тикета. Ошибки здесь: https://deploy.yandex-team.ru/stages/tools_staff_robots/logs.
В логах могут быть ошибки типа:
```
Issue update error Lack of permissions. Недостаточно прав для редактирования задачи. Для расширения прав в очереди GIFTS обратитесь к владельцу очереди:
Comment update error Lack of permissions. У вас нет прав на редактирование комментария.
```
Нужно запросить соответствующие права на робота.


# Как пользоваться
Пишем коммент как будто обращаемся к человеку и призываем robot-staff-duty. Можно отредактировать существующий комментария и призвать робота.
Робот найдет текущего дежурного по Staff и призовет его.
## Если нужно призвать дежурного не Staff back
В первой строке комментария пишем slug или id сервиса из абс, например:
```
team_ok
Посмотрите, плз
```
Можно через пробел уточнить какое именно дежурство нужно. Например, что нужен фронт:
```
staff front
глючит верстка
```
Сам текст комментария робот не изменяет.

# Создать тикет в очереди сервиса
Пишем коммент (или редактируем существующий) и призываем robot-staff-duty:
```
/ticket [очередь] [теги,через,зяпятую]
[Первая строка - титл будующего тикета]
[Последубщие строки - описание будующего тикета]
```
Если очередь не указана, то для TOOLSUP попытается найти очередь по ABC Service.
Если не указаны остальные строки, то скопирует из оригинального тикета.
Вместо /ticket можно написать /child, тогда новый тикет будет под-тикетом к текущему.

# Что делает сам
## Создает тикеты на дежурства
Для утвержденных в АБС смен создаются тикеты вида https://st.yandex-team.ru/STAFF-16574, на 7 дней вперед.
Настройки тут: https://a.yandex-team.ru/arcadia/intranet/hr-tech-duty-robot/src/create_duty_log.py#L15.

## Возвращает TOOLSUP тикеты на саппорт, когда все привязанные тикеты на сервис закрыты
Тикеты в очереди TOOLSUP на сервис Стафф(303) в состоянии "на стороне сервиса" возвращаются в состояние "на стороне саппорта" когда закрыты прилинкованные тикеты в очереди STAFF.
Права запрашивались в рамках TOOLSUP-108350.

## Кидает в текущий спринт баги по фильтру
Для ZBP стафф полезно кидать в текущий спринт баги приоритета медиум и выше. Такие баги сильно бьют по метрике, но не всегда удается быстро заметить, что они появились.
Робот проверяет запрос в стартреке и переносит баги в текущий спринт команды.
Настройки тут: https://a.yandex-team.ru/arcadia/intranet/hr-tech-duty-robot/src/gather_bugs.py#L8.
