# Процесс Контроля Диффов Сети

## Что это за процесс

### Что такое Diff

Diff (дифф) - это информация о различии конфигурации на устройстве с "правильной" конфигурацией устройства. Целевым местом генерацией
"правильной" (эталонной) конфигурации является система Аннушка.

### Откуда берутся Diff на сети?

Важно понимать откуда вообще появляются диффы на сети:
- Изменения генератора Аннушки
- Изменения тегов RT (Rackcode)
- Обновления софта
- Логика работы CLI устройтсва

### Цель процесса

Наши основные цели:
- **получить предсказуемую сеть**
- **снизить нагрузку на эксплуатацию сети**

Наши основные задачи:
- **массово автоматически выкатывать изменения конфигурации на сеть**
- **обеспечить безопасность массовой выкатки изменения на сеть**

Процесс включает в себя следующие процессы/документы:
- High Level Design (HLD) и процесс его обновления
- Low Level Design (LLD) и процесс его обновления
- Тестирование
- Генератор конфигурации
- Применение конфигурации на устройстве
- Отчеты с изменениями (Diff Reports)

### Инструментарий

На текущий момент в процессе участвуют следующий системы в процессе:
- Аннушка
- Racktables
- Network Element
- CK
- <UI:Чекиста>

Схема основных компонент процесса.
![Схема компонент процесса](./images/img1.jpg)

### Схема взаимодействия компонент



#### Аннушка

Аннушка хранит генераторы и логику генерации конфигурации оборудования. Конфигурация, сгенерированная Аннушкой из
ветки master, является целевой.

#### Racktables

Система инвентарной информации об устройстве.

#### Network Element

Сетевой элемент, с которого берется конфигурация и затем сравнивается реальная конфигурация устройства с ожидаемой.

#### UI:Чекиста

Рабочим местом проведения массовых автоматических изменений на сети является [UI:ChK](https://noc.yandex-team.ru/).

Полноценная пользовательская документация лежит тут: [Документация](https://docs.yandex-team.ru/nocdoc/utils/404)

## Процедура тестирования Safe Acl

Прежде чем проводить массовые изменения по любому генератору его надо тестировать. Это происходит в полуавтоматическом/полуручном
режиме.

**Когда проводим тестирование**: по средам в 11:00.

### Как проводить тестирование

Шаг 1.

## Классификация Reports

### Report Kind

### Report Type

### Report Diff

## Классификация генераторов

### Critical - по критичности

**Описание**: Классификация diff по критичности его влияния на продуктивный трафик. Чем меньше число приоритета - тем быстрее надо исправлять.

**Зачем это классификатор**. Для фокусировки ресурсов эксплуатации на выполнение работ по снижению diff на сети.

**Согласующий за назначение классификатора**: Руководитель службы NOC.

**Типы классификатора (тэг - приоритет)**:
1.1. Major - 1
1.2. Minor - 2
1.3. Nice to have - 3

### Impact - по влиянию на сервис

**Описание**: Классификация diff по влиянию на форвардинг трафика.

**Зачем нужен этот классификатор**: Для определения когда можно проводить работы по этому классификатору: в любое время/с выводом трафика с оборудования/только во время регламентных работ.

**Согласующий за назначение классификатора**: Руководитель службы эксплуатации/Эксперт эксплуатации.

**Типы классификатора**:
- No-impact - без влияния на форвардинг
- With-impact - с влиянием на форвардинг
  - With-impact-reboot - с влиянием на форвардинг, с перезагрузкой устройства
  - With-impact-no-reboot - с влиянием на форвардинг, без перезагрузки устройства

### Duration - время выполнения

**Описание**: Удельная оценка времени на проведение работы.

**Зачем этот классификатор**: Для оценки времени проведения работы

**Согласующий**: Руководитель службы эксплуатации.

**Типы классифиатора**:
- 0 min
- 15/30/45/60 min
- 1/2/3/4 h
- 0,5/1/2/3/4 d

### Complexity - по сложности проведения работ

**Описание**: Сложность проведения работы. Чем выше вес, тем сложнее работа.

**Согласующий за назначение классификатора**: Руководитель службы эксплуатации/Эксперт эксплуатации.

**Типы классификатора (тэг - вес)**:
- God - 4
- Hidh - 3
- Medium - 2
- Low - 1

### Automatic

**Описание**: Возможно ли проведение работ автоматически.

**Зачем нужен этот классификатор**. Чтобы вешать его на те генераторы, по которым мы можем работать автоматически, например, desctiption и др.

**Согласующий за назначение классификатора**: Руководитель службы эксплуатации.

**Типы классификатора**:
- True
- False

## Метрики процесса

1. Должно расти Automatic diff. Как отслеживать - график за две недели.
2. Должно снижаться количество Major diff. Как отслеживать - график за две недели.
3. Снизить количество новых diff на оборудовании. Как отслеживать - график или отчет за 2 недели со списком железа на которых diff был равен нулю, а стал не равен нулю.

## Что еще стоит обдумать

1. Ввести понятие stable generator. Критерий для его определения - генератор в Аннушке не меняется 14 дней. Проверки проводить только по stable generator.
2. Сделать дашбоард с производной появления новых diff на оборудовании. Цель -
3. Добавить в ЧК версию генератора, например, по номеру commit в master Аннушки.

## Классификация генераторов в Аннушке

### Major Gen

