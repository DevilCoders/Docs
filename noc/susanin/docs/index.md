# Что это за сервис

**Susanin** - сервис управления межДЦ трафиком.

**Susanin** состоит из 4 параллельно живущих компонентов:
1. [**Collector**](#collector) занимается сбором и обогащением топологии и отгрузкой результата в ZK
1. [**Calculator**](#calculator) занимается расчётом путей на основе топологии и отгрузкой их в виде снапшота в ZK
1. [**API**](#api) предоставляет доступ к просмотру снапшотов, их аппруву и доступ к снапшотам для раздачи конфигурации аннушкой
1. [**Distributor**](#distributor) занимается распростронением настроек путей из последнего аппрувнутого снапшота.

Верхнеуровневая схема взаимодествия представляет из себя:

![картинка](images/hld.svg)

## Collector

`Collector` устанавливает BGP-LS сессии с несколькими пирами (для отказоустойчивости), указанными в конфиг файле. Они отправляют свою `Link State Database` (`LSDB`) с помощью серии BGP Update, в которых передается информация по узлам, линкам и префиксам. `Collector` собирается эту информацию, дополняет её информацией полученно из RT и сохраняет итоговую топологию в виде одного json объекта в ZK:

{% cut "JSON-схема топологии" %}

{% code 'noc/susanin/example/topology-schema.json' lang='json' %}

{% endcut %}

Инстансы самого коллектора независимо собирают и сохраняют топологию в ZK. Т.о. та версия топологии, которая будет залита последней будет считаться самой актуальной и именно она будет использована для расчётов.

## Calculator

`Calculator` забирает топологию, собранную [**Collector'ом**](#collector), _забирает настройки, забирает информацию по трафик_ (пока не реализовано) и рассчитывает пути для трафика. _Результат складывает в снапшоты для проверки в первом приближении человека, а во втором тестирует и проверяется неким валидатором_ (пока не реализовано).

{% cut "JSON-схема снапшота" %}

{% code 'noc/susanin/example/snapshot-schema.json' lang='json' %}

{% endcut %}

## API

## Distributor
