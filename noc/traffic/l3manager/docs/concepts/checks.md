# Проверка рилов

L3 manager регулярно проверяет доступность ваших рилов, отправляя запросы на [указанный вами url](config-settings.md#section_odv_rlf_sfb). Если рилы виртуального сервиса перестают корректно отвечать на проверочные запросы, L3 manager обозначает рилы как недоступные и перенаправляет пользовательский трафик на другие рилы виртуального сервера или снимает сервис с [анонса в сети](statuses.md).

Проверочные запросы используются для:

- Мониторинга доступности рилов.
- Получения динамических весов рила.
- Отправки приложению текущего веса и статуса рилов.

## Доступность рилов {#rs-checks}

L3 балансеры отправляют запросы о состоянии сервиса на url, указанный вами в параметре [CHECK_URL](config-settings.md#check-url) на этапе создания виртуального сервера. Эти запросы содержат информацию об известном статусе активности рила и [весе рила](#weigths).

Если рил не отвечает на запросы или отправляет данные, которые не соответствуют указанным в параметре [CHECK_RESULT](config-settings.md#check-result), рил будет считаться недоступным.

Свойства запроса при проверке доступности:
- Время ожидания ответа — 1 секунда.
- Количество повторных попыток — 1.

Если вам необходимо увеличить время ожидания ответа, напишите [команде L3](mailto:slb@yandex-team.ru).

## Веса рилов {#weigths}

Рилы виртуального сервера могу иметь различные веса. Вес рила — это относительный коэффициент ресурсов сервера, который учитывается при распределении пользовательского трафика. Рилы с большим весом получают больше пользовательских сессий.

Веса могут быть как заданы изначально, так и изменяться динамически в процессе работы рилов:

- Статические веса задаются при создании [списка рилов](config-settings.md#section_lkx_rlf_sfb) или при помощи кнопки **Edit RS** на странице конфигурации вашего сервиса.
- Динамические веса рилов настраиваются при помощи параметров [ DYNAMICWEGHT](config-settings.md#dinamicweight) и [WEIGHT_IN_HEADER](config-settings.md#weight-in-header) при создании виртуального сервера и передаются в ответах на проверки доступности рилов.

При использовании динамических весов L3 manager передает:
- Текущий статус активности в заголовке `X-RS-Alive: <статус рила>`:
    - `1` — рил активен.
    - `0` — рил неактивен.
    
- Текущий вес рила в заголовке `X-RS-Weight: <вес рила>`.

## Пример запроса {#section_hs5_g2w_tfb}

```
GET /ping HTTP/1.0
User-Agent: KeepAliveClient
Host: %s%s
X-RS-Weight: 5
X-RS-Alive: 1
```

Запрос от L3 manager содержит информацию: 
- Текущий вес рила — 5.
- Текущий статус рила — доступен.

## Пример ответа {#section_qv3_h2w_tfb}

```
HTTP/1.1 200 OK
...
RS-Weight: 6
```

Ответ от приложения содержит информацию:

- Рил доступен.
- Рилу необходимо назначить динамический вес 6.

