# Matchers (Матчеры)
Александрия оперирует понятием Matcher(Матчер).  

**Matcher** - это сущность, являющаяся элементом упорядоченного списка и определяющая группу устройств или группу моделей устройств согласно критериям(далее фильтрам).  
По сути, Матчеры разделяют объекты из запроса на однотипные подмножества.

Близкими сущностями к Matcher являются "Match" и "Soft".  
**Matcher** определяет группу устройств согласно фильтрам  
**Match**   определяет соответствие этой группы конкретному релизу ПО (Soft) 

По сути, Match - это таблица соответствия Matcher и SoftID. "Matcher" можно перевести с английского как "сопоставитель", но реальным сопоставителем здесь является сущность Match.

**Soft** - это набор информации о конкретном релизе ПО, включая версию, образ, ссылку на архив.

### Фильтры (критерии определения группы)
Близкой аналогией Matcher'у является ACL. Только группа узлов определяется(фильтруется) не комбинацией _IPsubnet+L4port_, а с помощью:
* Набора тегов Racktables (**rack_codes**). 
  * Для запросов на основе RT_ObjectID и FQDN.
* Регулярного выражения модели устройства (**model_re**). 
  * Для запросов на основе моделей шасси(PID).

Данные фильтры взаимно исключают друг друга. Matcher определён либо с помощью rack_code, либо с помощью model_re.  

{% note info %}

По аналогии с ACL, в списке Matchers важен порядок перечисляемых фильтров. Выбирается первый подходящий Матчер и обработка останавливается(First Match).  
Более специфичный набор тегов, как правило, располагается в начале списка.

{% endnote %}

### Категории
Существует 3 параллельные категории Матчеров:
* **recommended**. Указывает на эталонную версию ПО для группы узлов (на данный момент)
* **dangerous**. Указывает на нежелательную версию ПО, которую надо сменить в срочном порядке
* **default**. (?)Указывает на допустимую версию ПО

Матчеры в разных категориях не влияют друг на друга, в том числе в нумерации правил.

### Формат и структура
Список Матчеров хранится в базе данных MySQL Racktables:  
```
show columns from Matcher;
```
| Field        | Type         | Null | Key | Default | Extra |
|---|---|---|---|---|---|
| id           | char(36)     | NO   | PRI | NULL    |       |
| category_id  | int(11)      | NO   | MUL | NULL    |       |
| model_re     | varchar(255) | YES  |     | NULL    |       |
| rack_code    | varchar(255) | YES  |     | NULL    |       |
| order_number | int(11)      | NO   | UNI | NULL    |       |

