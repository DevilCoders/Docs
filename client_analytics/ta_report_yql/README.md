# Шаблон yql-запроса для анализа поисковых запросов

Исходные данные для отчетов про подсвеченное в текстах и провалы в релевантности.

**Фильтры для сверки с отчетами Директа:**
- Тип условия показа: фразы
- Тип кампании: Текстово-графические объявления
- Тип площадки: Поиск (target_type 0)
- Название площадки: Яндекс
- Статус кампании: активные

Открутки в валюте логина без учета НДС.

## Отчет "Поисковые запросы" своими руками

Для больших логинов (от 100К пар запрос-фраза) может быть быстрее и удобней посчитать отчет самостоятельно.

[Пример запроса](https://yql.yandex-team.ru/Operations/XAUZ8To4QQPPsfPJ3NwMkaGfWsWXzSCIEs-7kCswjqI=)
- Обязательно поменять:
  - `$TASK_AUTHOR_LOGIN`
  - `$YT_TASK_FOLDER`
  - `$LOGINS`
- Опционально:
  - `$YT_BASE_PATH`
  - `$CAMPAIGN_IDS_WL`

Путь с результатами определен как `$YT_BASE_PATH` + `$YT_TASK_FOLDER` + `search_queries.data`. В примере получается: `//tmp/ta_report/TTT-1/search_queries.data`.

Схема сборки:
1. Скачать с YT `search_queries.data` как schemaful DSV. Все столбцы, с заменой отсутствующих значений на `null`.
1. Переименовать файл в `loginname_RUB_1970-01-01_1970-01-01_search_queries.tsv`
1. Упаковать и сжать как `tar -Pzcvf loginname_RUB_1970-01-01_1970-01-01.tar.gz loginname_RUB_1970-01-01_1970-01-01_search_queries.tsv`
1. Установить и запустить ta-report (ver. 0.19+): `ta-report search_queries --lang=ru`
