Metrika Related ids
===================

> Николай Иванович Вавилов -- русский и советский учёный-генетик, ботаник, селекционер, химик, географ, общественный и государственный деятель.
> Обосновал учение об иммунитете растений, открыл закон гомологических рядов в наследственной изменчивости организмов.

Дифф склейки с перепосылкой изменившихся идентификаторов.

Нам нужно две вещи:

Топик от крипты в формате (Id, IdType, NewRelatedIds, Version), где NewRelatedIds – новый список связанных (Id, IdType), либо пустой список для удаления строки. Обсудили, что в виде Version можно брать UpdateTimestamp. Топик – основной способ обновления данных. То есть на стороне крипты нужно все изменения таблицы проклейки заливать в этот топик.
Пример: допустим, была группа пользователей, связанных одним CryptaID: 1, 2, 3, 4. Предположим, что пользователь 1 от нее отвязался и стал связан с пользователем 5. Тогда в топике должны появиться такие строки:

    (ID) 1 -> (NewRelatedIDs) 5
    (ID) 5 -> (NewRelatedIDs) 1
    (ID) 2 -> (NewRelatedIDs) 3, 4
    (ID) 3 -> (NewRelatedIDs) 2, 4
    (ID) 4 -> (NewRelatedIDs) 2, 3

То есть, для каждого ID в топик залилась самая актуальная версия
Каждый день доступ к полной таблице проклейки. Сейчас у нас есть вот такой запрос   paste.yandex-team.ru/6192841. Он переналивает таблицу маппинга yandexuid -> related yandexuids на основе данных из home/crypta/public/matching/by_id/crypta_id/yandexuid. Мы хотим модифицировать этот запрос, чтобы он сравнивал состояние нашей таблицы проклейки и актуальной. То есть раз в сутки мы будем бэкапить нашу таблицу, строить дифф с актуальной таблицей крипты и обновлять строчки, которые отличаются, если они не были обновлены после бэкапа через топик. Этот механизм позволит нам синхронизировать таблицу крипты и нашу таблицу, в случае если что-то пошло не так. Здесь нас устроит любой формат таблицы, по которому мы можем адекватным способом построить связи id -> related ids.

Нас интересуют следующие идентификаторы:

    Yandexuid
    DeviceID: deviceId, gaid, idfa, oaid, uuid
    Hash(Email)
    Hash(phone)
