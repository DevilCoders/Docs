## Автотесты

### Структура unit-тестов
* Стараемся придерживаться подхода, аналогичного автоматической генерации тестов GoLand'ом. В идеале пользоваться им, заменяя и добавляя детали.
* Название тестовой функции должно включать имя структуры (если есть) и имя тестируемого метода: `Test_{typeName}_{methodName}`.
* Используем табличный подход. Это означает, что тесткейсы должны быть описаны в виде массива. В каждом кейсе содержатся:
  * название, отражающее суть кейса;
  * аргументы для формирования структуры и вызова тетсируемого метода;
  * ожидаемый результат.
* Тесткейсы запускаем через subtests: `t.Run(tt.name, func(t *testing.T) { ... } `.
* Проверяем результат работы метода с помощью библиотеки `testify`.
* Используем моки, сгенерированные с помощью `gomock`, для имитации методов интерфейсов. 
* Пишем тесты на все методы, которые содержат изолированную логику, в т.ч. приватные.
* [Пример хорошего файла с тестами](https://a.yandex-team.ru/arc_vcs/portal/avocado/libs/utils/requests/parser_test.go?rev=r9099685)

### Библиотека testify
* Используем бибилиотеку `testify` для всех assert/require/suite.
* С помощью `require` проверяем условия, невыполнение которых делает невозможным дальнейшие проверки. В остальных случаях используем `assert`.

### Моки с помощью gomock
* Используем библиотеку gomock для генерации моков
* Генерации моков прописываем в файле generate.go в конкретном пакете. [Пример](https://a.yandex-team.ru/arc_vcs/portal/avocado/libs/utils/requests/generate.go?rev=r9050172)
* Приватные интерфейсы должны порождать мок в файл {filename}_mock_test.go
* Публичные интерфейсы должны порождать мок в папку ./mocks

### Всегда пишем тесты на `apphost handlers`
* При добавлении нового `apphost handler` всегда пишем на него тесты
* Такие тесты могут мокать только apphost.Context или нашу прослойку над ним
* Этими тестами мы фиксируем поведение нашего хендлера в разных ситуациях, что позволяет разрабатывать код на локальной машине
* Такой подход позволяет удобно переиспользовать тесткейсы других разработчиков для проверки данного хендлера

### Smoke тесты
* Smoke тесты не проверяют тело ответа
* Обычно проверяем статус ответа и его заголовки
* Директория для таких тестов находится [тут portal/avocado/tests/smoke](https://a.yandex-team.ru/arc/trunk/arcadia/portal/avocado/tests/smoke)
* Пишем такие тесты с использованием testSuite

### Тест-кейсы
* Если применимо, старемся использовать для тестирования данные из реальных пользовательских запросов, по крайней мере в части кейсов.
[Пример тест-кейса](https://a.yandex-team.ru/arc_vcs/portal/avocado/libs/utils/requests/parser_test.go?rev=8c969d31933c9e6949e029bbbc4fcbc731459565#L165) 
