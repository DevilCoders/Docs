## Стайлгайд на хэндлеры

### Статичность
Хэндлеры должны быть статичными, т.е. должны создаваться единожды и обрабатывать сколь угодно много запросов.

В частности, хэндлер не может содержать в качестве полей какие-либо компоненты, значение которых зависит от запроса; все такие компоненты должны быть в контексте, который передается в хэндлер аргументом.

### Общий шаблон
Общий шаблон хэндлера - некоторый тип данных с особым методом, название которого имеет префикс `Serve`, в аргументах один или несколько контекстов, возвращаемое значение - ошибка. Контекст - некоторый тип данных, содержащий в себе актуальную информацию о запросе. Примеры соответствующих методов:
* Аппхостовый - `ServeApphost(ctx apphost.Context) error`, принимает аппхостовый контекст, в котором в особом формате представлена информация о grpc запросе в этот хэндлер
* Бейзовый - `ServeBase(ctx apphost.Context, baseCtx contexts.Base) error`, принимает оригинальный аппхостовый контекст, а также бейзовый контекст, который содержит множество компонент, вычисленных на основе исходного аппхостового контекста и, может, статических компонент.

### Преобразования контекстов
Контексты и их компоненты не должны встречаться в полях структур, разве что если эти структуры сами являются контекстами или частями контекстов.
Контекст не может быть обработан в теле того же хэндлера, в котором он был создан (хэндлер может собрать из переданных ему контекстов новые, но только для того, чтобы передать их аргументами в хранимый им иной хэндлер, принимающий соответствующие контексты (исключение - обработка ошибки сборки контекста, при которой может быть полезно использовать некоторые компоненты этого контекста, в частности, логгер); пример - бейз обертка из библиотеки `base`, аппхостовый хэндлер, который собирается из бейзового хэндлера (оборачивает его), и при обработке запроса (который представлен аппхостовым контекстом) собирает бейзовый контекст и передает оба контекста в обернутый бейзовый хэндлер).