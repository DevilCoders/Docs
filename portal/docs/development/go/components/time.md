# Библиотека time
Реализация в [a.yandex-team.ru/portal/avocado/libs/utils/time](https://a.yandex-team.ru/arc_vcs/portal/avocado/libs/utils/time)
Модель в [a.yandex-team.ru/portal/avocado/libs/utils/base/models](https://a.yandex-team.ru/arc_vcs/portal/avocado/libs/utils/base/models/time.go)
Модель предоставляется base контекстом посредством метода `GetTime() *models.TimeData`.

## Модель
[a.yandex-team.ru/portal/avocado/libs/utils/base/models](https://a.yandex-team.ru/arc_vcs/portal/avocado/libs/utils/base/models/time.go)

```go
type TimeData struct {
    HolidayInfo HolidayInfo
    HolidaysYTT HolidaysYTT
    MoscowTime  Time
    UserTime    Time
    UTCTime     Time
    IsManual    bool
}
```

```go
type Time = time.Time
```

```go
type HolidayInfo struct {
    Name      string
    IsHoliday bool
}
```

```go
type HolidaysYTT struct {
    Yesterday bool
    Today     bool
    Tomorrow  bool
}
```

По большей части соотносится с представлением времени в перле (почти все поля из перлового представления можно получить из этой модели, если чего-то нужного не хватает - можно попросить @jammer312 ее дополнить), но есть некоторые отличия (в секции ниже).

* `HolidayInfo` - праздник ли в этот день (с учетом геолокации пользователя) и его название
* `HolidaysYTT` - были ли праздники вчера, сегодня и завтра соответственно
* `IsManual` - было ли время переопределено (актуально для тестового окружения, где время можно задать через cgi параметры)

* `MoscowTime` - локальное время в Москве, может быть переопределено (`IsManual`)
* `UserTime` - локальное время в временной зоне пользователя, может быть переопределено (`IsManual`)
* `UTCTime` - время в UTC+0, не может быть переопределено (актуальное время получения запроса)

Время представлено типом `time.Time` из [стандартной библиотеки time](https://pkg.go.dev/time), для которого определены методы для получения различного представления, в том числе отдельных компонент (день, час, минута и т.д.), а также операций с ним (прибавление временных промежутков, получение разницы во времени).

Небольшой нюанс реализации: время в `go` представлено непосредственно моментом времени и настройками представления (есть еще параметры, но в данном случае они не существенны). Настройки представления - в том числе локация (временная зона), и они определяют результат выполнения методов получения представления (например, метод, возвращающий текущий час, будет давать разный результат в зависимости от выбранной временной зоны). Если время не переопределено (`IsManual`), то все три поля (`MoscowTime`, `UserTime` и `UTCTime`) задают один и тот же момент времени с разными настройками представления (если переопределено, то только два (`MoscowTime`, `UserTime`)). В частности, получение разницы в московском времени и глобальном `MoscowTime.Sub(UTCTime)` вернет нулевой временной промежуток, т.к. это один и тот же момент времени (пусть и в разных локациях), а не временной промежуток в 3 часа (т.к. временная зона для Москвы - UTC+3), как можно было бы предположить.

# Различия с перлом
1. `UTCTime` - актуальное время получения запроса в временной зоне UTC+0. В перле в соответствующей переменной лежит нечто очень странное (момент времени в московской временной зоне со сдвигом на 3 часа). Для получения перлового таймстампа можно сделать `UTCTime.Unix() - 3*60*60`.
2. День в году (метод `YearDay`) - в перле индексация начинается с 0, в го с 1 (первое января в го - 1ый день, в перле - 0ой). 

## Вспомогательные функции

[a.yandex-team.ru/portal/avocado/libs/utils/time](https://a.yandex-team.ru/arc_vcs/portal/avocado/libs/utils/time/format.go)

Для специфичного для перла представления времени строками реализованы вспомогательные функции:
* `AsYYYYMMDD(t Time) string`
* `AsYYYYMMDDHHMMSS(t Time) string`
* `AsHHMM(t Time) string`
* `AsISO(t Time) string`
