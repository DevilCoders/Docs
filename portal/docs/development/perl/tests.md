# Перловые тесты (perl tests)
*TeamCity* - билд-сервер для обеспечения непрерывной интеграции. Чтобы понять, что это такое, можно почитать [хабр](https://habr.com/ru/company/tinkoff/blog/532546/) или посмотреть этот [видос](https://www.youtube.com/watch?v=zqi4fDF-S60).

Перловые тесты **perl tests**, оформлены в сборку [`portal-morda-perl-tests`](https://teamcity.yandex-team.ru/buildConfiguration/PortalMordaXenial_PortalMordaPerlTests?mode=builds) проекта `portal-morda-xenial`.

На каждое изменение файлов в пуллреквесте, оканчивающихся на `.pm` или `.t`, автоматически запускается сборка стенда и прогон тестов на одном из свободных **build-агентов**. После прохождения/непрохождения тестов тимсити отправляет отчет в github.

## Как настраиваются
Перейдя на [главную страницу сборки](https://teamcity.yandex-team.ru/buildConfiguration/PortalMordaXenial_PortalMordaPerlTests?mode=builds), можно увидеть все прогоны тестов c сопутствующей информацией: на каком агенте происходил прогон, с правками из какой ветки, сколько тестов упало/прошло/пропущено, логи с ошибками и т.д.

![Team](../../images/portal-morda-perl-tests.png){: .center}

Чтобы настроить или увидеть конфигурацию сборки, нужно кликнуть на `Edit/View configuration...`. Если отображает `Vew...`, то у вас нет прав на редактирование, при необходимости, запросите у @core.

![Team](../../images/portal-morda-perl-tests-settings.png){: .center}

На этой странице отображены разделы настроек сборки, нас интересуют следующие:
- **General Settings** - основные настройки: имя сборки, тип и т.д.
- **Version Control Settings** - из какого репозитория брать исходный код (morda/main), а также из каких веток и дефолтная ветка (dev).
- **Build Steps** - здесь находится вся логика прогона тестов, оформленная в bash-скрипты, которые исполняются на build-агенте друг за другом.
- **Triggers** - условия для запуска процесса сборки. В нашем случае, прогон тестов нужен при изменении файликов, оканчивающихся на `.pm` и `.t`.
- **Dependencies** - зависимости от других сборок, в которых мы нуждаемся. В нашем случае - это `portal-morda-install-depends`.
- **Build Features** - здесь настроена отбивка о запуске/завершении тестов в пуллреквесте.
- **Agent Requirements** - требования к агентам, которые необходимы для нормальной сборки. В этом разделе можно увидеть список подходящих агентов. Для перловых тестов - это агенты с именем, начинающимся на `xenial-morda-build-1`. Они запущены на деве `v137`.
