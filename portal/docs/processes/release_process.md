# Процесс релизов в Морде
{% note tip "Дисклеймер" %}

Всё всегда обсуждаемо. Да, всегда могут быть исключения из-за больших и сложных задач, из-за внезапных дедлайнов, из-за большого количества багов ¯\\_(ツ)_/¯

{% endnote %}

{% note tip "Каналы связи" %}

* Telegram-чат ["Покатушки Морды"](https://t.me/joinchat/BlyRek7XrnZIJpDaD8C3kQ) 
* Telegram-чат ["Мордячий Мартичат"](https://t.me/joinchat/CEw0gU6DoUQfvHU9wtInsw)
* Telegram-чат ["Морда (факапочная)"](https://t.me/joinchat/BlyRekEwILp56Vu030x2gg)

{% endnote %}

## Общие правила
* Роль релиз-менеджеров выполняют дежурные тестировщики: они сигнализируют о начале приёмки и о готовности выкладки релиза в продакшн, принимают решение о докатках/ревертах тасков из релиза и т. д.
* Каждый менеджер несет ответственность за сроки выезда нужных им фич. Надо своевременно сообщать разработке и тестированию о сроках и дедлайнах.
* **Переводы обновляются в задачах, для которых нужны переводы, и через автоматический пул-реквест [ежедневно по инструкции](https://wiki.yandex-team.ru/morda/novyjj-process-relizov-v-morde/obnovlenie-perevodov/).**
* **По умолчанию релизы собираются автоматически ежедневно (кроме выходных) в 18:00. К 19:00 релиз уже должен быть собран, RC-стенды должны быть подняты.**
* **Релиз тестируется с 19:00 до 14:00 следующего дня.**
* С 14:00 до 18:30/19:00 тестировщики занимаются тестированием новых задач.
* С 18:30/19:00 тестировщики в приоритетном порядке переключаются на тестирование своих задач в релиз-кандидате.
* **Разработчики до 18:00 коммитят свои готовые задачи.**
* Если собранный автоматически релиз содержит в себе 1-3 небольших по объёму задачи, которые необязательно должны попасть в продакшн на следующий день, дежурный тестировщик вправе а) разрешить докатку не попавших в автосборку, но уже закоммиченных пул-реквестов или б) принять решение об отмене релиза. В этом случае на следующий день в 18:00 он просит дежурных разработчиков собрать новый релиз. 

{% endnote %}
## Cтандартное окно релизов, экспериментов и экспортов
* Ожидаемое время дежурного на рабочем месте с 11:00 до 20:00.
* Окно начала выкладки экспортов и экспериментов **под контролем дежурного** – с 12:00 до 19:30.
* Окно начала выкладки релиза с 12:00 до 18:00.
* Если релиз требуется выкатить в другой период времени, должна быть весомая причина: критичный хотфикс / высокие репутационные риски от невыкладки.
* Если до 18:00 релиз не покатили, но при этом он готов к выкладке в продакшн (о готовности релиза отписывается дежурный тестировщик в чате "Покатушки Морды"), то процесс выкладка откладывается до 12:00 следующего дня.
* Если выкладка не может закончиться до 18:00 из-за затянувшихся учений/регламентных работ, нужно настоять на том, чтобы эти учения/регламентные работы сходились в строго отведённое для них время.
* Окно выкладки экспортов **без дежурных** – с 11:00 до 20:00. После 20:00 и до 11:00 экспорты выкатываются в продакшн **только** в экстренных случаях (критичные баги продакшна, серьёзные репутационные риски от неверного показа или от отсутствия фичи).
* Менеджер / ответственный тестировщик / аналитик сам принимает решение, нужны ли ему дежурные для сопровождения выкладки экспортов в продакшн. Если есть сомнения в необходимости присутствия дежурных, нужно с ними проконсультироваться.
* Менеджер / ответственный тестировщик / аналитик в общем случае с помощью бота [Mrs. Norris](https://wiki.yandex-team.ru/morda/mrsnorris/) уведомляет дежурных в чате "Покатушки Морды" о том, что именно он собирается выкладывать в продакшн.

## Стопперы релиза
* учения;
* работы / авария в ДЦ;
* организационные фризы на релизы в компании (проведение важных мероприятий и т. д.).

Стопперы отмечены в [этом календаре](https://calendar.yandex-team.ru/embed/month?embed&private_token=46440d714afcb9394b6e4f5cb555b15ea5d37940&tz_id=Europe%2FMoscow&uid=1120000000000809) и [календаре плановых работ](https://calendar.yandex-team.ru/week?embed&layer_ids=32047&tz_id=Europe/Moscow). Не все плановые работы или учения являются блокерами, нужно уточнять у дежурных разработчиков или SRE Морды.

## Релизы-блокеры в Морде

Релиз считается блокером в том случае, если он содержит в себе таски, чьё появление в продакшне критически необходимо в ближайшее возможное время – хотфикс крупных багов (с приоритетами "Критичный" и "Блокер"), задачи с приоритетом "Блокер".

Релиз-блокер выкладывается в продакшн вне релизного окна (то есть после 18:00), при этом выкладка продолжается до тех пор, пока релиз не окажется в продакшне полностью.
Ввиду того, что команда Морды нацелена на минимизацию количества релизов–блокеров и на снижение уровня нагрузки и стресса на дежурных, каждый такой релиз разбирается на соответствующей [встрече](https://calendar.yandex-team.ru/event/60663438?applyToFuture=1&event_date=2021-12-16T14%3A00%3A00&isEditing=1&recurrenceAsOccurrence=1&uid=1120000000000809).

 
{% note alert %}

Интервал релиз-фриза – 1.5 часа до начала работ, учений (позднее, чем за 1.5 часа не начинаем катить).

{% endnote %}

## Как происходит релиз
* Взаимодействие менеджеров и тестировщиков происходит в чате "Что надо к выкладке".
* **При необходимости в 17:30 дежурный тестировщик призывает всех менеджеров узнать, готовы ли их задачи к релизу**.
* **В 18:00:00 стартует автосборка; дежурный разработчик следит за сборкой и если возникают ошибки – устраняет их.**
* (повтор)**Релиз тестируется с 19:00 до 14:00 следующего дня: дежурный тестировщик смотрит на фон ошибок в Кибане и ErrorBooster'е, разбирает отчёты по запускам регресса на асессоров; остальные тестировщики смотрят свои задачи.**
* Дежурный тестировщик пишет в чат "Покатушки Морды" сообщение о готовности релиза и его особенностях.
* Дежурные разработчики от бэкенда и фронтенда выкатывают релиз и следят за графиками.
* После выкатки (отката) релиза дежурный тестировщик заполняет необходимую в релизном таске информацию для [борды](https://st.yandex-team.ru/dashboard/32386).
