# yandex-portal-betas
Пакет-сборщик beta инстансов морды. Содержит в себе только рецепт приготовления пакетов.

## Отличия от продакшн-сборки
1. Запакована сконфигурированная морда
2. Используется локальная статика, а не yastatic

## Отличия от девов
1. Весь фронтенд собран, лишнее удалено
2. Используется фриз
3. Шаблоны тоже склеены в один большой index.js

## Сборка
Каждому бета-инстансу соответствует свой пакет, например yandex-portal-betas-instance-gamma-1-1 - это пакет для инстанса gamma,
который установится в /opt/www/morda-gamma.

Для указания собираемого инстанса нужно передавать в debuild env переменную **INSTANCE**:

`debuild --set-envvar INSTANCE=gamma`

Перед сборкой следует установить версию пакета:

`./fixversion 2017.12.12-0`

Сборка состоит из нескольких шагов
1. Клонирование конфигуратора. Можно указать ветку, передав env параметр **CONF_BRANCH** (по-умолчанию master)
2. Клонирование морды. Ветка выбирается аналогично, **MORDA_BRANCH** (по-умолчанию release)
3. Конфигурация фронтенда как дев.
4. Сборка фронтенда с YENV=builder
5. Удаление лишнего

## Автосборка в тимсити
https://teamcity.yandex-team.ru/viewType.html?buildTypeId=PortalMorda_PortalMordaFrontBeta

Эта сборка никогда не стартует автоматически.

Чтобы выкатить какую-нибудь ветку на какой-нибудь инстанс, нужно запустить эту сборку, указав в параметрах нужный инстанс и ветку.

Версия пакета будет равна `YYYY.MM.DD-<номер сборки>`

После сборки будет создан тикет в кондукторе, затем кондуктор поставит собранный пакет на бету.


