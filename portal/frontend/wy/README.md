# Виджеты wy

## Разработка

машина dev.xscript.yandex.net
инстансы разработки в /opt/www/wy-*, * - имя соответствующего инстанса морды
конфиги nginx генерируются конфигуратором с параметром -m wy (это выполнять на dev.xscript.yandex.net)
` $ sudo ./configurator.pl -m wy -d <имя_инстанса> ` 

## Настройка инстанса морды

1. Инстанс нужно сконфигурировать с флагом `wydev` (или `wyrc`, если нужно посмотреть на wy-rc)
2. Перезапустить `nginx`

## Релиз

```
npm run release
```

## Пример

Для тех кто недавно в проекте, немного более развернутое описание

Все основные правила указаны выше. Написаное ниже просто более развернутый пример.

//Задача - пофиксить виджет погоды, dev-инстанс `v45d0`.//

Теперь, на `dev.xscript.yandex.net/opt/www/` мы можем склонировать нужный репозиторий.
В моем случае понадобилось склонировать `morda/wy.git` в папку`./wy-v45d0`
Далее здесь же заходим в папку с конфигуратором
и выполняем `sudo ./configurator.pl -m wy -d v45d0`
Не забываем перезапустить nginx - `sudo /etc/init.d/nginx restart`

Далее нужно на dev машине прописать флаг `wydev` в nginx конфиге для нужного инстанса.
В папке с конфигуратором заходим в `./etc` и правим `configurator.conf`
Нам нужно найти в нем блок нашего инстанса.
В моем случае это `<Instance v45d0>...</Instance>` и в нем прописать флаг `wydev`.
Сохраняем изменения в файле. Натравливаем конфигуратор на нужный инстанс, перезапускаем nginx.

Все готово. Теперь идем на морду и смотрим, откуда запрашивается нужный файл (у меня это был `_weather.css`).
Если все прошло успешно, то он будет запрашиваться с `https://wy-<инстанс>.wf.yandex.ru/css/_weather.css`.
До этого он запрашивался с `yastatic.net`.

Все изменения в виджетах делаются в нужной папке на машине`dev.xscript.yandex.net`.
После правок, в этой же папке не забываем сделать `make`.

P.S. 1. Если в запросах видно, что файл запрашивается из нужного места, но к нему нет доступа, то пройдите по ссылке на файл и разрешите браузеру доступ к `wy-<инстанс>.wf.yandex.ru`.

P.S. 2. В примере `v45d0` указан просто для наглядности. Не забываем менять его на имя своего инстанса.
