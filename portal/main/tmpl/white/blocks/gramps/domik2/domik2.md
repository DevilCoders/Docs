## Домик ##

Состоит из нескольких частей:

* domik2. Блок, закреплённый в шапке. Имеет свёрнутое и развёрнутое состояние.
* dropdown. Выпадающий блок из статичного блока. Имеет несколько разновитдностей.
* notifications. Отвечает за генерацию нотификаций, используется domik2 и dropdown
* social. Отвечает за вёрстку соц-авторизации. Сама соц-авторизация работает через блок auth__social
* slider. Переключатель разных видов домика, если их нужно показывать (если домик один - то не используется).


### domik2 ###

Статичный блок. Имеет два основных модификатора:

* expanded. Отвечает за показ `dropdown`.
* logged. Авторизован ли пользователь.

### dropdown ###

Выпадающее меню из статичной части `domik2`. Бывает нескольких типов:

* login. Авторизация
* notifications. Информация о количестве писем, и т. д. Для авторизованного пользователя.
* stale. Протухшая авторизация. Очень похоже на `login`, только логин сделан скрытым инпутом, а соц-авторизации нет совсем.
* register-promo. Показывается пользователям без l-куки (которые, по всей видимости, не логинились в данном браузере). Имеет переход для обычной формы авторизации (`login`).
* multiauth-promo. Обычно показывается после авторизации аккакунтом, когда человек авторизовывался другим аккаунтом в недавнее время. Показывается по бк-флагу, один раз.

Последние два в данный момент выключены. Чтобы их включить, нужно поправить deps, список в domik2__dropdown.view.js и данный текст :)

Всегда показывается как минимум login или notifications. Если должно показаться что-то ещё, то возможные виды выпадающих блоков оборачиваются в `slider`.

### slider ###

Переключатель разных видов `dropdown`. Используется, если их больше одного.
Для переключения используется анимация, поэтому разные блоки располагаются один под другим с помощью _position: absolute_. Переключение производится только в одну сторону.

### Анимация ###

Анимация сделана с помощью css3, должна работать в новых браузерах и ие10+. В остальных случаях получается простой переход без анимации. Для того, чтобы невидимые блоки не брали на себя клики, после окончания анимации скрытия на них вешается _height: 0_ (а не _display: none_, чтобы анимация показа работала корректно). _pointer-events_ работает не во всех браузерах, поэтому от него было принято решение отказаться.
У экспериментального залогиненного домика анимация работает сложно, но также через css3. Примерная схема блоков в свёрнутом виде:

```
┌──────────────────────────┬──────────────────────────┐
│ нотификации пользователя │ логин пользователя и ава │
└────────────────────┬─────┴──────────────────────────┤   ^
                     │          скрытый домик         │   |
                     └────────────────────────────────┘
```

Домик накладывается поверх верхних блоков, это тяжело здесь отобразить.
Фактически, он всегда занимает место по ширине, но просто не виден.

При разворачивании домик показывается через прозрачность и visibility. Ширина нотификаций меняется через max-width до 0, при этом получается следующее:

```
┌─────┬──────────────────────────┐
│     │ логин пользователя и ава │
├─────┴──────────────────────────┤   ^
│ логин пользователя         /-\ │   |
│                            \-/ │
│ Почта 32                       │
│ Диск                           │
│ Деньги 0                       │
│ Написать письмо             /\ │
└────────────────────────────────┘
```

Здесь показаны скрытые нотификации. Так как попап не с position absolute, то он занимает место по ширине и всё упирается в него.
Опять же, попап поверх верхней строки, логин не дублируется
