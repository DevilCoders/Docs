# Ошибки Merge Queue

<!--
При переносе файла `errors.md` нужно поменять путь в переменной `ERROR_DOCS_PATH`.

@see https://a.yandex-team.ru/arc_vcs/frontend/projects/microservices/services/merge-queue/modules/messages/errors.js?rev=2b27f7c72d4b7fc89dd1f39b394b4a29bfc1bf02#L12
-->

## Ошибки Arcanum

### <a name="MQERR_2001"></a> MQERR_2001: Попытка постановки в очередь закрытого пулл-реквеста Арканума

В [Аркануме][arcanum] нельзя поставить пулл-реквест в очередь, если он был отклонён (discarded) или влит (merged).
Также нет возможности переоткрыть пулл-реквест после того, как он был отклонён.

Если пулл-реквест был отклонён по ошибке, следует [создать][arc_pr_c] новый и повторить попытку влития.

### <a name="MQERR_2002"></a> MQERR_2002: Попытка постановки в очередь сломанного пулл-реквеста Арканум

В [Аркануме][arcanum] нельзя влить пулл-реквест, если он находится в состоянии `Error` или `Fatal Error`.

### <a name="MQERR_2003"></a> MQERR_2003: В пулл-реквесте есть конфликты

В [Аркануме][arcanum] нельзя влить пулл-реквест с конфликтами. Следует отребейзить пулл-реквест, разрешить
конфликты в нём и повторить попытку влития.

### <a name="MQERR_2004"></a> MQERR_2004: Попытка постановки в очередь пулл-реквеста Арканума с неопубликованными изменениями

В [Аркануме][arcanum] нельзя влить пулл-реквест, если его [последние изменения][arcanum_pr_diffset] не опубликованы (находятся в статусе **Draft**).

Чтобы опубликовать последние изменения, нужно нажать на кнопку **Publish** на странице пулл-реквеста.

Создать пулл-реквест сразу с опубликованными изменениями можно командой `arc pr create --publish`. Подробности в [документации arc][arc_pr_c].

### <a name="MQERR_2005"></a> MQERR_2005: HEAD ревью-реквеста изменился, пока ревью-реквест был в очереди

Типичные причины изменений в ветке: добавление коммитов, rebase, force push.
Изменения ветки инвалидируют состояние проверок, которые прошли до постановки в очередь.
Таким образом, нарушаются гарантии корректности проверок пулл-реквеста, и потому пулл-реквест исключается из очереди.
В этом случае следует повторить попытку влития.

### <a name="MQERR_2017"></a> MQERR_2017: Требуется разрешение на запись в ветку пулл-реквеста

В проекте [настроено][before-merge] требование разрешения на изменение ветки, но проверка комбинации пользователь + токен + ветка завершилась неудачно.

Возможные причины:

- Владелец ветки (`users/<логин-владельца>/…`, обычно это же автор пулл-реквеста) никогда ранее не выдавал подобного разрешения Merge Queue.
- Сохранённый токен отозван владельцем или командой разработки MQ в рамках чистки базы секретов.

Без такого разрешения влить пулл-реквест в данном проекте через Merge Queue не получится.

Разрешение выдаётся по ссылке из комментария об ошибке, обычно это https://mqs.si.yandex-team.ru/oauth.
По ссылке нужно переходить именно _автору_ пулл-реквеста, а не тому кто пишет `/merge`.
Открытие ссылки также требует [сетевой доступ к MQS][mqs-access].

Для групповых веток поведение не определено.

[before-merge]: ./configuration.md#before-merge
[mqs-access]: ../guides/ui.md#access

### <a name="MQERR_1040"></a> MQERR_1040: Ошибка хука beforeMerge

Произошла ошибка при исполнении секции `beforeMerge`. Обратитесь в [infraduty].

### <a name="MQERR_1038"></a> MQERR_1038: Сборка пулл-реквеста при постановке в очередь завершилась с ошибками

Ошибка может случиться в проектах с Trendbox CI, если прогон конвейера при постановке в очередь завершается с ошибками, не являющимися ошибками прохождения проверок.

В таком случае следует проверить ошибки сборки и повторить попытку влития. Если это не решило проблему, то обратиться в [infraduty].

### <a name="MQERR_1039"></a> MQERR_1039: Произошла ошибка при получении конфигурации для репозитория в arcadia-github

**arcadia-github** — реестр проектов, события в которых обрабатываются Merge Queue.

Представляет собой список путей в Аркадии и возможных зеркал в GitHub.
[Хранится][arcadia-gh-cfg] в формате YAML в системе Genisys, кэшируется на час.
Для просмотра нужен [сетевой доступ][genisys-access].

- Если проекта в реестре нет, то надо его туда добавить. Это может сделать только команда разработки MQ.
- Если проект в реестре есть, то вероятнее всего случилось что-то непредвиденное.

Нужно обратиться в [infraduty].

[genisys-access]: https://wiki.yandex-team.ru/skynet/genisys/#access

[arcanum]: https://docs.yandex-team.ru/arcanum/
[arcanum_pr_diffset]: https://docs.yandex-team.ru/arcanum/pr/statuses#sostoyaniya-diffseta
[arc_pr_c]: https://docs.yandex-team.ru/arc/ref/commands#pr-create
[infraduty]: https://wiki.yandex-team.ru/infraduty/
[arcadia-gh-cfg]: https://genisys.yandex-team.ru/rules/search-interfaces.arcadia-github/default
