# Лего компоненты

Для того, чтобы компоненты из `lego-components` рисовались в нужных нам цветах,
а также меняли их в зависимости от темы устройства, используем втроенный в Лего механизм темизации — [themekit](https://github.com/bem/themekit).

## Крастко о структуре темизации

1. В проекте должен лежать **конфиг**, в котором описано, какие темы есть в проекте.
2. Каждая такая тема состоит из следующих составляющих:
  - **Конфиг** — файл, в котом указано, от какой темы наследоваться, как эта тема называется, для каких платформ собирается, из таких **токенов** состоит.
  - **Токены** — перечисление цветов в виде дерева, которое описано в `.yml` файле. Если тема наследуется, то эти токены перетирают базовые токены.
  - **Пресеты** — собранные `.scss` файлы с перечислением всех цветов в виде `var()` переменных.

## О том, как собираются темы у нас

### Базовый конфиг

Конфиг с темами лежит в папке конфигов нашего проекта [.config/themekit.config.js](../../.config/themekit.config.js).
На данном этапе в нём лежит 2 темы, которые общие у Картинок и Видео: `fiji-light` для светлой темы, и `fiji-dark` для тёмной:

```js
entry: {
    'fiji-light': 'sakhalin/src/components/Theme/fiji-light/theme.json',
    'fiji-dark': 'sakhalin/src/components/Theme/fiji-dark/theme.json',
}
```

Также в конфиге прописано собирать, как цвета `color`, так и размеры `root` компоненов. Ведь мы хотим конфигурировать и то, и другое.

### Темы проекта

Все наши темы лежат в папке [sakhalin/src/components/Theme](../../sakhalin/src/components/Theme), аналогично темам из Лего. В папке `Theme` каждая тема находится в своей папке и имеет одинаковую структуру. Рассмотрим строение темы на примере [светлой темы проекта](../../sakhalin/src/components/Theme/fiji-light).

```
Theme
  ↳ fiji-light
      ↳ theme.json // Конфиг темы
      ↳ tokens
      |   ↳ color@platform.yml  // Токены с переопределением цветов
      |   ↳ root@platform.yml   // Токены с переопределением размеров
      ↳ presets
      |   ↳ color@platform.scss // Собранные var переменные цветов
      |   ↳ root@platform.scss  // Собранные var переменные размеров
      ↳ platform.scss // Экспорт пресетов для сборки postcss
      ↳ platform.ts   // Экспорт пресетов и названия темы для импорта в компоненты
```

### Конфиг темы

**theme.json** — конфиг темы, путь к которому указан в конфиге тем проекта:

```json
{
    "extends": "@yandex-lego/components/Theme/themes/default.theme.json", // наследуем обычную тему Лего
    // Каждая тема состоит из двух селекторов:
    "whitepaper": {
        "color": "fiji-light-[platform]", // селектор цвета Theme_color_fiji-light-...
        "root": "fiji-[platform]", // селектор размера Theme_color_fiji-... Так как размеры не зависят от темы устройства, светлая и тёмная тема у нас делят между собой один селектор
    },
    "platforms": ["desktop", "touch"], // собираем дестопы и тачи (телефоны + пады)
    "sources": [
        "sakhalin/src/components/Theme/fiji-light/tokens/*.yml" // применяем все токены темы
    ]
}
```

### Токены

**tokens** — токены темы, разбитые по платформам. Платформы [стандартные](https://a.yandex-team.ru/arc/trunk/arcadia/frontend/packages/lego-components/src/Theme/tokens/color-light.tokens.yml), перечень из зашит в `themekit`, не регулируется.

Пример полного файла с токенами [смотрите в Лего](https://a.yandex-team.ru/arc/trunk/arcadia/frontend/packages/lego-components/src/Theme/tokens/color-light.tokens.yml). Токены нашей светлой темы перетирает именно эти токены.

Токены в общем состоят из 3х уровней:

1. **Супербазовый уровень**. Туда входят самые верхнеуровневые цвета проекта, акценты — цвет ссылок, текста и т.д. Остальные цвета так или иначе ссылаются и [вычисляют себя](https://github.com/bem/themekit#-color-processing) в зависимости от этих цветов.
2. **Базовый уровень**. Эти цвета вычисляют себя от супербазового уровня, при этом объединяя некие цветовые решения проекта. Например, возьмем реальный цвет из токенов Лего: `color.fillColor.soft.value: color({color.essential.value} a(97%) })`. Цвет `fillColor.soft` представляет собой некую "мягкую" заливку фона, которая может использоваться несколькими компонентами Лего.
3. **Компонентый уровень**. Эти цвета определены не в общем конфиге Лего, а в каждом компоненте в специальной папке [*.tokens](https://a.yandex-team.ru/arc/trunk/arcadia/frontend/packages/lego-components/src/Button/Button.tokens/Button.tokens.yml). Эти цвета определяют цвета конкретных контролов и их `view`, `size` модификаторов.

Мы же все эти 3 группы токентов переопределяем в одном файле:

```yml
# базовые и супербазовые цвета всегда начинаются со слова color
color:
  path:
    value: '#000080' # цвет ссылок — супербазовый
  control:
    type:
      default:
        fillColor:
          base:
            value: '#eeeef2' # цвет заливки всех контролов с модификатором view=default — базовый
# компонентные цвета начинаются с имени компонента
divider:
  fillColor:
    value: rgba(0, 0, 0, .1) # цвет границ конкретного компонента — разделителя — компонентый
```

**ВНИМАНИЕ**. Старайтесь всегда переопределять цвета как можно выше по дереву. Так мы сохраним внешний вид проекта более целостным, и наши цветовые решения унаследуют как можно большее количество компонентов.

### Пресеты

Чтобы из токенов собрать пресет, нужно выполнить команду `npm run themekit:build`. Это запустит пересборку всех тем проекта. Результат сборки сохраняется в папку `preset` в качестве селектора с `var()` переменными.

Далее эти переменные импортируются в [postcss.config.js](../../postcss.config.js), где с помощью плагина `postcss-theme-fold` только нужные `var()` переменные конвертируются в цвета и добавляются в файл стилей.
