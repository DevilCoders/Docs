# Написание YAML-сценариев

[Документация Palmsync про поля YML и валидацию](https://github.yandex-team.ru/search-interfaces/infratest/tree/master/packages/palmsync)

## Best Practices
1. Разбиваем пустой строкой все поля верхнего уровня кроме ``feature``, ``type`` и ``experiment``. Их пишем друг за другом.
1. Все текстовые названия в полях ``feature``, ``type``, ``experiment`` и тест-кейсы в ``specs`` пишем с **большой** буквы.
1. В директивах ``do``, ``assert``, ``screenshot``, ``tech`` пишем всё с **маленькой** буквы.
1. Не используем в основном названии фичи сокращения доступные узкому кругу лиц. Можно написать его дополнительно.
   Пример: Поиск по картинке ("Сибирь"). Пишем спеки так, чтобы понял любой человек, а не только ты и члены твоей команды. Не употреблять сленговые слова/выражения.
1. Не используем слово Эксперимент в названии эксперимента, и слово Фича в названии фичи. Стараемся давать название, из которого сразу понятен контекст.
1. Каждый отдельный тип и каждый отдельный эксперимент описываем в **отдельном** файле.
1. Соблюдаем конвенцию именования файлов описанную в разделе [Соглашения по структуре](#Именование-файлов).
1. Не дробим кейсы ради отдельных атомарных проверок. В одном кейсе может быть несколько ```assert``` и ```screenshot``` проверок.
1. В названии файлов с экспериментами не используем слово ``exp``.
1. Для повторяющихся тест-кейсов можно использовать алиасы (подробнее в [Особенности использования полей](#Особенности-использования-полей).
1. Для повторяющихся шагов используем ```beforeEach```. Шаги из этого блока будут подставляться в начало каждого кейса. Note: before не стоит использовать, так как он официально нерекомендован в hermione и в будущем будет запрещен совсем.
1. Для счётчиков и их параметров, а так же других технических проверок, например проверки значений cookie, вместо ``assert`` используем ``tech``. Такие проверки не попадают в сценарии асессоров. Все пары do-tech будут автоматически исключаться из заданий асессорам.
1. Пишем без лишней вложенности в ```specs``` без необходимости. **Максимально возможная вложенность - 3**.
1. Пишем без частей URL страниц и флагов в заголовках тест-кейсов:
    1. Вместо "перейти по адресу `/images/touch`", пишем "перейти на главную страницу сервиса".
    1. Вместо "перейти по адресу `/video/search?text=bmw&exp_flags=video_whatever`" пишем "перейти по запросу bmw". Список флагов со значениями уже указан в директиве flags.
1. Пиши грамотно!
1. Неправильно писать ` - assert: проверить ссылку`. Подобные проверки необходимо разносить на действие и ожидаемый результат.
```yml
- do: нажать на ссылку "Картинки" в табах сервисов
- assert: ссылка ведет на сервис Картинки
```
1.  Конструкция типа:
```yml
- do: действие
- assert: результат 1
- assert: результат 2
- assert: результат 3
```
в заданиях преобразуется в
```yml
- do: действие
- assert: результат 1
```
```yml
- do: действие
- assert: результат 2
```
```yml
- do: действие
- assert: результат 3
```
Учитывайте это при написании последовательных спек!
Если вы хотите, чтобы после действия были проверены подряд несколько утверждений, используйте конструкцию подобного вида:
```yml
- do: в поисковой стрелке отчистить поле ввода
- do: нажать кнопку "Найти"
- assert:
        в поисковой строке осталось пустое поле ввода,
        на странице сообщение "Задан пустой поисковый запрос",
        результаты поиска отсутствуют
```
1. Если yml-файл пишется отдельно от тестов, то в спеках вместо скриншотов можно вставлять ссылку на jing (https://wiki.yandex-team.ru/jing/).
Пример:
    ```
    - assert: блок Яндекс Директ на морде выглядит корректно [https://jing.yandex-team.ru/files/i-v-manysheva/Smotrite_video_onlain_serialy_multiki_igry_klipy_filmy_na_Yandekse_2017-11-29_15-39-44.png]
    ```
1. Пиши в совершенной форме. Ожидаемый результат assert/tech должен быть сформулирован так, чтобы на него можно было ответить "Верно"/"Не верно". НЕ стоит писать "должен появиться саджест", лучше написать "появился саджест" (без знака вопроса!) - на такое утверждение легко можно ответить "Верно"/"Не верно".
Пример:
    ```
    - tech: должен отправиться счётчик
    ```
    ->
    ```
    - tech: отправился счётчик
    ```
    - Коротко и ясно :)
1. Если фича на всех доменах имеет одинаковую функциональность/внешний вид, не нужно копировать yaml на все домены с разным переводом! Асессоры должны проверять схожесть внешнего вида, а не переводы.
Выделяем фичу в отдельный домен, только если у неё отличается функциональность/внешний вид.
1. При покрытии фичи стараться описывать не только положительные проверки, но и добавлять пару отрицательных кейсов.
1. Не дублировать тесты! Перед написанием yaml-файлов обязательно провалидируй в проекте уже существующие тесты. Не пиши новые файлы, если можно поправить/дополнить старые.

## Соглашения по структуре файлов и папок
При написании тестов соблюдаем конвенцию именования файлов и папок, а так же внутреннюю структуру файлов.

### Структура папок
Тестовые сценарии хранятся в папке [features](https://github.yandex-team.ru/mm-interfaces/fiji/tree/dev/features) в корне репозитория.

Структура этой папки следующая:
```
features/
    <service-name>/
        common
        deskpad
        desktop
        touch
        touch-phone
        touch-pad
        searchapp-phone
        searchapp-pad
```

Если какого-то уровня нет, его нужно создать.

При описании новой фичи необходимо:
1. Создать папку с кратким названием фичи для нужной платформы.
1. Создать файл с таким же названием в корне этой папки с расширением ```.testpalm.yml```.
1. При наличии экспериментов создать папку exp и в ней класть файлы с описанием экспериментов.

### Именование файлов

Формат названия файла: ``feature-name-short-desc.testpalm.yml``.

1. В названии файла обязательно указывается название фичи и краткое описание его содержания.
1. Используется kebab-case.

Пример файловой структуры папки с фичей:
```
    related/
            related.testpalm.yml <- основная функциональность связанных
            related-carousel.testpalm.yml <- тип Карусель
            related-grid.testpal.yml <- тип Сетка
            exp/
                related-double-thumbs.testpalm.yml <- эксперимент с двойными тумбами
                related-rectangular-thumbs.testpalm.yml <- эксперимент с прямогольными тумбами
                related-carousel-without-arrow.testpalm.yml <- эксперимент с отсутствующими стрелками в карусели связанных
```

Аналогичными образом называем папки (не забываем про ``exp``) и файлы gemini и hermione, относящиеся к фиче.
На данный момент они лежат в отдельных папках, но в обозримом будущем они (как и у СЕРПа) будут лежать в одной папке.

## Используемые поля

На проекте настроены кастомные поля `service` и `browsers`. Подробнее про настройку кастомных полей можно прочитать [здесь](https://github.yandex-team.ru/search-interfaces/infratest/blob/master/packages/palmsync#schemeextension).

Остальные поля являются общими для всех проектов, про них можно прочитать в [документации Palmsync](https://github.yandex-team.ru/search-interfaces/infratest/tree/master/packages/palmsync#поля-файла).

Обязательные поля:
- ``feature`` - человеко-понятное название фичи.
- ``specs`` - описание тест-кейсов.
- ``files`` - список файлов с gemini и hermione тестами.

Необязательные поля:
- ``aliases`` - список алиасов с шагами.
- ``description`` - краткое описание фичи. Будет доступно в задаче в TestPalm.
- ``type`` - одна из разновидностей фичи.
- ``experiment`` - название эксперимента.
- ``flags`` - список флагов, необходимых для работы эксперимента.
- ``priority`` - приоритет функциональности (согласовываем с тестировщиком).
    Допустимые значения:
    - high
    - **medium (по умолчанию)**
    - minor
- ``manager`` - ответственный за фичу менеджер.
- ``qa-engineer`` - ответственный за фичу тестировщик.
- ``tags`` - список тегов.

Поля, которые выставляются автоматически:
- ``service`` - название сервиса фичи
    Допустимые значения:
    - images
    - video
- ``platform`` - название платформы фичи
    Допустимые значения:
    - desktop
    - touch-pad
    - touch-phone
    - tv
- ``tlds`` - домены, для которого предназначен yml
- ``browsers`` - название браузеров, в кторых отсутствует фича
Названия браузеров хранятся тут:https://testpalm.yandex-team.ru/fiji/settings в разделе  Environments


### Особенности использования полей

Более подробно про поля можно прочитать в [документации](https://github.yandex-team.ru/search-interfaces/infratest/tree/master/packages/palmsync#поля-файла).

**type**

Поле ``type`` используется в случаях, когда есть несколько разновидностей фичи.

Пример: в сервисе Картинки есть фича Связанные запросы.
Связанные запросы имеют несколько разновидностей: в виде карусели, в виде сетки.
Поведение этих модификаций различается, поэтому следует описать эти несколько типов в отдельных файлах.

В первом файле опишем общую для всех видов связанных запросов функциональность:
```yml
feature: Связанные запросы

specs:
    При клике на связанный запрос происходит переход на страницу похожих картинок:
```

Во втором файле опишем особенности связанных запросов в виде карусели:
```yml
feature: Связанные запросы
type: В виде карусели

specs:
    При клике на стрелку вправо срабатывает подскролл к следующим элементам:
```

В третьем файле опишем связанные запросы в виде сетки:
```yml
feature: Связанные запросы
type: В виде сетки

specs:
    Скрываются неполные строки:
```

И так далее.

**params**

Если нужно указать несколько флагов, делаем это в виде списка:
```yml
params:
  exp_flags:
    - flag=1
    - flag=2
```

Если флаг один, пишем так же, как и несколько:
```yml
params:
  exp_flags:
    - images_touch_market_no_thumbs=1
```

Писать значение флага не обязательно, если оно равно 1 (значение по-умолчанию).
В данном поле можно указать произвольные параметры, которые будут добавлены в атрибуты тестового сценария, само поле params в атрибуты не попадет. Поле params может быть выставлено как для целого сьютов, так и для отдельных сьютов и даже тестов.

Пример:

```yml
params:
  exp_flags:
    - foo1
    - foo2
  some_key: foo

specs:
  Какой-то сьют:
    - params:
        exp_flags: bar
    - Какой-то тест:
      - params:
          some_key:
            - baz1
            - baz2
      - do: bla-bla
      - assert: bla-bla
 ```

**aliases**
Используется для описания шагов, которые повторяются в нескольких тест-кейсах.

Для этого сразу после основных полей ``feature``, ``type``, ``experiment`` указываем поле ``alliases``:
```yml
feature: Адресный сниппет
type: Много точек

aliases:
  - &checkLinks
    - assert: проверка наличия счетчика
    - assert: в ссылке есть source параметр
    - assert: в ссылке есть sll параметр
```

И затем используем его в specs:
```yml
specs:
    Проверка параметров в ссылке:
      - do: получить выдачу по запросу 'окна пластиковые'
      - assert: должен появиться адресный сниппет 'Много точек'
      - *checkLinks
```

Примеры написания:
  * [Пример 1](https://github.yandex-team.ru/serp/web4/blob/23205fc84fd2d015a1245824acd9630159ca0dda/features/deskpad/serp-item/serp-item_post_adresa_many.testpalm.yml)
  * [Пример 2](https://github.yandex-team.ru/serp/web4/blob/23205fc84fd2d015a1245824acd9630159ca0dda/features/deskpad/serp-item/serp-item_post_adresa_single.testpalm.yml)

**specs**

Описание тестовых сценариев. Обязательно должно содержать как минимум 1 вложенный сценарий.
```yml
specs:
    Проверка параметров в ссылке:
      - do: получить выдачу по запросу 'окна пластиковые'
      - assert: должен появиться адресный сниппет 'Много точек'
```

В случае отсутствия вложенных сценариев palmsync будет валиться на валидации hermione тестов.

**files**

Для указания нескольких файлов используем список:
```yml
files:
    - features/video/touch-phone/series-navigator-colorized.hermione.js
    - gemini/video/touch-phone/series-navigator-colorized.gemini.js
```

Если все проверки ручные (manual), указываем пустой массив:
```yml
files: []
```

Если проверки планируется автоматизировать в одной из задач, используем пустой массив и комментарии:
```yml
files: []
  # https://st.yandex-team.ru/IMAGESUI-1234 - gemini
  # https://st.yandex-team.ru/IMAGESUI-1234 - hermione
```
Пока что нет нормального способа указать TODO прямо в теле files не через комментарии.
Это будет сделано в задаче [FEI-5853](https://st.yandex-team.ru/FEI-5853)

**priority**

Поле используется для фильтации фич по приоритетам в интерфейсе TestPalm.
Все фичи по умолчанию имеют приоритет medium.
Для приоритета отличающегося от medium можно указать это поле.

**browsers**
Пример использования
```yml
browsers:
  notFor:
    - desktop-ie11
    - desktop-edge
```
### Написание нескольких assert -ов:
* Как склеиваем?

Склеиваем через | (вертикальную черту)
* Когда склеиваем?

a) ДА, склеивать если так будет выглядеть у асессеров логично.

Пример:
https://github.yandex-team.ru/raw/mm-interfaces/fiji/dev/features/video/common/serial/object-answer/object-answer-compilations.testpalm.yml 

Как это выглядит у асессеров:
https://assessor-test-viewer.yandex-team.ru/ (сюда подставить ссылку, что выше и нажать Get me some yaml!)

б) НЕТ, не объединять, если по спеке это будет выглядеть не логично у асессеров. (Например, объединять assert и tech)

Пример:
https://github.yandex-team.ru/raw/mm-interfaces/fiji/dev/features/video/desktop/kids-mode/exp/kids-mode-confirm-to-index.testpalm.yml

Как это выглядит у асессеров:
https://assessor-test-viewer.yandex-team.ru/ (сюда подставить ссылку, что выше и нажать Get me some yaml!)


### Исключение тест-кейсов для тестирования асессорами
Отдельные кейсы, которые не должны по каким-то причинам попадать в задания асессоров, отмечаем следующим полем в содержимом тест-кейса:
```yml
    - tags: no_assessors
 ```
Если необходимо, чтобы все кейсы из файла не тестировались асессорами, необходимо использовать:
```yml
 tags:
    - no_assessors
 ```
Возможные причины, по которым кейс не должен попадать асессорам:
- содержит только `tech`
- работает на патчах, которые не работают для асессоров
- содержит проверку только искусственно созданных скринов в gemini, которые в реальной жизни получить почти нереально
- сложен для воспроизведения асессорами

**Стараемся теги писать в начале файла, а не в конце, ибо это заметнее (особенно в больших файлах) и есть большая вероятность продублировать тег, если он в конце.**

Тег нельзя использовать в конструкциях `beforeEach` - либо присваиваем его всему файлу, либо проставляем в отдельных спеках.

**Обратный тег**
`for_assessors` -  для кейсов, которые должны попадать только асессорам. Эти кейсы не будут попадать в раны, сформированные в рамках формального тестирования.
### Устойчивые конструкции в Yaml-файлах для асессоров

**Стандартные do:**

**Про запросы**

```yml
- do: получить выдачу по запросу "bmw"
```

```yml
- do: открыть главную страницу сервиса
```

```yml
- do: открыть главную страницу сервиса в неавторизованном состоянии в режиме инкогнито
```

**Про ориентации девайсов/ширину экрана**

```yml
- do: установить альбомную/портретную ориентацию устройства
```

```yml
- do: повернуть устройство в альбомную ориентацию
```

```yml
- do: установить ширину браузерного окна 900px
```

**Про тапнуть/кликнуть/нажать**

Везде на всех платформах используем универсальное `нажать`

**Фичи под блендером**

Если показ фичи находится под блендером, то используем вот такую конструкцию:
```yml
- do: обновить страницу 2-3 раза, пока не появится колдунщик видео
```

### Стандартные assert
**Ссылки/переходы на другие страницы**

```yml
- assert: произошёл переход на страницу ... в той же/в новой вкладке
```

**Если нужно проверить, что ничего не поменялось**

```yml
- assert: страница выдачи выглядит как и прежде
```
 **Хорошо сопровождать скриншоты текстом:**
 ```yml
- screenshot: <фича> выглядит корректно [screenshot]
```
или
 ```yml
- screenshot: кнопка прокрашивается желтым [screenshot]
```

**Домены**

Если доменов несколько, то пишем в виде массива:
```yml
tlds: [ru, by, kz, ua]
```

Если домен один, то пишем в строку:

```yml
lds: ru
```

Для домена **com** пишем такое выражение иначе происходит редирект
```yml
- do: получить выдачу по запросу "bmw" c дополнительным параметром в адресной строке &lr=87
```

### Что не знают асессоры
1. Сленговые термины/выражения
2. Для проверки счётчиков вместо `assert` используется `tech`

Пример:
```yml
- tech: один раз отправился счётчик с параметром path=471.1108.1155.854.220
```

3. Патчи/застабленные данные
4. Проверка/подставление параметров в url (мы пытаемся их научить, но пока не взлетает, поэтому такие проверки попадают под тег `no_assessors` и размечаются аналогично счётчикам - `tech`)

### Что знают асессоры
1. Все слова из (https://wiki.eva.yandex-team.ru/SERP.Slovar-dlja-asessorov/ *словаря*)
2. Выдача
3. Режим инкогнито

## Замены сленговых слов/выражений

```
Распашонка/холодильник = Просмотрщик
Футер = Подвал
Тумба = Постер/картинка
Ховер = Навести курсор мыши
Морда = Главная страница сервиса
Попап = Информационное сообщение/информационное окно/окно с информацией
```

## Теги в тасках
**assesors** - любая таска, связанная с (https://goals.yandex-team.ru/filter?user=24265&importance=0,1,2,3&goal=24686 *целью*) про асессоров
**assesor_bug** - баги, найденные асесорами
**yml_falsepositive** - универсальный тег для разметки  нескольких типов ошибок со стороны сервисов и/или инфраструктуры. Таким тегом помечаем:
- баги в yml
- другие баги со стороны сервисов/инфраструктурные проблемы, связанные с целью про асессоров

---

## Hermione
При написании hermione тестов есть особенности связанные с валидацией YAML файла фичи.
Самый верхний ```describe``` должен состоять из содержимого полей ```feature```, ```type```, ```experiment``` разделенных ``` / ```  (прямой слеш обособленный пробелами).

Описываем YAML:
```yml
feature: Колдунщик Маркета
type: Неявной модели
expeiment: Без тумбов
flags: images_touch_market_no_thumbs=1

specs:
    Проверка работы ссылок:
        При клике по ссылке с названием модели происходит переход на маркет:
            - do: ....
            - assert: ....
```

Тогда файл с hermione тестом будет выглядеть следующим образом:
 ```js
describe('Колдунщик Маркета / Неявной модели / Без тумбов', () => {
    describe('Проверка работы ссылок', () => {

    });
});
 ```

 Тут стоит отметить следующие особенности:

 1. Слеш в самом верхнем describe нужно разбивать двумя пробелами, иначе валидация не пройдет. Скоро эта проблема решится отдельным хелпером.
 1. Если тест-кейс в YAML содержит шаги то он преобразуется в it, если он содержит (вложенные) тесткейсы - он преобразуется в describe.
 1. Тест-кейс не может одновременно содержать и шаги и кейсы - это будет невалидный YAML-файл.


## Gemini
В тестовых сценариях мы можем использовать директиву ``screenshot`` - это ещё один из видов assert'ов.
В ней обязательно указываем описание скриншота и путь до него.

Путь формируется из названий сьютов, а конечной единицей является ``capture``.

Таким образом правильное описание директивы ``screenshot`` будет выглядеть следующим образом:
```yml
- screenshot: внешний вид предыдущей картинки дня со стрелками листания [images/touch/b-501px morda left]
```

Нужно не забывать указывать название скриншота - краткое описание того, что на нём изображено.

## Пример описания фичи
Описываем фичу Поиск по картинке.

Создаем папку с фичей в папке для соответствующей платформы.

В этой папке создаем одноименный файл ``cbir.testpalm.yml`` в котором будем описывать основную функциональность.

Пример отражения фичи и её экспериментов на файловой системе:
```
fiji/features/images/touch-phone/cbir/
                                    cbir.testpalm.yml <- основная функциональность фичи
                                    exp/
                                         cbir-preview-inside-arrow.testpalm.yml <- превью загруженной картинки в стрелке
                                         cbir-ocr.testpalm.yml <- распознавание текста на картинке
                                         cbir-actions-modal.testpalm.yml <- модальное окно выбора типа загружаемой картинки
```

Файл с фичей будет содержать основную функциональность фичи:
```
feature: Поиск по картинке

specs:
  Загрузка картинки через саджест [manual]:
    ...
  Показ страницы c отсутствующими результатами поиска:
    ...
  Проверка блока похожие:
    ...

files: []
   # TODO: https://st.yandex-team.ru/IMAGESUI-5580 # hermione + gemini

priority: high
```

Файл с экспериментом будет содержать описание функциональности привносимой экспериментом:
```
feature: Поиск по картинке
experiment: Колдунщик Авто.ру
flags: images_touch_auto_wizard

specs:
  Показ колдунщика Авто.ру для изображений с автомобилями:
    ...

files: []
   # TODO: https://st.yandex-team.ru/IMAGESUI-1111 # hermione + gemini
```

### Синхронизация в TestPalm
Синхронизация в TestPalm происходит при влитии пулла в dev.
При этом при каждом коммите происходит валидация файла сценариев.

Чтобы запустить вручную валидацию до коммита, можно вызывать команду
- `npm run lint:palmsync` - запускает ту же команду валидации что и при коммите

Например:
```
npm run lint:palmsync путь/к/файлу/с/ямл-сценарием.testpalm.yml
```

Более подробно про синхронизацию можно посмотреть в докладе Синхронизация TestPaml с [Кровавого четверга](https://clubs.at.yandex-team.ru/search-interfaces/1954).

### Полезные ссылки
- [Всё про TestPalm](https://wiki.yandex-team.ru/testpalm/)
- [Документация СЕРПа по YAML](https://github.yandex-team.ru/search-interfaces/infradocs/blob/master/testing/testpalm/scheme.md)
- [Доклад Синхронизация TestPaml с Кровавого четверга](https://clubs.at.yandex-team.ru/search-interfaces/1954)

## Часто задаваемые вопросы
- **Что такое TestPalm? Зачем он нужен?**

    TestPalm - система управления тестовой документацией и тестированием.
    Предназначена для хранения и систематизации тестовой документации в виде тест кейсов и тест сьютов,
    для проведения контролируемого регрессионного тестирования распределенной командой тестировщиков.

    Более подробно можно почитать [здесь](https://wiki.yandex-team.ru/testpalm/).

- **Должен ли Hermione полностью соответствовать YAML? Сначала Hermione или YAML?**

    Между Hermione и YAML должно быть полное соответствие относительно структуры тест-кейсов (кроме ``manual`` тест-кейсов).
    Реализация автотестов может отличаться от шагов, указанных в YAML.


- **Как быть когда уже есть Hermione, писать YAML по нему?**

    YAML является основным источником, по которым мы пишем автоматизированные тесты.
    Сначала пишем YAML, согласуем с тестировщиком, а затем рефакторим Hermione, а при необходимости и Gemini.

- **Я затронул функциональность и тесты на неё. Нужно ли мне писать на неё YAML в той же задаче или можно сделать отдельно?**

    **У уже существующего блока нет YAML**

    - В рамках задачи слегка затронут блок - **НЕ пишем**
    - Задача поправить шрифты и отступы в блоке - **НЕ пишем**
    - Задача поправить баг в блоке - **НЕ пишем**
    - Задача сделать поведение в блоке под флагом - **пишем ТОЛЬКО для нового поведения**

    Если фича не покрыта YAML нужно завести задачу и прилинковать её к интеграционной задаче по покрытию сервиса.

    Задача в Видео: скоро будет

    Задача в Картинках: [IMAGESUI-5580](https://st.yandex-team.ru/IMAGESUI-5580)

    **Новый блок и\или новая функциональность:**

    Пишем YAML сразу.

- **Какой flow при написании YAML на новую или существующую фичу?**

    Алгоритм работы следующий:

    1. Определяемся с названием фичи, самостоятельно или с тестировщиком. Если фича новая, просим тестировщика внести в карту фич.
    2. Пишем YAML файл на фичу и призываем тестировщика из своей команды на ревью.
    3. Исправляем замечания от тестировщика.
    4. Когда YAML готов, пишем hermione и gemini тесты на функциональность. Если затрагивается уже существующая ранее не описанная фича, обязательно находим имеющиеся тесты и рефакторим их исходя из содержимого YAML файла.

- **Где посмотреть карту фич для сервиса?**

    За составление карты фич ответственен тестировщик из команды сервиса.

    Посмотреть карты фич можно по ссылкам:
    * [Картинки](https://wiki.yandex-team.ru/test/multimedia/images-features/)
    * [Видео](https://wiki.yandex-team.ru/search-interfaces/multimedia/video/feature-map/)

- **Как описывать счётчики?**

    Тестирование счетчиков, как правило, не выделяется в отдельные тесты.
    Счетчики описываются прямо в тест-кейсе и помечаются при помощи технической директивы ```tech```.
    Такой вариант является более предпочительным, так как не требует отдельно загружать страницу.

    Например:
    ```yml
    specs:
        При клике на кнопку происходит показ модального окна:
          - do: кликнуть по кнопке
          - tech: отправился счётчик /image/touch/preview/commercial/button/market
          - tech: у счетчика параметр nc = 1
          - tech: у счетчика параметр params.vars содержит -pos=3,-link_type=market_search
          - tech: у счетчика параметр params.reqid равен полученному ранее
          - tech: у счетчика параметр params.href равен полученному ранее
    ```

    Иногда есть необходимость описать счетчики отдельным тест-кейсом.
    Тогда достаточно описать этот тест-кейс в specs.

    Пример:
    ```yml
    specs:
        Проверка работы счетчиков:
            Счетчик клика по маркетной кнопке:
                - do: кликнуть по кнопке
                - tech: отправился счётчик /image/touch/preview/commercial/button/market
                - tech: у счётчика параметр nc = 1
    ```

- **Нужно ли использовать теги?**

    Теги позволяют удобно фильтровать фичи в интерфейсе TestPalm.
    В СЕРПе, например, теги не используются.
    Однако, для фильтрации мы можем использовать платформу, фичу, эксперименты и прочие поля.
    Без особой необходимости теги использовать не стоит.

    На данный момент у нас есть следующие теги (список будет пополняться):
     - ```autotests-only``` - сложная для ручного тестирования функциональность, которая покрыта автотестами.

- **Какие gemini нужно прикреплять в files? Можно ли прикреплять gemini на изолированный блок?**

    Когда в директиве files указывается путь на gemini тест, предполагается что скриншот делается не в изолированном пространстве (изолированные блоки),
    а именно на той странице, которая прогоняется в тестах. Однако это увеличивает время выполнения тестов, и в большинстве случаев мы делаем ссылки на изолированные блоки.

- **Что делать с мобильным приложением? На какой уровень писать фичи?**

    Для этого у нас есть "логические" платформы: ``searchapp-phone``, ``searchapp-pad``.
    Называем их логическими, потому что по факту это платформы ```touch-phone``` и ```touch-pad```.
    Но выделяем их отдельно, потому что поведение отличается от обычных тачей.

- **Может ли ссылка на unit-тест включаться в files?**

    Прикреплять ссылки на юнит-тесты в директиве ``files`` бессмысленно.
    При синхронизации учитываются только hermione и gemini файлы.

- **Где посмотреть тестовые сценарии после синхронизации?**

    Посмотреть синхронизированные сценарии можно в TestPalm: [Fiji](https://testpalm.yandex-team.ru/fiji)

- **Могут ли директивы flags и experiment находится внутри specs?**

    Не могут. Директивы указываются для всей фичи, а не для отдельных тест-кейсов.


- **Что, если часть функциональности нельзя автоматизировать?**

    Нужно помечать её через ```[manual]``` в заголовке кейса в specs.
    ```yml
    feature: Поиск по картинке

    specs:
        Загрузка картинки через саджест[manual]:
    ```
    Такая функциональность будет помечена отдельным полем в TestPalm.

    Нужно стремиться к тому, чтобы все тест-кейсы были автоматизированы.

- **Что есть фича? Привязана ли она к блокам? Как выделить фичу?**
    Фича не обязательно является блоком. Фича может быть совокупностью блоков (прим. - Поиск по картинке).
    В тоже время блок может быть фичей (прим. - колдунщик Авто).
    В случае, если разработчик самостоятельно не может выделить фичу, ему нужно обратиться к тестировщику.

- **Нужно ли мне создавать отдельные файлы для экспериментов? Или можно описать все эксперименты в одном файле?**

    Каждый эксперимент пишется строго в отдельном файле.

- **Каким образом происходит валидация TestPalm?**

    Если коротко проверяются следующие шаги:

    1. Проверка обязательных полей и соотвествия типов их содержимого.
    2. Проверка всех скриншотов имеющихся в gemini файле, на присутствие в YAML файле.
    3. Проверка всех тест-кейсов на наличие в файле c hermione тестами.

- **Что за директива screenshot? Как формируется URL картинки?**

    Смотри раздел [gemini](#gemini)

- **Что делать если в разных тест-кейсах полностью повторяются шаги и проверки?**

  Для этого можно использовать механизм алиасов.

  Подробнее в [Особенности использования полей](#Особенности-использования-полей).
