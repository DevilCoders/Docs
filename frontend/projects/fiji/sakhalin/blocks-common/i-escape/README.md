# i-escape

Экранирует строковые поля в данных по переданной схеме. Экранирование
затрагивает символы `<>'"` и не затрагивает спецсимволы html. Значение поля
до экранирования сохраняется в `_{ название поля }`.

## Схема экранирования
### Серверные данные
Определяется в `escaping_scheme.json` сервиса. Копирует вложенность полей в данных
(&export=json, json_dump=1) с пометками какие поля нужно заэкранировать. Если в данных
в качесте значения поля массив, то он аналогично задаётся массивом с единственным элементом
в схеме.

Пример:
```json
{
    "searchdata": {
        "images": [{
            "passages": [{
                "title": true,
                "text": true,
                "raw_pass": true
            }]
        }]
    }
}
```

Схему экранирования можно расширять с помощью флага `mmui_extended_escape_scheme`:
```
&exp_flags=mmui_extended_escape_scheme=path.to.0.some.field,some.other.0.field
```

### Данные, получаемые с клиента
Схему экранирования можно применить в экстренных случаях и для данных, которые мы получаем на клиенте ajax'ом с помощью флага `mmui_ajax_escape_scheme`. В этом случае в html будет вставлен блок i-escape-ajax, в который через JS-параметры будет передана развёрнутая схема экранирования.
Блок добавляет префильтр на все ajax-запросы, поэтому пользоваться данным методом стоит только для экстренного фикса XSS в проде **с последующим фиксом на уровне вёрстки**.
Формат флага: `url=path.to.0.field,other.0.field:url2=path.to.field`, например:
```
&exp_flags=mmui_ajax_escape_scheme=yandex.ru/images-apphost/rim=rld.0.s.0.t,rld.0.s.0.ph
```
**Важно:** нужно максимально точно указывать url, чтобы точечно экранировать ответы только необходимых ручек. И всегда проверяйте работу сконфигурированного флага перед раскаткой через ITS.
