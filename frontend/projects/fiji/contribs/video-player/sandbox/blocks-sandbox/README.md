Песочницы плееров
=================

Для каждого блока автоматически собирается html-страничка. Весь код блоков реализуется на vanilla.js (нет ни i-bem, ни jQuery). В каждой песочнице доступен глобальный объект Sandbox, который содержит общие для всех песониц хелперы.

Пример простейшей песочницы:
```js
Sandbox.decl({
    /**
     * Инициализирует песочницу
     */
    init: function() {
        document.body.innerHtml = this.params.html;
        this.on(this.onMessage);
    },

    /**
     * Обработчик сообщений плеера
     */
    onMessage: function(data) {
        this.trigger(data.event, data);
    }
});
```

## Объект Sandbox

Методы:
* **decl(body)** - декларирует песочницу, в качестве параметра принимает объект с методами песочницы;
* **on(handler)** - подписывает функцию handler на все сообщения, приходящие в песочницу от плеера;
* **trigger(event, data)** - триггерит событие родительскому окну. Все события должны быть в формате https://yandex.ru/support/video/partners/jsapi.xml

Специальные методы песочницы:
* **init()** - инициализирует песочницу. Выполняется в момент готовности DOM.
* **preload()** - предназначен для предзагрузки скриптов песочницы. Выполняется сразу после декларации песочницы, до готовности DOM.

Параметры
* **params** - объект с параметрами, переданными в хеше запроса. Создаётся при инициализации песочницы и поэтому недоступен в preload.
* **getDefaultParams()** - параметры, которые будут использованы по умолчанию.

Песочница позволяет управлять воспроизведением видео в ней (пример: `youtube/youtube.vanilla.js`).
Для этого в адаптере нужно реализовать методы, описанные ниже:
* **play()** - начать / продолжить воспроизведение
* **pause()** - пауза
* **seek({ time: 10 })** - перемотка. _time_ - время в секундах от начала видео
* **seekForward({ interval: 10 })** - перемотать вперед. _interval_ - необязательный параметр, если его нет, то перематываем на 10 сек.
* **seekBackward({ interval: 10 })** - перемотать назад. _interval_ - необязательный параметр, если его нет, то перематываем на 10 сек.
* **setVolume({ volume: 0.5 })** - установить громкость. _volume_ принимает значения от 0 до 1.
* **mute()** - выключить звук
* **unmute()** - включить звук

Проверить методы управления можно отправкой сообщений в песочницу.
Примеры:
```js
var data = {
    method: 'sandbox:play'
};
window.postMessage(data, '*');
```
```js
var data = {
    method: 'sandbox:seek',
    time: 10
};
window.postMessage(data, '*');
```
```js
var data = {
    method: 'sandbox:setVolume',
    volume: 0.5
};
window.postMessage(data, '*');
```

## Добавление новой песочницы

1. Копируем существующую, модифицируем;
2. Открываем `{ Абсолютный путь до fiji }/contribs/video-player/pages-common/{ Имя песочницы }/{ Имя песочницы }.html#{ Параметры песочницы }`. Проверяем, что работает;
3. Пишем в консоли песочницы `window.addEventListener('message', console.log.bind(console))`. Проверяем, что события с префиксом `sandbox` приходят в формате https://yandex.ru/support/video/partners/jsapi.xml
4. Правим тесты;
5. Вызываем `node tools/sandbox-test { Путь до блока песочницы }`. Проверяем, что тесты проходят;
6. Вызываем `make package`;
7. Коммитим изменение версии статики;
8. Добавляем в функцию `getName` файла `sandbox.bemhtml.js` новую песочницу;
9. Пишем тест на шаблон новой песочницы;
10. Добавляем новую песочницу (ту же, что добавляли в моду `getName`) в `player2/player2.vanilla.js` (на нужном уровне) в возвращаемый массив метода `getHostingsSupportedEvents`;
11. Вызываем `node tools/export-hostings` для обновления списка хостингов в `configs/hostings.json`;
12. Песочница добавлена =)
