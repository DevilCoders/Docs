# –°—á–µ—Ç—á–∏–∫–∏
–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—á–µ—Ç—á–∏–∫–æ–≤

[üìπ –î–æ–∫–ª–∞–¥ –ø—Ä–æ —Å—á–µ—Ç—á–∏–∫–∏](https://yadi.sk/i/8z5NOwIE5QoYgQ)

## –û—Å–Ω–æ–≤–Ω–æ–µ
–î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å [ctr](https://h.yandex-team.ru/?https://en.wikipedia.org/wiki/Click-through_rate), –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–≤–∞ —Å—á–µ—Ç—á–∏–∫–∞. –ù–∞ –ø–æ–∫–∞–∑ –∏ –Ω–∞ –∫–ª–∏–∫.

## –í–∏–¥—ã —Å—á–µ—Ç—á–∏–∫–æ–≤

* `blockstat` ‚Äì –ª–æ–≥, –∫–æ—Ç–æ—Ä—ã–π –ø–∏—à–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ [mapreduce](https://h.yandex-team.ru?https://ru.wikipedia.org/wiki/MapReduce) –∫–ª–∞—Å—Ç–µ—Ä. [‚ÑπÔ∏è –ü–æ–¥—Ä–æ–±–Ω–µ–µ](https://wiki.yandex-team.ru/statbox/availabledata/blockstatlog/)
* `redir` ‚Äì –ª–æ–≥, –∫–æ—Ç–æ—Ä—ã–π –ø–∏—à–µ—Ç—Å—è –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–º HTTP-—Å–µ—Ä–≤–µ—Ä–µ, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–ª–∏–∫–¥–µ–º–æ–Ω. –ù–∞ –Ω–µ–≥–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å —Å –∫–ª–∏–µ–Ω—Ç–∞ [‚ÑπÔ∏è –ü–æ–¥—Ä–æ–±–Ω–µ–µ](https://wiki.yandex-team.ru/statbox/availabledata/redirlog/)

–£ —Å—á–µ—Ç—á–∏–∫–æ–≤ `redir` –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–ª–∞—Å—Å–æ–≤. –û–Ω–∏ –∑–∞–¥–∞—é—Ç—Å—è –≤ –ø–æ–ª–µ `dtype` [‚ÑπÔ∏è –ü–æ–¥—Ä–æ–±–Ω–µ–µ](https://wiki.yandex-team.ru/search-interfaces/multimedia/images/counters/islands/strediwebwhento/)

`dtype`:
* `iweb` ‚Äì –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
* `stred` ‚Äì –¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

### –ü—É—Ç—å —Å—á–µ—Ç—á–∏–∫–∞
–£ –≤—Å–µ—Ö —Å—á–µ—Ç—á–∏–∫–æ–≤ –µ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `path`. –≠—Ç–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å—á–µ—Ç—á–∏–∫–∞.

–ü—É—Ç—å —Å—á–µ—Ç—á–∏–∫–∞ –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, —Å –∫–æ—Ç–æ—Ä–æ–π –æ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è.
* `search` ‚Äì –≤—ã–¥–∞—á–∞
* `index` ‚Äì –º–æ—Ä–¥–∞
* `viewer` ‚Äì –ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫

–ü—É—Ç—å —Å—á–µ—Ç—á–∏–∫–∞ –¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è.
* `click` ‚Äì –∫–ª–∏–∫
* `show` ‚Äì –ø–æ–∫–∞–∑
* `open` ‚Äì –æ—Ç–∫—Ä—ã—Ç–∏–µ
* `close` ‚Äì –∑–∞–∫—Ä—ã—Ç–∏–µ

–ü—É—Ç—å —Å—á–µ—Ç—á–∏–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ.
* `/index/snippet/button/click`

#### –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É—Ç–∏
–î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—á–µ—Ç—á–∏–∫–∞, –µ–≥–æ –ø—É—Ç—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω [—Å–ª–æ–≤–∞—Ä—ë–º blockstat](https://stat.yandex-team.ru/DictionaryEditor/BlockStat). –î–µ–ª–∞—Ç—å —ç—Ç–æ —Ä—É–∫–∞–º–∏ –Ω–µ –Ω—É–∂–Ω–æ, –¥–ª—è —ç—Ç–æ–≥–æ –≤ –∫–æ–¥–µ –µ—Å—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.

‚òù *–°–ª–µ–¥—É–µ—Ç —Å—Ç–∞—Ä–∞—Ç—å—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª—é—á–∏ –∏–∑ —Å–ª–æ–≤–∞—Ä—è –∏ –ø–æ –º–∏–Ω–∏–º—É–º—É –¥–æ–±–∞–≤–ª—è—Ç—å —Ç—É–¥–∞ –Ω–æ–≤—ã–µ.*

–í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤ —Ñ–∞–π–ª–µ [blockstat.dict.json](blockstat.dict.json) –ª–µ–∂–∏—Ç –∫–æ–ø–∏—è —Å–ª–æ–≤–∞—Ä—è. –ï—ë –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥–æ–π `fiji counters`.

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—É—Ç–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å npm –ø–∞–∫–µ—Ç `blockstat`.

```bash
> npx blockstat /index/snippet/button/click
629.254.440.882

> npx blockstat 629.254.440.882
index/snippet/button/click
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—á–µ—Ç—á–∏–∫–∞
–°–æ —Å—á–µ—Ç—á–∏–∫–æ–º –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –ø–æ–ª–µ `vars`. –ù–∞–∑–≤–∞–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω—ã –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å `-`.

```js
vars: {
    '-index': 1
    '-type': 'blogger'
}
```

‚òù *–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –Ω–∞–∑—ã–≤–∞—Ç—å –±–µ–∑ `-` –≤ –Ω–∞—á–∞–ª–µ, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ. –ù–æ —Ç–∞–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω—ã [—Å–ª–æ–≤–∞—Ä—ë–º blockstat](https://stat.yandex-team.ru/DictionaryEditor/BlockStat)*

## –ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å
–ù—É–∂–Ω–æ —Å–ª–∞—Ç—å —Å—á–µ—Ç—á–∏–∫–∏ –Ω–∞ –ª—é–±—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

* –ö–ª–∏–∫ –ø–æ —Å—Å—ã–ª–∫–µ
* –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ
* –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–ø–∞–ø–∞
* –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–ø–∞–ø–∞
* –°–∞–±–º–∏—Ç —Ñ–æ—Ä–º—ã

## –ß—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å
üí° –ï—Å–ª–∏ –ø–æ—Å–ª–µ –∏–∑—É—á–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –≤—Å–µ –µ—â—ë –Ω–µ –æ—á–µ–≤–∏–¥–Ω–æ –∫–∞–∫–æ–π —Å–ø–æ—Å–æ–± –≤—ã–±—Ä–∞—Ç—å, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –≤ —á–∞—Ç–µ [üí¨ Dev –í–∏–¥–µ–æ](https://t.me/joinchat/AnHOJhzLUVaJJuOg4MCTgw). –†–∞–∑–±–µ—Ä—ë–º –∫–µ–π—Å –∏ –¥–æ–ø–æ–ª–Ω–∏–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é.

### –ü—Ä–æ—Å—Ç–æ–π —Å–ª—É—á–∞–π
–ï—Å–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å—Ä–∞–∑—É ‚Äì —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ–π —Å–ª—É—á–∞–π.

–î–ª—è –ø–æ–∫–∞–∑–∞ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å `blockstat`, –¥–ª—è –¥–µ–π—Å—Ç–≤–∏—è `redir` `iweb`. –£ —Å—á–µ—Ç—á–∏–∫–æ–≤ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –ø—É—Ç—å.

### –°–ª–æ–∂–Ω—ã–π —Å–ª—É—á–∞–π
–ï—Å–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º —É—Å–ª–æ–≤–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä –≤ –ø–æ–ø–∞–ø–µ) ‚Äì —ç—Ç–æ —Å–ª–æ–∂–Ω—ã–π —Å–ª—É—á–∞–π.

–î–ª—è –ø–æ–∫–∞–∑–∞ –∏ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏—è –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å `redir` `iweb` —Å —Ä–∞–∑–Ω—ã–º–∏ –ø—É—Ç—è–º–∏.

–ù–∞–ø—Ä–∏–º–µ—Ä `/index/popup/button/show` –∏ `/index/popup/button/click`.

### –û—Å–æ–±—ã–π —Å–ª—É—á–∞–π
–ï—Å–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ —Å—Ä–∞–∑—É, –Ω–æ –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä ‚Äì —ç—Ç–æ –æ—Å–æ–±—ã–π —Å–ª—É—á–∞–π. –ù–∞–ø—Ä–∏–º–µ—Ä –æ—Å–æ–±—ã–º —Å–ª—É—á–∞–µ–º –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—è.

–ü—Ä–∏ –æ—Å–æ–±–æ–º —Å–ª—É—á–∞–µ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å `blockstat` –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ `redir` `iweb` –¥–ª—è –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ.

## –ö–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å
### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
#### –í video-viewer
1. –î–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ –≤ [getCounters.ts](https://github.yandex-team.ru/mm-interfaces/fiji/blob/dev/video-viewer/src/components/DataProvider/DataProvider.utils/getCounters.ts)
2. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å—á–µ—Ç—á–∏–∫ –≤ —Ç–∞–π–ø–∏–Ω–≥–∏ [VideoViewer.typings](https://github.yandex-team.ru/mm-interfaces/fiji/blob/dev/video-viewer/src/components/VideoViewer/VideoViewer.typings/index.ts)

‚òù *–ò–Ω–¥–µ–∫—Å —Å—á–µ—Ç—á–∏–∫–∞ –≤ `getCounters` —ç—Ç–æ –µ–≥–æ `name`, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ*

```js
{
    //...
    viewerButtonClick: counter.data({ // viewerButtonClick - name —Å—á–µ—Ç—á–∏–∫–∞
        path: '/viewer/button/click',
    }),
    //...
}
```

### –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ
1. –ü—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å callback –≤ —Ç–æ–º –º–µ—Å—Ç–µ, –≥–¥–µ –Ω—É–∂–Ω–∞ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å—á–µ—Ç—á–∏–∫–∞
2. –û–±–µ—Ä–Ω—É—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤ [withCounters](https://github.yandex-team.ru/mm-interfaces/fiji/blob/dev/video-viewer/src/lib/Counters/withCounters)

#### –°—á–µ—Ç—á–∏–∫ –Ω–∞ –¥–µ–π—Å—Ç–≤–∏–µ
```js
import { withCounters, CounterType } from '../../../lib/Counters';

export interface LinkProps {
    onClick: () => void
}

const LinkPresener: FC<LinkProps> = ({onClick, ...props}) => <a onClick={onClick} {...props}/>;

export const Link = withCounters<LinkProps>(Link, {
    events: {
        onClick: {
            name: 'viewerButtonClick', // - name —Å—á–µ—Ç—á–∏–∫–∞ c —Å–µ—Ä–≤–µ—Ä–∞
            type: CounterType.stred | CounterType.iweb // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é CounterType.iweb
            getVars: (props: LinkProps) => void; // –ü–æ–ª—É—á–∞–µ—Ç props, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç vars –¥–ª—è —Å—á–µ—Ç—á–∏–∫–∞
        }
    }
})
```

#### –°—á–µ—Ç—á–∏–∫ –Ω–∞ –ø–æ–∫–∞–∑
```js
import { withCounters, CounterType } from '../../../lib/Counters';

export interface LinkProps {
    onShow: () => void
}

const LinkPresener: FC<LinkProps> = ({onShow, ...props}) => {
    useEffect(onShow, []);

    return <a {...props}/>;
};

export const Link = withCounters<LinkProps>({
    events: {
        onShow: { name: 'viewerLinkClick' }
    }
})(LinkPresener)
```

#### –û—Ç–ø—Ä–∞–≤–∫–∞ –≤—Ä—É—á–Ω—É—é
‚òù *–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫—É –≤—Ä—É—á–Ω—É—é —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –º–µ—Ç–æ–¥–æ–º –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ*

–ï—Å–ª–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—á–µ—Ç—á–∏–∫–∞ –Ω—É–∂–Ω—ã –æ—á–µ–Ω—å —Å–ª–æ–∂–Ω—ã–µ —É—Å–ª–æ–≤–∏—è, –∏–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ `state`, –º–æ–∂–Ω–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤—Ä—É—á–Ω—É—é.

```js
import { useCounterStred, useCounterIweb } from '../../../lib/Counters';

export interface LinkProps {
    i: number
}

export const Link: FC<LinkProps> = ({number, ...props}) => {
    const stred = useCounterStred();
    const iweb = useCounterIweb();
    const [prevNumber, setPrevNumber] = useState(number);

    useEffect(() => {
        stred('viewerLinkNumber', { '-number': prevNumber });
        iweb('viewerLinkNumber', { '-number': prevNumber });

        setPrevNumber(number);
    }, [number]);

    return <a {...props}/>;
};
```

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏—Å—å
### –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ
–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—á–µ—Ç—á–∏–∫–æ–≤ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `?exp_flags=validate_counters`. –≠—Ç–æ—Ç —Ñ–ª–∞–≥ –≤–∫–ª—é—á–∞–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—á–µ—Ç—á–∏–∫–æ–≤ –≤ –∫–æ–Ω—Å–æ–ª—å.

–í –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–µ –≤–æ –≤–∫–ª–∞–¥–∫–µ `Network` –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –∑–∞–ø—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–∞ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–≤ –ø–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –ø—É—Ç–∏ *(–Ω–∞–ø—Ä–∏–º–µ—Ä `path=629.254.440.882`)*

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ `templar` —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π —Ñ–∞–π–ª –ª–æ–≥–æ–≤ blockstat. –ù—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å—á–µ—Ç—á–∏–∫ –∑–∞–ø–∏—Å–∞–Ω –≤ —ç—Ç–æ—Ç —Ñ–∞–π–ª.

–ü–∞–ø–∫–∞, –≤ –∫–æ—Ç–æ—Ä–æ–π —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ñ–∞–π–ª –≤–∏–¥–∞ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ `--logs` –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ dev —Å–µ—Ä–≤–µ—Ä–∞.

–î–æ–ø—É—Å—Ç–∏–º –ª–æ–≥–∏ –ª–µ–∂–∞—Ç –≤ –ø–∞–ø–∫–µ `--logs /Users/username/.yandex-int/logs/rr`.

–ß—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—á–µ—Ç—á–∏–∫, –Ω—É–∂–Ω–æ:
* –û—á–∏—Å—Ç–∏—Ç—å –ø–∞–ø–∫—É `/Users/username/.yandex-int/logs/rr`
* –ó–∞–ø—É—Å—Ç–∏—Ç—å dev —Å–µ—Ä–≤–µ—Ä
* –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ
* –ù–∞–π—Ç–∏ –≤ –ø–∞–ø–∫–µ `/Users/username/.yandex-int/logs/rr` –ª–æ–≥ —Å blockstat –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä `current-report-renderer_blockstat-12345`) –∏ –æ—Ç–∫—Ä—ã—Ç—å
* –ù–∞–π—Ç–∏ –≤ —Ñ–∞–π–ª–µ –Ω—É–∂–Ω—É—é –∑–∞–ø–∏—Å—å –ª–æ–≥–∞ –ø–æ –ø—É—Ç–∏ —Å—á–µ—Ç—á–∏–∫–∞ *(–Ω–∞–ø—Ä–∏–º–µ—Ä `/viewer/button/click`)*

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∑–∞–ø–∏—Å–∞–ª–∏—Å—å
–ß—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å—á–µ—Ç—á–∏–∫–∏ –ø–∏—à—É—Ç—Å—è, –Ω–∞–¥–æ —Å–¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å –≤ [mapreduce](https://h.yandex-team.ru?https://ru.wikipedia.org/wiki/MapReduce).

–ó–∞–ø—Ä–æ—Å –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤ —Å–µ—Ä–≤–∏—Å–µ [yql.yandex-team.ru](https://yql.yandex-team.ru/) –∏—Å–ø–æ–ª—å–∑—É—è —Å–∏–Ω—Ç–∞–∫—Å–∏—Å [YQL](https://yql.yandex-team.ru/docs/).

### –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ
–õ–æ–≥–∏ —Å—á–µ—Ç—á–∏–∫–æ–≤ –ª–µ–∂–∞—Ç –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ `hahn` –ø–æ –ø—É—Ç–∏ `/logs/redir-log/`.

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞
```sql
USE hahn; /* –ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ */

SELECT * /* –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø–æ–ª—è —á–µ—Ä–µ–∑ , */
FROM `//logs/redir-log/30min/2020-07-17T16:00:00` /* 30min, –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å 1h –∏–ª–∏ 1d */
WHERE
    `dict`['dtype'] == 'iweb' and /* dtype —Å—á–µ—Ç—á–∏–∫–∞ */
    `dict`['path'] == '629.254.440.882' /* path —Å—á–µ—Ç—á–∏–∫–∞ */
```

[–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞](https://yql.yandex-team.ru/Operations/XxWveCAsJQvJeImKj200rEgizMsYSOXEJOBl63-JKBw=)

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
–õ–æ–≥–∏ —Å—á–µ—Ç—á–∏–∫–æ–≤ –ª–µ–∂–∞—Ç –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ `hahn` –ø–æ –ø—É—Ç–∏ `/logs/video-blockstat-log`.

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞
```sql
USE hahn; /* –ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ */

SELECT * /* –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø–æ–ª—è —á–µ—Ä–µ–∑ , */
FROM `//logs/video-blockstat-log/30min/2020-07-19T13:30:00` /* 30min, –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å 1h –∏–ª–∏ 1d */
WHERE
    blocks like '%/viewer/button/click%' /* path —Å—á–µ—Ç—á–∏–∫–∞ */
LIMIT 10 /* –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, —á—Ç–æ–± –±—ã—Å—Ç—Ä–µ–µ –±—ã–ª–æ */
```

[–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞](https://yql.yandex-team.ru/Operations/XxWyPWim9Yp5H_5nk7UcWmydCdXkdKI-ffMNZZwIeoo=)

## –ö–∞–∫ –Ω–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç
### –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ

* –í—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ
* –ü–æ–ª—É—á–∏—Ç—å `reqid`
* –í—ã–∑–≤–∞—Ç—å [yaCheckClientCounter](https://github.yandex-team.ru/mm-interfaces/fiji/blob/dev/runner/hermione/commands/yaCheckClientCounter.js), –ø–µ—Ä–µ–¥–∞–≤ –ø—É—Ç—å —Å—á–µ—Ç—á–∏–∫–∞

```js
return this.browser
    .click(PO.viewer.button())
    .getReqId(PO.page()).then((reqid) => this.browser.yaCheckClientCounter(reqid, {
        path: '/viewer/button/click'
    }))
```


### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
* –ü–æ–ª—É—á–∏—Ç—å `reqid`
* –í—ã–∑–≤–∞—Ç—å [yaCheckServerCounter](https://github.yandex-team.ru/mm-interfaces/fiji/blob/dev/runner/hermione/commands/yaCheckServerCounter.js), –ø–µ—Ä–µ–¥–∞–≤ –ø—É—Ç—å —Å—á–µ—Ç—á–∏–∫–∞

```js
return this.browser
    .click(PO.viewer.button())
    .getReqId(PO.page()).then((reqid) => this.browser.yaCheckServerCounter(reqid, {
        path: '/viewer/button/click'
    }))
```
