
# VideoPlayer

## Содержание
1. Примеры использования
2. Пропсы
3. Параметры для счётчиков
4. Логика работы

## Примеры использования

Плеер без счётчиков

    <VideoPlayer url={{
    	baseUrl: 'someUrl',
    	hash: 'urlHash' // необязательное поле
    	placeholderImage: 'somePic.jpg' // необязательное поле - ссылка на картинку-заглушку
    }} />

Плеер со ссылкой на ролик рекламы

    <VideoPlayer
	    url={{
	    	baseUrl: 'someUrl'
	    }}
	    isAd: true // необязательное поле
	/>

Плеер со счётчиками

    <VideoPlayer
	    url={{
	    	baseUrl: 'someUrl'
	    }}
	    videoCounterParams={{
		    duration: 123, // длительность ролика в секундах
		    origin: 'youtube.com/video', // ссылка на оригинальное видео
		    reqid: 'reqid', // идентификатор запроса
		    videoUrl: 'yandex.ru/video/someVideo', // ссылка на сервисе видео
		    host: 'youtube', // необязательное поле - хост
		    position: 2 // необязательное поле - позиция ролика в выдаче
	    }}
	/>

## Пропсы

Плеер может принимать следующие данные:

1.  *url* - ссылка на само видео в формате {baseUrl: string, hash: string}
2.  *videoCounterParams* - объект с данными для счётчиков (которого может не быть)
3.  *placeholderImage* - ссылка на картинку-заглушку для плеера
4.  *isAd* - идентификатор того, что плеер показывает рекламу
5. Различные обработчики событий песочницы

## Параметры для счётчиков

VideoPlayer умеет отправлять следующие счётчики:

- open-player - Счётчик нужен для того, чтобы понять, что пользователь смотрит видео. Срабатывает на mount плеера и в момент получения новой ссылки
- duration - Счётчик нужен для того, чтобы понять, сколько времени пользователь посмотрел конкретное видео. Срабатывает на unmount плеера и перед обновлением плеера на новое видео

Помимо плеерных счётчиков есть ещё счётчики песочницы, которые она отправляет, имея определённые данные.

## Логика работы

1. Сначала мы определяем, стоит ли показывать спиннер загрузки видео. Этот спиннер показывается во время загрузки iframe с видео, пряча его. Если же в течение 3 секунд iframe не вызвал событие onIframeLoad или не сработало событие инициализации песочницы, то плеер показывает iframe принудительно. Стоит отметить, что спиннер загрузки не стоит показывать, если плеер отображает рекламу, поскольку инициализация происходит сразу, а события срабатывают далеко не всегда.

2. Далее плеер навешивает на window listener, который слушает события песочницы и обрабатывает их с помощью eventCallbackMap.

3. Также плеер умеет отправлять счётчики, если переданы необходимые параметры.