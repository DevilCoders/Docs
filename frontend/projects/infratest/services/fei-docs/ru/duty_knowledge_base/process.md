# Процесс дежурства

## INFRADUTY

От каждого из контуров участвует один дежурный в соответствии с расписанием в сервисе контура.
Каждый "контурный" дежурный разбирает только обращения зон ответственности, которые относятся к его контуру.

Общую очередь можно найти на [основной доске](https://st.yandex-team.ru/dashboard/7855), а список контурных дашбордов -
в [виджете с информацией](https://st.yandex-team.ru/dashboard/7855#36466).

Дежурство состоит из нескольких видов деятельности:

- [разбор обращений](#appeals)
- [сопровождение плановых работ](#maintenances)
- [устранение инцидентов](#incidents)

### Разбор обращений {#appeals}

В рамках дежурства существует две очереди обращений: очередь обращений на первичную проверку и очередь на разбор отложенных обращений.

На каждом этапе разбора обращений можно столкнуться с тем, что не хватает документации или экспертизы.
В этом случае нужно незамедлительно обратиться за помощью к эксперту, чтобы не задерживать разбор обращений.
Эксперт - это один из разработчиков [ABC-сервиса зоны ответственности](https://abc.yandex-team.ru/services/FEI/services/?tags=120)
(чаще вы будете обращаться к руководителю этого сервиса - ответственному за эту область), которым размечено обращение.

#### Первичная проверка {#check}

Очередь отображена на виджете "Ожидает первичной проверки".

**SLA на проверку критичности проблемы (реакцию): 30 минут от создания тикета только в рабочие дни с 12:00 до 18:00.** В остальное время для привлечения внимания дежурного используется [эскалация](eskalaciya.md).

Каждое новое обращение должно быть проверено на предмет критичности проблемы. Критичность определяется в первую очередь потенциальным ущербом для разработчиков.

1. Взять первое в очереди обращение.

1. Если обращение — дубликат одного из разбираемых обращений (секции "Разбираем", "На стороне пользователя", "На стороне смежников"), закрыть обращение с резолюцией `Дубликат/Duplicate` в пользу уже разбираемого тикета.

1. Если обращение — фичереквест, то изменить `Тип/Type` задачи на `Новая возможность/New Feature`, призвать эксперта в обращение.

1. Если в обращении сообщается о проблеме, то определить критичность проблемы по приведенной ниже шкале; для обращений остальных типов считать критичность равной 0.

  - 0 — массовых падений нет, возможен незначительный регресс
  - 1 — проблема в релизе
  - 2 — массово задета локальная разработка
  - 3 — массово задеты сборки PR
  - 4 — массово задеты сборки MQ

2. Если критичность = 0, то выставить обращению приоритет `Нормальный/Normal`, перевести в `Обращение проверено/Appeal is checked` (статус `Проверено/Checked`).

3. Если критичность > 0, то выставить обращению повышенный приоритет `Критичный/Critical` (можно `Блокирующий/Блокер`).

4. Если критичность = 1, то перевести в `Обращение проверено/Appeal is checked` (статус `Проверено/Checked`), найти исполнителя в своем контуре, который немедленно приступит к [разбору](#process) обращения.

4. Если критичность > 1, то [создать инцидент](https://wiki.yandex-team.ru/infraduty/alarm), указав обращение источником сигнала, и закрыть данное обращение. Работайте с инцидентом согласно [процессу](https://wiki.yandex-team.ru/search-interfaces/infra/duty/incidents/), и помните, что первоочередная задача — потушить пожар.

5. Если критичность = 4, то [остановить MQ](https://wiki.yandex-team.ru/search-interfaces/infra/duty/cookbook/#kakostanovit/vozobnovitochered) на задетых проектах.

#### Разбор {#process}

Очередь отображена на виджете "Ожидает разбора".

Процесс:

1. Взять первое в очереди обращение, назначить себя исполнителем, перевести в `Начать работу/Start Progress` (статус `В работе/In Progress`).

1. Поискать документацию или образцово разобранный тикет [внутренним поиском](https://search.yandex-team.ru/search). Если не нашли, спросите у эксперта.

1. Если в процессе разбора оказывается, что экспертизы не хватает (через час от начала разбора всё ещё не понятно, как разбирать обращение/мониторинг),
то привлечь эксперта к разбору. В этом случае эксперт разбирает обращение, а дежурный следит за тем, чтобы обращение было разобрано.
Призывая эксперта, переведите обращение в `На стороне эксперта FEI/On the side of FEI expert` (статус `На стороне менеджера/On the side of manager`).
При ответе эксперта (экспертом считается разработчик FEI, не являющийся дежурным на данный момент) обращение будет автоматически переводиться в статус `Открыт/Open`.

1. Если в процессе разбора оказывается, что проблема находится на стороне используемой нами инфраструктуры вне FEI,
свяжитесь с ответственными за этот компонент через установленный ими канал поддержки.
Пока вы получаете от смежников ответ, переведите обращение в `На стороне смежников вне FEI/On the side of partner outside of FEI` (статус `На стороне партнера/On the side of partner`).
После исправления проблемы или получения задачи на исправление проблемы необходимо вручную перевести обращение в следующий статус:

  - `Переоткрыть/Reopen` (статус `Открыт/Open`), если также требуются работы с нашей стороны
  - `Закрыть/Close` (статус `Закрыт/Closed`), если работ с нашей стороны не требуется.

1. Если в процессе разбора оказывается, что вы закопались и конца и края не видно (тикет в работе больше 3 рабочих дней и до сих пор не понятно, что вызвало проблему),
попросите эксперта завести задачу в контур на разбираемую проблему и закройте обращение со ссылкой на эту задачу.

1. Перед закрытием обращения убедиться, что баги на все проблемы, с которыми вы столкнулись при разборе обращения:

  - заведены,
  - качественно описаны (баг = шаги воспроизведения + ожидаемое поведение + реальное поведение),
  - прилинкованы к обращению,
  - содержат в поле `ABC Сервис/ABC Service` сервис зоны ответственности (чтобы задача попала на радары к ответственному за область).

  На что надо заводить задачи:

  - на поломки инструментов,
  - на непонятные ошибки,
  - на плохое логгирование,
  - на флапающие мониторинги,
  - на ложные срабатывания мониторингов,
  - на отсутствие документации

1. При закрытии обращения:
  - выставить обращению подходящую резолюцию:
    - Fixed. Обращение валидное и было разобрано или закрыто в пользу FEI или любого другого тикета.
    - Invalid. Обращение не связано с инфраструктурой, которую мы разрабатываем и поддерживаем; проблему можно было решить силами команды автора обращения; невалидный сигнал мониторинга (мониторинг флапнул, не показал проблему, ...).
  - выставить обращению `ABC Сервис/ABC Service` области ответственности
  - если можно автоматизировать разметку/разбор, выставить компонент `duty: automatable` (в комментарии указать, что можно автоматизировать)

### Сопровождение плановых работ {#maintenances}

Подразумеваются:

- регламентные работы (можно увидеть future events в [фиде пресета](https://infra.yandex-team.ru/feed?preset=Cs51xCixnx6))
- плановые работы смежников
- собственные плановые работы

Для информирования пользователей необходимо создать тикет с типом события maintenance [через форму](https://wiki.yandex-team.ru/infraduty/alarm).

[Подробности](https://wiki.yandex-team.ru/search-interfaces/infra/duty/#uvedomlenijaoplanovyxrabotax).

### Устранение инцидентов {#incidents}

Подразумеваются:

- внезапные поломки у смежников
- внезапные поломки, вызванные нашими изменениями

Для информирования пользователей необходимо создать тикет с типом события incident [через форму](https://wiki.yandex-team.ru/infraduty/alarm).

[Подробности](https://wiki.yandex-team.ru/search-interfaces/infra/duty/incidents/).

## RRDUTY

Подробнее про дежурство контура RR можно прочитать на [вики](https://wiki.yandex-team.ru/search-interfaces/infra/report-renderer/duty).

## Завершение дежурства {#finish}

В конце дежурства:

- незавершенные инциденты снимите с себя (очистить поле `Исполнитель/Assignee`, статус менять не нужно)
- незавершенные обращения снимите с себя и переведите в `Открыт/Open` (очистить поле `Исполнитель/Assignee`)
- расскажите ответственному за дежурство - @fenice - о проблемах, с которыми вы столкнулись в ходе дежурства
