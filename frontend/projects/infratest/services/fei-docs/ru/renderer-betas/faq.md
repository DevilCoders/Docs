# FAQ

## Как посмотреть логи

_Задачка на улучшение просмотра логов бет - [FEI-22582](https://st.yandex-team.ru/FEI-22582)_

Есть следующие варианты посмотреть логи для беты:

### Пойти в контейнеры с бетой по ssh

Поскольку для бет применяется репликация, бета-версия шаблонов может присутствовать сразу в 2-х контейнерах с бетами. Вероятно, для не совсем точечного дебага достаточно зайти на одну машинку. Делается это так (исходим из того, что нам доступно только имя беты):

1. Находим UI беты, например, для `renderer-web4-dev.yandex-team.ru` это [https://yappy.z.yandex-team.ru/b/renderer-web4-dev](https://yappy.z.yandex-team.ru/b/renderer-web4-dev), где последняя часть это `renderer-{id_проекта}-pull-{номер_пулреквеста}` или `renderer-{id_проекта}-dev` или `renderer-{id_проекта}-release`.
1. В сайдбаре нажимаем **Components**.
1. Откроется страница, на которой будет видно обе реплики беты, со ссылками на соответствующие няня-сервисы:
![](https://jing.yandex-team.ru/files/rmdm/comps-2.png)
1. Берем последнее число в этих ссылках, это номер слота с бетой. По нему можно вывести номер порта, на котором в каждой из реплик поднята бета с вашим шаблоном. Формула такая `порт = 4000 + <номер слота> * 10`. Таким образом, для изображенных реплик порт будет `4020` и `4210` соответственно.
1. Теперь можно перейти по этим ссылкам (или по одной, если этого достаточно), откроются сервисы в няне.
1. Там стандартным образом заходим по SSH на под (он один на каждый сервис).
1. Смотрим нужный лог шаблонов, например, debug, подставив правильный порт из п.4: `tail -100 /logs/current-report-renderer_renderer-debug-event-templates-port-4020 | report-renderer/bin/log-formatter`.

   **Важно:** Здесь есть особенность для сервисов, не полностью переехавших на AppHost: `fiji`. Чтобы посмотреть лог apphost-шаблонов, нужно к порту выше прибавить единичку: `порт (apphost fiji) = 4000 + <номер слота> * 10 + 1`; в случае HTTP-шаблонов прибавлять нужно не 4000, а 8080, и умножать не на 10, а на 5: `порт (http fiji) = 8080 + <номер слота> * 5`.

### В setrace по reqid

Если у вас есть reqid запроса, можно посмотреть логи вершины с рендерером в [setrace](https://setrace.yandex-team.ru/):

![](https://jing.yandex-team.ru/files/rmdm/rr-logs.png)

reqid можно получить так:

- из заголовка `X-Yandex-Req-Id` ответа на исходный запрос,
- либо добавляем к запросу на бету параметр `dump_eventlog_only=1` и ищем событие `TReqID` в полученном ответе.

## Как заменить квоту

_Или, что делать в случае ошибки вида `Quotas in beta template (report-renderer-templates, report-renderer-templates-replica) don't match the quota specified in the config file (report-renderer-serp)`_.

В случае, если требуется заменить квоту, в которой поднимаются беты с шаблонами рендерера на новую (и/или вы видите сообщение подобное сообщению выше в тасках деплоя в своем пулл-реквесте, в котором вы меняете квоту в конфиге renderer-бет), необходимо обратиться через [форму infraduty](https://wiki.yandex-team.ru/infraduty/form/), выбрав инструмент "Деплой бет" с запросом на смену квоты ([инструкция для дежурного](../duty_knowledge_base/renderer-betas.md#izmenenie-kvoty)). При этом, беты в пулл-реквестах, до которых новый конфиг еще не доехал, при новых запусках начнут падать с подобной ошибкой, но уже с обратным порядком квот, в них потребуется либо отребейзиться, либо внести необходимую правку.

Если же вы видите сообщение с ошибкой выше в логах таски деплоя беты в своем пулл-реквесте, при этом конфиг бет вы не трогали, вероятно кто-то уже поменял квоту и тогда достаточно отребейзиться, либо внести необходимую правку в своем пулл-реквесте.
