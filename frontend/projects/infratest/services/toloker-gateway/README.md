# toloker-gateway

HTML-страница, проверяющая соответствие окружения толокера с требуемым в задании.

## Общая информация

* Страница должна работать даже на самых старых окружениях (условно IE7+).
* Конфиг ожидаемого передаётся через Query-параметр (`?hash`) закодированный в Base64 и имеет [следующий формат](#формат-конфига).
* Переданный конфиг матчится на распаршенный UserAgent пользователя.
* Если проверка пройдена, то отображается код, который рассчитывается как `Unicode` представление первого и последнего символа строки из поля `key` в конфиге, записанное в два слова через пробел. Оба слова всегда имеют длину в 3 символа (`101 621`). Далее код используется толокером для доступа к заданию в Yang-е.

## Формат конфига

```js
{
    key: 'fb9a20c8cf3ad602636b9454f7afff9c',
    env: {
        BrowserName: {
            type: 'string',
            value: 'Edge'
        },
        BrowserVersion: {
            type: 'version',
            value: '78.x.x - 79.x.x'
        },
        OSName: {
            type: 'string',
            value: 'Windows 10'
        },
        OSVersion: {
            type: 'version',
            value: '10.x.x'
        }
    }
}
```

## Поддерживаемые типы матчеров

### `string`

Матчер по строке с приведением регистра.

```js
{
  OSName: {
      type: 'string',
      value: 'Windows 10' // равносильно windows 10 у пользователя
  },
}
```

### `version`

Матчер версий с использованием [semver](https://www.npmjs.com/package/semver).

В этом матчере рекомендуется использовать [Hyphen Ranges](https://www.npmjs.com/package/semver#hyphen-ranges-xyz---abc) или [X-Ranges](https://www.npmjs.com/package/semver#x-ranges-12x-1x-12-), потому что значение будет передано асессору в шаблон без изменений.

⚠️ Версия текущего окружения преобразуется перед тем, как попытаться её проверить по шаблону. Правила преобразования:
Нули в начале составных частей версий будут удалены, так что версия `14.01.00` будет преобразована в `14.1.0`.

## Тестирование

Обязательно требуется проверить работоспособность в IE8, как минимум.

## Деплой

Деплоимся в асессорский бакет в s3 (`crowdtest`) в директорию `public`. Деплой полуавтоматический с использованием команды `npm run deploy`. В переменных окружения должны быть `S3_ACCESS_KEY_ID` и `S3_SECRET_ACCESS_KEY`.
