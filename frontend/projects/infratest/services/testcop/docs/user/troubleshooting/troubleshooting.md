# Проблемы и их решения

## В прогоне запустились все (или почти все) заскипанные тесты

Как устранить проблему:

- перейдите в [Sandbox][sandbox];

- [найдите](https://sandbox.yandex-team.ru/tasks?children=true&type=SANDBOX_CI_BUILD_SKIP_TESTS_LIST&limit=20&created=3_days) последнюю задачу `SANDBOX_CI_BUILD_SKIP_TESTS_LIST`, которая опубликовала ещё нормальный скип-лист;

- склонируйте её и запустите заново;

- убедитесь, что опубликован новый не пустой скип-лист;

- склонируйте и перезапустите последовательно все задачи `SANDBOX_CI_BUILD_SKIP_TESTS_LIST`, которые запускались после последней успешной задачи, чтобы в скип-лист попали все тесты, заскипанные уже после нее.

Данная проблема будет окончательно решена после [FEI-18177](https://st.yandex-team.ru/FEI-18177).

## Пустой список заскипов на странице Тесткопа /skips/{tool}/{project}

Вы перешли в [Тесткоп][testcop] и открыли страницу со списком заскипанных тестов для вашего проекта:

![скриншот: пустой список заскипов](https://jing.yandex-team.ru/files/robot-testcop/testcop.doc.user.troubleshooting.skip-list-is-absolutely-empty.png)

А на странице ничего не отображается.

Список может быть пустым по двум причинам:

1. Скип-лист, действительно, пустой: ни один тест в проекте *(project)* для указанного инструмента *(tool)* и ветки *(branch)* не заскипан.

2. Система не может найти скип-лист из-за того, что к ресурсу в Sandbox'е, в котором он хранится, давно не обращались: временная метка *Accessed* у ресурса старше недели.

Самый быстрый способ понять с каким случаем мы имеем дело, это открыть ссылку вида:

`https://testcop.si.yandex-team.ru/api/v1/skip-list/{tool}/{project}?branch={branch}`

где вместо `{tool}`, `{project}` и `{branch}` надо подставить ваш инструмент, имя проекта и ветку в проекте *(например, `dev`, `master` или релизную ветку)*.

Если по ссылке открывается пустой JSON, то ничего делать не нужно, скип-лист, действительно, пустой.

Иначе, выполните следующие действия:

- откройте [Sandbox][sandbox];

- перейдите на вкладку [Resources](https://sandbox.yandex-team.ru/resources?limit=20&created=14_days);

- найдите ресурс со скип-листом для вашего проекта, указав следующие параметры поиска:

  - Resource type: `SANDBOX_CI_ARTIFACT`;

  - Attributes:
  
    - key = `project`, value = `имя вашего проекта`;

    - key = `branch`, value = `ветка в вашем проекте`;
    
    - key = `type`, value = `skip-tests-list`
    
    все атрибуты должны быть типа `string` и применяться с оператором `AND`.

  *См. [пример](https://sandbox.yandex-team.ru/resources?type=SANDBOX_CI_ARTIFACT&limit=20&attrs=%7B%22project%22%3A%22web4%22%2C%22branch%22%3A%22dev%22%2C%22type%22%3A%22skip-tests-list%22%7D) поискового запроса для проекта web4.*

  ![скриншот: поиск ресурса со скип-листом](https://jing.yandex-team.ru/files/robot-testcop/testcop.doc.user.troubleshooting.searching-skip-list-in-sandbox.png)

- после того, как вы нашли нужный ресурс, откройте его и обновите временную метку `Accessed`, перейдя по ссылке вида `https://proxy.sandbox.yandex-team.ru/{ID ресурса}`:

  ![скриншот: ресурс со скип-листом](https://jing.yandex-team.ru/files/robot-testcop/testcop.doc.user.troubleshooting.skip-list-in-sandbox.png)

- перейдите в [Тесткоп][testcop] и откройте страницу со скип-листом для вашего проекта, чтобы убедиться, что скип-лист отображается корректно.

Мы планируем решить данную проблему в [FEI-22469](https://st.yandex-team.ru/FEI-22469). И окончательно отказаться от хранения скип-листов в ресурсах Sandbox'а в [FEI-18177](https://st.yandex-team.ru/FEI-18177).

## Тест до сих пор заскипан, хотя тикет заскипа уже давно закрыт

Скорее всего, в названии теста были кавычки – из-за этого при закрытии тикета система не смогла расскипать тест.

Эта бага была починена в [FEI-21671](https://st.yandex-team.ru/FEI-21671).

После чего часть нерасскипанных тестов проверялась и расскипывалась в рамках задачи [FEI-21672](https://st.yandex-team.ru/FEI-21672).

**Что делать?**

Нужно перескипать тест на новый тикет заскипа, прогнать его *(см. опцию гермионы `--repeat`)*, и, если тест успешно проходит без необходимости внесения правок в код, то расскипать тест через [Тесткоп][testcop].

Если же тест падает, то починить его, и расскипать уже в рамках обычного рабочего процесса: через ревью-реквест с указанием тикета заскипа.

Примеры обращения в `INFRADUTY` с подобной проблемой:

- [INFRADUTY-15343](https://st.yandex-team.ru/INFRADUTY-15343)

- [INFRADUTY-15974](https://st.yandex-team.ru/INFRADUTY-15974)

- [INFRADUTY-16574](https://st.yandex-team.ru/INFRADUTY-16574)

## В Testpalm не прорастает информация о том, что тест расскипан

Скорее всего, тест, действительно, заскипан, поэтому в Testpalm'е он и отображается как заскипанный. См. выше.

[sandbox]: https://sandbox.yandex-team.ru
[testcop]: https://testcop.si.yandex-team.ru/
