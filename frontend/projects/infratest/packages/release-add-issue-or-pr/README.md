# release-add-issue-or-pr

Пакет для добавления коммитов в релизную ветку по указанным пулл-реквестам или тикетам.

## Входные параметры

* **commitIdentifiers** — список номеров пулл-реквестов или ключей тикетов.
* **owner** — owner репозитория на GitHub.
* **repo** — название репозитория на GitHub.
* **baseBranch** — базовая ветка, в которой будут искаться коммиты.
* **branch** — релизная ветка в которую нужно черри-пикать коммиты.
* **updateIssue** — обновлять ли описание релизного тикета и статусы добавленных тикетов. По умолчанию выключено.
* **nextStatus** — статус в который надо перевести тикеты, к которым привязаны коммиты.

## Поиск комитов по пулл-реквестам

По указанным номерам пулл-реквестов ищутся их merge-commit'ы в базовой ветке.
После чего найденные merge-commit'ы черри-пикаются в релизную ветку.
Если включено обновление тикетов, то список тикетов извлекается из тела merge-commit'a, которое содержит заголовок пулл-реквеста, который в свою очередь содержит в самом начале номер тикета. Если у пулл-реквеста в заголовке несколько тикетов указано через запятую, то обновлены будут они все.

## Поиск комитов по тикетам

По указанным ключам тикетов ищутся коммиты в базовой ветке у которых в теле в самом начале первым указан искомый ключ тикета.
После чего найденные коммиты черри-пикаются в релизную ветку.
Если включено обновление тикетов, то обновляются тикеты, по которым искали коммиты.

## Обновление тикетов

Данная опция выключена по умолчанию.
Если опция включена происходит следующее:

1. В релизный тикет в описание добавляется список добавленных тикетов.
1. Всем добавленным тикетам, а также их саб-тикетам, меняется статус на указанный в **nextStatus**.

## Дополнительно

* Если найденные для черри-пика коммиты уже присутствуют в целевой ветке, то будет брошено исключение.
* Если включено обновление тикетов и будет найдено больше одного релизного тикета, то будет брошено исключение.
* Релизный тикет ищется по названию репозитория и номеру версии в очереди SEAREL.

## CLI

```bash
Добавление пулл-реквестов или задач в релизную ветку

Options:
  --help, -h            Show help                                      [boolean]
  --version, -v         Show version number                            [boolean]
  --owner               владелец репозитория на GitHub                [required]
  --repo                название репозитория                          [required]
  --base-branch         в какой ветке искать коммиты по задаче        [required]
  --branch              в какую ветку черри-пикать коммиты по задаче  [required]
  --commit-identifiers  номера нужных задач или пулл-реквестов, разделённые
                        запятыми                             [string] [required]
  --next-status         статус в который необходимо перевести тикет
  --update-issue        обновить описание релизной задачи и перевести все тикеты
                        в указанный статус                             [boolean]

```
