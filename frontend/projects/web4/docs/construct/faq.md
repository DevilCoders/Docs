# FAQ по Конструктору

- [Как понять – создавать новый блок или дорабатывать существующий](#Как-понять--создавать-новый-блок-или-дорабатывать-существующий)
- [Как создать новый блок](#Как-создать-новый-блок)
- [Можно ли указывать конструкторские блоки в deps-ах](#Можно-ли-указывать-конструкторские-блоки-в-deps-ах)
- [Как писать стили конструкторским блокам](#Как-писать-стили-конструкторским-блокам)
- [Можно ли хакрдкодить настройки шрифта в стилях](#Можно-ли-хакрдкодить-настройки-шрифта-в-стилях)
- [Как "раскрасить" блок под тему поискового ответа](#Как-раскрасть-блок-под-тему-поискового-ответа)
- [Как правильно кастомизировать блоки внутри друг друга](#Как-правильно-кастомизировать-блоки-внутри-друг-друга)
- [Как расширить функционал сразу нескольких блоков](#Как-расширить-функционал-сразу-нескольких-блоков)
- [Как в блоке получить данные сразу от нескольких адаптеров](#Как-в-блоке-получить-данные-сразу-от-нескольких-адаптеров)
- [Как правильно экспериментировать с блоками](#Как-правильно-экспериментировать-с-блоками)
- [Как переопределить счетчик на блоке](https://wiki.yandex-team.ru/search-interfaces/baobab/#razmetkacherezkonstruktor)
- [Где прочитать про клиентские счетчики](https://wiki.yandex-team.ru/search-interfaces/baobab/#klientskieschetchikivanilla.js/i-bem.js)

### Как понять – создавать новый блок или дорабатывать существующий?

Чтобы просмотреть все существующие блоки на конструкторе можно воспользоваться [документацией](https://serpdocs.si.yandex-team.ru).

**Не плодите, пожалуйста, блоки аналогичные существующим или очень схожие!** Обсудите с дизайнером уже имеющиеся в наличие блоки – они тоже заинтересованы в единообразии!

Если вы нашли блок, который подходит вам, как базовый, но нужен отличный вид или доработки, то **не бойтесь дорабатывать существующие блоки**. Это может быть как модификатор с какой либо темой для блока, так и доработка основной функциональности блока. Но при этом не забывайте соблюдать чистоту в коде блоков – все доработки должны быть:
- отчуждаемы (чтобы можно было оторвать по ненадобности, чтобы код не превращался в лапшекод, чтобы было проще покрыть тестами)
- покрыты тестами и иметь примеры
- задокументированы
- без изменений базового API блока (если не готовы обновить всё, где используется этот блок)
- без изменений базового поведения блока, НО если это делается преднамеренно, то должно быть согласовано с дизайнерами
- без привязки к какой либо фиче (**Плохой пример:** передавать `type: 'z-afisha'` в блок `thumb`)

### Как создать новый блок?

Если вы точно удостоверились, что ничего схожего среди существующих блоков нет, то можно приступить к созданию нового блока на конструкторе. При создании блока не забывайте руководствоваться пунктами:

>Блок – это компонент. Он должен быть спроектирован так, чтобы при удалении его вызова не пришлось больше ничего выпиливать и править.

>Не создавайте блок `table2`, если это та же таблица, но немного с другой функциональностью – доработайте `table`.

>Все новые блоки на проекте необходимо создавать в рамках конструктора (в папке `construct/`).

>Именовать новый блок необходимо как можно очевидней, даже если вы считаете, что блок одноразовый. Опять же, завтра может всё поменяться и кому-то он пригодится! **Не называйте блок по имени фичи!** Фича - это адаптер, внутри которого мы уже используем нужные нам блоки. Если используем форму, паранджу, или другой компонент, то именуйте соответствующе. Это предотвратит дублирование блоков, упростит навигацию и поиск блоков.

> Плохой пример именования: `z-emias` или `emias`
> **Хороший пример именования**: `form`, `overlay`, `key-value`

Далее действуем по [алгоритму](./blocks-howto.md).

### Можно ли указывать конструкторские блоки в deps-ах?

Блоки конструктора **НИКОГДА НЕ ДОЛЖНЫ УКАЗЫВАТЬСЯ в deps.js**. Тем более в депсах других бандлов!

Каждый блок хранит свою статику в отдельном бандле и **сам пушит свой бандл** на страницу. **Не надо пушить бандл вызываемого блока еще раз самостоятельно!**

### Как писать стили конструкторским блокам?

**Не завязывайтесь в стилях блока на селекторы родителя**, это сохранит отчуждаемость. Ваш блок могут использовать в различных других блоках и при этом он должен сохранять свой вид, не зависимо от родителя.

**Например:** Не используйте селекторы содержащие `.serp-item` в блоках, потому что никто не гарантирует что блок будет использоваться только внутри `.serp-item`.

**Не прокидывайте кастомные стили в блок** через API, это не гарантирует правильного поведения блока. Мы физически не можем предусмотреть всех возможных ситуаций, комбинаций и взаимодействий блока с его окружением. Такой способ управления стилями блока не позволит нам закрепить и задокументировать все возможные его вариации. Вместо этого сделайте, например, блоку модификатор со своей темой.

Внутри блока **НЕЛЬЗЯ переопределять стили, меняющие вид других конструкторских блоков**. Совсем! И никогда!

**Можно влиять только на позиционирование или внешние отступы другого блока.** Например, нельзя переопределять цвет или отступы внутри другого блока, но можно поменять его position.

Если вам нужно поправить стили для каких-то конструкторских блоков внутри вашего блока – напишите модификатор для этого блока или, если отличия на столько кардинальные, то создайте новый блок.

Сейчас мы можем гарантировать поддержку API основных блоков. Если же каждый начнет менять их поведение в потрохах своих блоков, то поддерживать блок станет не возможным. Каждое обновление блока до новых версий превратится в боль.

### Можно ли хакрдкодить настройки шрифта в стилях?

Ответ по умолчанию — **НЕТ**. Сначала нужно попробовать применить [типографику](./typo.md), и если только у вас продуктовая необходимость и особое разрешение от дизайна, тогда "можно".

### Как "раскрасить" блок под тему поискового ответа?

В случае, если блок используется в карточке (см. `isCard`), вы можете использовать цветы и темы, переданные из адаптера.

Подробности в [документации к supply-colorized](./colorized.md#Как-научить блок применять цвета темы).

### Как правильно кастомизировать блоки внутри друг друга?

**Блоки взаимодействуют друг с другом строго через API. Нельзя использовать элементы/миксины другого конструкторского блока через bemjson.**

Это сделано для того, чтобы мы могли свободно менять внутреннее устройство/bemjson блока как считаем правильным, гарантированно не ломая другие блоки.

API блоков при этом мы поддерживаем обратно совместимым, либо ломаем совместимость осознанно, заменяя все вызовы по коду (это дорого).

### Как расширить функционал сразу нескольких блоков?

Для расширения api набора блоков в конструкторе предусмотрен механизм [supply-ев](./supply.md).

### Как в блоке получить данные сразу от нескольких адаптеров?

В некоторых блоках нужно предусматривать взаимодействие с несколькими адаптерами.
Если вы не знаете зачем это нужно - не предусматривайте.

В таких блоках, любое взаимодействие с данными в dataset должно происходить с помощью специальных [хелперов](https://a.yandex-team.ru/arc_vcs/frontend/projects/web4/construct/blocks-common/construct/__multiple-adapters/construct__multiple-adapters.priv.js)

Пример:
```js
/**
 * Я поддерживаю работу с несколькими адаптерами одновременно.
 *
 * @params {Context} context
 * @params {MySuperBlock} dataset
 *
 * @returns {Bemjson}
 */
blocks['mySuperBlock'] = function(context, dataset) {
  var createElem = _.partial(
        blocks['construct__multiple-adapters-call-elem'],
        context,
        dataset,
        'muSuperBlock'
    );

  return {
    block: 'block',
    mods: { type: 'default' },
    content: [
        createElem('arg1'),
        createElem('arg2'),
    ]
  }
}

blocks['mySuperBlock__arg1'] = function(context, dataset) {
  return blocks['blah-blah'](context, dataset) //предположим, что такой блок есть
}

blocks['mySuperBlock__arg2'] = function(context, dataset) {
  return blocks['blah-blah'](context, dataset) //предположим, что такой блок есть
}
```

### Как правильно экспериментировать с блоками?

Если для проведения какого-либо эксперимента вам нужно сделать доработку блоков или создать новый блок, то вся **экспериментальная функциональность должна быть вынесена на основных уровнях конструктора** (не на экспериментальный). Если экспериментальные блоки писать на эксп. уровнях, это затрудняет переиспользование уже написанного кода между командами. Другие команды могут хотеть использовать что-то подобное, а про ваш эксперимент не знать. Тем более, что эксперименты могут быть выкачены на 100% и не раскатываться в коде месяцами.

Подробности в [документации](../experiments/construct.md).
