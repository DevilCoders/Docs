# Overlay для десктопа

## Назначение
Оверлей - это блок, который показывается при клике на ссылку/кнопку поверх всей выдачи (в том числе шапки и дистрибуционных попапов).

![Overlay-example](https://jing.yandex-team.ru/files/lakate/overlay-example.png)

## Состав блока

* состоит из триггера и панели оверлея.
* по клику на триггер (например, ссылка/кнопка) открывается панель оверлея.
* сама панель состоит из шапки и содержимого
    * шапка состоит из кнопок "назад" и "закрыть"
        * кнопка "закрыть" в шапке ведет себя так:
            * добавляет новую запись в историю браузера, чтобы по кнопкам вперед/назад вернуться в правильное состояние
            * закрывает все overlay-и
        * кнопка "назад" в шапке ведет себя так:
            * если в контенте у блока реализован метод onBackButtonClick, вызовет его
            * иначе, переход назад по истории браузера на шаг назад
    * контент всегда загружается с помощью ajax-запроса

Цвет фона оверлея можно задать, указав тему в параметрах триггера (см. пример ниже)

## Поведение

Рассмотрим процесс открытия оверлея:
* клик на блок, который триггерит открытие оверлея
* открывается overlay со спиннером
* начинает грузиться контент оверлея с помощью ajax-запроса
* если контент загружается успешно:
    * контент вставляется в оверлей
    * текущее состояние записывается в историю браузера, поэтому переключаться между открытыми оверлеями можно с помощью переходов по истории
* если происходит ошибка - оверлей закрывается

## z-index в оверлее

* Чтобы оверлей показывался поверх всего (в том числе шапки и дистрибуционных попапов), ему выставляется z-index: 31001
* Для отображения попапов внутри оверлея их z-index увеличивается автоматически на величину z-index самого оверлея (благодаря доопрепределению [popup2_target_anchor.js](https://a.yandex-team.ru/arc_vcs/frontend/projects/web4/blocks-desktop/popup2/_target/popup2_target_anchor.js))
* Если такое поведение не подходит или недостаточно надо реализовывать механизм о котором говорится в https://st.yandex-team.ru/SERP-59622

## Способ использования

### 1. Сделать ссылку/кнопку триггером открытия оверлея

Пользуемся  блоком supply__overlay

```js

link.overlay = {
    // Уникальный идентификатор для содержимого, которое загрузится по клику на этот элемент
    // Если один и тот же контент должен показаться по клику на разные триггеры,
    // у них в параметрах надо указывать одинаковый overlayId, чтобы не загружать его несколько раз
    overlayId: 'my-overlay-content-id',

    // Необязательный параметр
    // Его нужно указывать, когда необходимо переопределение дефолтных методов оверлея onAfterOverlayOpen и onBackButtonClick
    // Реализация переопределения лежит в том блоке, название которого указано в поле
    block: 'my-overlay-content',

    // Необязательный параметр
    // Нужно указывать, когда необходим определенный бэкграунд оверлея.
    theme: 'my-theme',

    // Параметры для загрузки контента аякс-запросом
    ajaxParams: {
            request: {
                ...
            },
            ajax: {
                adapter: 'my-adapter'
                ...
            }
        }
    }
```

### 2. Реализовать блок, который будет контентом

```js

BEM.DOM.decl('my-overlay-content', {
    onAfterOverlayOpen: function() {
        // Если после открытия оверлея, необходимо сделать что-то кастомное
        // надо добавить этот метод в код блока. Оверлей будет сам вызовать его после каждого открытия оверлея
    },

    onBackButtonClick: function() {
        // Если нужно кастомно обрабатывать клик по кнопке Назад в шапке оверлея,
        // надо добавить этот метод в код блока. Оверлей сам вызовет его при клике в кнопку
        // Если у блока нет реализации этого метода, оверлей сам обработает клик, шагнув по истории назад
    },

    /* остальные методы блока */
});
```

### 3. Реализовать шаблонизацию ajax-запроса

```js

blocks['adapter-my-adapter__ajax'] = function(context, data, params) {
    return {
        block: 'my-overlay-content',
        /* данные для отрисовки блока */
    };
};
```
