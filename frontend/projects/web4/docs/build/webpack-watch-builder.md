# Webpack Watch Builder

Стандартная Webpack Dev Middleware имеет один недостаток, при старте она компилирует и загружает в память все entry (со всеми зависимостями). Это замедляет старт dev сервера, и потребляет существенное количество памяти.

В целях оптимизации, был сделан аналог WDM, который умеет собирать entry по требованию.
[Исходный код](../../.config/kotik/middlewares/webpack-watch-builder.js)

### Схема работы

При запуске `npm run build`:
- webpack собирает статику в `.build/dev`
- `EntriesDepsJsonPlugin` генерирует json файл `.build/dev/entries-deps.json`, со списком зависимостей для каждой entry

При запуске `npm run dev`:
- Уже собранная статика из `.build/dev` раздается с помощью WSSM
- Webpack Watch Builder читает `entries-deps.json`, и начинает отслеживать изменения в файлах
- Когда изменяется файл, определяются entry которые нужно пересобрать
- Затронутые entry собираются с помощью webpack
- Пересобранные entry начинают раздаваться из оперативной памяти, с помощью WDM (запись на диск тоже происходит)

### Известные проблемы

- Если между `npm run build` и `npm run dev`:
    - были правки в файлах, они не применятся. Решение: заново сохраните файл.
    - была добавлена новая entry, она не соберется. Решение: запустите `npm run build`.
    - была удалена/перемещена entry, webpack будет сообщать об ошибках (отсутствует файл entry). Решение: запустите `npm run build`.
