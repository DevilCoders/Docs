# FAQ по залогину

## Как узнать статус залогиненности пользователя
В старом стеке - `RequestCtx.GlobalContext.isLoggedIn`.

В актуальном - `this.context.isLoggedIn`.

На клиенте можно посмотреть - `window.Ya.SerpContext.uid`, если он не пустой - значит пользователь залогинен.

## Откуда брать данные о пользователе

Из `GlobalContext.blackbox` - [тайпинги](https://a.yandex-team.ru/arc/trunk/arcadia/frontend/projects/web4/src/lib/GlobalContext/props/blackbox/index.js)

В `blackbox` содержится информация обо всех аккаунтах пользователя, в которые он залогинен в данный момент.

## Что такое cookieL
Поле в данных, которое содержит информацию о том, каким последним аккаунтом пользователь совершал вход.

На самом деле это кука-идентификатор, которую расшифровывает репорт и отдает нам данные об аккаунте.

Лежит в `GlobalContext.cookieL`.

## Чем displayName отличается от login
`displayName` - это имя, которое пользователь выбрал для отображения на сервисах Яндекса. Его может настроить каждый
пользователь на [странице профиля в Яндекс паспорте](https://passport.yandex.ru/profile/display-name).

Если вам нужно отобразить имя пользователя, пользуйтесь именно этим полем.

`login` - это идентификатор пользователя, который он использует для входа. Его можно использовать для формирования
ссылки на паспорт. Используется в качестве фолбэка, когда `displayName` пуст.

## Экзотические типы пользовательских данных
Все типы пользователей перечислены на [wiki](https://wiki.yandex-team.ru/zalogin/z-team/tipy-akkauntov-pasporta/).

tl;dr бывают пользователи без почты ([неофониши](https://wiki.yandex-team.ru/passport/neofonishi/) и соц. аккаунты). У социальных аккаунтов логин генерируется автоматически и
представляет из себя строку вида `uid-3553kd`. У неофонишей также нет логина и почты. Логин генерируется случайно при создании
аккаунта и выглядит примерно так `nphne-nuffgmf5`. Именно поэтому, важно использовать `displayName` вместо логина.

## Может ли на верстку прийти сломанная информация о пользователе
Да, такие случаи бывают. Например, если пользователя заблокировали или он вышел из аккаунта со всех устройств. Все
такие пользователи отфильтровываются на этапе инициализации `blackbox` в `GlobalContext`. Выглядит такой пользователь
примерно вот [так](https://forever.si.yandex-team.ru/demo/get?project=SERP&platform=desktop&hash=1305720284).

## Есть ли информация о пользователе в контексте ajax запроса
Да, в контексте ajax запроса есть вся информация о пользователе в `GlobalContext.blackbox`, поэтому передавать что-либо о
пользователе в параметрах не нужно.

## В каких случаях может понадобиться `backpath`
Чаще всего, `backpath` нужен, когда после авторизации пользователь перенаправляется на другой сервис. Например, при
добавлении в избранное, мы перенаправляем пользователя на сервис коллекции, однако при отмене авторизации, нам нужно
вернуть пользователя обратно на серп. Если не указать `backpath`, то даже при отмене авторизации пользователя перенаправит
в коллекции.

## Аккаунт менеджер
Нативный способ авторизации в поисковом приложении Яндекса. Использует для авторизации системное хранилище аккаунтов,
которое шарится между всеми приложениями на устройстве. Предпочтительно использовать именно этот способ авторизации.

Для старого стека используйте миксин к кнопке [app-auth](https://a.yandex-team.ru/arc/trunk/arcadia/frontend/projects/web4/construct/blocks-touch-phone/app-auth/app-auth.priv.js)

[Пример](https://a.yandex-team.ru/arc/trunk/arcadia/frontend/projects/web4/construct/blocks-touch-phone/entity-search/__badge/entity-search__badge.priv.js?#L137)

Для актуального стека [withYaAuthApi](https://a.yandex-team.ru/arc/trunk/arcadia/frontend/projects/web4/src/lib/YandexApplicationsApi/withYandexApplicationsApi.tsx)

[Пример](https://a.yandex-team.ru/arc/trunk/arcadia/frontend/projects/web4/src/components/ZaloginPopup/Content/ZaloginPopup-Content@touch-phone.tsx?#L68)
