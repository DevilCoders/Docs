# Формирование ссылок на Яндекс.Паспорт

[Официальная документация](https://doc.yandex-team.ru/Passport/architecture/concepts/passport.html?lang=ru)

Система для авторизации пользователей в сервисах Яндекса. На серпе мы предоставляем функциональность входа, регистрации и
смены активного аккаунта. Для этого нужно лишь правильно сформировать ссылку на Яндекс.Паспорт.

## Параметры ссылки
[Официальная документация](https://doc.yandex-team.ru/Passport/AuthDevGuide/concepts/interface.html?lang=ru)
- `path` - `/auth` для авторизации, `/registration` для регистрации
- `retpath` - ссылка, по которой нужно перенаправить пользователя после успешной авторизации
- `backpath` - ссылка, по которой нужно перенаправить пользователя при отмене авторизации
- `origin` - идентификатор сервиса и функциональности, из которой пользователь пришел на паспорт

## Зачем размечать ссылки авторизации ориджинами
Ссылки необходимо размечать для подробного анализа точек авторизации на сервисе.

## Формирование ориджинов
Примеры правильных ориджинов:

`serp__collections__geo_favorite_add` - добавление в избранное в колдунщике гео

`serp__collections__images_viewer_favorite_add` - добавление в избранное в просмотрщике картинок

`serp__ugc__geo_review_reaction` - лайк / дизлайк комментарию в блоке отзывов гео

`serp__ugc__entity_create_review` - создание отзыва в блоке отзывов в объектном ответе

`serp__images_viewer_save` - сохранение картинки из просмотрщика картинок

### Алгоритм формирования ориджина:
- ориджин всегда начинается с идентификатора сервиса - `serp`
- после основного идентификатора идут дополнительные, в первую очередь, представляющие другую вертикаль и отделяются
двойным нижним подчеркиванием. Например, добавление в избранное, это функционал сервиса коллекции, поэтому ориджин - `serp__collections`
- количество дополнительных идентификаторов не ограничено, это лишь показывает, что в сценарии авторизации участвовали
несколько сервисов
- также двойным подчеркиванием нужно отделять команду фичи. Например, добавление в избранное в колдунщике объектного
ответа `serp__collections__entity`
- после всех идентификаторов нужно через одинарное нижнее подчеркивание `_` указать действие, которое совершил
пользователь прежде чем перейти к авторизации. Это может быть добавление в избранное, лайк к комментарию, написание отзыва
- вместо сценария, можно указать местонахождение точки авторизации, например бургер меню `serp_touch_authburger`
- указывать платформу (тачи, десктопы) не нужно. Ориджин на всех платформах для одного сценария может быть одинаковым

## Формирование ссылок для входа и регистрации
Для формирования ссылок есть готовые хелперы в старом и актуальном стеке.

Для старого стека используется блок [i-login-url](https://a.yandex-team.ru/arc/trunk/arcadia/frontend/projects/web4/blocks-common/i-login-url/i-login-url.priv.js) в серверном коде.

Для актуального стека используется хелперы в `src/lib/passport`:
[/client](https://a.yandex-team.ru/arc/trunk/arcadia/frontend/projects/web4/src/lib/passport/client.ts) для клиента и
[/server](https://a.yandex-team.ru/arc/trunk/arcadia/frontend/projects/web4/src/lib/passport/server.ts) для сервера.

Примеры использования

- Серверный код
```js
blocks['i-login-url'](context.reportData, {
    origin: 'serp__collections__geo_favorite_add',
    retpath: RequestCtx.Service.service(RequestCtx.GlobalContext, 'disk').root,
    backpath: true
});
```

```js
blocks['i-login-url'](data, { origin: 'serp__suggest_login', retpath: false });
```

```js
getLoginUrl(this.context, { origin: 'serp_header_burger' });
```

```js
getRegistrationUrl(this.context, { origin: 'serp__ugc__review_reaction' });
```
- Клиентский код

```js
getLoginUrl({ origin: 'serp_header_burger' });
```

```js
getRegistrationUrl(this.context, { origin: 'serp__ugc__review_reaction' });
```

## Использование информации из cookieL для формирования ссылки
В ссылке на паспорт можно указать параметр `uid` или `login`, тогда пользователю сразу-же откроется форма с вводом пароля.
Также, можно указать социальную сеть, которой пользователь совершал вход. Все эти параметры поддержаны в хелперах.
