# Инструменты для работы с логами
#### Ответственный: [Александр Сулима](https://staff.yandex-team.ru/st-lukas)
##### Знатоки: [Михаил Березин](https://staff.yandex-team.ru/karamadjong), [Евгений Дашкевич](https://staff.yandex-team.ru/jabs)


### i-log
Блок, отвечающий за запись в blockstat на сервере и в редир на клиенте - состоит из следующих компонент:

#### serverside
Здесь находится код, который строит log дерево на основе bem-json дерева. Это происходит в момент наложения BEMHTML
шаблонов. Перед применением BEMHTML-шаблонов нужно вызвать функцию
```js
blocks['i-log'](data);
```
Всё остальное будет сделано автоматически.

log ноды размечаются добавлением поля `logNode` в bemjson блока или элемента, например так:

```js
const bemjson = {
  block: 'b-page',
  // ...
  logNode: data.ct('page', { 'schema-ver': '0', ui: 'desktop', service: 'web' }),
  // ...
};
```

`data.ct()` - это функция-хелпер

Для элементов, при клике на которых должен сработать счётчик, в поле `counter` следует писать:
```js
const bemjson = {
   block: 'link',
   // ...
   counter: data.scounter('click')
}
```

В качестве аргумента функции передаётся action (hover-in/hover-out/click/show  и.т.д)

#### clientside

Тут хранится функция nc, которая выполняет обход по дереву DOM-нод на клиенте, при каком-то событии, например, клике,
и отправляет счётчик с клиентской страницы в редирлог на основании позиции элемента в DOM-дереве и имени переданного события.

###popup
Блок popup обладает особенностью - в процессе инициализации он выкусывает себя из первоначальной позиции в дереве,
соответственно без специального механизма построить правильный path не получится.

В этом блоке находится доопределение скриптов попапа, чтобы пути строились корректно даже для нод внутри него.
Никаких изменений в существующем коде делать не нужно.
