# Контекст запроса в браузере

На клиенте есть своя версия [GlobalContext](../../lib/GlobalContext/README.md).

Отличия:

* здесь поля могут меняться при перезапросе
* здесь есть не все поля (из соображений безопасности и экономии трафика)
* здесь некоторые поля имеют "обфусцированные" названия (пример - sk вместо secretKey)

Как использовать:

```ts
import { GlobalContextProvider, GlobalContextConsumer } from '.../components/GlobalContext';

// пробрасываем контекст в фичу MyFeature
return (
    <GlobalContextProvider>
        <MyFeature />
    </GlobalContextProvider>
);

// читаем контекст в любом месте внутри фичи
return (
    <GlobalContextConsumer>
        {ctx => <MyComponent prop=${ctx.reqid} />}
    </GlobalContextConsumer>
);
```

__NB:__ React-код компонентом запускается и на клиенте и на сервере. Важно помнить, что клиентский контекст доступен только на клиенте (в обработчиках событий или в любом месте после mount-а). На сервере нужно использовать `this.context` адаптера.

## FAQ

### Аналогичный объект есть в i-bem?

В мире i-bem клиентский контекст доступен через `BEM.blocks['i-global'].param(...)` или через `Ya.SerpContext`.

### Если i-global.params изменится в i-bem, как новые данные доедут в React?

В i-bem изменяется сам объект `Ya.SerpContext`, ссылка на который прокидывается в React через `GlobalContextConsumer`. Если ваш код на React использует данные из контекста в обработчиках событий и не использует их для рендеринга (как это обычно и происходт), то при чтении конкретного поля будут всегда получаться актуальные данные.

### Почему в i-bem версии поле есть, а TS говорит, что его нет?

Нужно просто расширить интерфейс, описывающий `Ya.SerpContext`. Поля там появляются ровно тогда, когда они где-то стали нужны.
