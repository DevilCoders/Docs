# ReactBus

__В React-коде не должно быть прямых обращений в i-bem, только через события на шине `ReactBus`__

## Реализация

Шина реализована поверх [TinyEmitter](https://github.com/scottcorgan/tiny-emitter)-а.

Пока не проинициализируется i-bem и загрузится React, шина работает в режиме ожидания, а все сгенерированные на шине события попыдают в специальную очередь. Когда i-bem и React будут готовы к работе, события из очереди доставляются до получателя, и шина начинает работать в нормальном режиме.

## Использование

Код шины доставляется на страницу в виде бандла "i-react-bus". По умолчанию бандл пушится, когда на странице есть фича на React.

Если хочется генерировать события на шине до того, как приедет фича на React.

В i-bem шина доступна как `Ya.reactBus`, а в коде React-компонента через [компонент ReactBus](./ReactBus.ts):

```ts
import { reactBus } from '../components/ReactBus/ReactBus';
```

## FAQ

### Как передать данные из React в i-bem?

```ts
// React-компонент отправляет данные вместе с событием
reactBus().emit('popup:open', data);
```

```js
// i-bem получает данные в обработчике
Ya.reactBus.on('popup:open', function(data) {
    // ...
});
```

### Как получить данные из i-bem в React?

```ts
// React-компонент запрашивает данные через событие
reactBus().emit('something:get-by-id', { id }, response => {
    // ...
});
```

```js
// i-bem передает данные в callback при обработке события
Ya.reactBus.on('something:get-by-id', params, function(callback) {
    callback(storage.get(params.id));
});
```

### Как передать данные из i-bem в React?

```ts
// React-компонент ждет события от i-bem
reactBus().on('react:do-something', data => {
    // ...
});
```

```js
// i-bem передает данные в виде события
Ya.reactBus.emit('react:do-something', data);
```

### Куда писать i-bem-код про работу с шиной?

Если ваш код должен приезжать для всех React-фичей, то пишем его прямо в [i-react-bus.js](../../../blocks-common/i-react-bus/i-react-bus.js) после объявления шины. Примером является код для блока "counter".

Если ваш код используется не всеми React-фичами или есть только под экспериментом, то пишем его, где удобнее. Но не забываем, что бандл самой шины должен попасть на страницу раньше вашего кода.

### Куда писать React-код про работу с шиной?

Ограничений нет. Бандл с шиной всегда оказывается на странице раньше ассетов с React-компонентами.
