# Турбо в СЕРПе

Турбо на тачфонах открывается в оверлее — выезжающем справа блоке. Оверлей может быть одиночный, а может быть в виде слайдера, где каждый элемент слайдера — это айфрейм с турбо-страницей.

## Подмена хоста Турбо

Существует возможность подменить хост турбо, к которому будут идти запросы в оверлее. Для этого есть флаг `turbo-host`.

Установим хост локальной рабочей копии: `&exp_flags=turbo-host=user-1-ws1.si.yandex.ru`.

Можно указать номер пулреквеста в репозиторий турбо: `&exp_flags=turbo-host=1234`.

Кроме этого, доступны значения:
* [`dev`](https://renderer-turbo-dev.hamster.yandex.ru/turbo?text=test_news) — текущая версия турбо в ветке разработки
* [`priemka`](https://webtemplates.hamster.yandex.ru/turbo?text=test_news) — версия турбо в релизном пакете перед выкаткой в продакшен
* [`hmstr`](https://hamster.yandex.ru/turbo?text=test_news) — внутренний продакшен

## Проброс дополнительных CGI-параметров в Турбо

Иногда нужна возможность добавить параметры в адрес турбо-страницы, открываемой в айфрейме. Для этого есть флаг `turbo-cgi`.

Добавим параметр, логирующий работу метрики: `&exp_flags=turbo-cgi=_ym_debug=1`.

Можно добавлять сразу несколько параметров: `&exp_flags=turbo-cgi=_ym_debug=1,exp_flags=analytics-disabled=0,exp_flags=adv-disabled=0`

## Открытие локального Турбо в локальном СЕРПе

Для этой возможности существует [плагин](../../../.config/templar/plugins/controllers/turbo.js).

Шаги запуска:
1. `turbo › npm start -- -p 9999`
2. `web4 › TURBO_URL=http://localhost:9999 npm run dev -- --public`
3. Подставить {public-host} и открыть: `https://{public-host}/search/touch/?text=test&exp_flags=turbo-host={public-host}`

## Открытие автобет Турбо на одном домене с локальным СЕРПом

Шаги запуска:
1. Запустить web4 с переменной окружения:
    - открывать dev Турбо: `web4 › TURBO_URL=dev npm run dev -- --public`
    - открывать автобету Турбо из пулреквеста: `web4 › TURBO_URL=1234 npm run dev -- --public`
2. Подставить {public-host} и открыть: `https://{public-host}/search/touch/?text=test&exp_flags=turbo-host={public-host}`

## Отключение фолбэка

Фолбэк — это переадресация с турбо-страницы на страницу оригинала, которая выполняется, если турбо долго не отвечает.

При подмене хоста турбо на локальный часто успевает сработать фолбэк, потому что локальная бэта отвечает медленно. Фолбэк можно изменить, например установить его очень большим: `&exp_flags=turbo-fallback-timeout=999999`.

## Отключение красивых адресов

При разработке красивых адресов турбо-страниц сломали работу флага подмены хоста Турбо (`turbo-host`, [задача на починку](https://st.yandex-team.ru/TURBOUI-3866)). Для того, чтобы подменить хост турбо сейчас нужно отключить красивые адреса, для этого служат флаги: `&exp_flags=turbo-beauty-url-disable=1&exp_flags=turbo-turbopages-org=null`.
