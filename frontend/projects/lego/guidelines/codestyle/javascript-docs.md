Документирование JavaScript API
===============================

Для документирования кода используется [JSDoc](http://usejsdoc.org).

В JSDoc мы не описываем внутреннее устройство блоков, а пишем справочную информацию. Её следует писать так, чтобы у
читающего полностью сложилось представление о том, как описываемым кодом пользоваться, что от него можно ожидать и какие есть
подводные камни без необходимости заглядывать в код.

## Текст описания

Документация пишется на русском языке.
Описание отделяется от тегов пустой строкой. Предложения пишутся с большой буквы,
в конце предложений всегда ставится точка:

```js
/**
 * Это стол, за ним едят.
 *
 * @private
 * @param {Chair} chair Это стул, на нем сидят.
 */
```

Текст может разбиваться на несколько строк или абзацев. Абзацы разделяются пустой строкой:

```js
/**
 * Пример длинного длинного длинного длинного
 * длинного абзаца.
 *
 * А это второй абзац.
 */
```

Допустимо использовать `markdown`:

````js
/**
 * Пример кода:
 *
 * ```js
 * block.someMethod(params)
 * ```
 *
 * @private
 */
````

Описание методов пишется в изъявительном наклонении.

Правильно:

```js
/**
 * Устанавливает модификатор.
 */
```

Неправильно:

```js
/**
 * Установить модификатор.
 */
```


### БЭМ-сущности

Каждый БЭМ-блок по сути является классом.

JS-параметры блоков описываются как аргументы конструктора. Каждый параметр представлен
свойством аргумента `params`:

```js
/**
 * Управляющий элемент интерфейса для удобного и наглядного выбора диапазона значений.
 *
 * @class slider
 * @extends component
 * @param {Object} params Параметры блока.
 * @param {Number} [params.min] Минимальное значение слайдера. Если не задано,
 * будет использовано крайнее правое значение шкалы.
 * @param {Number} [params.max] Максимальное значение слайдера. Если не задано,
 * будет использовано крайнее левое значение шкалы.
 */
BEM.DOM.decl({ block: 'slider', baseBlock: 'component' }, /** @lends slider.prototype */ {
    // ...
});
```

При декларации модификатора блока используется имя класса с подчёркиваниями:
```js
/**
 * @class slider_theme_normal
 * @extends BEM.DOM
 */
BEM.DOM.decl({ block: 'slider', modName: 'theme', modVal: 'normal' });
```

При сборке документации для Лего-сайта используется инструмент [bem-jsdoc3-plugin](https://github.com/bem/bem-jsdoc3-plugin).
Он самостоятельно определяет имена БЭМ-сущностей при использовании конструкции `BEM.DOM.decl()`.

В случаях, когда блок декларируется не через `i-bem.js`, и при этом
необходимо включить его в документацию на Лего-сайте, нужно применять теги:

- `@block <имя блока>`
- `@mod <имя модификатора>`
- `@val <значение модификатора>`

### БЭМ-сущности на нескольких уровнях переопределения

Если блок или модификатор описан на нескольких уровнях переопределения, основное описание
размещается на уровне `common`. На других уровнях размещается только дополнение к `common`,
специфичное для каждого уровня.

При переопределении методов и свойств следует указывать тег [`@override`](http://usejsdoc.org/tags-override.html).


### Ссылки на другие БЭМ-сущности

Для того, чтобы сделать комментарий компактнее, можно не писать слова «элемент» и «модификатор».
Вместо этого достаточно сокращённых записей `__elem` и `_mod_val`.

Так же можно комбинировать элементы с модификаторами:

```js
/**
 * Делает что-то для `__elem_mod_val`.
 */
doSomething: function() {
    // ...
}
```


### Свойства и методы

Внутри кода БЭМ-сущности должны быть документированы все публичные и защищенные свойства.

Некоторые свойства и методы БЭМ-сущностей должны иметь модификатор доступа:
- [`@protected`](http://usejsdoc.org/tags-protected.html) — защищённые свойства и методы.
Допускается их переопределение за пределами библиотеки, при этом
они не должны использоваться напрямую из внешнего кода;
- [`@private`](http://usejsdoc.org/tags-private.html) — закрытые свойства и методы.
Их имена начинаются с подчёркивания. Использование таких полей допускается
только в пределах библиотеки в рамках собственного блока.
Переопределение таких полей не допускается.

Модификатор доступа по умолчанию: [`@public`](http://usejsdoc.org/tags-public.html) — публичные свойства и методы.
Они предполагают неограниченное открытое использование за пределами библиотеки.
Для них не требуется явного указания модификатора доступа.

Стандартные защищённые ([`@protected`](http://usejsdoc.org/tags-protected.html)) свойства и методы блока:
- `onSetMod`
- `onElemSetMod`
- `getDefaultParams()`
- `destruct()` в `BEM.DOM`
- `live()`

#### Описание свойств и методов

JSDoc для публичного метода должен содержать краткое описание, перечисление всех аргументов и возвращаемое значение.

Для параметров обязательно указание типов.
Описание параметра начинается с большой буквы и заканчивается точкой.

Пример:

```js
/**
 * Подписывает на событие.
 *
 * @param {String|String[]} eventType Одно или несколько имён событий.
 * @param {Object} [eventData] Данные события.
 * @param {Function} handler Обработчик события.
 * @returns {BEM.DOM} this
 */
bind: function(eventType, eventData, handler) {
    // ...
}
```

Для защищенного метода в описании дополнительно указывается, в каких случаях метод нужно переопределять и когда
он вызывается.

#### Статические свойства и методы

При сборке документации на Лего-сайте используется [bem-jsdoc3-plugin](https://github.com/bem/bem-jsdoc3-plugin).
Этот инструмент автоматически помечает свойства и методы из второй секции
декларации блока тегом [`@static`](http://usejsdoc.org/tags-static.html).
Поэтому использование тега `@static` не требуется.

#### Устаревшие свойства и методы

Устаревшие свойства помечаются тегом `@deprecated`, после которого указывается:

- версия, в которой свойство было объявлено устаревшим;
- рекомендуемая замена.

Пример:

```js
/**
 * Пример документирования устаревших методов.
 *
 * @deprecated В версиях >=1.1 рекомендуется использовать `coolerExample()`.
 */
example: function() {
    // ...
}
```

### События

Все события описываются при помощи [тега `@event`](http://usejsdoc.org/tags-event.html) в начале тела блока.
Вместе с событием должны быть описаны все его сопутствующие данные, если они есть, например:

```js
/**
 * Поле ввода.
 *
 * @class input
 * @extends BEM.DOM
 */
BEM.DOM.decl('input', /** @lends input.prototype */ {
    /**
     * Событие изменения значения поля ввода.
     *
     * @event input#change
     * @type {Object}
     * @prop {String} oldValue Старое значение.
     * @prop {String} newValue Новое значение.
     */
});

```

В теге `@event` указывается полный идентификатор БЭМ-сущности.
Пример для модификаторов:

```js
/**
 * Генерируется, когда оба ползунка устанавливаются в одно значение.
 *
 * @event slider_type_range#collapse
 */
```

Метод, инициирующий событие, снабжается тегом [`emits`](http://usejsdoc.org/tags-fires.html):
```js
/**
 * Показывает блок.
 *
 * @emits input#show
 */
show: function() {
    this.trigger('show');
}

```

### Порядок тегов JSDoc для методов

1. Блок описания. Отделяется от тегов пустой строкой.
1. `@protected` или `@private` — модификатор доступа, если это не публичное API
1. `@deprecated` — если свойство или метод объявлены устаревшими
1. `@emits` — если метод инициирует события
1. `@param` — при наличии параметров
1. `@returns` — при наличии возвращаемого значения

### Комплексный пример описания JSDoc для БЭМ-блока

```js
/**
 * Модальное окно.
 *
 * @class modal
 * @extends popup
 * @param {Object} params Параметры блока.
 * @param {BEM.DOM} params.owner Владелец модального окна.
 */
BEM.DOM.decl({ block: 'modal', baseBlock: 'popup' }, /** @lends modal.prototype */ {
    /**
     * Событие появления модального окна.
     *
     * @event modal#show
     * @type {Object}
     * @prop {Object} coords Координаты.
     * @prop {Number} coords.x Координата X.
     * @prop {Number} coords.y Координата Y.
     */

    /**
     * Показывает блок.
     *
     * @deprecated В версиях >=2.0, используйте метод `present()`.
     * @emits modal#show
     * @param {Object} coords Координаты.
     * @param {Number} coords.x Координата X.
     * @param {Number} coords.y Координата Y.
     * @returns {BEM.DOM} this
     */
    show: function(coords) {
        // ...
        this.trigger('show', { coords: coords });
    }
}, /** @lends modal */ {
    /**
     * Имя события нажатия указателя.
     * Предназначено для переопределения на touch-уровнях.
     *
     * @private
     */
    _pointerPressEvent: 'mousedown'
});
```

### Шаблон блока для редакторов кода

Шаблон работает в `js`-файлах.
При вводе строки `BEM` и нажатию на `Tab` появляется базовая декларация блока
и предлагается ввести имя блока. После следующего нажатия на `Tab`
курсор переходит в функцию `onSetMod.js.inited()` для начала реализации блока.

#### Sublime Text 3

Выберите в меню `Tools → New Snippet...`

В открывшийся новый файл вставьте текст шаблона:

```xml
<snippet>
    <content>/**
 * ${1:BLOCK}.
 *
 * @class ${1:BLOCK}
 * @extends BEM.DOM
 * @param {Object} params Параметры блока.
 */
BEM.DOM.decl('${1:BLOCK}', /** @lends ${1:BLOCK}.prototype */ {
    /**
     * @protected
     */
    onSetMod: {
        js: {
            inited: function() {${0}}
        }
    },

    /**
     * Возвращает стандартные значения параметров блока.
     *
     * @protected
     * @returns {Object}
     */
    getDefaultParams: function() {
        return {};
    },

    /**
     * @protected
     */
    destruct: function() {}
}, /** @lends ${1:BLOCK} */ {
    /**
     * @protected
     */
    live: function() {}
});</content>
    <tabTrigger>BEM</tabTrigger>
    <scope>source.js</scope>
    <description>BEM.DOM.decl</description>
</snippet>
```

Сохраните файл по следующему пути: `~/Library/Application Support/Sublime Text 3/Packages/User/BEM.sublime-snippet`.

#### WebStorm

Откройте настройки (`⌘,`) и выберите `Preferences → Editor → Live Templates`:
![WebStorm-LiveTemplates](https://jing.yandex-team.ru/files/tenorok/Snimok_ekrana_2015-05-13_v_12.19.21.png)

Обязательно выберите язык `JavaScript` (как на изображении выше), где шаблон будет работать.

Добавьте текст шаблона:
```js
/**
 * $BLOCK$.
 *
 * @class $BLOCK$
 * @extends BEM.DOM
 * @param {Object} params Параметры блока.
 */
BEM.DOM.decl('$BLOCK$', /** @lends $BLOCK$.prototype */ {
    /**
     * @protected
     */
    onSetMod: {
        js: {
            inited: function() {$END$}
        }
    },

    /**
     * Возвращает стандартные значения параметров блока.
     *
     * @protected
     * @returns {Object}
     */
    getDefaultParams: function() {
        return {};
    },

    /**
     * @protected
     */
    destruct: function() {}
}, /** @lends $BLOCK$ */ {
    /**
     * @protected
     */
    live: function() {}
});
```

### TODO

Пометка `// TODO: ...` предназначена для обозначения необходимости
выполнения задачи по отдельной части кода.

Обязательно указание полной ссылки на задачу в трекере.

Простой пример `TODO`:

```js
// TODO: Отрефакторить инициализацию блока https://st.yandex-team.ru/ISL-76
```

Пример `TODO` для метода:

```js
/**
 * Возвращает секретный код.
 *
 * TODO: Изменить алгоритм https://st.yandex-team.ru/ISL-76.
 */
 getSecretCode: function() {
     // ...
 }
```
