# Contribution

Как передать свой код в библиотеку `islands`.

Библиотека открыта для:
- исправления ошибок;
- добавления новой функциональности существующим блокам;
- добавления новых блоков;
- внесения исправлений и дополнений в тесты и документацию.

Для передачи кода в библиотеку блоков `islands` настоятельно рекомендуем
ознакомиться со следующими документами:

- «[API Блока][islands-api]»
- «[Стиль кодирования][islands-codestyle]»
- «[Рекомендации по написанию функциональной документации][shablon-bloka]»
- «[Рекомендации по документированию API блока][codestyle-jsdoc]»
- «[Рекомендации по разработке примеров][examples]»
- «[Рекомендации по написанию тестов][unit-tests]»
- «[Рекомендации по работе с изображениями][images]»
- «[Релизный цикл библиотек][release-cycle]»
- «[Правила оформления задач в Стартреке][startrek]»
- «Синхронизация переводов в Tanker»


### Разработка

- Рекомендуем называть ветку разработки в формате `<username>.<ISL-1234>[.<keywords>]`.
  Например: `sagitov.ISL-2503`, `karamadjong.ISL-366.rm-ie67css`.
- Описания коммитов не должны содержать номеров задач


### Передача кода

- Заведите задачу в очереди `ISL` согласно «[Правилам оформления задач в Стартреке][startrek]»
- Уточните у команды разработки ветку для отправки PR (далее, в качестве примера, ветка `dev`)
- Убедитесь, что код соответствует
  «[Контрольному списку принятия PR](#Контрольный-список-принятия-PR)»<br>
  - [Как запустить тесты локально][tunnel]
  - [Как писать unit-тесты][unit-tests]
  - [Как писать тесты на шаблоны][template-tests]
- Сделайте `git rebase` от последнего состояния основной ветки (`git pull --rebase origin dev`)
- Объедините коммиты по содержанию (`git rebase -i dev`, `squash`)
- Отправьте PR на ревью в ветку `dev`:
  1. заголовок для PR возьмите из Стартрека с помощью кнопки
     «[Copy commit message](http://jing.yandex-team.ru/files/karamadjong/copy_commit_message.png)»;
  1. описание PR должно содержать функциональные изменения, реализованные в рамках этого
     PR и любые замечания, которые будут полезны разработчику, проводящему ревью;
  1. после отправки PR начнется сборка библиотеки на TeamCity, в
     процессе которой будут запущены тесты, собраны и опубликованы примеры
     на [lego-staging][staging];
  1. убедитесь, что примеры опубликованы и тесты прошли успешно на странице
     PR (зеленая плашка `Good to merge — TeamCity Build islands :: ... (Details)`);
  1. задача с готовым PR будет рассмотрена в течение одного полного рабочего дня: она будет переведена
     в состояние «Открыта» и будет определен спринт, в котором начнется работа по данному PR;

В случае отсутствия ответа в течение двух рабочих дней, обратитесь к [kuznecov@][kuznecov] или [karamadjong@][karamadjong].


### Ревью

- Задача на ревью PR берется в один из ближайших спринтов
- Ревью выполняется одним или несколькими разработчиками из команды разработки
  библиотек `islands-*`
- В случае принятия нового блока, к ревью могут привлекаться эксперты из сервисов
- Общение ведется в комментариях к задаче или на странице PR, если
  необходимо комментировать код
- Выполняется функциональное и регрессионное тестирование блоков, которых касаются
  вносимые в библиотеку изменения
- При возникновении замечаний или багов, обнаруженных при тестировании, задача
  возвращается на доработку
- Исправления добавляются коммитом, при необходимости снова сделайте `rebase` от
  соответствующей ветки
- О внесенных исправлениях сообщайте исполнителю задачи выполнения ревью
- Результатом выполненного ревью является `merge` в соответствующую ветку


### Релиз

Изменения попадают в новый релиз библиотеки в соответствии с документами:

  - «Жизненный цикл блока»
  - «[Релизный цикл библиотеки][release-cycle]»


## Процессы в команде разработки библиотеки блоков islands

Внешние разработчики создают задачу в соответствующей очереди.

Ответственный за перевод в работу [kuznecov@][kuznecov]:

  - отслеживает очередь библиотеки блоков `islands`;
  - при появлении новой задачи на ревью PR:
    - переводит задачу в необходимую очередь;
    - выясняет у контрибьютора недостающую информацию;
    - выясняет у команды ориентировочные сроки рассмотрения PR;
    - проставляет Компоненты задачи в соответствии с
      «[Правилами оформления задачи в Стартреке][startrek]»;
    - переводит задачу в состояние «Открыта»;
  - сообщает контрибьютору срок рассмотрения;
  - добавляет задачу в один из следующих спринтов.

В рамках спринта исполнитель:

  - берет задачу в работу и устанавливает себя исполнителем;
  - в PR устанавливает себя в поле `Assignee`;
  - выполняет проверку согласно
    «[Контрольному списку принятия PR](#Контрольный-список-принятия-PR)», за
    проверку всех пунктов отвечает исполнитель;
  - выполняет проверку кода на целостность API;
  - создает подзадачу на тестирование;
  - в случае возникновения замечаний, причина описывается в комментариях кода
    в PR или в комментариях задачи, задача переводится в статус
    `Требуется информация`;
  - при отсутствии замечаний, в задаче уточняются компоненты, и она переводится в состояние `Решен`.

Разрешение спорных вопросов:

  - если код изменяет API библиотеки и отсутствует иное решение, PR
    принимается как мажорное изменение (смотри «[Релизный цикл библиотек][release-cycle]»);
  - функциональная документация может быть не полноценной, но должна давать
    информацию о внесенных изменениях;
  - покрытие тестами опционально;
  - если принятие решения по приему PR зашло в тупик, исполнитель
    или [kuznecov@][kuznecov] к задаче подключают дополнительных экспертов;
  - если автор PR не имеет возможности внести необходимые правки, либо нужно ускорить принятие PR,
  ревьювер может переоткрыть PR на себя:

    ```
    git fetch origin pull/<номер_pr>/head:<название_ветки>
    git push origin <название_ветки> -u
    ```
  - документы имеют рекомендательный характер:
    - всё, что возможно, проверяется роботами;
    - задача команды обеспечить «приятный» контрибьют.

Жизнь после принятия PR:

  - задача рассматривается командой на "Daily meeting" или на "Подведении итогов
    спринта";
  - по необходимости создаются задачи:
    - на документацию блока
    - на покрытие тестами
    - на поддержку других платформ
    - на анонс в Этушку
  - выясняется в какой релиз попадают изменения (смотри
    «[Релизный цикл библиотек][release-cycle]»);
  - в задачу вносится информация о релизе;
  - задача закрывается.


## Контрольный список принятия PR

1.  PR отправлен в соответствующую ветку
2.  отсутствуют отклонения от дизайнерского гайда
3.  все переводы актуальны
4.  внесены соответствующие изменения в функциональную документацию
5.  изменения покрыты тестами
  - unit-тесты
  - тесты hermione
  - тесты на шаблоны
6.  имеются примеры для проверки новой функциональности
7.  js-код и bemhtml-код имеют документацию
8.  картинки (png, svg, jpg, etc.) оптимизированы
9.  наличие деградации svg до png
10. изменения протестированы
11. изменения подробно описаны в `releases/X.Y.Z-release-notes.md` для следующего релиза библиотеки. Для MINOR и MAJOR добавление записи в release-notes обязательно, а для PATCH рекомендуется в особых случаях (например, security-fix, или другое важное изменение, о котором нужно сообщить пользователям).

[islands-api]: http://wiki.yandex-team.ru/lego/islands/tech/api
[islands-codestyle]: http://lego.yandex-team.ru/codestyle/
[shablon-bloka]: https://lego.yandex-team.ru/doc/practics/documentation-creation-guide/
[codestyle-jsdoc]: https://lego.yandex-team.ru/doc/codestyle/jsdocs/
[examples]: https://lego.yandex-team.ru/doc/practics/examples-creation-guide/
[unit-tests]: https://lego.yandex-team.ru/doc/practics/unit-tests/
[images]: https://lego.yandex-team.ru/doc/practics/images/
[release-cycle]: https://lego.yandex-team.ru/doc/processes/release-cycle/
[design-2x]: http://islands.yandex-team.ru/
[design-3x]: http://guide.yandex-team.ru/
[tunnel]: https://lego.yandex-team.ru/doc/practics/tunnel/
[template-tests]: https://lego.yandex-team.ru/doc/practics/templates/
[staging]: https://lego-staging.dev.yandex-team.ru/
[karamadjong]: http://staff.yandex-team.ru/karamadjong
[kuznecov]: http://staff.yandex-team.ru/kuznecov
[startrek]: https://lego.yandex-team.ru/doc/processes/startrek/
