# islands 5.8.0

<!-- ЧЕЛОВЕЧЕСКОЕ ВСТУПЛЕНИЕ -->

Изменения, вошедшие в релиз **islands 5.8.0**, разделены на группы:

* [минорные изменения](#Минорные-изменения) — задачи, в рамках которых произошло расширение API блоков;
* [исправлено и улучшено](#Исправлено-и-улучшено) — различные исправления, не затрагивающие API блоков;
* [Lego on React](#lego-on-react) — задачи, касающиеся Lego on React

Все важные изменения подробно описаны [ниже](#Пояснения).

## Минорные изменения

| Заголовок                                                                                     | Задача     | PR      |
| :-------------------------------------------------------------------------------------------- | :--------- | :------ |
| [`b-page`: Добавить размеры иконок для iOS7](#ISL-2437)                                       | [ISL-2437] | [#2387] |
| `input`: Портировать `input_expanding_yes`                                                    | [ISL-3839] | [#2372] |
| [`meccano`: Перенести блоки с датами с уровня `desktop` на уровень `common`](#ISL-3868)       | [ISL-3868] | [#2402] |
| [`popup`, `popup2`: Добавить API для выбора `scope`](#ISL-3872)                               | [ISL-3872] | [#2409] |
| [`popup_motionless_yes`: Сделать модификатор «замораживающий» выбранное направление](#ISL-3870) | [ISL-3870] | [#2410] |
| Портировать многострочную строку ввода в шапке                                                | [ISL-3775] | [#2428] |

## Исправлено и улучшено

| Заголовок                                                                                     | Задача     | PR               |
| :-------------------------------------------------------------------------------------------- | :--------- | :--------------- |
| `b-page`: На ios появляется затемнение при тапе                                               | [ISL-2147] | [#2396]          |
| [`checkbox`: Сделать текст в лейбле выделяемым](#ISL-3058)                                    | [ISL-3058] | [#2400]          |
| `i-bem`: `_findBlocks` с `onlyFirst` не должен никогда возвращать массив                      | [ISL-2844] | [#2399]          |
| [`input_autofocus_yes`: Срабатывает автофокус для неактивного (`disabled`) поля ввода](#ISL-3718) | [ISL-3718] | [#2375]          |
| `pointerevents`: Unable to get property `'touch-action'` of `undefined` or `null` refer…      | [ISL-3846] | [#2380]          |
| `popup2`: Не успевает перерисовать себя в 60FPS у цели с `position:fixed`                     | [ISL-3876] | [#2413]          |
| `popup2`: Невозможно передать отрицательные значения для отступа                              | [ISL-3009] | [#2437]          |
| `user-account`: Исправить отсутствие экранирования в логине                                   | [ISL-3899] | [#2421]          |
| `user2`: Кнопка «Войти» формируется без `retpath`                                             | [ISL-3890] | [#2426]          |

## Lego on React

| Заголовок                                                                        | Задача     | PR      |
| :------------------------------------------------------------------------------- | :--------- | :------ |
| [Lego-on-react: Починить проблему с `Map()` в ie10](#ISL-3787)                     | [ISL-3787] | [#2379] |
| `Select.react`: Пустой список при первом открытии                                | [ISL-3537] | [#2389] |
| `b-page.react`: Добавить экспорт `pointerfocus` и `b-page`                       | [ISL-3905] | [#2422] |
| `radio-button.react`: Устранить ошибочное использование `_side_both` в `React`   | [ISL-3626] | [#2349] |
| `textinput.react`: Указан неправильный `propTypes` для `autocomplete`            | [ISL-3694] | [#2436] |
| `tumbler.react`. Warning: Failed prop type: Invalid prop `size` of value `xs` su… | [ISL-3851] | [#2385] |

## Пояснения

<a name="ISL-3787"></a>
### [Lego-on-react: Починить проблему с `Map()` в ie10][ISL-3787]

**Портирован блок [keycodes](../../common.blocks/keycodes/keycodes.react.js).**
Пример использования блока:
```js
import Keys from 'b:keycodes';

if (e.which === Keys.ENTER)

if (Keys.is(e.which, 'ENTER', 'SPACE') // эквивалентно if (e.which === Keys.ENTER || e.which === Keys.SPACE)
```

**Убрали из зависимостей блок react-keydown**
В IE10 возникала проблема из-за использования [Map](https://github.com/glortho/react-keydown/blob/master/dist/store.js#L39) в модуле react-keydown, т.к. он его не поддерживает. Было принято решение отказаться от него в пользу блока keycodes.

<a name="ISL-2437"></a>
### [b-page: Добавить размеры иконок для iOS7][ISL-2437]

На уровне `touch` добавлена возможность передачи иконок размера 180x180 для iPhone 6 Plus и 192x192 для Chrome на Android.

<a name="ISL-3058"></a>
### [checkbox: Сделать текст в лейбле выделяемым][ISL-3058]

У блока `checkbox` удалёно `CSS`-свойство `user-select: none`, запрещающее выделение текста.

Если вы желаете сохранить запрет на выделение, добавьте данное правило блоку `checkbox` на своем уровне переопределения:
```css
.checkbox {
    user-select: none;
}
```

<a name="ISL-3718"></a>
### [input_autofocus_yes: Срабатывает автофокус для неактивного (disabled) поля ввода][ISL-3718]

Добавлена проверка на атрибут `disabled` в `input_autofocus_yes`, убран неиспользуемый код выставления/снятия модификатора `autofocus`.

<a name="ISL-3868"></a>
### [meccano: Перенести блоки с датами с уровня desktop на уровень common][ISL-3868]

Блоки `m-calendar` и `m-datepicker` теперь доступны для платформ `touch-pad` и `touch-phone`.

<a name="ISL-3872"></a>
### [popup, popup2: Добавить API для выбора scope][ISL-3872]

В `popup` и `popup2` был добавлен метод для выбора места вынесения окошка. По умолчанию окошко выносится
в конец `<body>`.
```js
// elem — jQuery-объект в конец которого будет добавлено окошко
block.findBlockInside('popup').setScope(elem);
block.findBlockInside('popup2').setScope(elem);
```

Окошко выносится в `DOM` в момент показа. Если окошко уже было вынесено в конец `<body>` или в конец другого элемента,
его нужно скрыть и показать заново.

<a name="ISL-3870"></a>
### [popup_motionless_yes: Сделать модификатор «замораживающий» выбранное направление раскрытия][ISL-3870]

В блок `popup2` добавлен модификатор `popup2_motionless_yes`, позволяющий зафиксировать положение всплывающего окна после открытия. Сейчас направление раскрытия изменяется при прокрутке страницы.

В старом блоке был модификатор `popup_adaptive_yes`. Сейчас поведение этого модификатора включено по умолчанию. Это поведение отключается модификатором `popup2_motionless_yes`.

```js
({
    block: 'popup2',
    mods: {target: 'anchor', motionless: 'yes'},
    /* … */
})
```

Начальное направление рассчитывается и фиксируется в момент открытия всплывающего окна. Для смены направления необходимо закрыть окошко и открыть его заново.

[ISL-3787]: https://st.yandex-team.ru/ISL-3787
[#2379]: https://github.yandex-team.ru/lego/islands/pull/2379
[ISL-3537]: https://st.yandex-team.ru/ISL-3537
[#2389]: https://github.yandex-team.ru/lego/islands/pull/2389
[ISL-3905]: https://st.yandex-team.ru/ISL-3905
[#2422]: https://github.yandex-team.ru/lego/islands/pull/2422
[ISL-2437]: https://st.yandex-team.ru/ISL-2437
[#2387]: https://github.yandex-team.ru/lego/islands/pull/2387
[ISL-2147]: https://st.yandex-team.ru/ISL-2147
[#2396]: https://github.yandex-team.ru/lego/islands/pull/2396
[ISL-3058]: https://st.yandex-team.ru/ISL-3058
[#2400]: https://github.yandex-team.ru/lego/islands/pull/2400
[ISL-2844]: https://st.yandex-team.ru/ISL-2844
[#2399]: https://github.yandex-team.ru/lego/islands/pull/2399
[ISL-3839]: https://st.yandex-team.ru/ISL-3839
[#2372]: https://github.yandex-team.ru/lego/islands/pull/2372
[ISL-3718]: https://st.yandex-team.ru/ISL-3718
[#2375]: https://github.yandex-team.ru/lego/islands/pull/2375
[ISL-3868]: https://st.yandex-team.ru/ISL-3868
[#2402]: https://github.yandex-team.ru/lego/islands/pull/2402
[ISL-3846]: https://st.yandex-team.ru/ISL-3846
[#2380]: https://github.yandex-team.ru/lego/islands/pull/2380
[ISL-3872]: https://st.yandex-team.ru/ISL-3872
[#2409]: https://github.yandex-team.ru/lego/islands/pull/2409
[ISL-3876]: https://st.yandex-team.ru/ISL-3876
[#2413]: https://github.yandex-team.ru/lego/islands/pull/2413
[ISL-3009]: https://st.yandex-team.ru/ISL-3009
[#2437]: https://github.yandex-team.ru/lego/islands/pull/2437
[LEGO-2001]: https://st.yandex-team.ru/LEGO-2001
[#2373]: https://github.yandex-team.ru/lego/islands/pull/2373
[ISL-3870]: https://st.yandex-team.ru/ISL-3870
[#2410]: https://github.yandex-team.ru/lego/islands/pull/2410
[ISL-3626]: https://st.yandex-team.ru/ISL-3626
[#2349]: https://github.yandex-team.ru/lego/islands/pull/2349
[ISL-3694]: https://st.yandex-team.ru/ISL-3694
[#2436]: https://github.yandex-team.ru/lego/islands/pull/2436
[ISL-3851]: https://st.yandex-team.ru/ISL-3851
[#2385]: https://github.yandex-team.ru/lego/islands/pull/2385
[ISL-3899]: https://st.yandex-team.ru/ISL-3899
[#2421]: https://github.yandex-team.ru/lego/islands/pull/2421
[ISL-3890]: https://st.yandex-team.ru/ISL-3890
[#2426]: https://github.yandex-team.ru/lego/islands/pull/2426
[LEGO-2006]: https://st.yandex-team.ru/LEGO-2006
[#2394]: https://github.yandex-team.ru/lego/islands/pull/2394
[LEGO-1999]: https://st.yandex-team.ru/LEGO-1999
[#2371]: https://github.yandex-team.ru/lego/islands/pull/2371
[ISL-3775]: https://st.yandex-team.ru/ISL-3775
[#2428]: https://github.yandex-team.ru/lego/islands/pull/2428
