# islands 5.25.0

Изменения, вошедшие в релиз islands 5.25.0, разделены на группы:

* [минорные изменения](#Минорные-изменения) — задачи, в рамках которых произошло расширение API блоков;
* [исправлено и улучшено](#Исправлено-и-улучшено) — различные исправления, не затрагивающие API блоков.

Все важные изменения подробно описаны [ниже](#Пояснения).

## Минорные изменения

| Заголовок                                                                        | Задача     | PR               |
| :------------------------------------------------------------------------------- | :--------- | :--------------- |
| suggest2: Оторвать старую зависимость islands-suggest с СЕРПа в пользу islands@… | [ISL-4954] | [#3825]          |
| [tooltip_theme_promo: Расширение возможностей](#ISL-4997)                        | [ISL-4997] | [#3586]          |
| typings: Добавить поля mix и cls для всех объектов                               | [ISL-4868] | [#3584]          |
| [user2.react: Скачет на touch-phone при скролле](#ISL-5127)                      | [ISL-5127] | [#3805]          |
| user2: Добавить проброс plusLinkParams в ссылку menu                             | [ISL-5148] | [#3730]          |
| yaplus, user2: Добавить переводы для разных локализаций                          | [ISL-5160] | [#3761], [#3758] |
| yaplus: Добавить таймаут перед показом по наведению и автоматическое скрытие     | [ISL-5171] | [#3774]          |
| [Реализовать компонент, совмещающий ссылку для Я.Плюс и промо-тултип](#ISL-5106) | [ISL-5106] | [#3672]          |

## Исправлено и улучшено

| Заголовок                                                                                     | Задача     | PR      |
| :-------------------------------------------------------------------------------------------- | :--------- | :------ |
| i-bem: Конфликт react и i-bem блоков                                                          | [ISL-5088] | [#3690] |
| [i-bem__dom: Не работает специальный код обработки resize при подписке на несколько…](#ISL-4912) | [ISL-4912] | [#3648] |
| icon_glyph: Нельзя проставить иконкам размеры через css                                       | [ISL-5118] | [#3822] |
| lego-on-react: Обновить bem-react-core до  v1.0.0-rc.11                                       | [ISL-5117] | [#3751] |
| lego-on-react: вернуть стили в dist сборку                                                    | [ISL-5158] | [#3741] |
| link: Сломались ссылки с иконками                                                             | [ISL-5095] | [#3647] |
| messenger: На Windows пропадает скролл у страницы по наведению в попап с ямбом                | [ISL-5022] | [#3653] |
| notifier: Добавить счетчики колокольчика в redir-log v.1                                      | [ISL-5145] | [#3740] |
| notifier: Доработать пустое состояние                                                         | [ISL-5116] | [#3685] |
| notifier: Закрывать окно нотификатора при клике по кнопке браузера «Назад»                    | [ISL-5115] | [#3725] |
| notifier: Зафиксировать высоту notifier__popup                                                | [ISL-4933] | [#3487] |
| notifier: Переходить в профиль пользователя Коллекций по клику на аватар                      | [ISL-5154] | [#3769] |
| select2 - исправить выбор пункта меню в селекте с помощью клавиши Space (браузер…             | [ISL-4875] | [#3623] |
| select2.react: Исправить поведение селекта с типом simple при выборе пункта меню…             | [ISL-4938] | [#3634] |
| select2: Поправить выравнивание у элемента button                                             | [ISL-4691] | [#3065] |
| [select2: Смотреть в значение контрола при инициализации](#ISL-4851)                          | [ISL-4851] | [#3662] |
| social-broker: HTML5 storage manipulation (DOM-based)                                         | [ISL-4843] | [#3656] |
| textinput.react: Добавить недостающие описания типов                                          | [ISL-5067] | [#3719] |
| textinput: Невозможно программно восстановить значение после reset                            | [ISL-4466] | [#3718] |
| [tooltip: Исследовать возможность сделать хвостик полупрозрачным](#ISL-4416)                  | [ISL-4416] | [#3632] |
| user2.react: в Safari через раз не работает "Добавить аккаунт"                                | [ISL-5141] | [#3722] |
| user2: Обрезается картинка "Добавить аккаунт" в YaBro                                         | [ISL-5037] | [#3622] |
| [user2_fetch-accounts_yes: Передавать avatarHost в список аккаунтов](#ISL-5035)               | [ISL-5035] | [#3627] |
| yaplus: Доработки, патчи                                                                      | [ISL-5146] | [#3703] |
| заменить использование bem-react-core на @yandex-lego/i-bem-react                             | [ISL-5167] | [#3768] |

## Пояснения

<a name="ISL-4912"></a>
### [i-bem__dom: Не работает специальный код обработки resize при подписке на несколько событий this.bindToWin('orientationchange resize scroll', handler)][ISL-4912]

При подписке на несколько событий не отрабатывал [специальный код](https://github.yandex-team.ru/lego/islands/blob/v5.23.0/common.blocks/i-bem/__dom/i-bem__dom.js#L539) в `i-bem__dom`.

Чтобы исправить это, код был перенесен в `i-jquery__winresize`, проверка реализована с помощью `preDispatch`.
Элемент `i-jquery__winresize` добавлен в `shouldDeps` `i-bem___dom`.

<a name="ISL-4851"></a>
### [select2: Смотреть в значение контрола при инициализации][ISL-4851]

В блоке `select2` поправлено выравнивание текста в элементе `__button`.
Выравнивание должно быть по левому краю, как в нативном контроле, однако в какой-то момент это сломалось и теперь было исправлено.

<a name="ISL-4416"></a>
### [tooltip: Исследовать возможность сделать хвостик полупрозрачным][ISL-4416]

У блока `tooltip` был добавлен элемент `backdrop` и все стили отвечающие за фон были перенесены на этот элемент. Данное изменение было сделано для того, чтобы иметь возможность устанавливать прозрачность для фона и хвостика одновременно.

Пример использования:
```css
.tooltip__backdrop {
    opacity: 0.8;
}

.tooltip__backdrop:before {
    background-color: #323232;
}

.popup2__tail:after {
    background-image: linear-gradient(to top right, #323232 50%, transparent 50%);
}
```

<a name="ISL-4997"></a>
### [tooltip_theme_promo: Расширение возможностей][ISL-4997]

В блок `tooltip` были внесены изменения внешнего вида для темы `promo`.

Добавлен элемент `close` (закрывающий крестик). Элемент опциональный, по умолчанию не подключается.

Размер кнопок более не ограничен 100px. Ширина кнопки адаптируется под длину текста.

Картинку теперь можно разместить в любом углу `tooltip`. Картинке в уголке добавлен
модификатор `side`, определяющий угол, в котором должна разместиться картинка (`top-left`, `top-right`, `bottom-left`,
`bottom-right`). По умолчанию используется `bottom-left` (как и ранее).

Хвостик стал выглядеть немного иначе. Благодаря этим изменениям были исправлены некоторые баги,
связанные со старым хвостиком.

```js
({
    block: 'tooltip',
    mods: {size: 's', view: 'classic', tone: 'default', theme: 'promo'},
    js: {to: ['bottom-left']},
    content: [
        {elem: 'close'},
        {elem: 'description', content: 'Добавляйте понравившиеся ролики в закладки'},
        {elem: 'corner', mods: {star: 'yes', side: 'top-right'}}
    ]
});
```

<a name="ISL-5127"></a>
### [user2.react: Скачет на touch-phone при скролле][ISL-5127]

В блоке `user2` оставили только одно из возможных направлений раскрытия попапа - `bottom-right`.
Это было сделано, чтобы избежать багов при скролле, кроме того, на сервисах блок мультиавторизации располагается справа и нет кейсов, в которых попапу следует открываться вправо.

Добавлено поле `popup`. Переданные в это поле поля прокидываются в `user2__popup` (в том числе поле `directions`, если `bottom-right` по каким-либо причинам не удовлетворяет всем условиям).
Например:

```js
([{
    block: 'user2',
    uid: 6789054321,
    yu: 123456789012345678,
    retpath: 'https://yandex.ru',
    avatarId: '20706/84473936-5041676',
    popup: {
        zIndexGroupLevel: 4,
        directions: ['bottom-right', 'bottom-left']
    },
    name: 'test',
    passportHost: 'https://passport.yandex.ru',
    unreadCount: 25
}]);

```

```js
<User
    uid='6789054321'
    yu='123456789012345678'
    retpath='https://yandex.ru'
    popup={{
        zIndexGroupLevel: 4,
        directions: ['bottom-right', 'bottom-left']
    }}
    avatarId='20706/84473936-5041676'
    name='Иван Персидский'
    passportHost='https://passport.yandex.ru'
    unreadCount={25} />

```

<a name="ISL-5035"></a>
### [user2_fetch-accounts_yes: Передавать avatarHost в список аккаунтов][ISL-5035]

При использовании модификатора `user2_fetch-accounts_yes` с доменом `yandex-team` необходимо добавить в `shouldDeps` зависимость от модификатора `provider`.

### Пример
```js
[{
    tech: 'js',
    shouldDeps: [
        {
            tech: 'bemhtml',
            block: 'user2',
            mods: {
                provider: ['yandex-team']
            }
        }
    ]
}];
```

<a name="ISL-5106"></a>
### [Реализовать компонент, совмещающий ссылку для Я.Плюс и промо-тултип][ISL-5106]

Реализован блок `yaplus`. Блок представляет собой ссылку, которая, в зависимости от состояния аккаунта (подключен или не подключен Яндекс.Плюс) ведет соответственно либо в пользовательские настройки, либо на страницу Я.Плюс.

Если Яндекс.Плюс не подключен, блок дополняется промо-тултипом.

Блок лежит на уровне `contribs` и публикуется отдельно от библиотеки, что позволяет ему не зависеть от версии Островов.
Блок реализован в `i-bem`- и в `react`-технологии.

[LEGO-2137]: https://st.yandex-team.ru/LEGO-2137
[#3762]: https://github.yandex-team.ru/lego/islands/pull/3762
[ISL-5088]: https://st.yandex-team.ru/ISL-5088
[#3690]: https://github.yandex-team.ru/lego/islands/pull/3690
[ISL-4912]: https://st.yandex-team.ru/ISL-4912
[#3648]: https://github.yandex-team.ru/lego/islands/pull/3648
[ISL-5118]: https://st.yandex-team.ru/ISL-5118
[#3822]: https://github.yandex-team.ru/lego/islands/pull/3822
[ISL-5157]: https://st.yandex-team.ru/ISL-5157
[#3750]: https://github.yandex-team.ru/lego/islands/pull/3750
[ISL-5117]: https://st.yandex-team.ru/ISL-5117
[#3751]: https://github.yandex-team.ru/lego/islands/pull/3751
[ISL-5158]: https://st.yandex-team.ru/ISL-5158
[#3741]: https://github.yandex-team.ru/lego/islands/pull/3741
[ISL-5095]: https://st.yandex-team.ru/ISL-5095
[#3647]: https://github.yandex-team.ru/lego/islands/pull/3647
[ISL-5022]: https://st.yandex-team.ru/ISL-5022
[#3653]: https://github.yandex-team.ru/lego/islands/pull/3653
[ISL-5145]: https://st.yandex-team.ru/ISL-5145
[#3740]: https://github.yandex-team.ru/lego/islands/pull/3740
[ISL-5116]: https://st.yandex-team.ru/ISL-5116
[#3685]: https://github.yandex-team.ru/lego/islands/pull/3685
[ISL-5115]: https://st.yandex-team.ru/ISL-5115
[#3725]: https://github.yandex-team.ru/lego/islands/pull/3725
[ISL-4933]: https://st.yandex-team.ru/ISL-4933
[#3487]: https://github.yandex-team.ru/lego/islands/pull/3487
[ISL-5154]: https://st.yandex-team.ru/ISL-5154
[#3769]: https://github.yandex-team.ru/lego/islands/pull/3769
[ISL-4875]: https://st.yandex-team.ru/ISL-4875
[#3623]: https://github.yandex-team.ru/lego/islands/pull/3623
[ISL-4938]: https://st.yandex-team.ru/ISL-4938
[#3634]: https://github.yandex-team.ru/lego/islands/pull/3634
[ISL-4691]: https://st.yandex-team.ru/ISL-4691
[#3065]: https://github.yandex-team.ru/lego/islands/pull/3065
[ISL-4851]: https://st.yandex-team.ru/ISL-4851
[#3662]: https://github.yandex-team.ru/lego/islands/pull/3662
[ISL-4843]: https://st.yandex-team.ru/ISL-4843
[#3656]: https://github.yandex-team.ru/lego/islands/pull/3656
[ISL-4954]: https://st.yandex-team.ru/ISL-4954
[#3825]: https://github.yandex-team.ru/lego/islands/pull/3825
[ISL-5067]: https://st.yandex-team.ru/ISL-5067
[#3719]: https://github.yandex-team.ru/lego/islands/pull/3719
[ISL-4784]: https://st.yandex-team.ru/ISL-4784
[#3641]: https://github.yandex-team.ru/lego/islands/pull/3641
[ISL-4466]: https://st.yandex-team.ru/ISL-4466
[#3718]: https://github.yandex-team.ru/lego/islands/pull/3718
[ISL-4416]: https://st.yandex-team.ru/ISL-4416
[#3632]: https://github.yandex-team.ru/lego/islands/pull/3632
[ISL-4030]: https://st.yandex-team.ru/ISL-4030
[#3612]: https://github.yandex-team.ru/lego/islands/pull/3612
[ISL-4997]: https://st.yandex-team.ru/ISL-4997
[#3586]: https://github.yandex-team.ru/lego/islands/pull/3586
[ISL-4868]: https://st.yandex-team.ru/ISL-4868
[#3584]: https://github.yandex-team.ru/lego/islands/pull/3584
[ISL-5127]: https://st.yandex-team.ru/ISL-5127
[#3805]: https://github.yandex-team.ru/lego/islands/pull/3805
[ISL-5141]: https://st.yandex-team.ru/ISL-5141
[#3722]: https://github.yandex-team.ru/lego/islands/pull/3722
[ISL-5148]: https://st.yandex-team.ru/ISL-5148
[#3730]: https://github.yandex-team.ru/lego/islands/pull/3730
[ISL-5037]: https://st.yandex-team.ru/ISL-5037
[#3622]: https://github.yandex-team.ru/lego/islands/pull/3622
[ISL-5035]: https://st.yandex-team.ru/ISL-5035
[#3627]: https://github.yandex-team.ru/lego/islands/pull/3627
[ISL-5160]: https://st.yandex-team.ru/ISL-5160
[#3761]: https://github.yandex-team.ru/lego/islands/pull/3761
[#3758]: https://github.yandex-team.ru/lego/islands/pull/3758
[ISL-5214]: https://st.yandex-team.ru/ISL-5214
[#3773]: https://github.yandex-team.ru/lego/islands/pull/3773
[ISL-5163]: https://st.yandex-team.ru/ISL-5163
[#3759]: https://github.yandex-team.ru/lego/islands/pull/3759
[ISL-5150]: https://st.yandex-team.ru/ISL-5150
[#3737]: https://github.yandex-team.ru/lego/islands/pull/3737
[ISL-5171]: https://st.yandex-team.ru/ISL-5171
[#3774]: https://github.yandex-team.ru/lego/islands/pull/3774
[ISL-5146]: https://st.yandex-team.ru/ISL-5146
[#3703]: https://github.yandex-team.ru/lego/islands/pull/3703
[LEGO-2108]: https://st.yandex-team.ru/LEGO-2108
[#3661]: https://github.yandex-team.ru/lego/islands/pull/3661
[ISL-5106]: https://st.yandex-team.ru/ISL-5106
[#3672]: https://github.yandex-team.ru/lego/islands/pull/3672
[ISL-4921]: https://st.yandex-team.ru/ISL-4921
[#3578]: https://github.yandex-team.ru/lego/islands/pull/3578
[ISL-5167]: https://st.yandex-team.ru/ISL-5167
[#3768]: https://github.yandex-team.ru/lego/islands/pull/3768
