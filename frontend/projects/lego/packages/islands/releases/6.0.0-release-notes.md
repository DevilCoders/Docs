# islands 6.0.0

<!-- ЧЕЛОВЕЧЕСКОЕ ВСТУПЛЕНИЕ -->

Изменения, вошедшие в релиз islands 6.0.0, разделены на группы:

* [мажорные изменения](#Мажорные-изменения) — задачи, в рамках которых произошло изменение или удаление API блоков
* [минорные изменения](#Минорные-изменения) — задачи, в рамках которых произошло расширение API блоков
* [исправлено и улучшено](#Исправлено-и-улучшено) — различные исправления, не затрагивающие API блоков

Все важные изменения подробно описаны [ниже](#Пояснения).

## Мажорные изменения

| Заголовок                                                                         | Задача     | PR                        |
| :-------------------------------------------------------------------------------- | :--------- | :------------------------ |
| [i-bem: Вынести в отдельный пакет](#ISL-4444)                                     | [ISL-4444] | [#4747]                   |
| [Не использовать deprecated-блоки в библиотеке ](#ISL-5708)                       | [ISL-5708] | [#4746], [#4635], [#4388] |
| [Оторвать костыли для старых браузеров](#ISL-5341)                                | [ISL-5341] | [#4536]                   |
| [deprecated: Положить deprecated-блоки в отдельную папку](#ISL-5412)              | [ISL-5412] | [#4695], [#4389]          |
| [suggest2: Перенести в отдельную папку с контрибами](#ISL-4913)                   | [ISL-4913] | [#4690]                   |
| [Перенести meccano-блоки в contribs](#ISL-5703)                                   | [ISL-5703] | [#4694]                   |
| [attach: Удалить устаревшие конструкции и остановить поддержку button](#ISL-3532) | [ISL-3532] | [#4515]                   |

## Минорные изменения

| Заголовок                                                                                     | Задача     | PR      |
| :-------------------------------------------------------------------------------------------- | :--------- | :------ |
| [Поддержка bem-xjst 8 в коде шаблонов](#ISL-5751)                                             | [ISL-5751] | [#4428] |
| [tooltip: Позволять докидывать attrs](#ISL-5787)                                              | [ISL-5787] | [#4742] |
| [dropdown2.react: Добавить возможность прокидывать собственный обработчик в onCl…](#ISL-5817) | [ISL-5817] | [#4669] |

## Исправлено и улучшено

| Заголовок                                                  | Задача     | PR               |
| :--------------------------------------------------------- | :--------- | :--------------- |
| copyright: Поменять название юр-лица Yandex ==> YANDEX     | [ISL-6007] | [#4693], [#4735] |


## Пояснения

<a name="ISL-5751"></a>
### [Поддержка bem-xjst 8 в коде шаблонов][ISL-5751]

В шаблонах поддержан `BEM-XJST 8`.
Обратная совместимость с `7.x` сохранена.

<a name="ISL-4444"></a>
### [i-bem: Вынести в отдельный пакет][ISL-4444]

Компонента `i-bem` и все её зависимости (3 элемента `i-jquery`) были вынесены в отдельный контриб.

Это стратегическое решение было принято исключительно для того, чтобы иметь возможность в скором времени отказаться от текущей поставки `i-bem` в пользу собранной версии, поставляемой через `npm`.
С подробностями можно ознакомиться в тикете https://st.yandex-team.ru/ISL-4914

<a name="ISL-5708"></a>
### [Не использовать deprecated-блоки в библиотеке ][ISL-5708]

Ряд блоков (в основном `meccano`) были переведены на актуальные блоки вместо `deprecated`-блоков.

* Блок `m-editor` и все блоки, которые он использует, переведены на актуальные блоки;
* Модификаторы для `popup2` `_drafts_yes`, `_forms_yes` и `_editor_yes` перенесены в отдельный блок `m-popup`, поскольку в сущности представляют собой обертки для `m-editor-popup`;
* Блок `m-editor-button` переведен на блок `button2`, рефакторинг шаблонов. Теперь нужны поля передаются не в `parentContent`, а в `ctx`:

Было:

```js
block('m-editor-button').mod('type', 'h2').content()(function() {
    var parentContent = applyNext();
    parentContent.attrs.title = BEM.I18N('m-editor-button', 'header2');
    parentContent.js = {
        placeholder: 'Header 2',
        before: '===',
        after: '===',
        hotkey: 'Ctrl+Shift+2, Command+Shift+2'
    };
    parentContent.content = ['h2', {
        elem: 'caption',
        tag: 'span',
        content: (this.ctx.caption && BEM.I18N('m-editor-button', 'header2'))
    }];
    return parentContent;
});
```

Стало:

```js
block('m-editor-button').mod('type', 'h2').content()(function() {
    var ctx = this.ctx;

    ctx.title = BEM.I18N('m-editor-button', 'header2');
    ctx.buttonJs = {
        placeholder: 'Header 2',
        before: '===',
        after: '===',
        hotkey: 'Ctrl+Shift+2, Command+Shift+2'
    };

    ctx.content = [
        'h2',
        {
            block: 'm-editor-button',
            elem: 'caption',
            content: (ctx.caption && BEM.I18N('m-editor-button', 'header2'))
        }
    ];

    return applyNext();
});
```

Вместо модификаторов [`side`](https://github.yandex-team.ru/lego/islands/tree/dev/common.blocks/button#Закругленная-кнопка) и `round`, которые использовались в `button`, теперь передается модификатор [`pin`](https://github.yandex-team.ru/lego/islands/tree/dev/common.blocks/button2#Модификатор-pin).

* `m-editor-popup_type_code` и `m-editor-popup_type_user` теперь используют блок `select2` вместо блока `select` и блок `textarea` вместо блока `input`;
* `m-editor-popup_type_link`, `m-editor-popup_type_user`, `m-editor-popup_type_video` и `m-editor-popup_type_picture` теперь используют блок `textinput` вместо `input`;
* Блок `m-head-action` переведен на блоки `button2` и `popup2`;
* Блок `m-head-menu` переведен на блок `popup2`;
* Блок `m-suggest` переведен на блоки `popup2` и `textinput`;
* Блок `m-datepicker` переведен на блок `textinput` и больше не использует `i-jquery__mousewheel`, но подписывается на событие `wheel`;
* Блок `m-calendar` переведен на блоки `button2` и `textinput`;
* Блоки `i-update-session` и `b-statcounter` больше не используют `i-common`;
* Блок `slider` переведен на `textinput`;
* В блоке `auth` теперь используются `textinput`, `button2`, `dropdown2` и `popup2`;
* Из блока `popup2` удален код про совместимость с блоком `popup`;
* `m-datepicker` переведен на блок `button2`;
* в блоке `b-autocomplete-item` больше не используется `i-bem-html`;
* `input_suggest_yes` переведен на блок `popup2`.

### Для блоков, переведенных на блок `popup2`

У `popup2` нет методов `show()` и `hide()`, ему нужно удалять и проставлять модификатор `visible, yes`. Также этот блок вызывает события `beforeOpen` и `beforeClose`, а не `open` и `hide`. К сожалению, у него пока не реализован циклический фокус - [Сделать блок focus-manager](https://st.yandex-team.ru/ISL-1899);

### Для блоков, переведенных на блок `select2`

У блока `select2` вместо метода `val` используются методы `getVal` и `setVal` (в будущем ему [будет добавлен](https://st.yandex-team.ru/ISL-3235) метод `val` для обеспечения консистентности API). Также у блока `select2` нет метода `_getPopup()`, обращаться к `select2__popup` можно через свойство `popup`.

### Изменения в API `input_suggest_yes`
Чтобы передать `directions` для `popup2`, нужно передать специальное поле `popupDirections`.

### Изменения в блоке `m-suggest`

В блоке `m-suggest` удалена `js`-логика модификатора `label`. Теперь для модификаторов отступы и положение меток реализованы через `css`. Если вам нужен дизайн, отличный от `m-suggest__popup_header_yes` или `m-suggest-in-search-header`, пожалуйста, пропишите их на уровне сервиса.

<a name="ISL-5341"></a>
### [Оторвать костыли для старых браузеров][ISL-5341]

В Лего 6.0 обновился список [поддерживаемых браузеров](https://st.yandex-team.ru/LEGO-2182#5b475f99ef8d2e001ae452d7).
В рамках этой задачи были оторваны решения, необходимые для браузеров, поддержка которых прекращена.

* Оторваны специальные стили для `IE8-9` (`ie8.css`, `ie9.css`)
* Блоки больше не используют `png`
* Элемент `__svg` убран из зависимостей блока `i-ua`, удалены стили, использующие селекторы `i-ua_svg_no` etc.
* В блоках `menu`, `attach` убрана явная проверка на наличие модификатора `_disabled` - теперь в поддержке [нет браузеров](https://caniuse.com/#feat=pointer-events), не поддерживающих `pointer-events`
* Убраны различные мелкие хаки
* Из шаблонов `b-page__css` удален код про условные комментарии для `ie8`, `ie9`

<a name="ISL-5412"></a>
### [deprecated: Положить deprecated-блоки в отдельную папку][ISL-5412]

Ряд устаревших и малоиспользуемых блоков, элементов и модификаторов были перенесены в отдельный пакет `islands-deprecated`.

Библиотеку не рекомендуется использовать, лучше по возможности запланировать работу по переходу на актуальные блоки.

```sh
npm install --save @yandex-lego/ui.islands-deprecated --registry=https://npm.yandex-team.ru
```

Блоки, элементы и модификаторы, попавшие в пакет:

* `alert`
* `alert-controller`
* `arrow`
* `b-dropdowna`
* `b-flash`
* `b-form`
* `b-form-attach`
* `b-form-button`
* `b-form-checkbox`
* `b-form-input`
* `b-head-stripe`
* `b-icon`
* `b-keyboard`
* `b-keyboard-loader`
* `b-keyboard-popup`
* `b-lang-switcher`
* `b-layout-table`
* `b-link`
* `b-menu`
* `b-menu-horiz`
* `b-menu-vert`
* `b-popupa`
* `b-slider`
* `b-slider-arrows`
* `b-slider-docs`
* `b-slider-indicator`
* `b-slider-shadow`
* `button`
* `check-button`
* `domik`
* `dropdown`
* `dropdown-menu`
* `dropdown2_switcher_button`
* `head-menu`
* `header`
* `header2__action`
* `header2__logo_preset`
* `header2__nameplate`
* `i-bem-html`
* `i-clipboard`
* `i-common`
* `i-flashcookie`
* `i-jquery__escape`
* `i-jquery__jsonp`
* `i-jquery__mousewheel`
* `i-loader`
* `i-menu`
* `i-popup`
* `i-ua__svg`
* `i-update-session`
* `i-user-info`
* `i-user-services`
* `input__found`
* `input__service-label`
* `input_width_content`
* `input_service-label_yes`
* `layout`
* `link-update-controller`
* `nameplate`
* `page-layout`
* `paranja`
* `polyfill`
* `popup`
* `select`
* `share-dropdown`
* `slide`
* `spin`
* `suggest`
* `suggest-item`
* `suggest2_for_popup`
* `user`
* `user-a11y-exit`
* `user-menu-update`

Неиспользуемые блоки и модификаторы были окончательно удалены из библиотеки `islands`:

* `m-button-action`
* `m-head_orange`
* `m-orange`
* `m-orange-actions`
* `m-orange-item`
* `m-oranges`
* `m-phone-button`
* `mi-orange`
* `mi-orange-token`
* `mi-phone-button`

<a name="ISL-5787"></a>
### [tooltip: Позволять докидывать attrs][ISL-5787]

В блок `tooltip` теперь можно прокидывать атрибуты с помощью `attrs`

<a name="ISL-5817"></a>
### [dropdown2.react: Добавить возможность прокидывать собственный обработчик в onClick][ISL-5817]

В блок `dropdown2` теперь можно прокидывать собственный обработчик клика с помощью `onSwitcherClick`
 Пример:
```javascript
//дропдаун с кастомным обработчиком клика
<Dropdown
    view='default'
    tone={tone}
    theme='normal'
    size={size}
    switcher='button'
    onSwitcherClick={(e) => {...}}
    hasTick>
    <Dropdown.Switcher>Кнопошка</Dropdown.Switcher>
    <Dropdown.Popup>Попапушка</Dropdown.Popup>
</Dropdown>
```

<a name="ISL-4913"></a>
### [suggest2: Перенести в отдельную папку с контрибами][ISL-4913]

Блок `suggest2` и все вспомогательные блоки вынесены в отдельный пакет @yandex-lego/ui.suggest2

```sh
npm install --save @yandex-lego/ui.suggest2 --registry=https://npm.yandex-team.ru
```

<a name="ISL-5703"></a>
### [Перенести meccano-блоки в contribs][ISL-5703]

`meccano`-блоки вынесены в отдельный контриб `@yandex-lego/meccano`.

```sh
npm install --save @yandex-lego/meccano --registry=https://npm.yandex-team.ru
```

<a name="ISL-3532"></a>
### [attach: Удалить устаревшие конструкции и остановить поддержку button][ISL-3532]

В блоке `attach` больше не используется блок `button`, вместо него используется `button2`.
Раньше использование `button2` включалось модификатором `_use_button2`, теперь это полностью перешло в код блока и модификатора больше не существует.


[SERP-76899]: https://st.yandex-team.ru/SERP-76899
[#4756]: https://github.yandex-team.ru/lego/islands/pull/4756
[ISL-5751]: https://st.yandex-team.ru/ISL-5751
[#4428]: https://github.yandex-team.ru/lego/islands/pull/4428
[SERP-76237]: https://st.yandex-team.ru/SERP-76237
[#4769]: https://github.yandex-team.ru/lego/islands/pull/4769
[ISL-6007]: https://st.yandex-team.ru/ISL-6007
[#4693]: https://github.yandex-team.ru/lego/islands/pull/4693
[#4735]: https://github.yandex-team.ru/lego/islands/pull/4735
[INFRADUTY-2782]: https://st.yandex-team.ru/INFRADUTY-2782
[#4763]: https://github.yandex-team.ru/lego/islands/pull/4763
[ISL-4444]: https://st.yandex-team.ru/ISL-4444
[#4747]: https://github.yandex-team.ru/lego/islands/pull/4747
[ISL-5708]: https://st.yandex-team.ru/ISL-5708
[#4746]: https://github.yandex-team.ru/lego/islands/pull/4746
[#4635]: https://github.yandex-team.ru/lego/islands/pull/4635
[#4388]: https://github.yandex-team.ru/lego/islands/pull/4388
[ISL-5995]: https://st.yandex-team.ru/ISL-5995
[#4723]: https://github.yandex-team.ru/lego/islands/pull/4723
[ISL-5341]: https://st.yandex-team.ru/ISL-5341
[#4536]: https://github.yandex-team.ru/lego/islands/pull/4536
[ISL-5412]: https://st.yandex-team.ru/ISL-5412
[#4695]: https://github.yandex-team.ru/lego/islands/pull/4695
[#4389]: https://github.yandex-team.ru/lego/islands/pull/4389
[ISL-5787]: https://st.yandex-team.ru/ISL-5787
[#4742]: https://github.yandex-team.ru/lego/islands/pull/4742
[SERP-76029]: https://st.yandex-team.ru/SERP-76029
[#4720]: https://github.yandex-team.ru/lego/islands/pull/4720
[ISL-5867]: https://st.yandex-team.ru/ISL-5867
[#4670]: https://github.yandex-team.ru/lego/islands/pull/4670
[ISL-5817]: https://st.yandex-team.ru/ISL-5817
[#4669]: https://github.yandex-team.ru/lego/islands/pull/4669
[ISL-4913]: https://st.yandex-team.ru/ISL-4913
[#4690]: https://github.yandex-team.ru/lego/islands/pull/4690
[LEGO-2128]: https://st.yandex-team.ru/LEGO-2128
[#4253]: https://github.yandex-team.ru/lego/islands/pull/4253
[ISL-5703]: https://st.yandex-team.ru/ISL-5703
[#4694]: https://github.yandex-team.ru/lego/islands/pull/4694
[SAKHALIN-2327]: https://st.yandex-team.ru/SAKHALIN-2327
[#4633]: https://github.yandex-team.ru/lego/islands/pull/4633
[SERP-75597]: https://st.yandex-team.ru/SERP-75597
[#4427]: https://github.yandex-team.ru/lego/islands/pull/4427
[ISL-3532]: https://st.yandex-team.ru/ISL-3532
[#4515]: https://github.yandex-team.ru/lego/islands/pull/4515
[ISL-5998]: https://st.yandex-team.ru/ISL-5998
[#4725]: https://github.yandex-team.ru/lego/islands/pull/4725
