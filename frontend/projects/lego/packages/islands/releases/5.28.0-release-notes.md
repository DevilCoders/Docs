# islands 5.28.0

Изменения, вошедшие в релиз islands 5.28.0, разделены на группы:

* [минорные изменения](#Минорные-изменения) — задачи, в рамках которых произошло расширение API блоков
* [исправлено и улучшено](#Исправлено-и-улучшено) — различные исправления, не затрагивающие API блоков
* [дополнительно](#Дополнительно) — задачи, не касающиеся кода блоков (документация, инфраструктура и т.д.)

Все важные изменения подробно описаны [ниже](#Пояснения).

## Минорные изменения

| Заголовок                                                                   | Задача     | PR      |
| :-------------------------------------------------------------------------- | :--------- | :------ |
| favorites: Добавить счетчик на закрывающий крестик                          | [ISL-5636] | [#4338] |
| i-font: Обновить YandexSans                                                 | [ISL-5012] | [#4365] |
| [link.react: Сделать возможным указывать иконку с любой стороны](#ISL-4023) | [ISL-4023] | [#3981] |
| [menu.react: Добавить метод onChange](#ISL-5181)                            | [ISL-5181] | [#4063] |
| [notifier: Улучшение дизайна](#ISL-5494)                                    | [ISL-5494] | [#4178] |
| popup2.react: Название onOutsideClick вводит в замешательство               | [ISL-5499] | [#4312] |
| [tooltip_theme_promo: Расширение возможностей 2](#ISL-5084)                 | [ISL-5084] | [#4314] |
| user-hat: Создать рекламный блок в user2                                    | [ISL-5228] | [#3928] |
| [Добавить новые иконки и сервисы в lego/tableau ](#ISL-5677)                | [ISL-5677] | [#4362] |

## Исправлено и улучшено

| Заголовок                                                                        | Задача     | PR               |
| :------------------------------------------------------------------------------- | :--------- | :--------------- |
| (lego-on-react) TextInput, TextArea не корректно работают с focused              | [ISL-5224] | [#4020]          |
| IOS контент скрывается при открытии tooltip в showcase                           | [ISL-5672] | [#4408]          |
| Uncaught TypeError: Cannot read property 'getAttribute' of null в pointerevents… | [ISL-5221] | [#4242]          |
| button2_view_default: Некорректное отображение цвета текста неактивной кнопки    | [ISL-5184] | [#4259]          |
| global-notifications: Пропала кнопка прочитывания уведомления                    | [ISL-5307] | [#3990]          |
| i-ua.react: Обойти конфликт с i-bem реализацией                                  | [ISL-5479] | [#4165]          |
| i-ua: Ошибка в IE11                                                              | [ISL-5280] | [#3989]          |
| input_autofocus_yes: срабатывает автофокус при нажатии на shift, backspace       | [ISL-5395] | [#4353], [#4324] |
| lego-on-react: Добавить блокам с вложенным popup2 пропс hiding                   | [ISL-3953] | [#4067]          |
| m-editor: удаление старых обработчиков хоткеев при повторной инициализации       | [ISL-5625] | [#4309]          |
| menu.react: Для MenuText нужно добавить уникальный ключ                          | [ISL-5092] | [#4337]          |
| modal: По клику на самый верхний modal закрываются те, что под ними              | [ISL-5220] | [#4088]          |
| notifier: Сдвинуть на 2 пикселя                                                  | [ISL-5675] | [#4364]          |
| popup2.react: Если открытие происходит не по клику, popup закрывается только со… | [ISL-4944] | [#3982]          |
| popup2.react: Перейти на использование Portal                                    | [ISL-4964] | [#4027]          |
| radio-button.react: Получать tabIndex из пропсов                                 | [ISL-5244] | [#4257]          |
| radio-button: Ломается вёрстка при resize в новом дизайне                        | [ISL-5305] | [#4245]          |
| radio-button: Не анимировать выбор значения при инициализации                    | [ISL-5397] | [#4097]          |
| react.notifier: onBeforeClose не срабатывает при нажатии браузерной кнопки назад | [ISL-5503] | [#4181]          |
| select2: Добавить возможность указывать текст выбранного пункта                  | [ISL-4601] | [#4053]          |
| select2: Падает ошибка при items:[] в BEMJSON                                    | [ISL-5083] | [#4301], [#4300] |
| serp-header: Поправить стили Плюса для детского поиска                           | [ISL-5577] | [#4241]          |
| suggest2: Поправить селекторы                                                    | [ISL-5424] | [#4087]          |
| tableau-node: Исправить ошибку при вызове URL parse                              | [ISL-5620] | [#4325]          |
| tableau.react: Добавить тайпинги                                                 | [ISL-5535] | [#4292]          |
| textinput, select2: Исправить выравнивание по базовой линии                      | [ISL-5076] | [#4132]          |
| tooltip.react: В dist нет элемента corner                                        | [ISL-5258] | [#4019]          |
| tooltip: У темы promo неправильно выравнивается хвост при направлении left-cent… | [ISL-5328] | [#3978]          |
| [user-hat: Поправить отображение в ie11](#ISL-5544)                              | [ISL-5544] | [#4214]          |
| [user2: Поправить отступы слева для пунктов меню](#ISL-5642)                     | [ISL-5642] | [#4319]          |
| user2: При добавлении пользователя перенаправляет на предыдущий запрос           | [ISL-5430] | [#4252], [#4244] |
| user2: Скрывать имя пользователя на планшетах и ограничить его ширину            | [ISL-5315] | [#4012]          |
| Моргает логотип в детском режиме в Видео                                         | [ISL-5411] | [#4076]          |

## Дополнительно

| Заголовок                                                                        | Задача     | PR      |
| :------------------------------------------------------------------------------- | :--------- | :------ |
| global-notifications: Поддержать в виджете уведомлений запрос для конкретных се… | [ISL-5250] | [#3992] |
| global-notifications: Проанализировать долгую загрузку на тачфонах               | [ISL-5364] | [#4052] |
| notifier.react: history api работает некорректно                                 | [ISL-5334] | [#3985] |
| notifier.react: Добавить возможность использовать modal вместо popup2            | [ISL-5330] | [#4043] |
| notifier: В ie11,edge, FF видны непонятные скроллы на всех элементах             | [ISL-5409] | [#4124] |
| notifier: Если у пользователя только один сервис, то попап обрезается            | [ISL-5470] | [#4128] |
| notifier: Не открывается окошко нотификатора в IE11                              | [ISL-5343] | [#3997] |
| notifier: Не работает переход на уведомление из диска по клике на фотографию     | [ISL-5399] | [#4057] |
| notifier: Поддержать работу на сервере                                           | [ISL-5290] | [#3966] |
| notifier: не открывается нотификатор в IE11                                      | [ISL-5458] | [#4117] |
| В мобильной верстке взаимодействие с нотификациями не отмечает их как …          | [ISL-5303] | [#4018] |

## Пояснения

<a name="ISL-5542"></a>
### [lego-on-react: удалить i-font из поставки][ISL-5542]

Из библиотеки `lego-on-react` был удален компонент `Font` из-за проблем с итоговым размером сборки, теперь для использования шрифтов необходимо загружать их со статики:

* https://yastatic.net/s3/home/fonts/ys/1/text-regular.woff2
* https://yastatic.net/s3/home/fonts/ys/1/text-medium.woff2
* https://yastatic.net/s3/home/fonts/ys/1/text-bold.woff2

Так же список доступных шрифтов со ссылками на статику можно посмотреть на странице примеров:

https://lego.yandex-team.ru/__example/islands/v5.27.0/desktop.examples/i-font/all/all.html#Шрифты

<a name="ISL-4023"></a>
### [link.react: Сделать возможным указывать иконку с любой стороны][ISL-4023]

В блоке `link` для элемента `__icon` добавлен модификатор `side` со значениями left и right.
Раньше не работало свойство iconRight и иконка не размещалась справа от текста.
Теперь можно разместить иконки и слева, и справа от текста ссылки.

```js
[{
    block: 'link',

    iconRight: { // icon / iconLeft / iconRight
        block: 'icon',
        mods: {
            type: 'load'
        }
    },
    text: 'Текст'
}]
```

<a name="ISL-5181"></a>
### [menu.react: Добавить метод onChange][ISL-5181]

Расширен API блока `menu` в `react`-реализации: добавлен метод `onChange`.
Метод принимает два аргумента: предыдущее и актуальное, уже обработанное значение `val`:

```
onChange(newVal, oldVal) {
    this.setState({val: newVal});
}
```

Теперь больше нет необходимости обрабатывать `val` самостоятельно для каждого отдельно типа меню, достаточно передать в пропсы `onChange`.

<a name="ISL-5494"></a>
### [notifier: Улучшение дизайна][ISL-5494]

В `global-notifications` обновлен дизайн непрочитанных сообщений и иконок сервисов.
В `notifier` обновлен крестик.

<a name="ISL-5084"></a>
### [tooltip_theme_promo: Расширение возможностей 2][ISL-5084]

B библиотеку добавлен новый блок `message-box`.

Он предназначен для компоновки контента внутри блока `popup2`
Также может быть использован и как самостоятельный блок.

<a name="ISL-5544"></a>
### [user-hat: Поправить отображение в ie11][ISL-5544]

Поправлено отображение блока `user-hat` в `ie11`.

<a name="ISL-5642"></a>
### [user2: Поправить отступы слева для пунктов меню][ISL-5642]

В блоке `user2` исправлен отступ для текста пунктом меню - выровнен в соответствии с именем пользователя.

<a name="ISL-5677"></a>
### [Добавить новые иконки и сервисы в lego/tableau ][ISL-5677]

В пакете `services` добавлены новые сервисы: коммандер, Direct API, английская версия РСЯ

[ISL-5224]: https://st.yandex-team.ru/ISL-5224
[#4020]: https://github.yandex-team.ru/lego/islands/pull/4020
[ISL-5672]: https://st.yandex-team.ru/ISL-5672
[#4408]: https://github.yandex-team.ru/lego/islands/pull/4408
[SERPTEST-491]: https://st.yandex-team.ru/SERPTEST-491
[#4023]: https://github.yandex-team.ru/lego/islands/pull/4023
[ISL-5221]: https://st.yandex-team.ru/ISL-5221
[#4242]: https://github.yandex-team.ru/lego/islands/pull/4242
[SAKHALIN-2054]: https://st.yandex-team.ru/SAKHALIN-2054
[#4299]: https://github.yandex-team.ru/lego/islands/pull/4299
[SERP-70248]: https://st.yandex-team.ru/SERP-70248
[#4100]: https://github.yandex-team.ru/lego/islands/pull/4100
[ISL-5184]: https://st.yandex-team.ru/ISL-5184
[#4259]: https://github.yandex-team.ru/lego/islands/pull/4259
[LEGO-2259]: https://st.yandex-team.ru/LEGO-2259
[#4413]: https://github.yandex-team.ru/lego/islands/pull/4413
[ISL-5636]: https://st.yandex-team.ru/ISL-5636
[#4338]: https://github.yandex-team.ru/lego/islands/pull/4338
[INFRADUTY-1571]: https://st.yandex-team.ru/INFRADUTY-1571
[#4120]: https://github.yandex-team.ru/lego/islands/pull/4120
[ISL-5250]: https://st.yandex-team.ru/ISL-5250
[#3992]: https://github.yandex-team.ru/lego/islands/pull/3992
[ISL-5364]: https://st.yandex-team.ru/ISL-5364
[#4052]: https://github.yandex-team.ru/lego/islands/pull/4052
[ISL-5307]: https://st.yandex-team.ru/ISL-5307
[#3990]: https://github.yandex-team.ru/lego/islands/pull/3990
[ISL-5012]: https://st.yandex-team.ru/ISL-5012
[#4365]: https://github.yandex-team.ru/lego/islands/pull/4365
[ISL-5479]: https://st.yandex-team.ru/ISL-5479
[#4165]: https://github.yandex-team.ru/lego/islands/pull/4165
[ISL-5280]: https://st.yandex-team.ru/ISL-5280
[#3989]: https://github.yandex-team.ru/lego/islands/pull/3989
[ISL-5395]: https://st.yandex-team.ru/ISL-5395
[#4353]: https://github.yandex-team.ru/lego/islands/pull/4353
[#4324]: https://github.yandex-team.ru/lego/islands/pull/4324
[LEGO-2177]: https://st.yandex-team.ru/LEGO-2177
[#3984]: https://github.yandex-team.ru/lego/islands/pull/3984
[ISL-3953]: https://st.yandex-team.ru/ISL-3953
[#4067]: https://github.yandex-team.ru/lego/islands/pull/4067
[ISL-5542]: https://st.yandex-team.ru/ISL-5542
[#4410]: https://github.yandex-team.ru/lego/islands/pull/4410
[ISL-4023]: https://st.yandex-team.ru/ISL-4023
[#3981]: https://github.yandex-team.ru/lego/islands/pull/3981
[ISL-5625]: https://st.yandex-team.ru/ISL-5625
[#4309]: https://github.yandex-team.ru/lego/islands/pull/4309
[ISL-5092]: https://st.yandex-team.ru/ISL-5092
[#4337]: https://github.yandex-team.ru/lego/islands/pull/4337
[ISL-5181]: https://st.yandex-team.ru/ISL-5181
[#4063]: https://github.yandex-team.ru/lego/islands/pull/4063
[ISL-5220]: https://st.yandex-team.ru/ISL-5220
[#4088]: https://github.yandex-team.ru/lego/islands/pull/4088
[ISL-5334]: https://st.yandex-team.ru/ISL-5334
[#3985]: https://github.yandex-team.ru/lego/islands/pull/3985
[ISL-5330]: https://st.yandex-team.ru/ISL-5330
[#4043]: https://github.yandex-team.ru/lego/islands/pull/4043
[ISL-5409]: https://st.yandex-team.ru/ISL-5409
[#4124]: https://github.yandex-team.ru/lego/islands/pull/4124
[ISL-5470]: https://st.yandex-team.ru/ISL-5470
[#4128]: https://github.yandex-team.ru/lego/islands/pull/4128
[ISL-5343]: https://st.yandex-team.ru/ISL-5343
[#3997]: https://github.yandex-team.ru/lego/islands/pull/3997
[ISL-5399]: https://st.yandex-team.ru/ISL-5399
[#4057]: https://github.yandex-team.ru/lego/islands/pull/4057
[ISL-5290]: https://st.yandex-team.ru/ISL-5290
[#3966]: https://github.yandex-team.ru/lego/islands/pull/3966
[LEGO-2160]: https://st.yandex-team.ru/LEGO-2160
[#3895]: https://github.yandex-team.ru/lego/islands/pull/3895
[ISL-5675]: https://st.yandex-team.ru/ISL-5675
[#4364]: https://github.yandex-team.ru/lego/islands/pull/4364
[ISL-5494]: https://st.yandex-team.ru/ISL-5494
[#4178]: https://github.yandex-team.ru/lego/islands/pull/4178
[ISL-5458]: https://st.yandex-team.ru/ISL-5458
[#4117]: https://github.yandex-team.ru/lego/islands/pull/4117
[ISL-4944]: https://st.yandex-team.ru/ISL-4944
[#3982]: https://github.yandex-team.ru/lego/islands/pull/3982
[ISL-5499]: https://st.yandex-team.ru/ISL-5499
[#4312]: https://github.yandex-team.ru/lego/islands/pull/4312
[ISL-4964]: https://st.yandex-team.ru/ISL-4964
[#4027]: https://github.yandex-team.ru/lego/islands/pull/4027
[ISL-5244]: https://st.yandex-team.ru/ISL-5244
[#4257]: https://github.yandex-team.ru/lego/islands/pull/4257
[ISL-5305]: https://st.yandex-team.ru/ISL-5305
[#4245]: https://github.yandex-team.ru/lego/islands/pull/4245
[ISL-5397]: https://st.yandex-team.ru/ISL-5397
[#4097]: https://github.yandex-team.ru/lego/islands/pull/4097
[ISL-5503]: https://st.yandex-team.ru/ISL-5503
[#4181]: https://github.yandex-team.ru/lego/islands/pull/4181
[LEGO-2153]: https://st.yandex-team.ru/LEGO-2153
[#3827]: https://github.yandex-team.ru/lego/islands/pull/3827
[ISL-4601]: https://st.yandex-team.ru/ISL-4601
[#4053]: https://github.yandex-team.ru/lego/islands/pull/4053
[ISL-5083]: https://st.yandex-team.ru/ISL-5083
[#4301]: https://github.yandex-team.ru/lego/islands/pull/4301
[#4300]: https://github.yandex-team.ru/lego/islands/pull/4300
[LEGO-2207]: https://st.yandex-team.ru/LEGO-2207
[#4036]: https://github.yandex-team.ru/lego/islands/pull/4036
[ISL-5577]: https://st.yandex-team.ru/ISL-5577
[#4241]: https://github.yandex-team.ru/lego/islands/pull/4241
[LEGO-2129]: https://st.yandex-team.ru/LEGO-2129
[#3795]: https://github.yandex-team.ru/lego/islands/pull/3795
[ISL-5424]: https://st.yandex-team.ru/ISL-5424
[#4087]: https://github.yandex-team.ru/lego/islands/pull/4087
[ISL-5620]: https://st.yandex-team.ru/ISL-5620
[#4325]: https://github.yandex-team.ru/lego/islands/pull/4325
[ISL-5535]: https://st.yandex-team.ru/ISL-5535
[#4292]: https://github.yandex-team.ru/lego/islands/pull/4292
[ISL-5076]: https://st.yandex-team.ru/ISL-5076
[#4132]: https://github.yandex-team.ru/lego/islands/pull/4132
[ISL-5258]: https://st.yandex-team.ru/ISL-5258
[#4019]: https://github.yandex-team.ru/lego/islands/pull/4019
[ISL-5328]: https://st.yandex-team.ru/ISL-5328
[#3978]: https://github.yandex-team.ru/lego/islands/pull/3978
[ISL-5084]: https://st.yandex-team.ru/ISL-5084
[#4314]: https://github.yandex-team.ru/lego/islands/pull/4314
[ISL-5544]: https://st.yandex-team.ru/ISL-5544
[#4214]: https://github.yandex-team.ru/lego/islands/pull/4214
[ISL-5228]: https://st.yandex-team.ru/ISL-5228
[#3928]: https://github.yandex-team.ru/lego/islands/pull/3928
[ISL-5642]: https://st.yandex-team.ru/ISL-5642
[#4319]: https://github.yandex-team.ru/lego/islands/pull/4319
[ISL-5430]: https://st.yandex-team.ru/ISL-5430
[#4252]: https://github.yandex-team.ru/lego/islands/pull/4252
[#4244]: https://github.yandex-team.ru/lego/islands/pull/4244
[ISL-5315]: https://st.yandex-team.ru/ISL-5315
[#4012]: https://github.yandex-team.ru/lego/islands/pull/4012
[ISL-5303]: https://st.yandex-team.ru/ISL-5303
[#4018]: https://github.yandex-team.ru/lego/islands/pull/4018
[SAKHALIN-2163]: https://st.yandex-team.ru/SAKHALIN-2163
[#4095]: https://github.yandex-team.ru/lego/islands/pull/4095
[ISL-5677]: https://st.yandex-team.ru/ISL-5677
[#4362]: https://github.yandex-team.ru/lego/islands/pull/4362
[SERP-70882]: https://st.yandex-team.ru/SERP-70882
[#4185]: https://github.yandex-team.ru/lego/islands/pull/4185
[METR-29606]: https://st.yandex-team.ru/METR-29606
[#4163]: https://github.yandex-team.ru/lego/islands/pull/4163
[LEGO-2203]: https://st.yandex-team.ru/LEGO-2203
[#4025]: https://github.yandex-team.ru/lego/islands/pull/4025
[LEGO-2182]: https://st.yandex-team.ru/LEGO-2182
[#3977]: https://github.yandex-team.ru/lego/islands/pull/3977
[LEGO-2174]: https://st.yandex-team.ru/LEGO-2174
[#3923]: https://github.yandex-team.ru/lego/islands/pull/3923
[ISL-5411]: https://st.yandex-team.ru/ISL-5411
[#4076]: https://github.yandex-team.ru/lego/islands/pull/4076
[LEGO-2186]: https://st.yandex-team.ru/LEGO-2186
[#3974]: https://github.yandex-team.ru/lego/islands/pull/3974
[SERP-68747]: https://st.yandex-team.ru/SERP-68747
[#3958]: https://github.yandex-team.ru/lego/islands/pull/3958
[IMAGESUI-8638]: https://st.yandex-team.ru/IMAGESUI-8638
[#4363]: https://github.yandex-team.ru/lego/islands/pull/4363
[SERP-72442]: https://st.yandex-team.ru/SERP-72442
[#4359]: https://github.yandex-team.ru/lego/islands/pull/4359
[#4306]: https://github.yandex-team.ru/lego/islands/pull/4306
[INFRADUTY-1475]: https://st.yandex-team.ru/INFRADUTY-1475
[#4051]: https://github.yandex-team.ru/lego/islands/pull/4051
[LEGO-2168]: https://st.yandex-team.ru/LEGO-2168
[#4047]: https://github.yandex-team.ru/lego/islands/pull/4047
[SERP-68767]: https://st.yandex-team.ru/SERP-68767
[#4055]: https://github.yandex-team.ru/lego/islands/pull/4055
[SERP-70071]: https://st.yandex-team.ru/SERP-70071
[#4086]: https://github.yandex-team.ru/lego/islands/pull/4086
[SERP-70302]: https://st.yandex-team.ru/SERP-70302
[#4126]: https://github.yandex-team.ru/lego/islands/pull/4126
[SERP-68022]: https://st.yandex-team.ru/SERP-68022
[#4082]: https://github.yandex-team.ru/lego/islands/pull/4082
[LEGO-2150]: https://st.yandex-team.ru/LEGO-2150
[#3946]: https://github.yandex-team.ru/lego/islands/pull/3946
[LEGO-2202]: https://st.yandex-team.ru/LEGO-2202
[#4013]: https://github.yandex-team.ru/lego/islands/pull/4013
[INFRADUTY-1673]: https://st.yandex-team.ru/INFRADUTY-1673
[#4197]: https://github.yandex-team.ru/lego/islands/pull/4197
