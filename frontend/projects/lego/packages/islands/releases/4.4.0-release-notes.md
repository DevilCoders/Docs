# islands 4.4.0

<!-- ЧЕЛОВЕЧЕСКОЕ ВСТУПЛЕНИЕ -->

Изменения, вошедшие в релиз islands 4.4.0, разделены на группы:

* [минорные изменения](#Минорные-изменения) — задачи, в рамках которых произошло расширение API блоков;
* [исправлено и улучшено](#Исправлено-и-улучшено) — различные исправления, не затрагивающие API блоков;
* [дополнительно](#Дополнительно) — задачи, не касающиеся кода блоков (документация, инфраструктура и т.д.).

Все важные изменения подробно описаны [ниже](#Пояснения).

## Минорные изменения

| Заголовок                                                                   | Задача     | PR             |
| :-------------------------------------------------------------------------- | :--------- | :------------- |
| [auth: Прыгают размеры блока после загрузки иконок](#ISL-1879)              | [ISL-1879] | [#907]         |
| [button2: Добавить размер l](#ISL-2110)                                     | [ISL-2110] | [#902]         |
| [checkbox: Добавить значение по умолчанию border-spacing: 0px;](#ISL-1475)  | [ISL-1475] | [#904]         |
| [dropdown2: Интегрировать button2](#ISL-2160)                               | [ISL-2160] | [#821]         |
| [tabs-menu: Сделать тему для новой touch шапки](#ISL-2265)                  | [ISL-2265] | [#893]         |
| [Адаптировать BH-шаблоны к использованию с опцией escapeContent](#ISL-2270) | [ISL-2270] | [#900], [#917] |
| [Избавиться от PNG-фолбеков на уровнях desktop и touch-pad](#ISL-1621)      | [ISL-1621] | [#815]         |

## Исправлено и улучшено

| Заголовок                                                 | Задача     | PR             |
| :-------------------------------------------------------- | :--------- | :------------- |
| b-page: Не добавлять `<title>`, если поле title отсутствует |[ISL-2249]| [#894]         |
| button2_type_link: Не сбрасывается модификатор pressed    | [ISL-1484] | [#722]         |
| i-flashcookie: Починить работу на доменах .com.tr         | [ISL-2272] | [#919], [#914] |
| i-services: поменять url сервиса legal                    | [ISL-1731] | [#898]         |
| pointerfocus: Поправить выделение при возврате на вкладку | [ISL-2168] | [#838]         |
| share-dropdown: Реализовать возможность добавления миксов | [ISL-2058] | [#929]         |

## Дополнительно

| Заголовок                                                              | Задача     | PR                     |
| :--------------------------------------------------------------------- | :--------- | :--------------------- |
| [b-form: Подготовить к удалению](#ISL-2224)                            | [ISL-2224] | [#887]                 |
| button2: Добавить новый JS-параметр                                    | [ISL-2284] | [#901]                 |
| control: Добавить документацию                                         | [ISL-2287] | [#905]                 |
| [i-common__clipboard: Объявить устаревшим](#ISL-1548)                  | [ISL-1548] | [#925]                 |
| i-request-animation-frame: Добавить документацию                       | [ISL-2236] | [#903]                 |
| [i-services: Объявить устаревшей логику удаления элементов](#ISL-2199) | [ISL-2199] | [#924]                 |
| select: Задокументировать JS-параметры блока передаваемые в popup      | [ISL-1795] | [#890]                 |
| slider: Обновить документацию после изменения логики вывода значений   | [ISL-2156] | [#895]                 |
| social-broker: Обновить документацию после рефакторинга                | [ISL-2241] | [#871]                 |

## Пояснения


<a name="ISL-1879"></a>
### [auth: Прыгают размеры блока после загрузки иконок][ISL-1879]

Была устранена проблема, из-за которой менялась высота элемента `social` блока `auth`, после загрузки иконок.

<a name="ISL-2224"></a>
### [b-form: Подготовить к удалению][ISL-2224]

Блок `b-form` объявлен устаревшим и будет удален в следующем мажорном релизе.

Если по какой-то причине вы используете этот блок, пожалуйста, скопируйте его на свой уровень.

<a name="ISL-2110"></a>
### [button2: Добавить размер l][ISL-2110]

В блоке `button2` для модификатора `size` добавлено новое значение `l`.

<a name="ISL-1475"></a>
### [checkbox: Добавить значение по умолчанию border-spacing: 0px;][ISL-1475]

В блоке `checkbox` добавлен сброс CSS-свойства `border-spacing` в 0, т.к. в некоторых браузерах (Chrome, YB), элементы с `display: inline-table` наследуют свойство `border-spacing`. Это могло вызывать проблемы при использовании блока `checkbox` внутри таблицы.

<a name="ISL-2160"></a>
### [dropdown2: Интегрировать button2][ISL-2160]

В `dropdown2` добавлена возможность использовать блок `button2` в качестве блока-переключателя.

Кроме этого, произведен рефакторинг блока, в ходе которого:
 - Модификатор `theme` из `dropdown2` стал устанавливаться и в дочерний `link`, в случае использования его в качестве
  блока-переключателя. Ранее этот модификатор устанавливался только в случае использования `button`;
 - Механизм передачи темы из `dropdown2` в дочерний
 `popup2` объявлен устаревшим. В версии islands 5.x дочерний блок `popup2` по умолчанию будет иметь тему `normal`.
 Сделано это потому, что сейчас значение модификатора `theme` из `dropdown2` пробрасывается и в блок-переключатель
 и в `popup2`.  Что не позволяет устанавливать тему для блока-переключателя, отличную от темы `popup2`
 с помощью модификаторов `dropdown2`.

<a name="ISL-1548"></a>
### [i-common__clipboard: Объявить устаревшим][ISL-1548]

Элемент `i-common__clipboard` объявлен устаревшим и будет удален в следующей мажорной версии.

<a name="ISL-2199"></a>
### [i-services: Объявить устаревшей логику удаления элементов][ISL-2199]

В блоке `i-services` логика удаления элементов, отличных от `url` и `name`, объявлена устаревшей.
Она была избыточна и не приносила практической пользы, а код не работал с bemxjst 4.0
Функциональность будет удалена в следующей мажорной версии библиотеки islands 5.0.

<a name="ISL-2265"></a>
### [tabs-menu: Сделать тему для новой touch шапки][ISL-2265]

Сделали новую тему `search-head` для блока  `tabs-menu`, чтобы использовать его в поисковой шапке на touch-телефонах.
Примеры использования смотрите  в блоке `search2` на уровне `touch-phone`.

<img src="https://jing.yandex-team.ru/files/persidskiy/touchsearch_2015-12-10_14-40-51.png" width="380" />

Кроме этого, сделали новый блок `native-scroll`, который обеспечивает прокрутку контента по горизонтали с помощью
нативного браузерного скролла. При этом он убирает нативную горизонтальную полосу прокрутки. Блок позволил
сделать плавную прокрутку поискового меню для touch-устройств. Так же он может пригодиться вам для создания
собственных компонентов. Сейчас  блок реализован только в CSS.  В дальнейшем его планируется развивать,
чтобы можно было им управлять с помощью JavaScript.

<a name="ISL-2270"></a>
### [Адаптировать BH-шаблоны к использованию с опцией escapeContent][ISL-2270]

Чтобы повысить безопасность, BH-шаблоны были адаптированы для работы в двух режимах: с опцией `escapeContent` и без нее. Мы рекомендуем по возможности включать эту опцию, но проверяйте, если для вас это важно, насколько сильно она влияет на скорость шаблонизации.

Поле `html` появилось в BH [v3.2.0](https://github.com/bem/bh/compare/bf286b8653546e7b297527e6ef394b46c5db46a8...v3.2.0#diff-5db77af6d9433eb778738e03a37dc102R908) и вплоть до v3.3.2 была ошибка при выводе без тега (`{tag: false, html: 'anything'}`) — обновитесь до [v3.3.3](https://github.com/bem/bh/compare/v3.3.2...v3.3.3) или сразу до v4.x.

<a name="ISL-1621"></a>
### [Избавиться от PNG-фолбеков на уровнях desktop и touch-pad][ISL-1621]

В рамках задачи были перенесены картинки формата png с уровня common, на уровень desktop и touch соответственно.
Картинки большинства блоков перенесены в папку %block__elem_mod%.assets.
Изменен скрипт формирования стилей и примеров country-flag.
Добавлены зависимости от i-ua__svg.



[ISL-1879]: https://st.yandex-team.ru/ISL-1879
[#907]: https://github.yandex-team.ru/lego/islands/pull/907
[ISL-2224]: https://st.yandex-team.ru/ISL-2224
[#887]: https://github.yandex-team.ru/lego/islands/pull/887
[ISL-2249]: https://st.yandex-team.ru/ISL-2249
[#894]: https://github.yandex-team.ru/lego/islands/pull/894
[ISL-2284]: https://st.yandex-team.ru/ISL-2284
[#901]: https://github.yandex-team.ru/lego/islands/pull/901
[ISL-2110]: https://st.yandex-team.ru/ISL-2110
[#902]: https://github.yandex-team.ru/lego/islands/pull/902
[ISL-1484]: https://st.yandex-team.ru/ISL-1484
[#722]: https://github.yandex-team.ru/lego/islands/pull/722
[ISL-1475]: https://st.yandex-team.ru/ISL-1475
[#904]: https://github.yandex-team.ru/lego/islands/pull/904
[ISL-2287]: https://st.yandex-team.ru/ISL-2287
[#905]: https://github.yandex-team.ru/lego/islands/pull/905
[ISL-2160]: https://st.yandex-team.ru/ISL-2160
[#821]: https://github.yandex-team.ru/lego/islands/pull/821
[ISL-1548]: https://st.yandex-team.ru/ISL-1548
[#925]: https://github.yandex-team.ru/lego/islands/pull/925
[#911]: https://github.yandex-team.ru/lego/islands/pull/911
[#906]: https://github.yandex-team.ru/lego/islands/pull/906
[ISL-2272]: https://st.yandex-team.ru/ISL-2272
[#919]: https://github.yandex-team.ru/lego/islands/pull/919
[#914]: https://github.yandex-team.ru/lego/islands/pull/914
[ISL-2236]: https://st.yandex-team.ru/ISL-2236
[#903]: https://github.yandex-team.ru/lego/islands/pull/903
[ISL-2199]: https://st.yandex-team.ru/ISL-2199
[#924]: https://github.yandex-team.ru/lego/islands/pull/924
[ISL-1731]: https://st.yandex-team.ru/ISL-1731
[#898]: https://github.yandex-team.ru/lego/islands/pull/898
[ISL-2168]: https://st.yandex-team.ru/ISL-2168
[#838]: https://github.yandex-team.ru/lego/islands/pull/838
[ISL-1795]: https://st.yandex-team.ru/ISL-1795
[#890]: https://github.yandex-team.ru/lego/islands/pull/890
[ISL-2058]: https://st.yandex-team.ru/ISL-2058
[#929]: https://github.yandex-team.ru/lego/islands/pull/929
[ISL-2156]: https://st.yandex-team.ru/ISL-2156
[#895]: https://github.yandex-team.ru/lego/islands/pull/895
[ISL-2241]: https://st.yandex-team.ru/ISL-2241
[#871]: https://github.yandex-team.ru/lego/islands/pull/871
[ISL-2265]: https://st.yandex-team.ru/ISL-2265
[#893]: https://github.yandex-team.ru/lego/islands/pull/893
[ISL-2270]: https://st.yandex-team.ru/ISL-2270
[#900]: https://github.yandex-team.ru/lego/islands/pull/900
[#917]: https://github.yandex-team.ru/lego/islands/pull/917
[ISL-1621]: https://st.yandex-team.ru/ISL-1621
[#815]: https://github.yandex-team.ru/lego/islands/pull/815
