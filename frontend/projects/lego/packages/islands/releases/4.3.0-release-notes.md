# islands 4.3.0

Изменения, вошедшие в релиз islands 4.3.0, разделены на группы:

* [Минорные изменения](#Минорные-изменения) — задачи, в рамках которых произошло расширение API блоков;
* [Исправлено и улучшено](#Исправлено-и-улучшено) — различные исправления, не затрагивающие API блоков;
* [Дополнительно](#Дополнительно) — задачи, не касающиеся кода блоков (документация, инфраструктура и т.д.)

Все минорные изменения подробно описаны в конце соответствующих разделов.

## Минорные изменения

| Заголовок                                                        | Задача     | PR     |
| :--------------------------------------------------------------- | :--------- | :----- |
| [i-request-animation-frame: Перенести в polyfill](#ISL-2091)     | [ISL-2091] | [#848] |
| [popup: По умолчанию избавиться от iframe в парандже](#ISL-2237) | [ISL-2237] | [#853] |
| [search2: Реализовать актуальный дизайн для touch-phone](#ISL-2264)                    | [ISL-2264] | [#875] |

## Исправлено и улучшено

| Заголовок                                                                             | Задача     | PR     |
| :------------------------------------------------------------------------------------ | :--------- | :----- |
| [popup: Изменить порядок отписки от событий клика на паранджу под попапом](#ISL-2134) | [ISL-2134] | [#856] |
| [i-bem__dom: починить кэширование размазанных по дереву блоков](#ISL-2274)            | [ISL-2274] | [#882] |
| Портировать изменения в reapply из bem-core                                           | [ISL-2163] | [#861] |

## Дополнительно

| Заголовок                                                   | Задача     | PR     |
| :---------------------------------------------------------- | :--------- | :----- |
| [b-link: Подготовить к удалению](#ISL-2072)                 | [ISL-2072] | [#806] |
| [header, slide, paranja: Подготовить к удалению](#ISL-2092) | [ISL-2092] | [#807] |
| popup2: Увеличить покрытие unit-тестами до 100%             | [ISL-2142] | [#828] |
| i-bem: Обновить документацию на метод findElem              | [ISL-2256] | [#885] |

## Пояснения


<a name="ISL-2072"></a>
### [ISL-2072 — b-link: Подготовить к удалению](https://st.yandex-team.ru/ISL-2072)

Блок `b-link` объявлен устаревшим. Вместо `b-link` используйте блок [`link`](https://lego.yandex-team.ru/libs/islands/v4.x/desktop/link/).

В блоке `i-counter` логика про подсчет кликов по `b-link_pseudo_yes` объявлена устаревшей.

<a name="ISL-2091"></a>
### [ISL-2091 — i-request-animation-frame: Перенести в polyfill](https://st.yandex-team.ru/ISL-2091)

Код из блока `i-request-animation-frame` перенесен в `polyfill__request-animation-frame`, а сам блок объявлен устаревшим и
 будет удален в islands@5x.

Если вы использовали `i-request-animation-frame`, то вместо него вам необходимо подключить
`polyfill__request-animation-frame`.

<a name="ISL-2092"></a>
### [ISL-2092 — header, slide, paranja: Подготовить к удалению](https://st.yandex-team.ru/ISL-2092)

Блоки `header`, `slide` и `paranja` объявлены устаревшими и будут удалены в одном из ближайших мажорных релизов,
после завершения работ над блоком [`header2`](https://lego.yandex-team.ru/libs/islands/v4.x/desktop/header2/).

* В новых дизайнерских гайдах функциональность блока `slide` не используется.
* Вместо `header` рекомендуется использовать блок [`header2`](https://lego.yandex-team.ru/libs/islands/v4.x/desktop/header2/), соответствующий всем требованиям нового гайда.
* Если на проекте необходима паранджа, в качестве альтернативы блоку `paranja`, рекомендуется реализовать ее как элемент вашего попапа (по аналогии с блоком `modal` на основе `popup2`) или приложения. Блок удаляется потому, что текущее решение мало востребовано на портале, а сделать лаконичное и универсальное — проблематично.

<a name="ISL-2134"></a>
### [ISL-2134 — popup: Изменить порядок отписки от событий клика на паранджу под попапом](https://st.yandex-team.ru/ISL-2134)

При скрытии попапа возникала ошибка, т.к. отписка от событий (посредством метода `unbindFrom`) на парандже выполнялась уже после ее удаления из блока popup.

Теперь отписка происходит до удаления паранджи.

<a name="ISL-2237"></a>
### [ISL-2237 — domik: По умолчанию избавиться от iframe в парандже](https://st.yandex-team.ru/ISL-2237)

Исправлен баг в деструкторе блока `popup`, который приводил к утечке памяти (не очищалась ссылка на элемент `under`).
Возникал из-за неправильного порядка вызова методов в деструкторе при удалении элемента `under`.

Элемент `under` (паранджа) блока `popup` больше не использует по умолчанию `iframe` в качестве контейнера.
Ранее, этот способ применялся для некоторых старых версий браузеров, чтобы перекрыть flash.
Теперь `iframe` заменен на `div`.

**NB** Для сборок, использующих уровень touch-pad, и раньше использовался `div`.

Чтобы вернуть предыдущее поведение, переопределите на своем уровне метод `isDivEnough` блока `popup` в файле элемента `under`:
```js
BEM.DOM.decl('popup', {
    isDivEnough: function () {
        return false;
    }
});
```

<a name="ISL-2264"></a>
### [ISL-2264 — search2: Реализовать актуальный дизайн для touch-phone](https://st.yandex-team.ru/ISL-2264)

<img width="373" src="https://jing.yandex-team.ru/files/persidskiy/touchsearch_2015-12-08_16-54-49.png" />

Мы сделали новую поисковую стрелку для всех поисковых сервисов на touch-phone. Она собирается из
`input_theme_touchsearch` и `button2_theme_touchsearch` или `button_theme_touchsearch`, которые помещаются в `search2`.
Подробнее как это сделать, смотрите в примере `search2` для уровня `touch-phone`.

<a name="ISL-2274"></a>
### [ISL-2274 — i-bem__dom: починить кэширование размазанных по дереву блоков](https://st.yandex-team.ru/ISL-2274)

Теперь в методах `elem()`/`findElem()` результат сохраняется в кэше, если контекст не передан или передан `block.domElem`.

Это позволило:
- унифицировать логику кэширования результатов поиска c `bem-core`;
- кэшировать элементы у разнесенных по двум и более DOM-узлам блоков;
- немного сократить код.



[ISL-2072]: https://st.yandex-team.ru/ISL-2072
[#806]: https://github.yandex-team.ru/lego/islands/pull/806
[ISL-2091]: https://st.yandex-team.ru/ISL-2091
[#848]: https://github.yandex-team.ru/lego/islands/pull/848
[ISL-2092]: https://st.yandex-team.ru/ISL-2092
[#807]: https://github.yandex-team.ru/lego/islands/pull/807
[ISL-2134]: https://st.yandex-team.ru/ISL-2134
[#856]: https://github.yandex-team.ru/lego/islands/pull/856
[ISL-2237]: https://st.yandex-team.ru/ISL-2237
[#853]: https://github.yandex-team.ru/lego/islands/pull/853
[ISL-2264]: https://st.yandex-team.ru/ISL-2264
[#875]: https://github.yandex-team.ru/lego/islands/pull/875
[ISL-2274]: https://st.yandex-team.ru/ISL-2274
[#882]: https://github.yandex-team.ru/lego/islands/pull/882
[ISL-2163]: https://st.yandex-team.ru/ISL-2163
[#861]: https://github.yandex-team.ru/lego/islands/pull/861
[ISL-2142]: https://st.yandex-team.ru/ISL-2142
[#828]: https://github.yandex-team.ru/lego/islands/pull/828
[ISL-2256]: https://st.yandex-team.ru/ISL-2256
[#885]: https://github.yandex-team.ru/lego/islands/pull/885
