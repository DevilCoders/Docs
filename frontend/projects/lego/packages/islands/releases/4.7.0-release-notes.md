# islands 4.7.0

<!-- ЧЕЛОВЕЧЕСКОЕ ВСТУПЛЕНИЕ -->

Изменения, вошедшие в релиз islands 4.7.0, разделены на группы:

* [минорные изменения](#Минорные-изменения) — задачи, в рамках которых произошло расширение API блоков;
* [исправлено и улучшено](#Исправлено-и-улучшено) — различные исправления, не затрагивающие API блоков;
* [дополнительно](#Дополнительно) — задачи, не касающиеся кода блоков (документация, инфраструктура и т.д.).

Все важные изменения подробно описаны [ниже](#Пояснения).

## Минорные изменения

| Заголовок                                                                    | Задача     | PR      |
| :--------------------------------------------------------------------------- | :--------- | :------ |
| [button2: События press/release и улучшение работы с клавиатурой](#ISL-2426) | [ISL-2426] | [#1074] |

## Исправлено и улучшено

| Заголовок                                                           | Задача     | PR      |
| :------------------------------------------------------------------ | :--------- | :------ |
| input: Не генерировать 'change' если значение не изменилось         | [ISL-1708] | [#1035] |
| [pointerevents__click: Добавить защиту от сквозного клика](#ISL-2246) | [ISL-2246] | [#1044] |
| b-slider: Ссылки не реагируют на нажатия         | [ISL-2459] | [#1087] |
| pointerevents__click: Не генерировать событие, если был pointermove | [ISL-2463] | [#1089] |
| auth: Генерировать случайный id для чекбокса в __haunter         | [ISL-2410] | [#1094] |



## Дополнительно

| Заголовок                                    | Задача     | PR      |
| :------------------------------------------- | :--------- | :------ |
| i-pressed-controller: Подготовить к удалению | [ISL-2095] | [#1030] |

## Пояснения


<a name="ISL-2426"></a>
### [button2: События press/release и улучшение работы с клавиатурой][ISL-2426]

В блоке `button2` добавлено два новых БЭМ-события и улучшена работа с клавиатурой.

#### События

Непосредственно перед получением модификатора `_pressed_yes`, генерируется БЭМ-событие `press`.
Непосредственно перед удалением модификатора `_pressed`, генерируется БЭМ-событие `release`.

Никаких данных вместе с событиями не передается.

#### Работа с клавиатурой

В блоке появились JS-параметры `prvntKeys` и `clickKeys`.

В параметре `prvntKeys` передается массив идентификаторов клавиш,
для которых нужно делать `preventDefault` по событию `keydown`.

В параметре `clickKeys` передается массив идентификаторов клавиш,
для которых нужно генерировать БЭМ-событие `click` по событию `keyup`.
Это необходимо в тех случаях, когда браузер не генерирует DOM-событие `click` самостоятельно,
как это происходит для `<a>` по `ENTER` и для `<button>` по `ENTER/SPACE`.

Параметры применяются совместно с параметром `pressKeys`, в котором передается
массив всех клавиш, на которые блок должен реагировать.

Используя параметры `pressKeys/prvntKeys/clickKeys` вы можете тонко настраивать
реакцию кнопки на нажатие тех или иных клавиш.

Например, можно реализовать:
```js
// Кнопку на <span>, которая нажимается пробелом без прокрутки экрана.
{
    block: 'button2',
    tag: 'span',
    text: 'text',
    js: {
        pressKeys: ['SPACE', 'ENTER'],
        prvntKeys: ['SPACE'],
        clickKeys: ['SPACE', 'ENTER']
    }
},
// Кнопку _type_link, у которой не осуществляется переход по ссылке по нажатию ENTER.
{
    block: 'button2',
    mods: {theme: 'normal', size: 's', type: 'link'},
    url: 'https://yandex.ru',
    text: 'text',
    js: {
        prvntKeys: ['ENTER']
    }
},
// Обычную кнопку, которая реагирует на нажатие клавиш `UP/DOWN` без прокрутки экрана.
{
    block: 'button2',
    mods: {theme: 'normal', size: 's'},
    text: 'text',
    js: {
        pressKeys: ['SPACE', 'ENTER', 'UP', 'DOWN'],
        prvntKeys: ['UP', 'DOWN'],
        clickKeys: ['UP', 'DOWN']
    }
}
```

<a name="ISL-2246"></a>
### [pointerevents__click: Добавить защиту от сквозного клика][ISL-2246]

В элемент `pointerevents__click`, реализующий событие `pointerclick`,
добавлена защита от браузерного клика, который происходит с задержкой
и попадает на произвольный DOM-элемент, успевший появиться по заданным координатам.

Проблема проявлялась при использовании саджеста, селекта и других подобных блоков.

Пример с навигационной панелью: https://yadi.sk/i/BO5A8To1ji57L <br>
Синтетический клик происходит после закрытия панели и попадает на логотип.



[ISL-2179]: https://st.yandex-team.ru/ISL-2179
[#1055]: https://github.yandex-team.ru/lego/islands/pull/1055
[ISL-2426]: https://st.yandex-team.ru/ISL-2426
[#1074]: https://github.yandex-team.ru/lego/islands/pull/1074
[ISL-2095]: https://st.yandex-team.ru/ISL-2095
[#1030]: https://github.yandex-team.ru/lego/islands/pull/1030
[ISL-1708]: https://st.yandex-team.ru/ISL-1708
[#1035]: https://github.yandex-team.ru/lego/islands/pull/1035
[ISL-2246]: https://st.yandex-team.ru/ISL-2246
[#1044]: https://github.yandex-team.ru/lego/islands/pull/1044
[ISL-2459]: https://st.yandex-team.ru/ISL-2459
[#1087]: https://github.yandex-team.ru/lego/islands/pull/1087
[ISL-2463]: https://st.yandex-team.ru/ISL-2463
[#1089]: https://github.yandex-team.ru/lego/islands/pull/1089
[ISL-2410]: https://st.yandex-team.ru/ISL-2463
[#1094]: https://github.yandex-team.ru/lego/islands/pull/1094
