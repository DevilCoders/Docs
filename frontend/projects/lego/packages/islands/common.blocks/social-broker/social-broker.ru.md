# social-broker

Блок `social-broker` предоставляет интерфейс для взаимодействия с
[Брокером социальных сетей](http://wiki.yandex-team.ru/social/broker). Брокер обеспечивает
связь с внешними социальными сервисами (Facebook, Twitter, Одноклассники и т. д.)
и выполняет социальную авторизацию, для сервисов Яндекса.

Для работы блока нужна [HTML-страница закрывающая окно](#elems-closer), в котором выполнялась социальная авторизация.

**NB** Блок не имеет DOM-представления и для работы с ним необходимо создать экземпляр блока с помощью `BEM.create('social-broker')`.

## Обзор блока

* [Запуск взаимодействия с Брокером](#start-block)
* [Закрывающая страница](#elems-closer)

<a name="fields-short"></a>
### Параметры блока

| Параметр | Тип  | Описание  |
| ---- | ---- | --------- |
| [provider](#params-def) | String | **Обязательный**. Двухбуквенный код провайдера [поддерживаемых социальных сетей](https://wiki.yandex-team.ru/social/providers) (например: `fk`, `ok`, `tw`). |
| [consumer](#params-def) | String |  Идентификатор сервиса Яндекса, вызывающего авторизацию. <br> Значение по умолчанию: ключ `id` из блока [i-global](../i-global/i-global.ru.md). |
| [retpath](#params-def) | String |  Абсолютный адрес, для переадресации пользователя после удачной авторизации (см. раздел [«Закрывающая страница»](#elems-closer)). <br> Значение по умолчанию: ключ `social-retpath` из блока [i-global](../i-global/i-global.ru.md). |
| [display](#params-def) | String | Тип отображения диалога авторизации. <br>Значение по умолчанию:`popup`. В этом случае откроется всплывающее окно социальной сети, для авторизации. Во всех остальных случаях произойдет перенаправление на Брокер. |
| [startUrl](#params-def) | String | Адрес Брокера. <br> Значение по умолчанию: ключ `social-startUrl` из блока [i-global](../i-global/i-global.ru.md). |
| [popupName](#params-def) | String | Второй аргумент функции `window.open()`. |


## Подробнее

<a name="start-block"></a>
### Запуск взаимодействия с Брокером

Чтобы запустить взаимодействие блока c Брокером, для начала процесса авторизации, используется метод `start()`. В нем можно определить функции для обработки успешной авторизации и возникновения ошибок, а также параметры передаваемые Брокеру.

Способы запуска:

* `start()` — метод экземпляра блока `social-broker`. **Рекомендованный способ**.

Используйте:

```javascript
var broker = BEM.create('social-broker');
broker.start();
```

Вместо:

```javascript
BEM.blocks['social-broker'].start();
```
После окончания работы с Брокером не забудьте вызвать `broker.destruct()`.

Чтобы использовать API блока `social-broker` из своего блока, убедитесь, что он добавлен в зависимость вашего блока:

```javascript
 shouldsDeps: [
     { block: 'social-broker' }
 ]
```

<a name="params-def"></a>
### Параметры блока

[Параметры](#params-short) блока `social-broker` используются Брокером для формирования адреса страницы (GET-запрос), в которой запускается процесс социальной авторизации на Яндексе.

Значение ключа `social-host` из [i-global](../i-global/i-global.ru.md) — хост Брокера.

Прочие параметры описаны в разделе [конфигурация Брокера](http://wiki.yandex-team.ru/social/broker#konfiguracijabrokera).

Пример использования блока `social-broker` в JavaScript:

```javascript
...
_onClick: function(e, provider) {
    BEM.blocks['social-broker'].start(function() {
        this.elem('good').show(); // функция обработки успешной авторизации, может быть – null.
    }, null, {
        // параметры, передаваемые Брокеру
        display: 'page', // тип отображения диалога авторизации (`page` – верстка для обычных окон).
        retpath: 'http://yandex.ru',
        provider: provider
    });
}
...
```

<a name="elems-closer"></a>
#### Закрывающая страница

Страница представляет собой специальную HTML-страницу с JavaScript-кодом, который закрывает окно для социальной авторизации и возвращает результат авторизации. Размещена в директории элемента `closer`.

Эта страница используется для перенаправления браузера в случае успешного прохождения процесса социальной авторизации. Должна располагаться в том же домене, что и скрипт, вызвавший социальную авторизацию.

