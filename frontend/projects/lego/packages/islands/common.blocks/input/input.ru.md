## Описание

Блок `input` («инпут») служит для создания различных типов текстовых полей с шириной 100%:

* поле ввода (значение по умолчанию);
* поле с паролем;
* текстовая область;
* поисковая форма.

### Объявление блока на странице

BEMJSON блока:

```javascript
{
    block: 'input',
    mods: {size: 's'},        // Модификатор размера – обязательный
   content: {elem: 'control'} // нативный инпут. Обязательный элемент
}
```

В результате BEMHTML-преобразований будет создано произвольное простое поле ввода с шириной 100%, внутри которого находится нативный инпут.

```bemjson
{
    block: 'input',
    mods: {size: 's'},
    content: {elem: 'control'}
}
```

### Содержимое блока

 `{Object|Array} content` – содержимое блока. Служит для добавления различных элементов блоку, расширяющих его функциональность.

Элемент `control` — вспомогательный скрытый элемент. На уровне шаблонизатора преобразуется в нативный контрол `<input атрибуты>`. Обязательный. Нужно явно указывать в BEMJSON блока `input`. По умолчанию подключает элемент блока `clear` – кнопка-крестик для очистки содержимого блока.

### Атрибуты блока

Блоку можно установить атрибуты нативного управляющего элемента `<input атрибуты>` или `<textarea атрибуты>`, в зависимости от типа блока (так как один из контролов всегда будет находиться в HTML блока для реализации его функциональности).

Ниже перечислены допустимые атрибуты, которые задаются в одноименных полях BEMJSON-декларации блока:

* `{String} name` — имя блока, для идентификации контрола обработчиком формы. Значение по умолчанию: `''`.
* `{String} value` — значение, отправляемое на сервер. Значение по умолчанию: `''`.
* `{String} id` — уникальный идентификатор блока. По умолчанию генерируется случайным образом, если явно не задан в BEMJSON.
* `{String} placeholder` — подсказка в поле ввода.

Следующие атрибуты блока `input`:
`name`, `value`, `id`, `tabindex`, `spellcheck`, `accesskey`, `placeholder` – можно задать в зарезервированном поле атрибутов `attrs` элемента `control`.
Значения атрибутов, которые заданны в поле `attrs`, перекроют значения аналогичных атрибутов, из одноименных полей BEMJSON блока.

```bemjson
{
    block: 'input',
    mods: {size: 's'},
    content: {
        elem: 'control',
        attrs: {accesskey: 'yes', id: 'newid', tabindex: '1', name: 'test'}
    }
}
```
Атрибуты **поля ввода** и **поля с паролем** — совпадают.

>**NB** Для браузеров без нативной поддержки атрибута [`placeholder`](http://caniuse.com/#feat=input-placeholder) автоматически выполнится fallback на элемент `hint` с модификатором `fallback_yes`. Если вы поддерживаете такие браузеры, добавьте в shouldDeps-зависимости блока элемент `hint`.

#### Атрибуты текстовой области
`name`, `value`, `id`, `rows`, `cols`, `readonly`, `wrap`, `maxlength`, `spellcheck`, `accesskey`, `tabindex` — не обязательные. Задаются аналогично атрибутам для **простого поля** .

```bemjson
{
    block: 'input',
    mods: {type: 'textarea', size: 's'},
    name: 'test',
    content: {
        elem: 'control',
        attrs: {rows: '3', readonly: 'yes', maxlength: '100'}
    }
}
```

### Варианты использования инпута

Чтобы расширить функциональность блока, достаточно поместить в его поле `content` нужный элемент из следующего списка ( перечисленные элементы необязательные ):

* `label` –  метка для поля ввода. Преобразуется в HTML-тег `<label>`. Связь метки с `<input>` устанавливается через идентификатор `id`, который генерируется по умолчанию случайным образом. При щелчке кнопкой мыши на метку в поле ввода устанавливается фокус.

```bemjson
{
    block: 'input',
    mods: {size: 's'},
    content: [
        {elem: 'label', content: 'Я метка'},
        {elem: 'control'}
    ]
}
```

>**NB** Чтобы метка корректно отображалась, располагайте элемент `control` **после** элемента `link`.

* `message` – сообщение об ошибке. Показывает сообщение об ошибке или другую дополнительную информацию. Располагается под полем ввода. Текст сообщения задается в поле `content` элемента.

  **Модификаторы элемента**:

   * `type` со значением `error` — задает тип сообщения (об ошибке);
   * `visibility` со значением `visible` – его видимость.

  _**Примечание**: В блоке реализован только тип сообщения для ошибок. Другой тип можно доопределить у себя на проекте._

```bemjson
{
    block: 'input',
    mods: {size: 's'},
    content: [
        {elem: 'label', content: 'Я метка'},
        {elem: 'control'}, // нативный input
        {
            elem: 'message',
            elemMods: {type: 'error', visibility: 'visible'},
            content: 'Ошибка'
        }
    ]
}
```

* `samples` – примеры для поля ввода. Является оберткой, объединяющей группу примеров. В поле  `content` элемента помещается массив элементов `sample`.
   * `sample` – конкретный пример к полю ввода. Представлен псевдоссылкой (элемент миксуется с блоком [link](../link/link.ru.md) с заданным модификатором `pseudo` в значение `yes`), которая предполагает действие без перехода на другую страницу. Визуально выделяется пунктирным нижним подчеркиванием. При нажатии на ссылку с примером его значение подставляется в поле ввода.

```javascript
{
    block: 'input',
    mods: {size: 's'},
    content: [
        {elem: 'control'},
        {
            elem: 'samples',
            content: [ // массив примеров для поля ввода
                {
                    block: 'link',
                    mods: {theme: 'pseudo', pseudo: 'yes'},
                    mix: [{block: 'input', elem: 'sample'}],
                    content: 'Пример 1'
                },
                {
                    block: 'link',
                    mods: {theme: 'pseudo', pseudo: 'yes'},
                    mix: [{block: 'input', elem: 'sample'}],
                    content: 'Пример 2'
                }
            ]
        }
    ]
}
```

* `clear` – кнопка-крестик очистки содержимого блока. По умолчанию добавляется в BEMHTML-шаблоне элемента `control`.
«Крестик» – векторное изображение, в формате SVG. Кнопка очистки не отобразится, если применить [модификатор бока clear со значением no](#m_clear).

```javascript
{
    block: 'input',
    mods: {size: 's', clear: 'no'},
    content: ['...']
}
```

#### Элемент `filter`

Шаблоны для обработки поля `filter`. Поле содержит BEMJSON блока, который реализует кнопку расширенных настроек в поисковой стрелке. Шаблоны применяются только для блока `input` c модификатором `theme` в значении `websearch`.

Поддерживается реализация кнопки, собранная с помощью `button2_theme_clear` и `icon_type_filter`.

```javascript
{
    block: 'input',
    mods: {size: 'ws-head', theme: 'websearch'},
    // ...
    filter: {
        block: 'button2',
        mods: {type: 'check', size: 'head', theme: 'clear'},
        attrs: {tabindex: -1},
        icon: {mods: {type: 'filter'}}
    }
}
```

Чтобы использовать такую кнопку, нужно дополнительно подключить к сборке следующие зависимости:

```javascript
[
    {block: 'input', elem: 'filter'},
    {block: 'button2', elem: 'icon'},
    {block: 'icon', mods: {type: 'filter'}}
]
```

### Модификаторы блока

### Модификатор `type`

Определяет тип поля ввода.

Допустимые значения | Описание
------------------- | -----------------------------------------------------------------
 —                  | По умолчанию, без указания типа, создается обычное текстовое поле с шириной 100%. В HTML: ` <input type="text"/>`.
`password`          | Поле с паролем. В HTML: `<input type="password" атрибуты>`.
`textarea`          | Текстовая область. В HTML: `<textarea атрибуты>`. По умолчанию размер текстовой области: `cols: 10` (ширина поля в символах), `rows: 10` (высота поля в строках текста).

Обычное текстовое поле:

```bemjson
{
    block: 'input',
    mods: {size: 's'},
    content: {elem: 'control'},
}
```

Поле с паролем:

```bemjson
{
    block: 'input',
    mods: { size: 's' , type: 'password'},
    content: { elem: 'control' }
}
```

Текстовая область:

```bemjson
{
    block: 'input',
    mods: {type: 'textarea', size: 's'},
    value: 'Я текстовая область размера S',
    content: {elem: 'control'}
}
```

#### Модификатор `clear`

Отвечает за скрытие кнопки-крестика, очищающей содержимое текстового поля.

Допустимое значение: `no`.

```bemjson
{
    block: 'input',
    mods: {size: 's', clear: 'no'},
    placeholder: 'Нет тут крестика и не будет',
    content: [
        {elem: 'control'}
    ]
}
```
#### Модификатор `theme`

Отвечает за стилевое оформления блока. Используется совместно с модификатором `size`.

Допустимые значения |  Описание
--------------------| ------------------------------------------------------------
`normal`            | Типовое оформление в островном дизайне. Значение по умолчанию.
`websearch`         | Оформление поля ввода внутри желтой поисковой стрелки ([search2](../search2/search2.ru.md)). Используется только совместно с модификатором `size_ws-head`.

```js
{
    block: 'input',
    mods: {theme: 'websearch', size: 'ws-head'},
    value: 'Введите запрос',
    content: {elem: 'control'}
}
```

#### Модификатор `size`

Задает размеры блока. Используется совместно с модификатором `theme`.

Модификатор `size` — обязательный при объявлении блока, для всех типов полей.
Допустимые значения: `xs`, `s` , `m`, `ws-head`. По умолчанию не определен.

По высоте блок `input` совпадает с  блоком кнопки [button2](../button2/button2.ru.md) с соответствующим размером `size` .

**s**

```bemjson
{
    block: 'input',
    mods: {size: 's'},
    placeholder: 'Размер s',
    content: [
        {elem: 'control'}
    ]
}
```

#### Состояния блока

* **Автофокус**, модификатор `autofocus` со значением `yes` – установка  фокуса в блок `input` при вводе текста на странице.

```bemjson
{
    block: 'input',
    mods: {size: 's', autofocus: 'yes'},
    content: {elem: 'control'}
}
```

Установить автофокус  можно при загрузке страницы с помощью JS-параметра блока: `js: { autoFocus: 'yes' }`, вместо модификатора  автофокуса.

```bemjson
{
     block: 'input',
     js: {autoFocus: 'yes'},
     mods: {size: 's'},
     content: {elem: 'control'}
}
```

* **Не активен**, модификатор `disabled` со значением `yes` – блок и все его элементы недоступны
 для действий пользователя.

```bemjson
{
    block: 'input',
    mods: {disabled: 'yes', size: 'm'},
    value: 'Я неактивное поле',
    content: {elem: 'control'}
}
```

```bemjson
{
    block: 'input',
    mods: {type: 'textarea', disabled: 'yes', size: 'm'},
    value: 'Я неактивная текстовая область',
    content: {elem: 'control'}
}
```

* **Курсор наведён**, модификатор `hovered` со значением `yes` – курсор мыши находится над инпутом.

* **В фокусе**, модификатор `focused` со значением `yes` – поле ввода в фокусе .

```bemjson
{
    block: 'input',
    mods: {focused: 'yes', size: 'm'},
    value: ' Введите имя',
    content: {elem: 'control'}
}
```

Возможен переход в инпут нажатием  **Ctrl + ↑**.

#### Поле ввода с иконкой

Свойства блока `iconLeft` и `iconRight` позволяют добавить в инпут иконку. Значением свойства служит объект, от которого будет расширен блок `icon`. Локальное доопределение типов иконок требует обязательного указания в зависимостях и элемента `{block: 'input', elem: 'icon'}`. Свойство `iconLeft` (алиас `icon`) и `iconRight` задают  соответственно положение иконки в поле ввода слева и справа. Не исключается вариант одновременного использования и левой и правой иконки. Размер иконке транслируется из модификатора `size` для основного блока `input`.

```js
{
    block: 'input',
    mods: {
        size: 's'
    },
    iconLeft: {mods: {type: 'lock'}},
    content: {elem: 'control'}
}
```

### Модификатор `suggest`

Задает поле ввода с саджестом (поисковые подсказки в выпадающем окне). Содержимое саджеста обновляется по мере ввода поискового запроса. Подходящий запрос можно выбрать как мышкой, кликнув на него, так и передвигаясь при помощи клавиш клавиатуры «вверх/вниз».

Допустимое значение: `yes`.

#### `dataprovider` поставщик данных саджеста

`dataprovider` — предоставляет данные о подсказках для саджеста. Он получает данные с сервера (URL сервера указывается в JS-параметре `dataprovider`) c помощью AJAX и преобразует их к формату, который требуется для построения вариантов подсказки.

`dataprovider` реализован как элемент блока `input` и является наследником блока [i-request_type_ajax](../common.blocks/i-request/_type/i-request_type_ajax.js). Содержит метод `getDataprovider()`, нормализующий процесс получения данных для автокомплита. Каждый пункт автокомплита — это экземпляр блока [b-autocomplete-item](../b-autocomplete-item/b-autocomplete-item.ru.md).

Поставщик данных задается в JS-параметре `dataprovider` с помощью полей:

 * `{String} url` — адрес сервера данных для саджеста. Обязательное.
 * `{String} namе` — название блока-провайдера (поставщика данных). Значение по умолчанию:  `input__dataprovider`. Необязательное.

Поле ввода с саджестом и провайдером по умолчанию:

```bemjson
{
    block: 'input',
    mods: {suggest: 'yes', size: 's'},
    js: {
        dataprovider: {url: 'http://suggest.yandex.ru/suggest-ya.cgi?v=4&callback=?'}
    },
    content: {elem: 'control', attrs: { name: 'autocomplete'}}
}
```

Также `input` позволяет указать **произвольный блок-провайдер** в поле `name` JS-параметра `dataprovider`.

[Пример](https://lego.yandex-team.ru/libs/islands/v4.10.0/desktop/input/examples/#custom-provider) поля ввода с саджестом и произвольным блоком-провайдером.

Для произвольного блока-провайдера на уровне переопределения проекта необходимо:

 * Создать блок с названием из `name` (например, `mock-data`), в котором определить метод `get()`:

```javascript
BEM.decl('mock-data', {
    get: function(request, callback) {...}
});
```

Можно создать по [примеру](https://github.yandex-team.ru/search-interfaces/frontend/blob/master/projects/lego/packages/islands/common.blocks/input/input.examples/custom-provider.blocks/mock-data/mock-data.js).

Блок-провайдер должен предоставлять callback данные в виде массива:
```
['строка для подсказки', items[], metainfo{}]
```

 * Добавить блок в зависимости инпута `myproject/input/input.deps.js`:

```javascript
({
    mustDeps: {block: 'mock-data'}
});
```

#### Поле ввода с подвалом для саджеста

Внизу саджеста можно установить подвал. Подвал – это блок `b-autocomplete-item__type_foot`, который отображает произвольный текст и не реагирует на перемещения по саджесту.

Простой саджест с подвалом:

```bemjson
{
    block: 'input',
    mods: {suggest: 'yes', size: 'm'},
    js: {
        dataprovider: {url: '//suggest.yandex.ru/suggest-ya.cgi?v=4&callback=?'},
        popupMods: {size: 'm'},
        foot: [
            'foot',
            'подвал саджеста <a class="link" href="ya.ru">Мои находки</a>'
        ]
    },
    content: {elem: 'control', attrs: {name: 'autocomplete'}}
}
```

>**NB** Саджеста у произвольной строки ввода нет в v1 Островов. Планируется его реализация в v2. У произвольной строки ввода появится автокомплит — по сути, тот же саджест.

#### Модификатор `tap-ahead`

Отвечает за добавление полю ввода **дополнительной подсказки** при вводе поискового запроса в инпут. Она позволяет
по нажатию клавиши `Tab` дополнить вводимое слово предложенным вариантом (визуально отделяется от набираемого текста запроса серым цветом шрифта). По умолчанию подсказка появляется при вводе минимум трех символов. Это поведение можно изменить, переопределив параметр `showOverChars`.

Допустимое значение: `yes`.

По умолчанию при инициализации блока `input` с модификатором `tab-ahead`, выставленным в значение `yes`, будет добавлен элемент блока `ahead`.
Полный текст дополнительной подсказки состоит из невидимой и видимой части – элементов блока инпут:

* `ahead-filler` — невидимая часть, необходимая для точного позиционирования видимой части.
* `ahead-hint` — видимая часть подсказки (серого цвета).

В HTML элемент `ahead` трансформируется в тег `<div>`, служащий контейнером для показа дополнительной подсказки. Каждый из элементов `ahead-filler` и `ahead-hint` преобразуется в тег
`<span>`, содержащий свою часть текста подсказки.

Поле ввода с дополнительной подсказкой:

```bemjson
{
    block: 'input',
    mods: {size: 's', suggest: 'yes', 'tap-ahead': 'yes'},
    js: {
        dataprovider: {
            url: '//suggest.yandex.ru/suggest-ya.cgi?v=4&callback=?',
            name: 'mock-data' // данные-заглушка, поставляются для независимости примеров от реальной выдачи
        }
    },
    content: {elem: 'control', attrs: {name: 'autocomplete'}}
}
```

В связке с `tab-ahead` могут использоваться модификаторы:

* `noprevent-tab` — не отменять нажатие **Tab**, если нечего было дополнять. В этом случае нажатием клавиши **Tab** фокус будет установлен на следующий элемент страницы (т.е. будет снят запрет на переход по нажатию на клавишу **Tab** к следующему контролу).

```bemjson
{
    block: 'input',
    mods: {size: 's', suggest: 'yes', 'tap-ahead': 'yes', 'noprevent-tab': 'yes'},
    js: {
        dataprovider: {
            url: '//suggest.yandex.ru/suggest-ya.cgi?v=4&callback=?',
            name: 'mock-data'
        }
    },
    content: {elem: 'control', attrs: {name: 'autocomplete'}}
}
```

* `nosplit-words` — не разбивать подсказку по словам. Дополнять подсказки целиком, а не отдельными словами.

```bemjson
{
    block: 'input',
    mods: {size: 's', suggest: 'yes', 'tap-ahead': 'yes', 'nosplit-words': 'yes'},
    js: {
        dataprovider: {
            url: '//suggest.yandex.ru/suggest-ya.cgi?v=4&callback=?',
            name: 'mock-data'
        }
    },
    content: {elem: 'control', attrs: {name: 'autocomplete'}}
}
```

#### Модификатор `pin`

Задает форму поля ввода (скругление углов и спиливание сторон). Используется для группировки инпута с другими блоками. Используется только с модификатором `theme` в значении `normal`.

Значение по умолчанию (модификатор не установлен): инпут с прямыми уголками и видимыми боковыми границами.

Допустимыми значениями модификатора являются комбинации двух ключевых слов через «-», сочетание которых
определяет форму уголков и видимость левой и правой границ инпута («левая-правая»). Например, `clear-brick`.

Ключевое слово | Описание
-------------- | --------------------------------------------------------------
`clear`        | Нет боковой границы.
`brick`        | Прямоугольная граница. Делает поле ввода «похожим на кирпич».
`round`        | Граница со скругленными уголками.

```bemjson
{
    tag: 'table',
    content: [
        {
            tag: 'thead',
            content: ['left \\ right', 'brick', 'clear', 'round'].map(function(content) {
                return {tag: 'th', content: content};
            })
        },
        ['brick', 'clear', 'round'].map(function(left) {
            return {
                tag: 'tr',
                content: [
                    {
                        tag: 'td',
                        attrs: {style: 'text-align: center; font-weight: bold;'},
                        content: left
                    },
                    ['brick', 'clear', 'round'].map(function(right) {
                        var pin = left + '-' + right;
                        if (pin === 'brick-brick') pin = undefined;
                        return {
                            tag: 'td',
                            content: {
                                block: 'input',
                                attrs: {style: 'width: 100px;'},
                                mods: {size: 's', clear: 'no', pin: pin},
                                value: pin,
                                content: {elem: 'control'}
                            }
                        };
                    })
                ]
            };
        })
    ]
}
```

#### Модификатор `poll`

Проверяет значение внутреннего нативного контрола по таймеру (блок `i-system`) каждые 50 миллисекунд и подставляет его в `value` блока. Используется для отслеживания изменений, которые не генерируют DOM-событие `input` на нативном контроле.

По умолчанию значение блока  `input` синхронизируется со значением внутреннего нативного контрола по событию `input` (включая полифиллы для IE8-9 и Opera12).

Существует несколько случаев, когда следует использовать модификатор `poll`:

* При автозаполнении полей формы. Поскольку во многих браузерах такие изменения значения можно отследить только с помощью частого опроса (polling).
* При программном изменении значения внутреннего нативного инпута.

Способ установки: BEMJSON. <br>
Допустимое значение: `yes`.

**NB** Применяйте модификатор только при крайней необходимости. Поскольку проверка выполнится для всех блоков страницы и при большом их количестве увеличится расход памяти браузера и снизится скорость его работы (отклик, загрузка страницы).


<a name="live"></a>
## Отложенная инициализация инпута

По умолчанию инпут инициализируется автоматически при загрузке страницы (то есть при наступлении события `domReady`).

Отложенная или live-инициализация блока – наступает только для конкретного экземпляра инпута в результате реакции на соответствующее событие (`focusin`, `focusout`).

Отложенная инициализация инпута с начальным значением

```bemjson
{
    block: 'input',
    js: {live: true, 'custom-js-params': true},
    mods: {size: 'm'},
    placeholder: 'Подсказка',
    value: 'Есть и подсказка',
    content: [
        {elem: 'control'}
    ]
}
```
Инпут с JS-параметром `autoFocus: true`, принудительно инициализируется сразу

```bemjson
{
    block: 'input',
    mods: {size: 'm'},
    js: {autoFocus: true},
    content: [
        {elem: 'control'}
    ]
}
```

### Включение отложенной инициализации

Существует несколько способов включить отложенную инициализацию:

* **Локально** – для конкретного экземпляра блока `input`.
 Достаточно в BEMJSON-декларации блока указать JS-параметр `live` со значением `true`
 (значение по умолчание `live: false` – автоматическая инициализация).

 ```javascript
 {
     block: 'input',
     js: { live: true }
     ...
 }
 ```

> **NB** При включении live-инициализации, отключится автокомплит.
Если одновременно указать в JS-параметрах `live: true` и `autoFocus: true` произойдет ошибка.

* **Глобально** – для всех блоков `input` проекта.
В этом случае, на уровне своего проекта нужно доопределить шаблон блока `input/input.bemhtml.js` следующим образом:

```javascript
block('input').mode('live')(true);
```

Все инпуты проекта станут инициализироваться отложено, кроме:

* Инпутов с явно отключенной live-инициализацией в BEMJSON через JS-параметр `live: false`.
* Инпутов с автофокусом (JS-параметр `autoFocus: true`).

В этих случаях инпут будет инициализироваться сразу.
Также, везде кроме этих двух случаев будет отключен автокомплит.

>  **NB** При глобально включенной live-инициализации необходимо принудительно задавать `live:false` для корректной работы инпута с
функциональностями (автозаполнение, автофокус и т.п.), которые требуют действий при загрузке документа, иначе они не будут работать.

Например, нельзя отключать автокомплит в инпутах формы авторизации (так как в поле логина выпадает список с подсказками ранее веденных значений).
