# i-update-session

Блок для обновления сессии пользователя. Блок статический, DOM-представления не имеет.

Если пользователь авторизован, то раз в час отправляется запрос
к Я.Паспорту для обновления информации о сессии.

Если пользователь не авторизован — ничего не происходит.

### Подключение
Подключается через `deps.js`:

```javascript
({
    block: 'i-update-session'
})
```

### Модификаторы блока
#### Модификатор `init`

Модификатор `init` в значении `auto` используется для автоматического старта.

```javascript
({
    block: 'i-update-session',
    mods: {
        init: 'auto'
    }
})
```

### API
Блок представляет собой Singleton: один объект на странице.
Запуск таймера для обновления производится методом `start()`; остановка –
методом `stop()`:

```javascript
// Запускаем поллинг, если пользователь авторизован:
BEM.blocks['i-update-session'].start();

// Останавливаем:
BEM.blocks['i-update-session'].stop();
```

### JS-параметры
Поведение блока можно изменить, переопределив на своем уровне функцию
`getDefaultParams()`, которая возвращает объект с ключами:

* `host` {?String} — авторизующий хост (`${protocol}//passport.yandex.${tld}`);
* `tld` {?String} — зона для хостов
    (по умолчанию: значение ключа `tld` блока `i-global`);
* `path` {?String} — путь после хоста до Паспорта (по умолчанию: `/auth/update/`);
* `interval` {?Number} — интервал между запросами к Паспорту
    для обновления сессии, в миллисекундах (по умолчанию: 55 минут).

**Внимание!** Функция `getDefaultParams()` — статичная.

### Особенности реализации
#### Я.Паспорт

Из-за большого количества legacy, некоторым сервисам необходимо изменить
пути к Паспорту.

Путь для сервисов в доменах `.ua`, `.kz`, `.by`: [pass.yandex.{ua|kz|by}/?retpath=](pass.ya.ru/pass?retpath=).

Для всех остальных сервисов: [pass.yandex.TLD/resign?retpath=](pass.yandex.TLD/resign?retpath=).

**Внимание!** Хост Паспорта берется из значения ключа `pass-host`
блока [i-global](../i-global/i-global.ru.md).

Изменить хост, путь и TLD можно переопределив функцию
`getDefaultParams()` (см. выше).

#### Фавиконка
Я.Паспорту нужно указывать путь возвращения в `retpath=`. Если этого
не делать, то Паспорт выдаёт ошибку.

В данный момент, значение `retpath` — это путь до фавиконки вида:
  `yandex.${tld}/favicon.ico`.

**Внимание!** Информация о TLD берется из ключа `tld` блока [i-global](../i-global/i-global.ru.md)
или указывается явно в методе `getDefaultParams`.
