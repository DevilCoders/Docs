# @yandex-lego/hedwig

## Что это такое?
Публикация версий npm пакета и открытие PR в сервисах

## Как пользоваться?
`hedwig` использует `yargs`, пользуйтесь командой `--help`:
`npm @yandex-lego/hedwig --help`.

## Как работает?

### hedwig
Открываем пачку пуллреквестов в сервисы.
Получаем конфиги, измененные пакеты и разные опции для нотификаций, дебага и прочего.
Затем мы пытаемся опубликовать каждый изменный пакет по схеме описанной в шаге [publish](#publish).
После мы идем по списку сервисов и выполняем [open-pr](#open-pr).

Собираем информацию о всех сервисах – формируем сообщение.

### open-pr
Открываем пр в сервис.
- смотрим есть ли там в зависимостях изменный пакет
- меняем версию
- перегенерируем package-lock файл
- записываем в ветку
- открываем ПР

### close-pr
Получаем конфигурацию сервисов и ветку, из которой открывали ПР.
Далее идем по списку из конфигурации и, если там связанная ветка есть – закрываем ПР.

(как правило ветки называются `lego-canary-pull-x`)

### publish

Публикуем пакеты с помощью `lerna publish from-package` в указанный тег.
Допустимо передать список пакетов в виде массива путей - в этом случае, если у указанных пакетов не обновлена версия в `package.json` и передан тег `canary`, утилита проставит для пакета вычисленную `canary`-версию.

## Поддержка
 Если у вас возникли вопросы и предложения по пакету, пишите команде Лего.

## Arc
Для Arc сейчас создаются RR через sandboxer, поэтому нужны соответсвенные переменные окружения.
Если вы запускаете из под другого овнера задачи (не FRONTEND), то нужно добавить еще переменных окружения:

- ROBOT_FRONTEND_SANDBOX_TOKEN || SANDBOX_OAUTH_TOKEN - для создания задач в sandbox
- HEDWIG_SANDBOX_OWNER - Овнер от которого нужно создать задачу

Если вы добавляете их в Vault, то они должны называться с `env.` -> `env.ROBOT_FRONTEND_SANDBOX_TOKEN`.

RR будет создаваться от robot-trenbot.
