# Работа с зависимостями в монорепозитории

## Контроль диапазона зависимостей
Внутри монорепозитория используется [depslint](../packages/depslint/README.md) контроля диапазона версий используемых контрибов и библиотек. Установленное правило: 2 мажора, 3 минора. Сервис не может обновить свои зависимости до самых свежих версий, пока в монорепозитории есть другие проекты, использующие более старые версии.

Все зависимости указываются в `package.json` явно. В корневом `package.json` допускаются только минимально необходимые пакеты, которые обеспечивают
инфраструктурные процессы монорепозитория. При разработке сервисов не должно возникать необходимости коммитить в корневой package.json.

## Работа с package-lock.json
`package-lock.json` — технический автогенерируемый файл, алгоритм генерации фиксированный. Поэтому не нужно заставлять живых людей делать эту рутину.
Часто при ручном обновлении lock-файлов возникают конфликты при ребейзе, их приходится резолвить руками и тратить еще больше ценного времени.
Кроме того, автоматическая генерация lock-файла будет осуществляться строго одной версией npm, что сократит диффы и обеспечит предсказуемость.

Процесс устроен так:
- установка текущих зависимостей — `lerna bootstrap --scope <имя_пакета_или_сервиса>`
- установка и сохранение новых зависимостей через `package.json`, без `package-lock.json`
- `package-lock.json` генерируются роботами в CI перед установкой для сборки и запуска тестов (но не пушатся в ветку)
- `package-lock.json` коммитятся в CI, сразу после влития PR в master/trunk
