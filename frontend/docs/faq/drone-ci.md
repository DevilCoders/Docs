# Поддержка Drone CI в монорепозитории

## :warning: Drone CI не развивается

Развитие [Drone CI][drone_ci] в монорепозитории остановлена.

Используйте Drone CI в монорепозитории исключительно для [миграции][migrate_manual] замороженных проектов.

Если проект активно разрабатывается, сразу после миграции нужно перейти на [Trendbox CI][trendbox_ci].

## Запуск Drone-проверок в пулл-реквестах

Поддержка `.drone.yml` реализована с помощью [специальной задачи][drone_job].

Задача будет запущена при условии, что пулл-реквест содержит изменения в пакете или сервисе с `.drone.yml`.

### Связи между пакетами и сервисами

Если изменения затрагивают зависимость пакета или сервиса с `.drone.yml`, эти изменения не будут использованы в проверке.  Зависимости будут установлены из [npm].

Если пулл-реквест содержит изменения в нескольких пакетах или сервисах с `.drone.yml`, проверки для из них запустятся параллельно на одном агенте.

### Отчёты 

Результат проверок для каждого пакета или сервиса будет опубликован в отдельном отчёте.

Если сборка завершилась с ненулевым кодом, отчёт будет иметь статус `FAILURE`.

## Запуск Drone-проверок в релизах

Поддержка `.drone.yml` реализована с помощью [специальной задачи][drone_job_release].

Релизные проверки запускаются при push-событии в ветки вида `release/<service>/<tag>`. В `.drone.yml` будет запущено событие `tag`. Название тега будет взято из названия релизной ветки.

[drone_job]: https://a.yandex-team.ru/arc_vcs/frontend/.trendbox.yml?rev=2a60932b4050572363e8fd1ae81bd69008b3634c#L198-209
[drone_job_release]: https://a.yandex-team.ru/arc_vcs/frontend/.trendbox.yml?rev=2a60932b4050572363e8fd1ae81bd69008b3634c#L180-197
[npm]: https://wiki.yandex-team.ru/npm/
[migrate_manual]: ../how-to/migrate/from-drone.md
