## Секция alertsets

Пресеты настроек мониторингов.

- [Поле settings](#поле-settings)
- [Поле juggler_check](#поле-juggler_check)
- [Поле alerts](#поле-alerts)
- [Поле extends](#поле-extends)

Алертсет это сущность, которая полность описывает настройки мониторингов, которые можно применить к объекту-хосту.
Включает в себя список алертов, список пресетов уведомлений, а также некоторые другие настройки, общие для всех алертов алертсета.

Можно отнаследовать один алерсет от другого, при этом будут доопределив или переопределив настройки и алерты.

Базовый формат:
```yaml
alertsets:
  <имя_алертсета>:
    settings:
      notifications: [<пресет1>, <пресет2>, ...]
    juggler_check:
      tags: [tag-from-alertset]
    alerts:
      <имя_алерта>:
        signal: "<сигнал>"
        warn: <порог1>
        crit: <порог2>
        inverse: true
        abc: my-service
        description: <Человекопонятное описание>
        disaster: true
        notifications: [<пресет2>, <пресет3>, ...]
        juggler_check: { ... }
```

### Поле settings

Необязательная секция с общими настройками алертсета.
Переопределяет `settings_defaults`.

### Поле juggler_check
Необязательная секция с настройками для Juggler чека. Доопределяет `juggler_checks_defaults` для всех алертов в `alerts`.

### Поле alerts

Словарь, который задает список алертов.

1. `<имя_алерта>` должно содержать только латинские буквы, цифры и знак подчеркивания. Нельзя использовать точки и пробельные символы.

1. `signal`

    Имя метрики, на которую мы будем накладывать ограничения, либо композиция [функций над метриками](https://doc.yandex-team.ru/Search/golovan-guide/concepts/auto.html).

    Примеры:
    1. `response_5xx_summ` - количество ответов с кодами вида 5xx
    1. `or(perc(push-response_5xx_summ, push-requests_summ), 0)` - процентное соотношение количества 5xx к общему количеству запросов или `0`, если сигнал отсутствует.

1. `warn` - порог, при превышении которого сигналом алерт переходит в состояние `WARN`.
   Если не указан, алерт переходит из `OK` сразу в `CRIT`.

1. `crit` - порог, при превышении которого сигналом алерт переходит в состояние `CRIT`.

1. `inverse` - флаг, при котором переход в состояние `CRIT` происходит, если сигнал ниже порога `crit`.
   Алерт находится в состоянии `OK`, если значение сигнала больше `warn`.

1. `window` - настройки окна. Оконный алерт использует не значение метрики в текущей точке, а определенным
   образом выбранное (агрегированное) значение за заданный период.

   * `window.size` - размер окна в человекочитаемом формате. Например: `10s`, `2m 30s`. Максимальное значение - 10 минут.
   * `window.aggregate` - способ агрегации. Возможные значения: `aver`, `max`, `min` и `summ`.

1. `disaster` - признак алерта, который говорит о негативном влиянии проблемы на пользователя.

   * в Juggler-проверку добавляется тег `is_disaster`, на который может смотреть автоматика.
   * если алерт отображается на панели, при срабатывании он окрашивается в яркий цвет.

1. `abc` - имя ABC-сервиса. Переопределяет `alertset.settings.abc`.

1. `description` - человекопонятное описание алерта. Отображается при клике на иконку «i» у светофора. В шаблонах yasm-панелей можно вывести в качестве подписи светофора через `<<alert.description>>`.

1. `notifications` - массив названий пресетов уведомлений. Переопределяет `alertset.settings.notifications`.

1. `juggler_check` - настройки для Juggler чека, привязанного к алерту. Доопределяет `juggler_checks_defaults` и `alertset.juggler_checks`.

### Поле extends

Имя алертсета, от которого наследуется текущий.
Для слияния используется `deep merge`. Наследование не ограничено одним уровнем, можно строить цепочки любой длины.
При этом любой из алертсетов может быть использован в секции `apps`.

Например:
```yaml
alertsets:
  base_alertset:
    settings:
      notifications: [ ... ]
    alerts:
      cpu_load: { ... }
      mem_usage: { ... }

  extended_alertset:
    extends: base_alertset  # Наследуемся от базового алертсета
    settings:
      notifications: [ ... ]  # Можем изменить настройки уведомлений
    alerts:
      cpu_load: { ... }  # Можем изменить старый алерт
      mem_usage:  # Можем отключить алерт из базового алертсета
      http_5xx: { ... }  # Или добавить новый
```
