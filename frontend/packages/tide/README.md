# Tide

Tide ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å —Ç–µ—Å—Ç–∞–º–∏, –∫–æ–¥–æ–º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏, –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏, –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤.
Tide —Ä–∞–±–æ—Ç–∞–µ—Ç —Å hermione –∏ testpalm —Ç–µ—Å—Ç–∞–º–∏, –Ω–æ –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –º–æ–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ª—é–±—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏.

### –ü–æ–º–æ—â—å üëÄ
 –í–æ–ø—Ä–æ—Å—ã? –ü—Ä–æ–±–ª–µ–º—ã? –°–º–µ–ª–æ –ø–∏—à–∏—Ç–µ –Ω–∞–º –≤ [Slack —á–∞—Ç](https://yndx-search.slack.com/archives/CP8P7J6JV)!

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```
npm i -D @yandex-int/tide --registry=http://npm.yandex-team.ru
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥ –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å –∏–º–µ–Ω–µ–º `tide.config.js`:
```js
module.exports = {
    plugins: {
        'tide-default-plugin-name': {
            enabled: false
        },
        'tide-plugin-name': {
            enabled: true
        },
        'tide-testpalm-generator': {
            enabled: false,
            rewrite: false,
            replacers: {
                addValue: (args) => [
                    { do: `—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫—É—Ä—Å–æ—Ä –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ "${args[0]}"` },
                    { do: `–¥–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –≤ –ø–æ–ª–µ "${args[1]}"` }
                ],
                assertView: (args) => ({ screenshot: `–≤–Ω–µ—à–Ω–∏–π –≤–∏–¥ [${args[0]}]` }),
                back: (args) => ({ do: '–Ω–∞–∂–∞—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥" –±—Ä–∞—É–∑–µ—Ä–∞' }),
                click: (args) => ({ do: `–Ω–∞–∂–∞—Ç—å –Ω–∞ "${args[0]}"` })
            }
        }
    }
}
```

### –ó–∞–ø—É—Å–∫

```
npx tide [options] [command] [paths...]
```

–î–ª—è –¥–µ–±–∞–≥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `DEBUG`:

```
DEBUG=tide* npx tide [options] [command] [paths...]
```

### –û–ø—Ü–∏–∏

- `-V, --version` ‚Äî –≤–µ—Ä—Å–∏—è –ø–∞–∫–µ—Ç–∞
- `-c, --config <path>` ‚Äî –ø—É—Ç—å –¥–æ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `--ignore <json-array>` ‚Äî –ø—É—Ç—å –¥–æ —Ñ–∞–π–ª–∞(–æ–≤) –¥–ª—è –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
- `--grep <regexp>` ‚Äî –ø–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ —Ç–µ—Å—Ç–∞ –∏–ª–∏ –ø–æ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–º—É –≤—ã—Ä–∞–∂–µ–Ω–∏—é
- `-p, --plugin <paths...>` ‚Äî –ø—É—Ç—å –¥–æ –ø–ª–∞–≥–∏–Ω–∞-—Å–∫—Ä–∏–ø—Ç–∞
- `-s, --silent` ‚Äî –∑–∞–ø—É—Å–∫ –±–µ–∑ –ª–æ–≥–∞ –∏ –≤—ã–≤–æ–¥–∞ –æ—à–∏–±–æ–∫ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤—ã—à–µ, —á–µ–º —É `--verbose`, default: false)
- `--verbose` ‚Äî –∑–∞–ø—É—Å–∫ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –ª–æ–≥–æ–º (default: false)
- `--conflict-mode` ‚Äî —Ä–µ–∂–∏–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤. –í–æ–∑–º–æ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: `new|old|both|ask`. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ mover –∏ experimenter. 
- `-h, --help` ‚Äî –≤—ã–≤–æ–¥ –ø–æ–º–æ—â–∏

### –ü—É—Ç–∏
–î–ª—è –∑–∞–¥–∞–Ω–∏—è –ø—É—Ç–µ–π –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å [fast-glob](https://github.com/mrmlnc/fast-glob#basic-syntax)

### –ö–æ–º–∞–Ω–¥—ã

- `stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–µ—Å—Ç–æ–≤—ã–º —Å—Ü–µ–Ω–∞—Ä–∏—è–º (default)
  - `--type [type]` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∏–ø–∞ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —Ç–µ—Å—Ç–æ–≤ (`'integration'`|`'e2e'`)
  - `--group [key]` ‚Äî –∫–ª—é—á, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –±—É–¥—É—Ç —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç (`'tool'`|`testpalmDataKey`, default: `'tool'`)
  - `--tool [tool]` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –Ω–µ –ø–æ `'tool'` (`'testpalm'`|`'hermione'`|`null`, default: `'testpalm'`)
  - `--sort [column|tool.column]` - –ø—É—Ç—å –¥–æ —Å—Ç–æ–ª–±—Ü–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –±—É–¥—É—Ç –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã —Å—Ç—Ä–æ–∫–∏ (default: `'testpalm.tests'`)
  - `-n, --max-count [number]` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ —Å—Ç—Ä–æ–∫ –≤—ã–≤–æ–¥–∏–º—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É (default: `0`)

### –ü–ª–∞–≥–∏–Ω—ã

Tide –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –ø–æ–º–æ—â–∏ –ø–ª–∞–≥–∏–Ω–æ–≤.

–ü–ª–∞–≥–∏–Ω—ã –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `tide.config.js`:

```js
module.exports = {
    plugins: {
        'tide-plugin-name': {
            enabled: true
        }
    }
};
```
–ì–¥–µ `tide-plugin-name` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–∞ –∏–ª–∏ –ø—É—Ç—å.

–ê —Ç–∞–∫–∂–µ –ø–ª–∞–≥–∏–Ω—ã –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å –∫–∞–∫ —Å–∫—Ä–∏–ø—Ç—ã, —Å –ø–æ–º–æ—â—å—é –æ–ø—Ü–∏–∏ `-p, --plugin`, —É–∫–∞–∑–∞–≤ –ø—É—Ç—å –¥–æ —Ñ–∞–π–ª–∞ –ø–ª–∞–≥–∏–Ω–∞.

```bash
npx tide --plugin path/to/plugin.js
```

–ü–ª–∞–≥–∏–Ω ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –≤–Ω—É—Ç—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –Ω–∞–≤–µ—à–∏–≤–∞—é—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏.

```js
module.exports = (tide) => {
    tide.on(e.BEFORE_FILES_READ, () => {
        console.log('Hello, world!');
    });
};
```

–ü–ª–∞–≥–∏–Ω—ã –±—ã–≤–∞—é—Ç –¥–≤—É—Ö —Ç–∏–ø–æ–≤:
- –ø–∞—Ä—Å–µ—Ä—ã ‚Äî –ø–∞—Ä—Å—è—Ç —Ñ–∞–π–ª—ã –∏ –¥–æ–±–∞–≤–ª—è—é—Ç –∏—Ö –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏, –∞ –ø–æ—Ç–æ–º —Å–µ—Ä–∏–∞–ª–∏–∑—Ü—É—é –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é —Ñ–∞–π–ª–æ–≤;
- —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ç–æ—Ä—ã ‚Äî —Ç—Ä–∞–Ω—Ñ–æ—Ä–º–∏—Ä—É—é—Ç –¥–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤ –ø–æ—Å–ª–µ —á—Ç–µ–Ω–∏—è –∏ –ø–∞—Ä—Å–∏–Ω–≥–∞;

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø–ª–∞–≥–∏–Ω–∞–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö:

- [tide-renamer](src/plugins/tide-renamer/README.md)
- [tide-hunter](src/plugins/tide-hunter/README.md)
- [tide-testpalm-generator](src/plugins/tide-testpalm-generator/README.md)
- [tide-testdata-manager](src/plugins/tide-testdata-manager/README.md)
- [tide-experimenter](src/plugins/tide-experimenter/README.md)

#### –°–æ–±—ã—Ç–∏—è

–†–∞–±–æ—Ç–∞ —Å Tide, –≤–∫–ª—é—á–∞—è —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤, –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞, –∑–∞–ø–∏—Å—å, –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è—Ö.

| –°–æ–±—ã—Ç–∏–µ              | –û–ø–∏—Å–∞–Ω–∏–µ |
| -                    | - |
| `CLI`                | –°—Ä–∞–±–∞—Ç—ã–≤–µ—Ç –ø–µ—Ä–µ–¥ –ø–∞—Ä—Å–∏–Ω–≥–æ–º CLI-–æ–ø—Ü–∏–π. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è CLI-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. |
| `INIT`               | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –≤—Å–µ—Ö –¥—Ä—É–≥–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π. |
| `START`              | –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã, —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ testCollection, fileCollection –∏ fileManager. |
| `BEFORE_FILES_READ`  | –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–¥ —á—Ç–µ–Ω–∏–µ–º —Ñ–∞–π–ª–æ–≤. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∑–∞–¥–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å. |
| `AFTER_FILES_READ`   | –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ—Å–ª–µ —á—Ç–µ–Ω–∏—è –∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ñ–∞–π–ª–æ–≤. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤. |
| `BEFORE_FILES_WRITE` | –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é —Ñ–∞–π–ª–æ–≤. |
| `AFTER_FILES_WRITE`  | –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–æ–≤. |
| `END`                | –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º —Ä–∞–±–æ—Ç—ã. |

–í—Å–µ —Å–æ–±—ã—Ç–∏—è, –∫—Ä–æ–º–µ `INIT`, `START` –∏ `END` –ø–µ—Ä–µ–¥–∞—é—Ç –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ `fileManager`, `fileCollection`, `testCollection`. 

### Programmatic API

Tide –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ –∫–∞–∫ CLI-—É—Ç–∏–ª–∏—Ç—É, –Ω–æ –∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ.

```typescript
import Tide from '@yande-int/tide';
const tide = new Tide(config);
```

`config` - –æ–±—ä–µ–∫—Ç, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ñ–æ—Ä–º–∞—Ç—É:

```typescript
interface TideConfig {
    plugins: Record<string, Record<string, any>>;
    ignore?: string[];
}
```

#### `run(): Promise<void>`

–í—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ `run` –∑–∞–ø—É—Å–∫–∞–µ—Ç Tide:
```typescript
tide.run();
```

#### –ü—Ä–∏–º–µ—Ä

–ü—Ä–∏–º–µ—Ä –ø–æ–ª—É—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞ –≤ –∑–∞–¥–∞–Ω–Ω–æ–º testpalm.yml —Ñ–∞–π–ª–µ.

```typescript
import Tide from '@yandex-int/tide';

const tide = new Tide({ plugins: {} });
const e = tide.events;

tide.on(e.BEFORE_FILES_READ, () => {
    tide.fileManager.setFilePaths('testpalm', ['path/to/file.testpalm.yml']);
});

tide.on(e.AFTER_FILES_READ, () => {
    const counter = tide.fileCollection.getTestFile('path/to/file.testpalm.yml').data.counter;

    console.log(counter);
});

tide.run();
```
