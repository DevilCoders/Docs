@yandex-int/link-my-stand
=========================

CLI-утилита для автоматического добавления ссылок на стенды в тикет в Трекере.
Ссылки формируются на основе переданного паттерна, в который подставляется номер PR, и добавляются в поле `Stands URI`.

`./bin/run -p 'https://renderer-jobs-pull-{{number}}.hamster.yandex.ru' --repo search-interfaces/frontend`

## Arcanum-API-токен и Startrek-токен

В утилите используется пакет [@yandex-int/tokenator-universal](https://a.yandex-team.ru/arc/trunk/arcadia/frontend/projects/infratest/packages/tokenator-universal#пример-использования), который позволяет получить токены автоматически. Для этого требуется настроить `ssh-agent` и добавить в него ключи – `ssh-add -l`.

Вы также можете передать токены через переменные окружения или сохранить в `~/.bashrc`, `~/.zshrc` etc.

О том, как получить свой [OAuth-токен](https://wiki.yandex-team.ru/tracker/api/#avtorizacija).

`STARTREK_TOKEN=<token>`

`ARCANUM_API_TOKEN=<token>`

## Опции

Доступные опции:

* `--pr`
* `--queues`
* `--patterns`
* `--repo`
* `--issues`
* `--useArc`

### `pr`

Номер PR, Является **обязательной** опцией.
Может передаваться как через опцию, так и через переменную окружения `TRENDBOX_PULL_REQUEST_NUMBER`.

### `patterns`

Паттерн, согласно которому будет формироваться ссылка на стенд. Является **обязательной** опцией.
Плейсхолдер для замены выделяется двойными фигурными скобками, например: `https://renderer-jobs-pull-{{number}}.hamster.yandex.ru`
Плейсхолдер внутри скобок можно оставить пустым или заполнить латинскими буквами или цифрами.

### `issues`

Список тикетов, в которых нужно добавить/обновить ссылки на стенды.
Если не передать эту опцию, утилита попытается выделить номера из названия PR в `github` или `arcanum`, в зависимости от переданной опции `useArc`.

### `queues`

Список очередей трекера, для которых может быть обновлен стенд.
Если не передать эту опцию, утилита привяжет стенды к тикетам из любых очередей, с которыми связан PR.

### `useArc`

Опция, указывающая на необходимость испоользовать Arcanum API. Можно также передать через переменную окружения `USE_ARC`.


