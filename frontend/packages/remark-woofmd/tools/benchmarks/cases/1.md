Страница виснет
<--delimiter-->
https://wiki.yandex-team.ru/users/mapache/Insturukcija-po-reliznomu-ciklu/
<--delimiter-->

%%(wacko wrapper=box wrapper_align=right wrapper_width=300)
{{TOC}}
%%

==Доступы/Настройки/Информация
<{С чего начать
Прежде чем приступить к ведению ветки, нужно обеспечить себе ((https://wiki.yandex-team.ru/browser/release-schedule/desktop-browser/start/#dostupy доступы))
В ((https://browser.yandex-team.ru/projects/desktop/releases релизнице)) включить вид для менеджера производства
200x0:https://jing.yandex-team.ru/files/ona15/firefox_2020-02-04_17-22-14.png
Для каждой ветки в очереди %%BROWSER-RELEASE%% создается эпик, в рамках которого нужно проводить работы, логировать время, например https://st.yandex-team.ru/BROWSERELEASE-1466 }>
<{Полезная информация для изучения
<{1. JSON-ы для запуска задач в вехе - пояснения

%%(json)
{
  "builds": [
    {
      "fake_tags": [
        "fake"
      ],
      "name": "win stable",
      "bare_from": "",
      "tags": [
        "rc",
        "portal"
      ],
      "properties": {
        "reverse.dep.env.YAPIN_REVISION": "9742cb799cf264056f1c2c92402faf0681fa7891",
        "env.ALICE_REVISION": "02dc3258e69a66085e5b509bd6827de8ea44d56c"
      },
      
      "tag": "win_stable",
      "has_fake": true,
      "prs": [],
      "prs_timeout": 0, 
      "build_type": "BrowserBrandedDistributives_BrandedStableWin"
    },
    {
      "fake_tags": [
        "fake"
      ],
      "name": "win toloka",
      "bare_from": "",
      "tags": [
        "toloka"
      ],
      "properties": {
        "env.ADD_STROKA": 0,
        "reverse.dep.env.YAPIN_REVISION": "9742cb799cf264056f1c2c92402faf0681fa7891",
        "reverse.dep.*.extraGnArgs": "enable_pretend_not_in_frame=true",
        "env.ALICE_REVISION": ""
      },
       
      "tag": "",
      "has_fake": true,
      "prs": [],
      "prs_timeout": 0,
      "build_type": "BrowserBrandedDistributives_BrandedStableWin"
    },
    
    {
      "fake_tags": [],
      "name": "win comm",
      "bare_from": "win_stable",
      "tags": [
        "comm"
      ],
      "properties": {
        "partner-names": "",
        "reverse.dep.env.YAPIN_REVISION": "9742cb799cf264056f1c2c92402faf0681fa7891",
        "env.ALICE_REVISION": "02dc3258e69a66085e5b509bd6827de8ea44d56c"
      },
       
      "tag": "", 
      "has_fake": false, 
      "prs": [], 
      "prs_timeout": 0, 
      "build_type": "BrowserBrandedDistributives_PartnersStableWin"
    },
    
    {
      "fake_tags": [],
      "name": "win noalice",
      "bare_from": "win_stable", 
      "tags": [
        "noalice"
      ],
      "properties": {
        "env.ADD_STROKA": 0, 
        "reverse.dep.env.YAPIN_REVISION": "9742cb799cf264056f1c2c92402faf0681fa7891",
        "env.ALICE_REVISION": ""
      },
       
      "tag": "",
      "has_fake": false,
      "prs": [],
      "prs_timeout": 0,
      "build_type": "BrowserBrandedDistributives_BrandedStableWin"
    }
    ]
   }
%%
    %%"name": "win stable",%% - основная сборка браузера для win
    %%"tag": "win_stable",%% - уникальный тег, указывающийся в следующих сборках в задаче на той же баре-сборке. !!При перезапуске задачи необходимо поменять тег, например на win_stable_1, и все параметры bare_from в остальных задачах, которые ссылались на старый тег!!
    %%"has_fake": true,%% -  Необходимо ли собирать фейк для этой сборки
    %%"prs": [],%% -  Тут можно указать список пиаров (только номера, через запятую), чтобы сборка запустилась только после их влития. Отдельно указывается для каждой сборки, но сборки на тушке win_stable в любом случае ожидают ее
    %%"prs_timeout": 0,%% - Время ожидания, после которого сборка запустится даже, если пиары из строки выше не подольются, в минутах
    %%"name": "win toloka",%% - Сборка толо-браузера для асессоров
    %%"name": "win comm",%% - Сборка коммерческой дистрибуции
    %%"name": "win noalice",%% - Сборка без алисы
    %%"bare_from": "win_stable",%% - тег ядра, на котором будет собираться сборка
    %%"env.ADD_STROKA": 0,%% - параметр, отключающий в сборке алису
    }>
}>

==Отвод ветки
===Отвод ветки мажора 

1. <{дождаться письма об отводе ветки
Ветку отводит отдел инфраструктуры. Дождитесь письма об отводе ветки на browser-infra@. Если письма долго нет, стоит напомнить об этом в ((https://t.me/joinchat/C641s03VvVlF1PW49Cde8g чате)).}>
2. <{Запустить задачи по переносу тикетов, созданию ветки брендингов и отправке писем
После отвода ветки запустите в релизнице задачи по переносу тикетов, созданию ветки брендингов и отправке писем (задачи можно запускать сразу друг за другом), не меняя параметров
!!параметры задач!!
**перенос тасков** - в трекере проверьте, что тикеты успешно перенеслись на фикс-версию вашей ветки:
%%(json)
TransitIssuesTask: transit issues
{
  "kind": "branch"
}
%%
**Создание ветки брендингов** - //веткой отвода во всплывающем окне указываем предыдущую ветку (для мажора это последний минор предыдщего релиза), новой веткой - вашу. Формат master-20.2.0/rc)//
%%(json)
CreateBrandingsBranchTask: 
{} (без параметров)
%%
Отправка писем - будут отправлены письма на browser-pm@, browser-mp@, browser-dev@
%%(json)
SendEmailTask: send email
{
  "tag": "branch"
} 
%%
не забудьте проверить ((https://browser.yandex-team.ru/projects/desktop/release-emails шаблон письма)) перед отправкой - увидеть текст для отправки можно по нажатию на //ред.// возле письма нужной вехи. Проверьте, что в тексте нет каких-либо несоответствий, например, дат или логинов
(иногда в релизах что-то меняется, например, менеджер или ответственный разработчик уходит в отпуск, тогда вместо подстановки из релизницы может быть указан логин)]>
В случае проблем с задачами пишите в ((https://t.me/joinchat/C641s03VvVlF1PW49Cde8g чат инфры))
}>

3. <{Убедитесь, что были запущены задачи на проверку ((https://wiki.yandex-team.ru/browser/release-schedule/desktop-browser/google-links/?from=%252Fusers%252Fyuliya-k%252Fdesktop-browser%252Fgoogle-links%252F гуглоссылок)). 
Проверить можно, зайдя в https://st.yandex-team.ru/BROWSER-75078 - в связанных должны быть задача 
Если нет, необходимо написать в ((https://t.me/joinchat/C641s03VvVlF1PW49Cde8g чат инфры))}>

===Отвод ветки минора
1. <{В день отвода напишите письмо на рассылку @browser-infra по шаблону
%%Тема: Отвод ветки [номер ветки]%%
 %%Текст:%% 
    Прошу отвести ветку master-[номер ветки]/rc от ветки master-[номер предыдущей ветки]/rc.%%
 
    А также:
    - настроить ежедневное автоподлитие [номер мажора] -> [предыдущая ветка] -> [номер новой ветки]
    - завести в очереди BROWSER фиксверсию [номер ветки] 
    - убедиться, что в teamcity версия сборки - [номер ветки]
    - убедиться, что тесты в bitbucket запускаются и работают по новой ветке корректно
}>
<{Пример отправленного письма
  <[Прошу отвести ветку master-20.2.4/rc от ветки master-20.2.3/rc.
   А также:
  - настроить ежедневное автоподлитие 20.2.0 -> 20.2.1 -> 20.2.2 -> 20.2.3 -> 20.2.4
  - завести в очереди BROWSER фиксверсию 20.2.4
  - убедиться, что в teamcity версия сборки - 20.2.4
  - убедиться, что тесты в bitbucket запускаются и работают по новой ветке корректно]>}>
Ответ от инфраструктуры можно ждать несколько часов - 3 часа это норм

<{После ответного письма необходимо проверить, что все действия выполнены 
фиксверсия изменена, ветка брендирования создана
Как проверить
1. ПРы на автоподлитие и локализацию создаются в репозитории browser. Зайдите в ((https://bitbucket.browser.yandex-team.ru/projects/STARDUST/repos/browser/pull-requests репозиторий)), откройте список ПР для вашей ветки (в поле %%Target Branch%% выберите вашу ветку)
https://wiki.yandex-team.ru/users/mapache/Insturukcija-po-reliznomu-ciklu/.files/pr.png
https://wiki.yandex-team.ru/users/mapache/Insturukcija-po-reliznomu-ciklu/.files/update.png
2. FixVersion в очереди браузера
Откройте любой тикет и проверьте, что с писке доступных для выбора версий в поле %%FixVersion%% появилось нужное значение
Если какой-то из пунктов не выполнен, необходимо обратиться в инфру }>




==Бротим
<{Переключается автоматически согласно дате в релизнице
Первый бротим собирается на следующий день после переключения. Необходимо проверить что бротим действительно собирается
Проверить можно в релизнице https://browser.yandex-team.ru/projects/desktop - Версия бротима будет соответсвовать новой ветке
Или в тимсити в канале ((https://teamcity.browser.yandex-team.ru/viewType.html?buildTypeId=BrowserBrandedDistributives_BrandedDevWin branded.dev.win)) - в соответствующей ветке будет сборка бротима
}>
==Катофф

 <{В релизнице необходимо запустить задачи на перенос тикетов и отправку писем
  * Открываем веху вашей ветки ((https://jing.yandex-team.ru/files/ona15/1580456149013.jpg скрин))
  * Внутри находится список задач, которые нужно запустить (нажать на кнопку Запуск у каждой задачи)
    <{Параметры задач
    //TransitIssuesTask: Перенос тикетов во время cut-off//
      %%
      {
        "kind": "cut-off"
      }
      %%
    //SendEmailTask: Письмо о cut-off//
      %%
      {
        "tag": "cut-off"
      }
      %%
    }>
  * После запуска первой задачи покажется ((https://jing.yandex-team.ru/files/ona15/1580473443509.jpg попап)) - дождитесь в нем статуса FINISHED. В таску сандбокса переходить не нужно и ничего в ней делать так же не нужно
  * После этого можно запускать вторую задачу, при запуске которой так же покажется ((https://jing.yandex-team.ru/files/ona15/1580473499816.jpg попап))
  После завершения всех действий попап со статусами будет выглядеть вот ((https://jing.yandex-team.ru/files/ona15/1580473561943.jpg так))
Результат: На почте появляется письмо о состявшемся катоффе
600x0:https://jing.yandex-team.ru/files/ona15/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA%20%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0%202020-01-31%20%D0%B2%2017.44.03.png }>

==Альфа

===Сборка альфы (время сборки 2-3 часа)
<{ чек-лист
* Проверьте, что все необходимые ПРы в ветку влились
Сборки запускаются через релизницу в день cut-off. 

**//Необходимые, это какие://**
а) стабилизация/автоподлития. Тут спрашиваем у инфры + ((https://bitbucket.browser.yandex-team.ru/projects/STARDUST/repos/browser/pull-requests?state=OPEN&at=refs%2Fheads%2Fmaster-20.3.0%2Frc смотрим)) открытые ПР **по своей ветке**. ПРы про автоподлитие имеют в заголовке что-то типа "update X with Y". По стабилизации идти к кому:matthewtff в личку.
б)ПРы, которые либо были призваны блокерами альфы, либо лично просили менеджеры/разработка
в) любые другие ПРы - узнать у кого:dmgor


* Откройте в релизнице веху - ((https://jing.yandex-team.ru/files/ona15/1580482288388.png Сборка Альфы))
* Без изменения запускаем задачу %%BrandedBuildsTask%%
  Конфиг для задачи
  %%(json)
  {
    "builds": [
      {
        "fake_tags": [
          "fake"
        ],
        "name": "win alpha",
        "bare_from": "",
        "tags": [
          "beta",
          "portal"
        ],
        "properties": {
          "reverse.dep.*.yapin_revision": "9742cb799cf264056f1c2c92402faf0681fa7891",
          "env.ALICE_REVISION": "02dc3258e69a66085e5b509bd6827de8ea44d56c"
        },
        "tag": "",
        "has_fake": true,
        "prs": [],
        "prs_timeout": 0,
        "build_type": "BrowserBrandedDistributives_BrandedBetaWin"
      },
      {
        "fake_tags": [],
        "name": "win beta tests",
        "bare_from": "",
        "tags": [],
        "properties": {},
        "tag": "",
        "has_fake": false,
        "prs": [],
        "prs_timeout": 0,
        "build_type": "Browser_Tests_Build_Win"
      }
    ]
  }
  %%
  Вносить изменения в конфиг не нужно
После обновите страницу - появится блок ((https://jing.yandex-team.ru/files/ona15/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA%20%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0%202020-01-31%20%D0%B2%2017.29.30-1.png Сборки)) - в нем находятся ссылки на сборки
**Примечание**: %%Билд win beta tests. Cборка - FAILED%% - Сборка не FAILED, какие-то ошибки со статусами. Откройте и проверьте, что сборка собралась 
* После успешного сбора билдов, необходимо 
  * Написать письмо на рассылку @browser-qa
  * Найти в эпике, заполнить и закрыть тикет со сборками альфы, например https://st.yandex-team.ru/BROWSERELEASE-1470 
    **Шаблон письма**
    %%Тема: [Alpha/Beta/RC][Ось] [номер ветки] сборки%%
    %%Текст:%% 
    х32 
    **[ось] [Alpha/Beta/RC]**
    [партнер]
    [номер билда]
    [ссылка на билд в тимсити]
    
    fake
    [партнер]
    [номер билда]
    [ссылка на билд в тимсити]
    
    **[ось] [Alpha/Beta/RC]**
    [ссылка на билд в тимсити]
    
    х64 - опционально, если есть такие сборки 
    **[ось] [Alpha/Beta/RC]**
    [партнер]
    [номер билда]
    [ссылка на билд в тимсити]
    
    fake
    [партнер]
    [номер билда]
    [ссылка на билд в тимсити]
    
    **[ось] [Alpha/Beta/RC]**
    [ссылка на билд в тимсити]
    
    [Тикет на конфигурация - если есть]
    [Дополнительная полезная информация]
    
    
    **Пример письма**
    %%Привет!
     
    х64
    **win_pgo_alice**
    20.2.2.47.8056
    https://teamcity.browser.yandex-team.ru/viewLog.html?buildId=50148809
    
    fake
    20.2.2.50.8055
    https://teamcity.browser.yandex-team.ru/viewLog.html?buildId=50148813
    
    **win_tests**
    https://teamcity.browser.yandex-team.ru/viewLog.html?buildId=50148822
     
    х32
    **win alpha**
    20.2.2.46.8052
    https://teamcity.browser.yandex-team.ru/viewLog.html?buildId=50148817
    
    fake
    20.2.2.51.8057
    https://teamcity.browser.yandex-team.ru/viewLog.html?buildId=50148819
    
    **win beta tests**
    https://teamcity.browser.yandex-team.ru/viewLog.html?buildId=50148821%%
    }>
    
    <{Выкладка на CDN/Деплой - после получения сборок
Сразу после получения сборок и отправки их в тестирование необходимо выложить сборки на CDN 
 <{ 1. Запустите задачу на деплой
* Откройте веху "Релиз альфы"
* Нажмите на кнопку "Добавить задачу", если задачи на деплой еще нет
* В название задачи скопируйте текст %%DeployToCDNTask: Deploy%%
* Выберите тип %%DeployToCDN%%
* В "Параметры" скопируйте json
%%(json)
{
  "build_type_id": "Browser_ManagerHelpers_ToDownload_DeployBetaForWindows",
  "properties": {
    "enable-portal": "--enable-portal",
    "enable-monitoring": "",
    "enable-update": "--enable-update",
    "brandings-list": "список партнеров",
    "sandbox": "",
    "enable-rss": "--enable-rss"
  }
}
%%
**партнеры**
//Основной партнер для альфы alpha-yandex, но при проведении экспериментов могут добавляться и иные, это зависит от конфигурации релиза//
* Нажмите кнопку "Добавить"
* После в конец списка в вехе добавится новая задача.
* Нажмите на кнопку "Запуск" у добавленной задачи

  Покажется попап со статусом работы задачи. Не закрывайте попап, повторно его открыть не получится.
  Если Статус выполнения задачи - ошибка, то деплой необходимо запустить вручную }>
  <{Алгоритм для запуска вручную:
  1. Открыть ссылку на сборку альфы в TeamCity
  2. Нажать на ((https://jing.yandex-team.ru/files/ona15/firefox_2020-02-04_13-13-14.png кнопку)) %%Actions%%
  3. Из выпадающего списка выбрать ((https://jing.yandex-team.ru/files/ona15/firefox_2020-02-04_13-13-49.png пункт)) %%Promote...%%
  4. Находим ((https://jing.yandex-team.ru/files/ona15/firefox_2020-02-04_13-15-07.png пункт)) %%Deploy Beta for Windows%% и жмем на %%...%%
  5. В появившемся попап на вкладке %%General%% проставляем ((https://jing.yandex-team.ru/files/ona15/firefox_2020-02-04_13-16-45.png чекбоксы)) для полей %%put the build to the queue top%% и %% delete all files in the checkout directory before the build%%
  6. На вкладке %%Parameters%%
    * Заполнить поле %%brandings-list%% указав черед пробел партнеров, которых будем выкладывать. Например ((https://jing.yandex-team.ru/files/ona15/firefox_2020-02-04_13-20-31.png так))
    * Проставить галки в ((https://jing.yandex-team.ru/files/ona15/firefox_2020-02-04_13-21-45.png полях)) %%enable-portal%%, %%enable-rss%%, %%enable-update%%
    * Снять галку в поле %%sandbox%%
    * В поле %%ST Task%% указать тикет на выкладку альфы, который заполняли на несколько пунктов выше 
  7. Нажимаем на кнопку %%Run build%% 
  8. Ждем удачного завершения, например https://teamcity.browser.yandex-team.ru/viewLog.html?buildId=51248029
  }> 
  
  <{ 2. [Не нужно, делается автоматически] В репозитории ((https://bitbucket.browser.yandex-team.ru/projects/STARDUST/repos/browser-server-api-resources/browse server-api-resources)) создастся ((https://jing.yandex-team.ru/files/ona15/slack_2020-02-04_13-43-49.png ПР))
Нужно полайкать самостоятельно и вмержить ПР собственноручно в мастер
* Открыть ПР
* Нажать на кнопку %%...%% в правом верхнем углу
* Выбрать ((https://jing.yandex-team.ru/files/ona15/slack_2020-02-04_13-46-36.png пункт)) %%Edit%%
* Из поля %%Reviewers%% удалить всех, проставить себя
* Сохранить изменение
* Апрувнуть ПР, нажав на зеленую кнопку в правом верхнем углу}>
<{3. [Не нужно, делается автоматически] Далее сделать черри-пик в прод
* Нажать на кнопку %%...%% в правом верхнем углу
* Выбрать пункт Cherry-pick
* Открывается ((https://jing.yandex-team.ru/files/ona15/firefox_2020-02-04_15-01-32.png попап))
* В поле %%Target branch%% выбрать значение %%Production%%
* Из поля %%Reviewers%% удалить всех, проставить себя
* Нажать на кнопку %%Cherry-pick%%
* Апрувнуть ПР, нажав на зеленую кнопку в правом верхнем углу}>
4. Через несколько минут начнется раскатка на CDN
5. Время раскатки на CDN около часа 

<[Если файлы через час так и не доступны, стоит написать stewie@
Наличие файлов обычно проверяет тестирование]> }>
    

===Релиз альфы
В первый день альфа выкладывается на портал, в мануальный апдейт и в автоапдейт на 30%
<{Заполните тикет на релиз
При выкладке альфы нас интересует тикет https://st.yandex-team.ru/BROWSERELEASE-1469
Его необходимо заполнить, а именно блоки Сборка и Регрессия
**Сборка** - можно заполнить, скопировав значение из ((https://jing.yandex-team.ru/files/ona15/firefox_2020-02-04_13-03-32.png попапа)), которые появляется при нажатии на ((https://jing.yandex-team.ru/files/ona15/firefox_2020-02-04_13-02-24.png кнопку)) Информация о сборках
**Регрессия** - ссылки на регресионный тикет и на дашборд для отсмотра багов
В этом же тикете описывается конфигурация, если проводятся какие-то эксперименты }>
Можно сделать <{вручную
https://wiki.yandex-team.ru/browser/release-schedule/desktop-browser/update-deploy/?from=%252Fusers%252Fyuliya-k%252Fdesktop-browser%252Fupdate-deploy%252F}>
Удобнее это делать через релизницу. 

Откройте веху "Релиз альфы"
Для запуска %%UpdateRssTask%% ((https://jing.yandex-team.ru/files/ona15/firefox_2020-02-04_15-15-24.png понадобится)) номер деплоя и тикет на релиз
После запуска появится ((https://jing.yandex-team.ru/files/ona15/firefox_2020-02-04_15-15-42.png попап)) со статусом исполнения задач
Номер деплоя можно получить так: 
    1. Откройте сборку, которую нужно выложить
    2. На вкладке %%Overview%% раскройте свернутый блок %%Deployments (1 finished)%%
    3. Возьмите id этого деплоя в его урле

<{ 5. Обновление на портале
1. Откройте веху "Сборка альфы"
2. Запустите задачи %%UpdateInstallTask%% 
  <{UpdateInstallTask: alpha portal
  
%%(json)
  {
    "update_config": {
      "kz": {
        "win": {
          "beta": [
            "1"
          ]
        }
      },
      "by": {
        "win": {
          "beta": [
            "1"
          ]
        }
      },
      "ru": {
        "win": {
          "beta": [
            "1"
          ]
        },
        "win-6.1-ie": {
          "beta": [
            "1"
          ]
        },
        "win-10.0-ie": {
          "beta": [
            "1"
          ]
        }
      }
    },
    "event_kind": "deploy"
  }
  %%
  }>
  ПР создаются автоматически в репозитории ((https://bitbucket.browser.yandex-team.ru/projects/STARDUST/repos/browser-uploads/browse browser-uploads))
  ((https://jing.yandex-team.ru/files/ona15/slack_2020-02-04_15-19-42.png Картинка 1)) }>
<{ 6. Выкладка апдейта
Запустите задачу %%UpdateRssTask%% 
<{UpdateRssTask: alpha 30%
  
%%(json)
  {
    "update_config": [
      {
        "kind": "manual",
        "name": "section_6_2_1_2_alpha_pgo"
      },
      {
        "kind": "percent",
        "percent": 30,
        "name": "section_6_2_1_2_alpha_pgo"
      }
    ],
    "event_kind": "update"
  }
  %%
  }>
  ПР создается автоматически в репозитории ((https://bitbucket.browser.yandex-team.ru/projects/STARDUST/repos/browser-server-api-resources/browse browser-server-api-resources))
  ((https://jing.yandex-team.ru/files/ona15/firefox_2020-02-04_15-20-19.png Картинка 2)) }>


<{ 7. Ревью и тестирование:
1. Отредактировать Ревьюеров для каждого ПР в мастер в обоих репозиториях
2. Добавить в ревьюеры ответственного за релиз + 1 любого члена команды релиз-менеджеров (на этапе передаче релизного процесса из группы произодства в тестирование в ревьюеры призывать кого-то из производства mapache@ hmstr@ alexeydrozdov@)). Итого для ПР в мастер должно быть ((https://jing.yandex-team.ru/files/ona15/firefox_2020-02-04_15-21-03.png 2 ревьюера))
3. Создать черри-пики в прод обоих ПРов, оставив в ревьюерах только ((https://jing.yandex-team.ru/files/ona15/firefox_2020-02-04_15-22-23.png 1 человека)) - ответственного за релиз
4. Написать в чат/лички ревьюерам и прислать ссылки на ПР в **master**. Добиться проставления лайков ПРам
5. После создания ПРов в прод в ((https://q.yandex-team.ru/#/join/f3508250-8325-40b6-8a4b-076ae3693d68 чат Q [YaBro] Выкладки бро)) автоматически отправляются (( https://jing.yandex-team.ru/files/ona15/Q_2020-02-04_15-52-53.png сообщения)) для тестирования
6. Если какой-то из ПРов после лайка не вмержился, возможно, проблема в протухших автотестах
0x0:https://wiki.yandex-team.ru/users/mapache/Insturukcija-po-reliznomu-ciklu/.files/photo2020-02-1317.22.05.jpeg
Перезапустить их так:
0x0:https://wiki.yandex-team.ru/users/mapache/Insturukcija-po-reliznomu-ciklu/.files/photo2020-02-1317.15.53.jpeg
Если все ОК, то в тикете на апдейт на 30% будет сообщение об успешной проверки от команды кого:kochetov-a
}>
<{ 6.Переложить setup.arcs
Во время деплоя setup.arcs загружается в версионную папку на cdn. Для завершения выкладки необходимо переложить соответствующий версионный арк в неверсионную папку. 
Если деплой делался через релизницу, то это произойдет автоматически. Если деплой делался руками, то после проверки в мастере необходимо преложить файлы самостоятельно. Для этого зайдите в соответствующую сборку деплоя, нажмите actions->promote->deploy unversioned setuparc->три точки возле run. Укажите в открывшемся окне нужные бренды/партнеры  и номер таска в стартреке (те же, что при деплое) и запустите сборку)
}>


===Апдейт альфы
<{ 0. Получить ок на апдейт
Уточните у dmgor@ (если он вне зоны доступа, то можно попросить посмотреть креши у кого:drbasic или кого:riosvk), можно ли раскатывать версию_номер, нет ли блокерных крешей. Если в предыдущем шаге выкладки были ближе к вечеру, утром может быть недостаточно аудитории для оценки ситуации, поэтому всегда стоит начинать выкладку как можно раньше. }>
<{ 1. Заполнить тикет на выкладку 
например так https://st.yandex-team.ru/BROWSERELEASE-1471
}>
<{ 2. Запустите в релизнице задачу на апдейт UpdateRssTask
1. Откройте веху ((https://jing.yandex-team.ru/files/ona15/firefox_2020-02-05_15-02-52.png Апдейт альфы))
2. Запустите задачy %%UpdateRssTask: alpha 100%%%
<{параметры задачи
%%(json)
{
  "update_config": [
    {
      "kind": "file",
      "name": "section_6_2_1_2_alpha_pgo"
    },
    {
      "kind": "percent",
      "percent": 100,
      "name": "section_6_2_1_2_alpha_pgo"
    }
  ],
  "event_kind": "update"
}
%%
}>
3. Для запуска ((https://jing.yandex-team.ru/files/ona15/firefox_2020-02-04_15-15-24.png понадобится)) номер деплоя и тикет на релиз. ID деплоя точно такой же, как при раскатке альфы на 30%. Тикет берем из эпика, например такой https://st.yandex-team.ru/BROWSERELEASE-1471
4. После запуска показывается ((https://jing.yandex-team.ru/files/ona15/firefox_2020-02-05_14-51-06.png попап)) со статусом задачи

Автоматически создается ПР в репозиторий ((https://bitbucket.browser.yandex-team.ru/projects/STARDUST/repos/browser-server-api-resources/browse browser-server-api-resources)) 
}>
<{ Ревью и тестирование
1. Отредактировать Ревьюеров для каждого ПР в мастер в обоих репозиториях
2. Добавить в ревьюеры ответственного за релиз + 1 любого члена команды группы производства (кроме Филиппа). Итого для ПР в мастер должно быть ((https://jing.yandex-team.ru/files/ona15/firefox_2020-02-04_15-21-03.png 2 ревьюера))
3. Создать черри-пики в прод, оставив в ревьюерах только ((https://jing.yandex-team.ru/files/ona15/firefox_2020-02-04_15-22-23.png 1 человека)) - ответственного за релиз
4. Написать в чат/лички ревьюерам и прислать ссылки на ПР в **master**. Добиться проставления лайков ПРам
Результат: Сообщение в чате %%[YaBro] Выкладки бро%% о выкладке альфы на 100% }>


==Катофф2
<{Запустите задачи 
<[SendEmailTask: Письмо о катоффе2

{
  "tag": "cut-off2"
}]>
и
<[FreezeBranchTask: Фриз веток при катоффе2

{
  "kind": "cut-off2"
}
]> 
}>

==Кодфриз и бета
===Кодфриз
* Проверьте, что все необходимые ПРы в ветку влились
Сборки запускаются через релизницу в день Code Freeze. 

    **//Необходимые, это какие://**
    а) стабилизация/автоподлития. Тут спрашиваем у инфры + ((https://bitbucket.browser.yandex-team.ru/projects/STARDUST/repos/browser/pull-requests?state=OPEN&at=refs%2Fheads%2Fmaster-20.3.0%2Frc смотрим)) открытые ПР **по своей ветке**. ПРы про автоподлитие имеют в заголовке что-то типа "update X with Y". По стабилизации идти к кому:matthewtff в личку.
    б)ПРы, которые либо были призваны блокерами альфы, либо лично просили менеджеры/разработка
    в) любые другие ПРы - узнать у кого:dmgor
* После чего запустите задачи в вехе Code Freeze
  Задачи можно заупскать параллельно, последовательность не важна
  <{TransitIssuesTask: Переносим тикеты во время code-freeze
  %%
  {
    "kind": "code-freeze"
  }
  %%
  }>
  <{FreezeBranchTask: Фризим ветку при code-freeze
  %%
  {
    "kind": "code-freeze"
  }
  %%
  }>
  <{SendEmailTask: Письмо о code-freeze
  %%
  {
    "tag": "code-freeze"
  }
  %%
  }>

===Сборка беты
<{1. Собираем бету
* Откройте в релизнице веху - ((https://jing.yandex-team.ru/files/ona15/1580482288388.png Сборка Беты))
* Без изменения запускаем задачу %%BrandedBuildsTask%%
  <{Конфиг для задачи
  %%(json)
  {
    "builds": [
      {
        "fake_tags": [
          "fake"
        ],
        "name": "win beta",
        "bare_from": "",
        "tags": [
          "beta",
          "portal"
        ],
        "properties": {
          "reverse.dep.*.yapin_revision": "9742cb799cf264056f1c2c92402faf0681fa7891",
          "env.ALICE_REVISION": "02dc3258e69a66085e5b509bd6827de8ea44d56c"
        },
        "tag": "",
        "has_fake": true,
        "prs": [],
        "prs_timeout": 0,
        "build_type": "BrowserBrandedDistributives_BrandedBetaWin"
      },
      {
        "fake_tags": [],
        "name": "win beta tests",
        "bare_from": "",
        "tags": [],
        "properties": {},
        "tag": "",
        "has_fake": false,
        "prs": [],
        "prs_timeout": 0,
        "build_type": "Browser_Tests_Build_Win"
      }
    ]
  }
  %%
}>
  Вносить изменения в конфиг не нужно
После обновите страницу - появится блок ((https://jing.yandex-team.ru/files/ona15/firefox_2020-02-20_12-44-11.png Сборки)) - в нем находятся ссылки на сборки
**Примечание**: %%Билд win beta tests. Cборка - FAILED%% - Сборка не FAILED, какие-то ошибки со статусами. Откройте и проверьте, что сборка собралась 
* После успешного сбора билдов, необходимо 
  * Написать письмо на рассылку @browser-qa
  * Найти в эпике, заполнить и закрыть тикет со сборками альфы, например https://st.yandex-team.ru/BROWSERELEASE-1475  
}>
<{2. Выкладка на CDN/Деплой - после получения сборок, если не предвидится пересбор
Сразу после получения сборок и отправки их в тестирование необходимо выложить сборки на CDN 
 <{ 1. Запустите задачу на деплой
* Откройте веху "Релиз альфы"
* Нажмите на кнопку "Добавить задачу", если задачи на деплой еще нет
* В название задачи скопируйте текст %%DeployToCDNTask: Deploy%%
* Выберите тип %%DeployToCDN%%
* В "Параметры" скопируйте json
  <{конфиг
  %%(json)
  {
    "build_type_id": "Browser_ManagerHelpers_ToDownload_DeployBetaForWindows",
    "properties": {
      "enable-portal": "--enable-portal",
      "enable-monitoring": "",
      "enable-update": "--enable-update",
      "brandings-list": "beta-yandex beta-custo-int beta-custo-tb",
      "sandbox": "",
      "enable-rss": "--enable-rss"
    }
  }%%
  }>
  Далее Все аналогично Альфе
}>
===Релиз беты
Аналогично альфе. При деплое указываются партнеры beta-yandex, beta-custo-int, beta-custo-tb и иные, в зависимости от конфигурации релиза
<{портал
на портал выкладывается бета для брендов int  и tb
%%(json)
{
  "update_config": {
    "com.tr": {
      "win": {
        "beta": [
          "1"
        ]
      }
    },
    "com": {
      "win": {
        "beta": [
          "1"
        ]
      }
    }
  },
  "event_kind": "deploy"
}
%%}>
<{апдейт
%%(json)
{
  "update_config": [
    {
      "kind": "manual",
      "name": "section_6_2_1_2_2"
    },
    {
      "kind": "percent",
      "percent": 30,
      "name": "section_6_2_1_2_2"
    },
    {
      "kind": "manual",
      "name": "section_6_3_1"
    },
    {
      "kind": "percent",
      "percent": 30,
      "name": "section_6_3_1"
    },
    {
      "kind": "manual",
      "name": "section_6_6_1"
    },
    {
      "kind": "percent",
      "percent": 30,
      "name": "section_6_6_1"
    }
  ],
  "event_kind": "update"
}
%%}>

===Апдейт беты
Аналогично альфе
<{конфиг
%%(json)
{
  "update_config": [
    {
      "kind": "file",
      "name": "section_6_2_1_2_2"
    },
    {
      "kind": "percent",
      "percent": 100,
      "name": "section_6_2_1_2_2"
    },
    {
      "kind": "file",
      "name": "section_6_3_1"
    },
    {
      "kind": "percent",
      "percent": 100,
      "name": "section_6_3_1"
    },
    {
      "kind": "file",
      "name": "section_6_6_1"
    },
    {
      "kind": "percent",
      "percent": 100,
      "name": "section_6_6_1"
    }
  ],
  "event_kind": "update"
}
%%}>

==Релиз
===Сборка рц
РЦ обычно собирается на следующий день после выкладки беты на 100%. 
1. Перед сборкой отсмотрите креши в бете (к креш-отчете), проверьте пиары в ветку. Желательно уточнить у dmgor@, не нужно ли дождаться подлития каких-либо фиксов.
<{2. Добавьте необходимые задачи в веху
<[//На данный момент в ходе эксперимента с х64 собираются две версии основной сборки - х32 и х64//
В мажорных релизах (.0) помимо стандартных win-сборок собирается браузер mac, в релизах .3 - linux]>
<{Типы сборок рц
1. win stable основная сборка для windows, раздается на всех брендах, кроме украины, и некоторых вип-партнеров. Релизится согласно графику релиза рц
2. win no alice собирается на той же bare-сборке, что и win stable, без алисы. Раздается для украины (релиз одновременно с раскаткой основной сборки на 100%), некоторых виппартнеров
3. win comm собирается на той же bare-сборке, что и win stable, в сборке пб собираются партнеры комдистрибуции (релизится после полной раскатки основной сборки)
4. win toloka специальная сборки браузера для асессоров
5. x64 отдельная сборка (в т.ч. bare), на данный момент раздается только на старых пользователей на бренде yandex через эксперимент
}>
Если в вехе у вас не хватает задач для нужных билдов, то вы их добавляете самостоятельно
<{Необходимый состав задач в вехе для сборки РЦ:
__Релиз - 0__
* Cборки для вин х32
* Cборки для вин х64
* Cборки для Mac
* Тесты

__Релизы - 1,2,4__
* Cборки для вин х32
* Cборки для вин х64
* Тесты

__Релиз - 3__
* Cборки для вин х32
* Cборки для вин х64
* Cборки для Linux
* Тесты
}>
**Json для задач на сборки в релизнице**
<{Cборки для вин х32

%%(json)
{
  "builds": [
    {
      "fake_tags": [
        "fake"
      ],
      "name": "win stable",
      "bare_from": "",
      "tags": [
        "rc",
        "portal"
      ],
      "properties": {
        "reverse.dep.env.YAPIN_REVISION": "9742cb799cf264056f1c2c92402faf0681fa7891",
        "env.ALICE_REVISION": "02dc3258e69a66085e5b509bd6827de8ea44d56c"
      },
      
      "tag": "win_stable",
      "has_fake": true,
      "prs": [],
      "prs_timeout": 0, 
      "build_type": "BrowserBrandedDistributives_BrandedStableWin"
    },
    {
      "fake_tags": [
        "fake"
      ],
      "name": "win toloka",
      "bare_from": "",
      "tags": [
        "toloka"
      ],
      "properties": {
        "env.ADD_STROKA": 0,
        "reverse.dep.env.YAPIN_REVISION": "9742cb799cf264056f1c2c92402faf0681fa7891",
        "reverse.dep.*.extraGnArgs": "enable_pretend_not_in_frame=true",
        "env.ALICE_REVISION": ""
      },
       
      "tag": "",
      "has_fake": true,
      "prs": [],
      "prs_timeout": 0,
      "build_type": "BrowserBrandedDistributives_BrandedStableWin"
    },
    
    {
      "fake_tags": [],
      "name": "win comm",
      "bare_from": "win_stable",
      "tags": [
        "comm"
      ],
      "properties": {
        "partner-names": "",
        "reverse.dep.env.YAPIN_REVISION": "9742cb799cf264056f1c2c92402faf0681fa7891",
        "env.ALICE_REVISION": "02dc3258e69a66085e5b509bd6827de8ea44d56c"
      },
       
      "tag": "", 
      "has_fake": false, 
      "prs": [], 
      "prs_timeout": 0, 
      "build_type": "BrowserBrandedDistributives_PartnersStableWin"
    },
    
    {
      "fake_tags": [],
      "name": "win noalice",
      "bare_from": "win_stable", 
      "tags": [
        "noalice"
      ],
      "properties": {
        "env.ADD_STROKA": 0, 
        "reverse.dep.env.YAPIN_REVISION": "9742cb799cf264056f1c2c92402faf0681fa7891",
        "env.ALICE_REVISION": ""
      },
       
      "tag": "",
      "has_fake": false,
      "prs": [],
      "prs_timeout": 0,
      "build_type": "BrowserBrandedDistributives_BrandedStableWin"
    }
    ]
   }
%%
}>
    
    <{win test
   %%(json)
   {
  "update_config": [],
  "builds": [
    {
      "fake_tags": [],
      "name": "win tests",
      "bare_from": "",
      "tags": [],
      "properties": {},
      "tag": "",
      "has_fake": false,
      "prs": [],
      "prs_timeout": 0,
      "build_type": "Browser_Tests_Build_Win"
    }
  ]
}
%%
    }>
 <{win x64
%%(json)
{
  "builds": [
    {
      "fake_tags": [
        "fake"
      ],
      "name": "win stable x64",
      "bare_from": "",
      "tags": [
        "rc",
        "portal"
      ],
      "properties": {
        "reverse.dep.*.x64": "--os-flavor x64",
        "reverse.dep.env.YAPIN_REVISION": "9742cb799cf264056f1c2c92402faf0681fa7891",
        "env.ALICE_REVISION": "02dc3258e69a66085e5b509bd6827de8ea44d56c"
      },
      "tag": "win_stable_x64",
      "has_fake": true,
      "prs": [],
      "prs_timeout": 0,
      "build_type": "BrowserBrandedDistributives_BrandedStableWin"
    }
  ]
}
%%
%%"reverse.dep.*.x64": "--os-flavor x64",%% - !!параметр, отвечающий за 64-битность сборки!!
}>
<{ linux
%%(json)
{"builds":
[
 {
      "fake_tags": [
        "fake"
      ],
      "name": "linux_stable",
      "bare_from": "",
      "tags": [
        "rc",
        "portal"
      ],
      "properties": {},
      "tag": "linux_stable",
      "has_fake": true,
      "prs": [],
      "prs_timeout": 0,
      "build_type": "BrowserBrandedDistributives_BrandedBetaLinuxNew"
    },
    {
      "fake_tags": [
        "fake"
      ],
      "name": "linux toloka",
      "bare_from": "",
      "tags": [
        "toloka"
      ],
      "properties": {
        "reverse.dep.*.extraGnArgs": "enable_pretend_not_in_frame=true"
      },
      "tag": "linux_toloka",
      "has_fake": true,
      "prs": [],
      "prs_timeout": 0,
      "build_type": "BrowserBrandedDistributives_BrandedBetaLinuxNew"
    }
  ]
}
%%
}>
<{MAC
%%(json)
{
  "builds": [
    {
      "fake_tags": [
        "fake"
      ],
      "name": "mac stable",
      "bare_from": "",
      "tags": [
        "rc",
        "portal"
      ],
      "properties": {},
      "tag": "mac_stable",
      "has_fake": true,
      "prs": [],
      "prs_timeout": 0,
      "build_type": "BrowserBrandedDistributives_BrandedStableMac"
    },
    {
      "fake_tags": [
        "fake"
      ],
      "name": "mac toloka",
      "bare_from": "",
      "tags": [
        "toloka"
      ],
      "properties": {
        "reverse.dep.*.extraGnArgs": "enable_pretend_not_in_frame=true"
      },
      "tag": "",
      "has_fake": true,
      "prs": [],
      "prs_timeout": 0,
      "build_type": "BrowserBrandedDistributives_BrandedStableMac"
    },
    {
      "fake_tags": [],
      "name": "mac_comm",
      "bare_from": "mac_stable",
      "tags": [
        "comm"
      ],
      "properties": {
        "partner-names": ""
      },
      "tag": "",
      "has_fake": false,
      "prs": [],
      "prs_timeout": 0,
      "build_type": "BrowserBrandedDistributives_PartnersStableMac"
    },
    {
      "fake_tags": [],
      "name": "mac RC tests",
      "bare_from": "",
      "tags": [],
      "properties": {},
      "tag": "",
      "has_fake": false,
      "prs": [],
      "prs_timeout": 0,
      "build_type": "Browser_Tests_Build_Mac"
    }
  ]
}
%%
}>

}>

<{3. Запустите задачи на сборки в определенном порядке
В связи с экспериментом 32/64 и для возможности быстрой подмены версии пользователям сначала необходимо запускать задачу на сборку x64, а затем остальные
1. Запускаем задачу для сборки х64
2. Ждем минут 20, чтобы задача взялась в работу
3. Затем запускаем все остальные задачи, необходимые для релиза
4. Ждем результат выполнения всех задач
}>
4. Написать письмо на рассылку browser-qa со сборками
<[Тестирование х64 можно проводить как на brand=yandex соответствующей сборки, так и на partner=yandex-x64]>
<{5. Деплой на CDN
Задачи на деплой аналогичны задачам этой вехи для альфы и беты. Основной список для деплоя: yandex, tb,int by, brocompany.
<[В рамках эксперимента с х64 есть некоторые особенности при деплое, т.к. раздается одновременно две версии (х32 и х64)
При деплое х32 версии необходимо указывать дополнительно партнера yandex-x32, а для х-64 версии указывать только партнера yandex-x64 ]>
<{DeployToCDNTask: DeployToCDNTask: Deploy x32
%%(json)
{
  "build_type_id": "Browser_ManagerHelpers_ToDownload_DeployStableForWindows",
  "properties": {
    "enable-portal": "--enable-portal",
    "enable-monitoring": "",
    "enable-update": "--enable-update",
    "brandings-list": "yandex, tb, int, by, brocompany, yandex-x32",
    "sandbox": "",
    "enable-rss": "--enable-rss"
  }
}
%%
}>
<{DeployToCDNTask: DeployToCDNTask: Deploy x64
%%(json)
{
  "build_type_id": "Browser_ManagerHelpers_ToDownload_DeployStableForWindows",
  "properties": {
    "enable-portal": "--enable-portal",
    "enable-monitoring": "",
    "enable-update": "--enable-update",
    "brandings-list": "yandex-x64",
    "sandbox": "",
    "enable-rss": "--enable-rss"
  }
}
%%
}>
!!После запуска задачи необходимо исправить ррс для бренда yandex (приходите к mapache@)!!

===Релиз рц
В первый день браузер выкладывается на портал и в мануальный апдейт
В релизнице запустите задачи <{UpdateInstallTask 
{
  "update_config": {
    "ru": {
      "win": {
        "default": [
          "1"
        ]
      },
      "win-6.1-ie": {
        "default": [
          "1"
        ]
      },
      "win-10.0-ie": {
        "default": [
          "1"
        ]
      }
    },
    "com.tr": {
      "win": {
        "default": [
          "1"
        ]
      }
    },
    "com": {
      "win": {
        "default": [
          "1"
        ]
      }
    },
    "by": {
      "win": {
        "default": [
          "1"
        ]
      }
    }
  },
  "event_kind": "deploy"
}
}> для создания пиара по выкладке на портал и <{UpdateRssTask
{
  "update_config": [
    {
      "kind": "manual",
      "name": "section_yandex_company"
    },
    {
      "kind": "manual",
      "name": "section_newupd_1_yandex"
    },
    {
      "kind": "manual",
      "name": "section_techno_from_18_2_1_to_unpartner"
    },
    {
      "kind": "manual",
      "name": "section_6_1_1_11_3"
    },
    {
      "kind": "manual",
      "name": "section_6_1_1_8"
    },
    {
      "kind": "manual",
      "name": "section_6_1_1_7_1"
    }
  ],
  "event_kind": "update"
}
}> для мануального апдейта
<{Для мажорного релиза не забудьте выложить YandexDriver
Откройте bare-сборку той версии, которую вы выкладываете на портал, нажмите actions -> promote, найдите в открывшемся окне сборку **Browser/ManagerHelpers/Release YandexDriver** и нажмите возле нее deploy
}>
===Апдейт рц
===Выкладка випов
===Выкладка комдистрибуции
===Линукс
===Мак
===Корпбраузер
===Толобраузер
