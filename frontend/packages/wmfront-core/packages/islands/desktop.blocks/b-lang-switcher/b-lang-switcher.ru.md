# b-lang-switcher

**Статус блока**: **deprecated**

Блок устарел, вместо него рекомендуется использовать блок `lang-switcher`.

Блок состоит из указателя языка, флага, ссылки изменения языка.

Ссылка изменения языка ведет на отдельную страницу на [tune](http://wiki.yandex-team.ru/tune), на который будет
осуществляться выбор нужного языка.  Если ссылка не задана явно во входных данных (параметр `url` элемента `lang`), то она генерируется по шаблону:

```
%tune-host%/api/lang/v1.1/save.xml?intl=%lang-code%&retpath=%params/retpath%&sk=%secret-key%
```

где

* `tune-host` — адрес сервиса [tune](http://wiki.yandex-team.ru/tune) для данного региона, берется из [i-services](../i-services/i-services.ru.md);
* `secret-key` — сгенерированный секретный ключ возвращаемый из `x:get-secret-key()`.<br>
  В BEMHTML-реализации секретный ключ необходимо задавать явно в параметрах блока

 [i-global](../i-global/i-global.ru.md): `this['i-global']['secret-key']`.

Переключатель языка различный в разных локалях. Отличия состоят в выбранном языке. Конкретный язык приобретает атрибут `selected` в процессе rebuild в том случае, если ни у одного из языков в BEMJSON нет такого атрибута. Если же атрибут `selected` существует, то соответствующий язык будет выбран во всех локалях.



## Обзор
### Модификаторы блока

Модификатор | Описание | Допустимые значения
--- | --- | ---
`type`| | `lang-detect`: Динамически определять рекомендуемый для пользователя набор языков из переданных


### Элементы блока

Элемент | Описание
--- | ---
[lang](#elems-lang) | Язык.
tests|


### Элементы блока

<a name="elems-lang"></a>
#### Элемент `lang`

Элемент `lang` в BEMJSON принимает параметр `lang`:

```javascript
{elem : 'lang', lang: {code: 'ua', name: 'украинский'}}, //если известен код региона
{elem : 'lang', lang: {langCode: 'uk', name: 'украинский'}}, //если известен язык
{elem : 'lang', lang: {region: {id : '187'}, name: 'украинский'}} //можно найти регион по любому его признаку
```

* `code` — код региона;
* `langCode` — код языка;
* `region` — входной хеш состоящий из полей для [Геобазы](http://wiki.yandex-team.ru/LeonidMovsesjan/Geobase/ServantMethodsDocumentation#dopustimyepolja Геобазы):
  * `id` региона;
  * `name` — название;
  * `short_ename` — короткое английское имя (используется в качестве строкового id, для поиска региона);
  * `ename` — английское имя;
  * `lang` — язык по умолчанию.

Можно использовать любой из трех вариантов.

```js
{
    block: 'b-lang-switcher',
    lang: { code: 'ru', name: 'Ru' },
    content: [
        {
            elem: 'lang',
            lang: { code: 'ua', name: 'Ua' },
            url: '#/bla'
        },
        {
            elem: 'lang',
            lang: { code: 'en', name: 'En' },
            url: '#/bla'
        },
        {
            elem: 'lang',
            lang: { code: 'ru', name: 'Ru' },
            selected: 'yes',
            url: '#/bla'
        }
    ]
}
```

### Как рекомендуется сервису выбирать локаль

Всегда есть текущий язык пользователя. Берется он из куки `My`, может
переключаться как явно человеком, так и автоматически по локали браузера.

Всегда есть язык для домена на который зашел пользователь. Сейчас соответствие домен-язык 1:1 (ru-ru, ua-uk, by-be,
kz-kk), но в будущем для одного домена релевантными могут быть несколько языков.

Всегда есть язык для региона, выбранного пользователем. Сейчас соответствие регион-язык 1:1 (Россия кроме Татарстана —
**ru**, Беларусь — **be**, Украина — **uk**, Казахстан — **kk**, Татарстан — **tt**), но в будущем для одного региона
релевантными могут быть несколько языков.

Итоговый список языков получаем конкатенацией 4-х списков, исключая дубли. Если в итоговом списке языков набирается
менее двух, то переключатель не показывается вообще.

Языки сортируются по алфавиту.

Например, посетителю домена **.kz** из Татарстана с белорусской локалью браузера мы должны предложить языки be (локаль), kk (домен), tt (регион), ru.  Причем страница должна будет отобразиться на белорусском языке.
