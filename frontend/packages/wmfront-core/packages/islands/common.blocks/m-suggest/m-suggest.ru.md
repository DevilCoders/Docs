
## m—suggest

Блок, позволяющий найти какую—либо сущность в интранете. Помимо стандартного, может использоваться в двух видах:

  * для обычной шапки;
  * для поисковой шапки.

### Что и зачем?

  Цель: Объединить существующий поисковый саджест и `мультикомплит` стаффа в один блок. Блок в новом дизайне, который можно будет использовать и в поиске как саджест, и в формах как автокомплит (должен уметь работать с двумя back—ends (поиск и стафф) и настраиваться в зависимости от того, где его используют).

### Общее

  Саджест отличается от автокомплита сценарием использования и предназначением, и как следствие — и back—end с данными:

  - **мультикомплит** — помогает пользователю заполнить произвольное поле в форме. Результат выбора элемента в автокомплите — заполнение поля в форме.

  - **саджест** — помогает сформулировать запрос к поиску. Результат работы — поисковый запрос иди сразу переход на найденный документ (wiki—страница / анкета на стаффе / страница очереди в трекере). Back—end в этом случае — поисковый саджест.

  Блок состоит из input'a и располагающегося относительно него popup'a.

  У блока можно задавать:

  1. список сущностей
  2. порядок их вывода
  3. максимальное количество подсказок для каждого типа сущности
  4. число символов в префиксе, после которого начинаем показывать данный тип сущности
  5. вариант внешнего вида (стандартный/для обычной шапки/для поисковой шапки)
  6. размер подсказок и инпута
  7. модификаторы инпута

### Сущности

На данный момент для `мультикомплита` доступны следующие сущности:

  1. staff — Сотрудник
  2. department — Отдел
  3. maillist — Рассылка
  4. equipment —  Оборудование
  5. table — стол
  6. room — комната

Для саджеста — только staff.

Для backend type_groups доступно  3 типа сущностей:

  1. services — сервисные группы
  2. intra — интранет группы
  3. departments — организационные группы

Не указан не один тип = выбраны все.

### Модификаторы

  * модификатор `type` определяет бэкенд для саджеста (параметры запроса, логика формирования данных для запроса, обработка данных с backend, поведение самого саджеста для конкурентного backend)
    На данный момент существует `type_multicomplete`, `type_intranet—suggest`, `type_groups` и `type_simple`. Обязательный модификатор. В случае intranet—suggest items становятся ссылками на страницу сущности.
    `groups` по поведению схож с `multicomplete`, отличие в, собственно, бэкенде, и отсутствием разбиения по типам сущностей в попапе и возможностью задать у сущности максимальное число показываемых items. Вместо этого в `m—suggest` в JS—параметрах можно указать `maxCount` для
    регулировки общего количества items всех сущностей. Этот тип предназначен для показа конкретного типа групп (типы групп — сущности саджеста).
    `simple` подразумевает универсальный полиморфный саджест, который сочетает в себе автокомплит и саджест.
    В параметрах принимает:

    — `url` — url json—ручки
    — `maxCount` (необязательный) — максимальное число выводимых в выпадающем списке элементов (лишние обрезаются).
    — `dataKey` (необязательный) — ключ к массиву элементов для саджеста в ответе, например, указав items саджест будет ожидать массив в ответе в ключе объект_ответа.items.
    — `textKey` (необязательный) — если элемент массива с пунктами саджеста — объект, то саджест будет искать текстовую строку представления элемента списка в ключе textKey.
    Массив элементов саджеста:
    — если элемент массива — строка, то по выбору саджеста сработает автокомплит значения в `input`.
    — если элемент массива — объект, тогда текстовое представление элемента саджеста берется из JS—параметр `dataKey` (если установлено) или `text` (по умолчанию).
      если в объекте есть свойство `url`, то при выборе элемента произойдет переход по ссылке, переданной в этом свойстве с атрибутом target равным JS-параметру блока `target`.

  * модификатор `size` определяет размеры элементов подсказки и блока `input`.
    На данный момент есть 2 размера — `s` и `m`. Не обязательный, по умолчанию — `s`.

  * модификатор `disable` = 'yes'/'' позволяет отключить инпут саджеста, предотвратить события указателя на саджесте.

### JS—параметры
`addRequestParams` — кастомные параметры запроса (при коллизии приоритетнее).

### Доступные параметры

1. `inputMods`: объект с модификаторами для блока `input` саджеста. `size` в этом параметре приоритетнее для блока `input`, чем модификатор `size`. Необязательный параметр.
2. `inputAttrs`: объект с атрибутами для нативного инпута. По умолчанию — `name` = "text", `autocomplete` = "off".
3. `value`: строка с изначальным значением инпута. Необязательный параметр.
4. `found`: строка для подсказки о числе найденных ответов. Необязательный параметр.
5. `hint`: строка-placeholder для инпута. Необязательный параметр.
6. `target`: когда элемент саджеста — ссылка, значение переданное в этот параметр установится как атрибут `target` ссылки.
7. `types`: массив объектов/строк с указанием сущностей для подсказки. В случае объекта также можно указать
  * `maxCount`: максимально количество показывающихся элементов для данной сущности;
  * `symbolsToSend`: номер символа в тексте input'a, начиная с которого будут показываться подсказки для этого типа;
  * `valueField`: название поля в данных, которое будет выводиться при выборе данного типа сущности в инпуте;
  * `fields` (для type_multicomplete): необходимые поля данных с сервера, через '|'. Например, 'login|gender|uid|id|affiliation';

### Методы

`val()(value)` — возвращает строку из инпута, если передать строку — установит её в инпут, если передать экземпляр `m—suggest—item` — установит в инпут его значение, запомнит данные с backend о сущности.

`getData()` — возвращает данные с backend о последней, выбранной в саджесте сущности.

`clearData()` — очищает данные о сохраненной/сохраненных сущности/сущностях саджеста.

`name()` — возвращает значение атрибута `name` инпута саджеста.

### События

`change` — генерируется по событию `change` на блоке `input` в `m—suggest`. Передает текущее значение блока `input`.

`update—items` — генерируется, когда обновляется список элементов в попапе `m—suggest`.

`popup—shown` — генерируется при раскрытии попапа `m—suggest`.

`popup—hidden` — генерируется по скрытию попапа `m—suggest`.

`select` — генерируется по выбору элемента саджеста.

Пример:
```javascript
types: [{
  name: 'equipment',
  maxCount: 2
 },{
  name: 'department',
  symbolsToSend: 3
 },
 'table'
]
```

Список поддерживаемых на данный момент типов подсказок:
  * `staff` — Сотрудник
  * `department` — Отдел
  * `equipment` — Оборудование
  * `maillist` — Рассылка
  * `table` — стол

`inHeader` — активирует вид для обычной шапки.
`inSearchHeader` — активирует вид для обычной шапки.

### Пример саджеста в стандартном виде

```js
 {
  block: 'm—suggest',
  mods: { type: 'multicomplete', size: 's'},
  inputMods: { clear: 'no' },
  hint: 'Поиск по интранету',
  types: [{
    name: 'equipment',
      maxCount: 3
    },{
        name: 'department',
        maxCount: 3
    },{
        name: 'table',
        maxCount: 3
    }
  ]
}
```

### Пример саджеста для обычной шапки

```js
{
    block: 'm—suggest',
    mods: { type: 'multicomplete', size: 's' },
    inputMods: { size: 'm' },
    inHeader: true,
    types: [
        {
            name: 'department'
        },
        {
            name: 'staff'
        },
        {
            name: 'maillist'
        }
    ]
}
```

### Пример саджеста для поисковой шапки

```js
{
    block: 'm—suggest',
    mods: { type: 'multicomplete', size: 's' },
    inputMods: { size: 'm' },
    inSearchHeader: true,
    types: [
        {
            name: 'department'
        },
        {
            name: 'staff'
        },
        {
            name: 'maillist'
        }
    ]
}
```
