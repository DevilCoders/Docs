## Описание

Блок `select` — раскрывающийся список выбора. Каждый пункт списка создается с помощью элемента блока `option`, который должен быть вложен в контейнер `select`.
В HTML всегда лежит невидимый `<select>` для использования его функциональности. При отключенном JS появляется нативный контрол.

Раскрывающийся список имеет всего один уровень вложенности, как в нативном выпадающем списке, и позволяет выбрать только один элемент из списка.
Больше уровней вложенности не предусмотрено.

`select` — составной блок, его реализация основана на блоках [button](../button/button.ru.md) (кнопка блока) и [popup](../popup/popup.ru.md) (всплывающее окно блока).
Визуально представлен кнопкой и выпадающим списком.

В версиях браузера MSIE ниже 8 блок `select` деградируют до нативного `<select>`.

Блок позволяет использовать [отложенную инициализацию](#live).

### Варианты использования

`select` позволяет создавать следующие разновидности списков:

* **обычный** — содержит список пунктов.

* **с группой элементов** — выпадающий список с пунктами, объединенными в группу. Групп может быть несколько.

  Для объединения пунктов списка в группу служит элемент блока `option group` – контейнер, внутри которого располагаются элементы `option` группы. Группе элементов можно задать заголовок – элемент блока `label`. Визуально заголовок группы выделяется жирным начертанием. Все вложенные элементы группы смещаются вправо от своих исходных положений (на 2em).

* **динамически перестраиваемые списки** – связанные списки, где содержание зависимого (второго) списка формируется в зависимости от выбранного значения в первом списке.

Подробнее в [примерах](./desktop.examples/select/all/all.html#Динамически-перестраиваемые-селекты-1-проброс-модификаторов-блоку-popup-и-элементу-select__popup). Необходимо также добавить [JS-реализацию](https://github.yandex-team.ru/lego/islands/blob/dev/common.blocks/select/select.examples/all.blocks/example/example.js#L28-L126) для этих примеров.


#### JS-параметры блока

| Параметр             | Тип     | Описание |
| -------------------- | ------- | -------- |
| `elemPopupMods`      | BEMJSON | Пользовательские модификаторы, передаваемые в элемент блока `popup`.
| `popupMods`          | BEMJSON | Пользовательские модификаторы, передаваемые в блок `popup`. |
| `popupParams`        | BEMJSON | Пользовательские JS-параметры, передаваемые в блок `popup`.
| [rows](#params-rows) | Number  | Высота списка, в строках. |
| [live](#live)        | Boolean | Отложенная инициализация блока. Значение по умолчанию: `true`.

### Объявление блока на странице

BEMJSON для использования блока:

```javascript
{
    block: 'select', // имя блока
    name: 'mail', // имя контрола для отправки на сервер
    mods: {size: 'm', theme: 'normal'}, // модификаторы блока. Модификаторы темы и размера – обязательные
    content: [ // содержимое блока
        { // кнопка блока
            block: 'button',
            content: 'Отправленные' // текст кнопки (отображает выбранный пункт списка)
        },
        {
            elem: 'control', // нативный список
            content: [ // массив элементов `option` и `option-group`
            	{
                    elem: 'option', // пункт выпадающего списка
                    attrs: {value: 'send'}, // атрибуты списка. value – обязательный
                    content: 'Отправленные' // название пункта
                },
                {
                    elem: 'option',
                    attrs: {value: 'draft'},
                    content: 'Черновики'
                },
                {
                    elem: 'option-group', // элемент группы
                    attrs: {label: 'Тут группа'}, // заголовок группы
                    content: [ // массив элементов `option`, принадлежащих группе
                        {
                       	    elem: 'option',
                            attrs: {value: 'tvc'},
                            content: 'ТВЦ'
                        }
                       ...
                    ]
                }
                …
            ]
        }
    ]
}
```

В результате BEMHTML-преобразований блок `select` трансформируется в `<span>`, реализующий кастомный список. Внутри него будет находиться нативный контрол `<select name="имя" атрибуты>`(элемент блока `control`), содержащий нативные элементы `<option атрибуты>` и `<optgroup атрибуты>` – преобразованные элементы блока `option` и `option-group` соответственно.

```js
{
    block: 'select',
    name: 'mail',
    mods: {size: 'm', theme: 'normal'},
    content: [ // содержимое блока
        {
            block: 'button',
            content: 'Отправленные'
        },
        {
            elem: 'control',
            content: [
            	{
                    elem: 'option',
                    attrs: {value: 'send'},
                    content: 'Отправленные'
                },
                {
                    elem: 'option',
                    attrs: {value: 'draft'},
                    content: 'Черновики'
                },
                {
                    elem: 'option-group',
                    attrs: {label: 'Тут группа'},
                    content: [ // массив элементов
                        {
                       	    elem: 'option',
                            attrs: {value: 'tvc'},
                            content: 'ТВЦ'
                        }
                    ]
                }
            ]
        }
    ]
}
```

#### Атрибуты выпадающего списка

Так как функциональность блока `select` основана на нативных элементах `select`, `option` и `optgroup`, то ему можно задавать аналогичные нативные атрибуты, а
для нативных элементов `option` и `optgroup` задаются одноименные пары («ключ:значение») в зарезервированном поле атрибутов `attrs` соответствующих элементов блока.

Для формирования HTML-атрибутов в нативном списке во входном BEMJSON блока задаются одноименные поля.

`id`, `name`, `tabindex` – необязательные атрибуты блока.

  * `{String} id` – уникальный идентификатор, генерируется по умолчанию.
  * `{String} name` – имя контрола для отправки на сервер.
  * `{Number} tabindex`.

#### Атрибуты и содержимое пунктов списка

* Атрибуты:
  * `selected` – служит для установки активного пункта списка. По умолчанию выбран первый элемент списка.
  * `value` – значение пункта списка, которое будет отправлено на сервер или прочитано с помощью скриптов. Обязательный атрибут.
  * `disabled` – блокирует доступ к элементу списка `disabled: 'disabled'`.

* `content` – название пункта в списке.

```javascript
{
	elem: 'option', // пункт списка
    attrs: {value: 'us', selected: 'selected'} // атрибуты пункта
    content: 'Белоруссия'
}
```

#### Атрибуты и содержимое группы пунктов

* Атрибуты элемента блока `option-group` устанавливаются в его поле `attrs`.

  * `disabled` – блокирует доступ ко всем элементам группы списка `disabled: 'disabled'`.
  * `label` – заголовок группы.

* `content` – содержит массив элементов `option` входящих в группу.

```javascript
{
 	elem: 'option-group',
    attrs: {label: 'СНГ'}, // заголовок и атрибуты группы
    content: [ // массив элементов `option`, входящих в группу
    	{
        	elem: 'option', // элемент группы
            attrs: {value: 'ua'},
            content: 'Украина'
        }
        ...
    ]
}
```

<a name="live"></a>
### JS-параметр блока `live`

> **NB** Начиная с версии islands 3.5.0, блок `select` по умолчанию инициализируется отложено, чтобы оптимизировать производительность браузера.<br>
Ранее блок по умолчанию инициализировался автоматически при загрузке страницы (то есть при наступлении события `domReady`).

Отвечает за включение отложенной инициализации блока.

Тип: Boolean.
Значение по умолчанию: `true`.

Если блок инициализируется автоматически (`live: false`), включить отложенную инициализацию можно несколькими способами:

* **Локально** – для конкретного экземпляра блока `select`.
Достаточно в BEMJSON-декларации блока указать JS-параметр `live` со значением `true`

 ```javascript
 {
     block: 'select',
     js: { live: true }
     ...
 }
 ```

* **Глобально** – для всех блоков `select` проекта.
В этом случае, на уровне своего проекта нужно доопределить соответствующий шаблон блока.

**BEMHTML** в `select/select.bemhtml.js`

```javascript
block('select').js()(function() {
    return this.extend({live: true}, this.ctx.js);
});
```

**BH** в `select/select.bh.js`

```javascript
module.exports = function(bh) {
    bh.match('select', function(ctx) {
        ctx.js(ctx.extend({live: true}, ctx.js()));
    });
};
```

Все блоки `select` проекта станут инициализироваться отложено, кроме блоков с явно отключенной live-инициализацией в BEMJSON через JS-параметр `live: false`:

 ```javascript
 {
     block: 'select',
     js: { live: false }
     ...
 }
 ```

В этих случаях блок инициализируется сразу.

### Модификаторы

«Галочка» для выбранного пункта выпадающего списка и «стрелочка» в кнопке – векторные изображения, в формате svg. Браузерам, не поддерживающим svg, отдается картинка в формате png.


#### Ширина списка
Ширину выпадающего списка можно установить с помощью модификатора `layout`, а также изменять с помощью CSS-стилей.

* По умолчанию блоку `select` задан модификатор `layout` со значением `auto` (в CSS установлено свойство `width: auto`). В этом случае ширина выпадающего списка и кнопки устанавливается, исходя из ширины его содержимого. [Пример](./examples/#10-auto)

* Ширину вы можете ограничить по своему усмотрению [CSS-свойством max-width](../common.blocks/select/select.examples/12max-width.blocks/select/select.css). [Пример](./examples/#12-max-width).

* Список с фиксированной шириной.
При выставленном модификаторе `layout` со значением `fixed` кнопке и выпадающему списку можно задать необходимое фиксированное значение ширины (CSS-свойство `width`) – [пример select.css](../common.blocks/select/select.examples/15fixed.blocks/select/select.css). [Пример](./examples/#15-fixed).

>  **Важно**: При использовании модификатора`layout` со значением `fixed` или CSS-свойства `max-width` ширину элемента `popup` нужно указывать на 2 пикселя меньше требуемой.


  Если у вас на странице находится два блока `select` с разной фиксированной шириной, то для каждого нужно выставить модификатор `width` с соответствующим значением, чтобы CSS-свойство, ограничивающее ширину, не применилось ко всем блокам `select`. [см. пример select.css](../common.blocks/select/select.examples/17two-fixed.blocks/select/select.css). [Пример](./examples/#17-two-fixed).

```javascript
{
	block: 'select',
    name: 'mail',
    mods: {size: 's', theme: 'normal', width: '100'},
    content: [...]
},
{
	block: 'select',
    name: 'mail2',
    mods: {size: 'm', theme: 'normal', width: '400'},
    content: [...]
}
```

* Блок `select` с модификатором `layout` с выставленным значением `content` имеет CSS-свойство `width: 100%`. В этом случае ширина кнопки и выпадающего списка – 100%. Они растягиваются на всю ширину родительского блока.


<a name="params-rows"></a>
#### Высота выпадающего списка

* `rows` – JS-параметр блока, служит для ограничения высоты списка.
Значение параметра определяет количество отображаемых строк в списке.
Задается во входных данных блока следующим образом:

```javascript
{
	block: 'select',
	name: 'mail',
	mods: {size: 'm', theme: 'normal'},
	js: {rows: 6}, // указание количества отображаемых строк в списке
	content: [...]
}
```

Если количество пунктов больше, чем указано в `rows`, список отобразится с вертикальной прокруткой (для элемента `popup` будет установлен модификатор `scrollable` со значением `yes`, отвечающий за CSS-свойство `overflow-y:scroll`).

```js
{
    block: 'select',
    name: 'mail',
    mods: {size:'m', theme: 'normal'},
    js: {rows: 3},
    content: [
        {
            block: 'button',
            content: 'Черновики'
        },
        {
            elem: 'control',
            content: [
                {
                    elem: 'option',
                    attrs: {value: 'send'},
                    content: 'Отправленные'
                },
                {
                    elem: 'option',
                    attrs: {value: 'draft'},
                    content: 'Черновики'
                },
                {
                    elem: 'option',
                    attrs: {value: 'inbox'},
                    content: 'Входящие'
                },
                {
                    elem: 'option',
                    attrs: {value: 'del'},
                    content: 'Удаленные'
                }
            ]
        }
    ]
}
```

#### Темы оформления

Для блока `select` реализована стандартная тема оформления – обычная (модификатор `theme` со значением `normal`). Модификатор темы – обязателен при объявлении блока. По умолчанию не определен.

Значение модификатора темы блока `select` передается модификатору темы кнопки (блок `button`), если оно явно не задано во входных данных кнопки.
По умолчанию кнопке списка установлен модификатор `arrow` со значением `down` (кнопка со стрелкой вниз).

#### Размеры

Модификатор размера `size` – обязательный. По умолчанию не определен.
Реализованные размеры: `s`, `m`.

По умолчанию значение модификатор `size` блока `select` передается блокам `button` и `popup`.

Если нужен размер кнопки, отличный от заданного в блоке `select`, его можно определить в поле `mods` входных данных кнопки `button`.

При необходимости размер блока можно доопределить в проекте. [Кастомный размер](../button/button.ru.md#customsize).

Размер s:
```js
{
    block: 'select',
    name: 'mail',
    mods: {size:'s',  theme: 'normal'},
    content: [
        {
            block: 'button',
            content: 'Черновики' // предварительно выбранный пункт "Черновики"
        },
        {
            elem: 'control',
            content: [
                {
                    elem: 'option',
                    attrs: {value: 'send'},
                    content: 'Отправленные'
                },
                {
                    elem: 'option',
                    attrs: {value: 'draft'},
                    content: 'Черновики'
                }
            ]
        }
    ]
}
```

Размер m:

```js
{
    block: 'select',
    name: 'mail',
    mods: {size:'m',  theme: 'normal'},
    content: [
        {
            block: 'button',
            content: 'Черновики' // предварительно выбранный пункт "Черновики"
        },
        {
            elem: 'control',
            content: [
                {
                    elem: 'option',
                    attrs: {value: 'send'},
                    content: 'Отправленные'
                },
                {
                    elem: 'option',
                    attrs: {value: 'draft', selected: 'selected'},
                    content: 'Черновики'
                }
            ]
        }
    ]
}
```

#### Состояния блока и его элементов

* Состояния блока `select`:
  * **Не активен**, модификатор блока `disabled` со значением`yes`.
  При переключении модификатора `disabled` экземпляр блока `select` находит вложенный в него блок `button` и переключает его модификатор `disabled` в то же значение, которое получил сам.
  Модификатор `disabled` в значении `yes` блока `select` делает кнопку списка неактивной и, следовательно, выпадающий список будет не доступен для пользователя.


```js
{
    block: 'select',
    name: 'mail',
    mods: {size:'m', disabled: 'yes', theme: 'normal'},
    content: [
        {
            block: 'button',
            content: 'Черновики'
        },
        {
            elem: 'control',
            content: [
                {
                    elem: 'option',
                    attrs: {value: 'send'},
                    content: 'Отправленные'
                },
                {
                    elem: 'option',
                    attrs: {value: 'draft', selected: 'selected'},
                    content: 'Черновики'
                }
            ]
        }
    ]
}
```

* Состояния элемента `option-group` (группа пунктов списка):
  * **Не активна** – не доступны только элементы списка, входящие в группу.
    Задать это состояние можно в поле атрибутов элемента `option-group`, указав атрибуту `disabled` значение `disabled`:

```javascript
...
{
    elem: 'option-group',
    attrs: {label: 'Заголовок группы', disabled: 'disabled'},
    content: [...]
}
...
```

* Состояния элемента `option` (пункты списка, элементы `select__item`) :

  * **Не активен**, модификатор `disabled` – пункт списка не доступен пользователю.
  * **Наведен**, модификатор `hovered`.
  * **В фокусе**, модификатор `focused`.
   Раскрытие списка может выполняться клавишей **Space** или **Enter**, если он находится в фокусе.
   Переход по пунктам списка может осуществляться клавишами **[↑,↓]**.

  * **Выбран**, модификатор `selected` – выбранный пункт, визуально отмечен «галочкой».

  Состояние **не активен** пункту можно установить во входных данных элемента `option` в поле атрибутов `attrs`,  задав атрибут `disabled` со значением `disabled`.


```js
{
    block: 'select',
    name: 'mail',
    mods: {size:'m', theme: 'normal'},
    content: [
        {
            block: 'button',
            content: 'Отправленные'
        },
        {
            elem: 'control',
            content: [
                {
                    elem: 'option',
                    attrs: {value: 'send'},
                    content: 'Отправленные'
                },
                {
                    elem: 'option',
                    attrs: {value: 'draft', selected: 'selected'},
                    content: 'Черновики'
                },
                {
                    elem: 'option',
                    attrs: {value: 'unknown', disabled: 'disabled'},
                    content: 'Неизвестные'
                },
                {
                    elem: 'option-group',
                    attrs: {label: 'Медиа-группа', disabled: 'disabled'},
                    content: [
                        {
                            elem: 'option',
                            attrs: {value: 'tvc'},
                            content: 'ТВЦ'
                        },
                        {
                            elem: 'option',
                            attrs: {value: 'ng'},
                            content: 'National Geographic'
                       }
                   ]
               }
            ]
        }
    ]
}
```


#### Предварительный выбор пункта списка

Во входных данных в контенте кнопки `button` нужно прописывать выбранный по умолчанию пункт списка. Это нужно для того, чтобы при загрузке страницы, пока еще не отработал JS, кнопка не схлопывалась без контента.

По умолчанию выбран первый пункт списка. Чтобы выбрать по умолчанию другой пункт — нужно добавить нужному пункту атрибут `selected="selected"` и в контенте кнопки `button` прописать содержимое этого пункта. Текст кнопки и выбранного пункта будут синхронизированы.

```js
{
    block: 'select',
    name: 'mail',
    mods: {size:'m',  theme: 'normal'},
    content: [
        {
            block: 'button',
            content: 'Черновики' // предварительно выбранный пункт "Черновики"
        },
        {
            elem: 'control',
            content: [
                {
                    elem: 'option',
                    attrs: {value: 'send'},
                    content: 'Отправленные'
                },
                {
                    elem: 'option',
                    attrs: {value: 'draft', selected: 'selected'},
                    content: 'Черновики'
                }
            ]
        }
    ]
}
```
