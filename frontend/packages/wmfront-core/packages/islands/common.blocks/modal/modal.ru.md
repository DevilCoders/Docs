# modal
**Статус блока**: [unstable](https://github.yandex-team.ru/lego/islands-guidelines/blob/master/blocks-stabilization.md) (API блока в разработке).

Блок используется для создания модального окна. Заменяет блок [popup c модификатором type в значении modal](https://github.yandex-team.ru/lego/islands/blob/dev/common.blocks/popup/popup.ru.md#%D0%9C%D0%BE%D0%B4%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D0%BE%D0%BA%D0%BD%D0%BE).


## Обзор
- [Особенности реализации](#features)
- [Скрытие ползунков страницы при открытии модального окна](#scrollbars)
- [Проблема с пролистыванием страницы на iOS и Android](#ios-scrolling)

<a name="mods"></a>
### Модификаторы блока

|Модификатор | Допустимые значения | Способы установки | Описание |
| -----------| --------------------| ------------------| ---------|
| [theme](#mods-theme) | `normal` | BEMJSON | **Обязательное**. Стилевое оформление модального окна. |
| [autoclosable](#mods-autoclosable) | `yes` | BEMJSON | Автоматическое закрытие модального окна. |
| [visible](#mods-visible) | `yes` | JS | Видимость модального окна. |


<a name="fields-short"></a>
### BEMJSON-поля блока

| Поле | Тип  | Описание  |
| ---- | ---- | --------- |
| [zIndexGroupLevel](#fields-zIndexGroupLevel) | Number| Уровень слоя модального окна. Значение по умолчанию: `20`.

## Подробнее
### Модификаторы блока
<a name="mods-theme"></a>
#### Модификатор `theme`

Определяет стилевое оформление модального окна. Кроме того, реализует анимацию открытия/закрытия модального окна на уровне `desktop`.

Способ установки: BEMJSON. <br>
Допустимые значения: `normal`.

```js
{
    block: 'test',
    js: true,
    content: [
        {
            block: 'link',
            mods: {pseudo: 'yes'},
            content: 'Простое модальное окно'
        },
        {
            block: 'modal',
            mods: {theme: 'normal', autoclosable: 'yes'},
            content: [
                'Модальное окно с темой normal.',
                {tag: 'br'},
                {
                    block: 'link',
                    mix: {block: 'test', elem: 'closer'},
                    mods: {pseudo: 'yes'},
                    content: 'Хорошо, закройте.'
                }
            ]
        }
    ]
}
```

_Включите в зависимость блока модификатор `theme` в значении `normal`_.

<a name="mods-autoclosable"></a>
#### Модификатор `autoclosable`

Отвечает за автоматическое закрытие модального окна. Закрывается щелчком мыши вне области блока или нажатием клавиши **Esc**.

Способ установки: BEMJSON. <br>
Допустимые значения:`yes`.

```js
{
    block: 'test',
    js: true,
    content: [
        {
            block: 'link',
            mods: {pseudo: 'yes'},
            content: 'Модальное окно с _autoclosable_yes'
        },
        {
            block: 'modal',
            mods: {theme: 'normal', autoclosable: 'yes'},
            content: 'Можно закрыть по ESC или клику снаружи.'
        }
    ]
}
```

_При использовании опционального модификатора включите его в зависимость блока в значении `yes`_.


<a name="mods-visible"></a>
#### Модификатор `visible`

Управляет видимостью модального окна на странице. Выставляется при открытии модального окна.

Способ установки: JS. <br>
Допустимые значения:`yes`.


<a name="fields"></a>
### BEMJSON-поля блока

<a name="fields-zIndexGroupLevel"></a>
#### Поле `zIndexGroupLevel`

Задает уровень слоя (`z-index`) для каждого модального окна.
Подробнее о работе со [слоями в popup2](https://github.yandex-team.ru/lego/islands/blob/dev/common.blocks/popup2/popup2.ru.md#%D0%A0%D0%B0%D0%B1%D0%BE%D1%82%D0%B0-%D1%81%D0%BE-%D1%81%D0%BB%D0%BE%D1%8F%D0%BC%D0%B8-z-index).

Тип: `Number`. <br>
Значение по умолчанию: `20`.

```javascript
{
    block : 'modal',
    mods : {theme : 'normal'},
    content : 'Содержимое модального окна',
    zIndexGroupLevel : 30
}
```

<a name="features"></a>
### Особенности реализации

* Функциональность модального окна основана на блоке [popup2](../popup2/popup2.ru.md).
* Позиционирование блока выполнено только с помощью CSS. Благодаря этому стало удобнее настраивать расположение блока в зависимости от потребностей сервиса. Перерисовка при изменении размеров происходит автоматически.
* Анимация открытия доступна только на уровне `desktop`. При необходимости можно скопировать на любой уровень у себя в проекте.
* В модальном окне нет функциональности по зацикливанию фокуса. Эта задача будет реализована отдельным блоком `focus-manager` (https://st.yandex-team.ru/ISLCOMPONENTS-1491).

<a name="scrollbars"></a>
### Скрытие ползунков страницы при открытии модального окна

Блок `modal` не имеет встроенного механизма скрытия ползунков на странице. Он не реализован, так как, исходя из
архитектуры приложения, скрытие ползунков – это область ответственности не модального окна, а специального управляющего
блока. Этот блок должен смотреть за открытыми модальными окнами (для этого модальные окна отправляют события в канал `modal`)
и скрывать ползунки. В примере блока `modal` находится [доопределение](https://github.yandex-team.ru/lego/islands/blob/dev/common.blocks/modal/modal.examples/blocks/b-page/b-page.js) для блока `b-page`,
 которое кроссбраузерно реализует эту функциональность. При необходимости, вы можете скопировать это
 доопределение на свой проектный уровень.

<a name="ios-scrolling"></a>
### Проблема с пролистыванием страницы на iOS и Android

Позиционирование модального окна поверх контента страницы  обеспечивает CSS-стиль `position: fixed` блока `modal`.
Но его использование на iOS и Android приводит к появлению неожиданного поведения браузера: иногда при прокрутке
содержимого модального окна прокручивается и страница под ним. Это происходит из-за того, что на iOS и Android
нельзя убрать прокрутку `<body>`. Даже если применить `overflow:hidden`, страница все равно будет прокручиваться.

Мы пробовали решить эту проблему несколькими способами (но у каждого есть свои недостатки):

- При открытии модального окна выставлять `position:fixed; height: <window height>; overflow:hidden` на `<body>`. <br>
_Недостаток_:  текущее положение на странице собьется, поэтому его нужно запоминать и выставлять заново. При этом страница
под модальным окном будет «скакать»: при его открытии она прокрутится в самое верхнее положение, а при закрытии -
вернется в предыдущее.

- Позиционировать модальное окно с помощью `position: absolute` и сделать так, чтобы контент модального окна прокручивался вместе со страницей. <br>
_Недостаток_: в этом случае можно будет прокрутить все модальное окно далеко вниз или вверх и просто «потерять» его.

- Любым доступным способом предотвращать события `touchmove`, которые вызывают прокрутку не контента попапа, а страницы. <br>
_Недостаток_: не найден способ отличать события, вызывающие прокрутку модального окна и события, вызывающие прокрутку
 страницы, т.к. технически они одинаковы.

Универсального решения найти пока не удалось, используйте наиболее подходящий способ для вашей задачи.
Если вам удастся найти такое решение, расскажите про него нам.
