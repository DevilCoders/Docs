## AssetsJsonPlugin
Плагин генерирует файл `assets.json`, в который попадают чанки в виде css/js ассетов. Этот файл нужен, чтобы `TaburetRuntime` мог отдавать нужные ассеты для фичей.

__Важно__: Ожидается, что значение свойства `output.filename` оканчивается на `.[chunkhash].js`.

```js
// где-то в webpack.conf.js
new AssetsJsonPlugin({
    output: './assets.json', // путь, где будет лежать и имя генерируемого файла

    langs: ['be', 'en', 'kk', 'ru'], // набор используемых языков

    freeze: { // контроль фризинга
        path: 'freeze',
    },

    asyncChunkGroupName: 'async', // название группы в которой находятся асинхронные чанки
})
```

### Структура assets.json
```js
{
    main: 'path/to/main-chunk.js',
    entries: {
        'features/Foo/Foo@desktop': {
            // основной чанк с модулями, используемыми только в этой фиче
            main: {
                ru, // номер из массива chunks основного чанка с переводами для "ru"
                en, // номер из массива chunks основного чанка с переводами для "en"
            },
            chunks: [/* номера общих чанков, используемых в фиче */],
        },
    },
    chunks: [
        // 0-ой чанк
        [/* ассеты, из которых состоит чанк 0-ой (кроме асинхронных) */],
        // 1-й чанк
        [/* ассеты, из которых состоит чанк 1-й (кроме асинхронных) */],
        // 2-й...
    ],
    componentsExperiments: {
        'components-experiments/flag/desktop': [/* номера чанков, используемых в эксперименте */],
    }
}
```

### Фризинг

Некоторые собранные js/css-файлы инланятся в `assets.json`, а некоторые js-файлы должны быть доступны как самостоятельный ресурс — это:
1. основной main-чанк, который собирается [MainChunkPlugin'ом](../MainChunkPlugin/MainChunkPlugin.md)
2. main-чанки из entries, которые содержат код специфичный только для конкретной entry. До https://st.yandex-team.ru/SERP-96778 остается возможность выбора - загружать эти чанки инлайном или как отдельный ресурс
3. асинхнронные-чанки, которые загружает webpack-runtime под капотом динамических import-ов

Все перечисленные файлы можно "фризить", т.е. перенести в специальную папку для удобного сервинга.
Фриз разных чанков реализован по-разному:

| Тип статики                | Путь до собранного файла          | Путь до зафриженного файла         |
| -------------------------- | --------------------------------- | ---------------------------------- |
| Оба вида main-чанков       | `build/{relativePath}/{filename}` | `freeze/{filename}`                |
| Асинхронные-чанки          | `build/{relativePath}/{filename}` | `freeze/{relativePath}/{filename}` |

Стили всегда инлайнятся для ускорения первой отрисовки, поэтому фризинг не касается css-файлов.

Фризинг по умолчанию включен, при этом целевой папкой является папка `freeze`.

### Асинхронные чанки
Асинхронные модули подключаются [динамическим import-ами](https://webpack.js.org/guides/code-splitting/#dynamic-imports). Webpack сам обрабатывает эти импорты, и чтобы не поломать пути до асинхронных чанков, их нужно фризить с сохранением относительного пути. Для этого в настройках надо указать в какой группе чанков они находятся. Это группа должна совпадать с группой из плагина [SplitChuncks](https://webpack.js.org/plugins/split-chunks-plugin/). Асинхронные модули не запрещается подключать обычным импортом в других местах проекта (в этом случае модуль попадет в два чанка - в синхронный и асинхронный).
