# @yandex-lego/components 3.7.0

<!-- ЧЕЛОВЕЧЕСКОЕ ВСТУПЛЕНИЕ -->

Изменения, вошедшие в релиз @yandex-lego/components 3.7.0, разделены на группы:

* [минорные изменения](#Минорные-изменения) — задачи, в рамках которых произошло расширение API блоков

Все важные изменения подробно описаны [ниже](#Пояснения).

## Минорные изменения

| Заголовок                                                   | Задача     | PR       |
| :---------------------------------------------------------- | :--------- | :------- |
| [Modal.ts: реализовать механизм фиксации фокуса](#ISL-7501) | [ISL-7501] | [#21308] |

## Пояснения

<a name="ISL-7501"></a>
### [Modal.ts: реализовать механизм фиксации фокуса][ISL-7501]

Основное изменение связано с добавлением доступности и возможности удержания фокуса внутри содержимого модального окна (компонент `Modal`), согласно [WAI-ARIA](https://www.w3.org/TR/wai-aria-practices-1.1/#dialog_modal). 

Далее, термин `элемент табуляции` будет относится к элементу, у которого значение атрибута `tabIndex` больше или равно нулю.

**Принцип работы**

- при открытии модального окна, фокус переходит на первый элемент табуляции.
- при нажатии на клавишу `Tab`:
  - фокус перемещается на следующий элемент табуляции
  - если фокус находится на последнем элементе, то фокус перемещается на первый элемент табуляции
- при нажатии на клавишу `Shift+Tab`:
  - фокус перемещается на предыдущий элемент табуляции
  - если фокус находится на первом элементе, то фокус перемещается на последний элемент табуляции
- при закрытии модального окна фокус возвращается на элемент, который вызвал его.

> Важно! Данный функционал включен по-умолчанию, так как соответствует тому, как должны работать модальные окна согласно спецификации доступности. Для изменения логики работы смотрите ниже в разделе API модального окна.

### Modal

#### ARIA-атрибуты

Добавлен атрибут `role` со значением `dialog` и `aria-modal` со значением `true`.

#### API

В компонент `Modal` были добавлены следующие свойства, которые позволяют управлять поведением фокуса внутри модального окна:

- `trapFocus` - включает или отключает удержание фокуса внутри модального окна. По-умолчанию, значение `true`.

- `autoFocus` - выставляет фокус на первый элемент табуляции, после открытия модального окна. По-умолчанию, значение `true`.

- `restoreFocus` - включает или отключает восстановления фокуса при закрытии модального окна. По-умолчанию, значение `true`.

- `restoreFocusRef` - ссылка на элемент, на который будет возвращен фокус после закрытия. По-умолчанию запоминается `document.activeElement` в момент открытия модального окна.

Примеры использования смотрите в [документации](https://lego.yandex-team.ru/lego-components/components/modal/examples).

### useFocusTrap

Был добавлен новый React-хук, который реализует логику по удержанию фокуса внутри DOM-элемента. Используется внутри компонента `Modal`.

**Основные возможности**

- удержание фокуса внутри DOM-элемента
- автоматическое перемещение фокуса на первый элемент табуляции при включении
- восстановление фокуса на элементе (триггере) при выключении

**Пример использования**

```tsx
import { useFocusTrap } from '@yandex-lego/components/useFocusTrap';

const Modal = (props) => {
  const { visible, restoreFocusRef, children } = props;
  const scopeRef = useRef(null);

  useFocusTrap({
    enabled: visible,
    scopeRef,
    autoFocus: true,
    restoreFocus: true,
    restoreFocusRef,
  });

  return <div ref={scopeRef}>{children}</div>
}
```

[ISL-7501]: https://st.yandex-team.ru/ISL-7501
[#21308]: https://github.yandex-team.ru/search-interfaces/frontend/pull/21308
