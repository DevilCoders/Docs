# @yandex-lego/components 3.8.0

<!-- ЧЕЛОВЕЧЕСКОЕ ВСТУПЛЕНИЕ -->

Изменения, вошедшие в релиз @yandex-lego/components 3.8.0, разделены на группы:

* [минорные изменения](#Минорные-изменения) — задачи, в рамках которых произошло расширение API блоков

Все важные изменения подробно описаны [ниже](#Пояснения).

## Минорные изменения

| Заголовок                                                                          | Задача     | PR       |
| :--------------------------------------------------------------------------------- | :--------- | :------- |
| [useOverlay.ts: Перенести логику из LayerManager в отдельный реакт-хук](#ISL-9741) | [ISL-9741] | [#21450] |

## Пояснения

<a name="ISL-9741"></a>
### [useOverlay.ts: Перенести логику из LayerManager в отдельный реакт-хук][ISL-9741]

Компонент `LayerManager` помечен как устаревший и будет удален в следующем мажорном релизе. Вместо него теперь следует использовать React-хук `useOverlay`.

### useOverlay

Добавлен новый React-хук `useOverlay`, который содержит в себе логику, которая была в компоненте `LayerManager`. Благодаря этому в дереве компонентов `React` теперь не содержится лишняя информация в виде компонента `LayerManager`, а использование данного функционала стало проще.

**Пример использования**

```tsx
import React, { useRef, useState, useMemo } from 'react';
import { useOverlay, OnClose } from '@yandex-lego/components/useOverlay';

export interface ModalProps {
  visible?: boolean;
  onClose?: OnClose;
}

const Modal: FC<ModalProps> = (props) => {
  const { visible, onClose, children } = props;
  const hostRef = useRef(null);

  useOverlay({ visible, onClose, essentialRefs: [hostRef] });

  return <div ref={hostRef}>{children}</div>;
}
```

Также были добавлены некоторые оптимизации подписок на DOM-события. Раньше каждый экземпляр подписывался на глобальные события документа.
Теперь подписка происходит в момент, когда в стек добавляется первый слой, а отписка - когда удаляется последний слой из стека.

[ISL-9741]: https://st.yandex-team.ru/ISL-9741
[#21450]: https://github.yandex-team.ru/search-interfaces/frontend/pull/21450
