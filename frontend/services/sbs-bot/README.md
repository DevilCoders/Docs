# tg-bot-sbs

## Важные ссылки

Проект в YDeploy: https://yd.yandex-team.ru/projects/sbs
Ключи в секретнице: https://yav.yandex-team.ru/secret/sec-01fmtyndppy60n8mpb379nkey8/explore/versions

Production бот: https://t.me/yandex_sbs_bot
Testing бот: https://t.me/SbsNewTestBot

[По всем попросам пишите на sbs-dev](mailto:sbs-dev@yandex-team.ru)

## Разработка

### Docker

Бот разворачивается на сервере в виде Docker образа из корпоративного регистра (обязательно нужно использовать теги т.к. ydeploy не поддерживает разворачивание подов из latest). Собрать образ можно командой:
```
npm run ci:deploy:master
```

### Локальный запуск

Необходимо прописать 1 обязательную переменную окружения (взять из секретницы) в файл `.env`:
```
TG_BOT_KEY=ЗДЕСЬ_КЛЮЧ
```

Далее запустить:
```
npm run start
```

## Что умеет бот

Картинкой:
- [/start](https://jing.yandex-team.ru/files/nazarkin-roma/bot1.0a882c5.jpg)
- [/invite](https://jing.yandex-team.ru/files/nazarkin-roma/bot4.c0e63fa.jpg)
- [/my_invites](https://jing.yandex-team.ru/files/nazarkin-roma/bot5.4e1dd7a.jpg)

### /start

- Приветствует на входе
- Проверяет ник пользователя по базе стаффа, если это яндексоид, то пароль не просим
- Спрашивает пароль
- Предлагает прислать новое задание

### /help

- Рассказывает чем мы тут вообще занимаемся
- Объясняет как приглашать новых пользователей

### Раз в час

- Проверяет ли рабочее сейчас время
- Находит пользователей, у которых не было активности последние 30 минут
- Не присылать новую задачу если на прошлую не было ответа
- Рассылает им новые задания, если они есть

### Выбор одного из вариантов в задании

- Реагирует на выбор пользователя
- Спрашивает комментарий
- Сохраняет комментарий
- Проверяет, есть ли что ещё прислать
- Если есть — благодарит и предлагает прислать следующую работу
- Если нет — просто благодарит

### Следующая работа

- Реагирует на запрос следующей работы
- Присылает следующую
- Если ничего нет — извиняется и говорит, что пришлёт позже

### /invite

- Работает только для админов
- Создает новый пароль (желательно удобочитаемый) для входа, привязанный к id текущего пользователя
- Предупреждает пользователя, что пароль одноразовый
