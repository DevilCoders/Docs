# Код фронта страницы "О рекламодателе"
- [Как запустить](#start)
- [Процесс разработки](#development)
- [Релизы](#releases)
- [Полезные команды](#helpers)

## <a name="start"></a>Как запустить
- Для запуска локального сервера выполнить `npm start` и перейти в http://localhost:3000/?test-example или на http://localhost:3000/ для просмотра 404 страницы
- Для запуска локальной Гермионы выполнить `npm run hermione`
- Для сборки продового варианта в папку build выполнить `npm run build`

Можно запустить `http://localhost:3000/index.html?тут-кликовая-абра-кадабра`, и посмотреть как страница работает на реальных данных. Запрос за данными будет спроксирован на тестовое API

## <a name="development"></a>Процесс разработки

```shell script
arc pull trunk
arc checkout -b feature_branch_name.DIRECT-123 trunk
...
arc commit -a -m "feat(advertiser-page): DIRECT-123 feature branch short description"
arc push -u users/<staff_login>/feature_branch_name.DIRECT-123
arc pr create
```
В имени коммита необходимо указывать правильный тип задачи, чтобы версия сервиса поднималась автоматически.

- `feat` - для задач по реализации нового функционала
- `fix` - для багфиксов
- `docs` - для изменений, затрагивающих только документацию
- `test` - для изменений, затрагивающих только тесты
- `chore` - для изменений, затрагивающих только сборку
- `refactor` - для рефакторингов

## <a name="releases"></a>Релизы
1) Для отведения релиза надо перейти на [специальную страницу проекта](https://a.yandex-team.ru/projects/frontend/ci/releases/timeline?dir=frontend%2Fservices%2Fadvertiser-page&id=release) в Аркануме и нажать на кнопку "Run release" в правом верхнем углу.

2) После нажатия кнопки процесс длящийся около 5 минут создаст задачу в трекере в очереди [SEAREL](https://st.yandex-team.ru/SEAREL/order:updated:false/filter?resolution=notEmpty()&components=101481), приаттачит все задачи с момента последнего успешного релиза, и запустит билд.
Ссылка на билд будет в комментариях. Как только сборка завершиться надо убедиться что новая статика собрана просмотрев отчет Deploy.

3) После того как сборка пройдет, надо:
- В сборке релиза в секции "Deploy: release" в логе step__script.log найти адрес загрузки файла index.html
- Проверить что он доступен, открыв его в браузере
- Заменить в [тестовом балансере](https://nanny.yandex-team.ru/ui/#/awacs/namespaces/list/uac.test.yandex.ru/upstreams/list/test-advertiser-info/show/) редирект на новый файл
- После выкатки проверить как оно работает на тестовом стенде `https://uac.test.yandex.ru/wizard/advertiser_info/тут-кликовая-абра-кадабра`

4) После тестирования надо создать задачу [в сендбоксе](https://sandbox.yandex-team.ru) с типом `ADVERTISER_PAGE_RELEASE` или склонировать [эту](https://sandbox.yandex-team.ru/task/1148676779/view).
В поле `Source url` надо указать полный путь (включая протокол) к файлу index.html из сборки. Запуск задачи заменит файл на проде. 

Откаты релизов производятся выполнением 4 пункта с указанием нужной версии файла.

## <a name="helpers"></a>Полезные команды

Для фикса стилей надо выполнить эту команду в каталоге монорепы фронта (на два уровня выше корня текущего проекта):

`node_modules/.bin/stylelint services/advertiser-page/src/**/*.scss --fix`

## Полезные знания
- В монорепе фронтенда некоторые npm пакеты нельзя обновить до актуальных версий. Список этих пакетов и требуемых версий можно подсмотреть здесь https://a.yandex-team.ru/arc/trunk/arcadia/frontend/.depslint.json
- В проекте не используется `@babel/preset-env`, ради скорости пересборки. Поэтому если у вас не проходят тесты в гермионе (пустая страница), значит вы используете что-то модное, например, `data?.text` или `class BlaBla {}`.
- babel используется только для транспиляции TypeScript и для JSX трансформации.
- Для Гермионы на тестовом стенде собирается сторибук, и загружается в статику. Дальше гермиона работает только со статичными страницами. Отдельный сервис не поднимается.
- Пакет `copy-webpack-plugin` 10 версии бросает seg fault. Поэтому его стоит обновлять отдельно, проверяя работает ли сборка. Локально или на ci не имеет значения - поведение одинаковое.
