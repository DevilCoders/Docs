# Ресурсы страницы
## Что это такое?
Данный модуль призван сосредоточить в себе логику подготовки загружаемых ресурсов страницы и предоставлять слою, ответственному за шаблонизацию, список ресурсов для вставки на страницу.

Ранее вся эта логика лежала в коде шаблонизации и это было удобно до тех пор, пока она не разрослась и стала неконтролируема. Данное решение позволяет для каждого ресурса изолировать логику вставки на страницу, формирования контента, а так же облегчить покрытие тестами.

Если вам нужно добавить какой-либо ресурс на страницу, то это нужно делать именно тут, ознакомившись с [инструкцией](#Инструкция)

## Какие есть ресурсы?
На текущий момент модуль отдаёт только `scripts` (для скриптов затащили пока только postsearch и fullsearch) и `styles` но сам механизм достаточно абстрактен, чтобы описать любой ресурс страницы, будь то `svg` или ссылка для предзагрузки. Достаточно завести поддиректорию с новым типом ресурсов и реализовать метод, отдающий этот новый тип, по [аналогии](https://github.yandex-team.ru/serp/turbo/tree/dev/core/pageResources/index.ts#L61-L76) с текущими.

Так же бывает необходимо произвести просто какой-то сайд эффект, чтобы добавить ваш скрипт/бандл через уже имеющиеся механизмы, типа `assets.pushBundle()`. На текущий момент предлагается это делать непосредстенно перед отдачей ресурсов. В дальнейшем будет вынесено в отдельную абcтракцию.

## Какие есть возможности?
Любой ресурс должен наследоваться от абстрактного класса `PageResourceGenerator` и реализовать его методы. Методы позволяют контроллировать необходимость отдачи ресурса и его контент.

Методы для реализации:
* `shouldInclude(context: IAdapterContext): boolean` — предикат, говорящий о необходимости включения данного ресурса на страницу.
* `getContent(context: IAdapterContext): IPageResource[]`— метод, который отдаёт список ресурсов.

Для передачи всей необходимой информации шаблонизатору предлагается использовать интерфейс `IPageResource`, который позволяет достаточно описать характеристики ресурса, который вы отдаёте, а так же передать необходимые мета данные:

```typescript
export interface IPageResource {
    /**
     * Имя ресурса
     */
    name: string;
    /**
     * Тип ресурса:
     * внешний (должен быть загружен после отдачи html)
     * инлайн (отправляется вместе c html)
     */
    type: EPageResourceType;
    /**
     * Контент бандла, может быть строкой (css, js) или URL
     */
    content: string;
    /**
     * Тип загрузки ресурса, если он является внешним
     */
    loadingType?: ELoadingType;
    /**
     * Идентификатор ресурса для счётчиков
     */
    rcid?: string;
    /**
     * Объект с любой дополнительной информацией.
     * В текущий момент весь этот объект при шаблонизации прокидывается в атрибуты ресурса.
     */
    meta?: Record<string, unknown>
}
```

## Инструкция
1. Создать файл с расширением `ts` в директории `src/core/resources/resourceType`.
2. В созданом файле реализовать абстрактный класс `PageResourceGenerator`
3. Ипортировать получившийся класс в `src/core/resources/resourceType/index.ts` и передать его экземпляр в экспортируемый список

Например, необходимо добавить на страницу какой-то скрипт, и он необходим только на стадии `presearch`. Если следовать инструкции, то получим следующее:
```typescript
// src/core/resources/scripts/myFancyScript.ts
import { IAdapterContext } from '@yandex-turbo/types/AdapterContext';

import { PageResourceGenerator, IPageResource, EPageResourceType } from '../../types';

export class MyFancyScript extends PageResourceGenerator {
    shouldInclude({ renderingType }: IAdapterContext): boolean {
        return renderingType === 'presearch';
    }

    getContent({ assets }: IAdapterContext): IPageResource[] {
        return [
            {
                name: 'my-fancy-script',
                type: EPageResourceType.inline,
                content: 'console.log("Hello from fancy script!!")'
            }
        ]
    }
}

// src/core/resources/scripts/index.ts
import { MyFancyScript } from './myFancyScript';

export default [
    // .... какие-то ресурсы
    new MyFancyScript(),
    // .... какие-то ресурсы
]
```
