# Реакция на пользовательские действия / Функциональное взаимодействие блоков

Для реализации реакции на события (например, пользовательские действия) у интерактивных компонентов (например, кнопка) существует специальное поле `on`, в котором можно указать события и необходимые операции, которые будут выполняться в ответ на эти события. Например,
```json
"on": {
    "_eventname_": [{
        "id": "user-defined-id",
        "method": "block-method"
    }]
},
```
### Формат описания обработчиков событий
 * Имя поля (`_eventname_`) — название необходимого события
 * Значение этого поля — массив действий выполняемых на это событие. Каждый объект этого массива — объект-описатель, с двумя полями:
   * `id` - идентификатор блока (в примере это `"user-defined-id"`), который будет задействован
   * `method` - метод класса этого блока (в примере `"block-method"`)

Методы, которые можно использовать в поле `method`, являются предопределенными для каждого блока. Например, у блока `modal` методы `open` и `close`. Читайте документацию по каждому блоку :)
Имена событий (`_eventname_`) для указания действий определяются библиотекой [bem-core](https://ru.bem.info/platform/libs/bem-core/). Например, у блока `button` определено событие `click`, а у блока `form` — `submit`.

Идентификатор блока (`id`) - валидный идентификатор DOM-узла, задаётся через поле `id` блоков.

Если при реализации действия не будет найден блок с указанным `id`, или найденный узел будет несоответствующего класса, выполнение действия будет отменено.

## Простой пример с показом галереи

Чтобы сделать галерею изображений, появляющуюся при нажатии на кнопку, можно применить блок `modal` для размещения галереи. У `modal` есть два публичных метода `open` и `close`, которые и нужно использовать. Чтобы можно было вызывать методы блока, необходимо прикрепить к нему идентификатор, по которому потом можно будет ссылаться на него.

```json
{
    "content_type": "modal",
    "id": "gallery-modal",
    "content": {
        "content": [{
                "content_type": "gallery",
                "items": [
                    {}
                ],
                "caption": "..."
            }
        ]
    }
}
```

Теперь в нужном месте на странице нужно расположить кнопку следующего содержания

```json
{
    "content_type": "button",
    "text": "Открыть галерею",
    "on": {
        "click": [{
            "id": "gallery-modal",
            "method": "open"
        }]
    }
}
```

То есть при клике (`click`) по кнопке будет открываться (`open`) модальное окно с идентификатором `gallery-modal`.

## Пример формы обратной связи

Чтобы сделать всплывающую форму обратной связи необходимо аналогично расположить её в блоке `modal` и открывать по нажатии на кнопку.


```json
{
    "content_type": "button",
    "text": "Подписаться",
    "on": {
        "click": [{
            "id": "form-modal",
            "method": "open"
        }]
    }
},
{
    "content_type": "modal",
    "id": "form-modal",
    "content": {
        "content": [{
            "content_type": "form",
            "content": {
            }
        }]
    }
}
```

Кроме этого нужно, чтобы при отправке формы модальное окно закрывалось автоматически. Для этого необходимо в обработчике события `submit` формы выполнять закрытие модального окна.
Также для удобства можно на саму форму добавить кнопку, позволяющую закрыть форму не выполняя действий. Вот как это выглядит в сборе

```json
[
    {
        "content_type": "button",
        "text": "Подписаться",
        "on": {
            "click": [{
                "id": "form-modal",
                "method": "open"
            }]
        }
    },
    {
        "content_type": "modal",
        "id": "form-modal",
        "content": {
            "content_type": "form",
            "on": {
                "submit": [{
                    "id": "form-modal",
                    "method": "close"
                }]
            },
            "content": {
                "content_type": "button",
                "on": {
                    "click": [{
                        "id": "form-modal",
                        "method": "close"
                    }]
                },
                "text": "Закрыть"
            }
        }
    }
]
```
