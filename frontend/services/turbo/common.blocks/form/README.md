## Блок формы

@gemini()

Форма строится на основе `fieldset` - контейнера, в который помещаются строки с контроллами формы (`form-line`) и другие блоки.

Пример формы с одним полем ввода и кнопкой:

```json
{
    "content_type": "form",
    "content": {
        "content_type": "fieldset",
        "content": [
           {
               "content_type": "form-line",
               "content": [
                   {
                       "content_type": "input",
                       "name": "name",
                       "placeholder": "Иван Петров",
                       "type": "text",
                       "label": "Ваше имя"
                   }
               ]
           },
           {
               "content": {
                   "content_type": "row",
                   "content": [
                       {
                           "content_type": "button",
                           "text": "Отправить",
                           "type": "submit"
                       }
                   ]
               }
           }
        ]
    }
}
```

В `form-line` могут лежать следующие виды контроллов:

Поле ввода (input):

```json
{
    "content_type": "form-line",
    "content": [
        {
            "content_type": "input",
            "name": "name",
            "placeholder": "Иван Петров",
            "type": "text",
            "label": "Ваше имя"
        }
    ]
}
```

Селект:

```json
{
    "content_type": "form-line",
    "content": [
        {
            "content_type": "select",
            "name": "city",
            "label": "Город",
            "options": [
                {
                    "text": "Москва",
                    "value": "Москва"
                },
                {
                    "text": "Минск",
                    "value": "Минск"
                },
                {
                    "text": "Казань",
                    "value": "Казань"
                },
                {
                    "text": "Новосибирск",
                    "value": "Новосибирск"
                }
            ]
        }
    ]
}
```

Поле многострочного ввода (`textarea`):

```json
{
    "content_type": "form-line",
    "content": [
        {
            "content_type": "textarea",
            "name": "comment",
            "label": "Вопрос/комментарий"
        }
    ]
}
```

Также в качестве дополнительных блоков в форме может лежать пользовательское соглашение. Оно добавляется элементом в `fieldset`.

Пример формы с пользовательским соглашением:

```json
{
    "content_type": "form",
    "content": {
        "content_type": "fieldset",
        "content": [
           {
               "content_type": "form-line",
               "content": [
                   {
                       "content_type": "input",
                       "name": "name",
                       "placeholder": "Иван Петров",
                       "type": "text",
                       "label": "Ваше имя"
                   }
               ]
           },
           {
               "content_type": "agreement",
               "type": "short",
               "full_text": {
                   "title": "Соглашение",
                   "text": [
                       {
                           "content_type": "paragraph",
                           "text": [
                               "Нажимая \"Отправить\", даю согласие ",
                               "ООО «ЯНДЕКС» , ИНН 7736207543",
                               " на обработку введенной информации в целях, указанных в анкете, в порядке, предусмотренном политикой конфиденциальности ",
                               "",
                               " компании. Анкета создана с использование ресурсов Яндекса, которые также предоставляют пользователя возможность автозаполнения анкет, в связи с чем также даю согласие ООО «Яндекс» на использование указанной в анкете информации в целях исполнения ",
                               {
                                   "content_type": "link",
                                   "text": "Пользовательского соглашения",
                                   "url": "https://yandex.ru/legal/rules/"
                               },
                               "."
                           ]
                       }
                   ]
               },
               "content": [
                   "Нажимая \"Отправить\", даю согласие ",
                   "ООО «ЯНДЕКС»",
                   " на обработку введенной информации и принимаю условия ",
                   {
                       "content_type": "link",
                       "text": "Пользовательского соглашения",
                       "url": "https://yandex.ru/legal/rules/"
                   },
                   " ООО «Яндекс»"
               ]
           },
           {
               "content": {
                   "content_type": "row",
                   "content": [
                       {
                           "content_type": "column",
                           "content": {
                               "content_type": "button",
                               "text": "Назад",
                               "action": "prev"
                           }
                       },
                       {
                           "content_type": "column",
                           "content": {
                               "content_type": "button",
                               "text": "Отправить",
                               "type": "submit",
                               "goal": "g3"
                           }
                       }
                   ]
               }
           }
        ]
    }
}
```

### Валидация

Блоки `checkbox`, `input`, `select` и `textarea` поддерживают валидацию.
Валидация – это массив правил. Правила отрабатываются в порядке объявления их в массиве.
Валидация срабатывает на изменение значения поля и при отправке формы.
При невыполнении правила валидации элемент выделяется красной рамкой, под элементом появляется подпись первого непрошедшего валидацию правила (валидатор `require` по-умолчанию не имеет подписи).
Если при отправке формы валидация завершается неуспешно, форма не отправляется, а страница прокручивается до самого верхнего элемента формы, не прошедшего валидацию.

Пример валидации элемента формы:

```json
{
    "content_type": "input",
    "name": "phone",
    "placeholder": "7-XXX-XXX-XX-XX",
    "type": "tel",
    "label": "Телефон",
    "validation": [
        {"phone": true},
        {"required": true},
        {"max-length": 10}
    ]
}
```

Поддерживаются следующие валидаторы:

- `require` – обязательное поле (boolean)
- `phone` – телефон (boolean)
- `email` – электронный адрес (boolean)
- `min-length` – минимальная длина значения поля (number)
- `max-length` – максимальная длина значения поля (number)
- `min-value` – минимальное значение числового поля (number)
- `max-value` – максимальное значения числового поля (number)

Если поле имеет простую валидацию, можно использовать короткую запись:

```json
"validation": {
    "phone": true
}
```

Если подпись ошибки по-умолчанию не устраивает, можно передать свою:

```js
"validation": [
    {
        "max-length": {
            "text": "Телефоны не бывают такими длиннными",
            "value": 10
        }
    },
    {
        "require": {
            "text": "Обязательное поле",
            "value": true
        }
    }
]
```

Для boolean полей `value: true` указывать не обязательно

### Preset

Создает формы определенной структуры.

##### Search

Форма поиска, используется в десктопной шапке. Создает один инпут, принимающий поисковый запрос.
Форма с пустым запросом не отправляется.

Кроме основных параметров формы на вход ожидает получить `action` следующего вида:

```json
{
    "action": "https://www.povarenok.ru/recipes/search?name={text}&a=b"
}
```

где `{text}` при запросе заменится значением ввода пользователя. Если форма не содержит в качестве
значения параметра `{text}`, то будет поисковый инпут отрисован не будет.

Если форма была передана с методом `POST`, то параметры `name` и `a` из примера будут переданы
в качестве данных формы.

Дополнительно в параметрах можно указать

```json
{
    "placeholder": "Поисковая подсказка"
}
```

иначе будет установлено значение по умолчанию: `Поиск...`
