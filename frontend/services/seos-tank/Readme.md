# SEOS-tank

Сервис для нагрузочного тестирования сервиса SEOS

## Разработка

```bash
# Локальный запуск
npm run dev
```

## Сборка проекта

```
npm run build
```

## Использование

Используем по следующей схеме:

-   Поднимаем SEOS с `NODE_ENV=loadtest` (можно локально, можно в облаке)
-   Поднимаем SEOS-tank (проще локально, если железо потянет)
-   Дергаем одну из ручек для стрельб (ручки и формат данных описаны ниже)
-   После стрельб сгенерируется файл с данными о стрельбах (тайминги запросов) в папку `./output`
-   Эти данные можно преобразовать в табличку командой `node ./build/bin/readLogs filename.json`. (скрипт поищет `filename.json` в `./uploads` и выведет таблицу)

## Ручки

### Нагрузка на количество rps в одну комнату

1 комната, константное количество пользователей (зависит от количества воркеров) + 1 на прослушивание ответов
Создается одина комната, к ней подключаются пользоватли, после в сервис шлются запросы на изменение документа в этой комнате (вставка / удаление текста) и смещение курсора
Количество запросов растет со `start` до `end`

```
POST /fire/oneDocument

{
    url: string, // url до seos с портом и схемой 'http://seos.net:8080'
    start: number, // Начальное значение запросов в секунду
    end: number, // Конечное значение запросов в секунду
    step: number, // Шаг увеличения количества запросов в секунду
    msec?: number, // 1000 по-умолчанию. Время на выполнение каждого шага
    workers?: number, // 4 по-умолчанию. Количество воркеров с которых будет подаваться нагрузка
}
```

### Нагрузка на количество пользователей в одной комнате

1 комната, растущее количество пользователей от `start` до `end`
Создается одина комната, и танк начинает подключать к этой комнате пользователей, каждый из которых генерирует постоянныю нагрузку в `requests` rps.

```
POST /fire/manyUsers

{
    url: string, // url до seos с портом и схемой 'http://seos.net:8080'
    start: number, // Начальное значение количества пользователей
    end: number, // Конечное значение количества пользователей
    step: number, // Шаг увеличения количества пользователей
    requests: number, // rps, который генерирует каждый пользователь
    msec?: number, // 1000 по-умолчанию. Время на выполнение каждого шага
    workers?: number, // 4 по-умолчанию. Количество воркеров с которых будет подаваться нагрузка
}
```

### Нагрузка на количество комнат с 2-мя пользователями в каждой

Растущее количество комнат от `start` до `end`
Танк создает комнаты на каждый шаг и подключает к ней 2-ух пользователей, которые генерируют постоянную нагрузку в `requests` rps

```
POST /fire/manyRooms

{
    url: string, // url до seos с портом и схемой 'http://seos.net:8080'
    start: number, // Начальное значение количества комнат
    end: number, // Конечное значение количества комнат
    step: number, // Шаг увеличения количества комнат
    requests: number, // rps, который генерирует каждый пользователь
    msec?: number, // 1000 по-умолчанию. Время на выполнение каждого шага
    workers?: number, // 4 по-умолчанию. Количество воркеров с которых будет подаваться нагрузка
}
```
