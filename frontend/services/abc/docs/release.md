# Релиз

0. Предупредить тестирование заранее, что скоро будет релиз, и какие задачи в него попадут: ему нужно будет выделить время на проверку. Обычно — сказать про это на стендапе.

1. Собрать релиз. ([Описание процесса в общей доке монорепы](https://a.yandex-team.ru/arc_vcs/frontend/docs/how-to/arc/setup-releases.md#otvedenie-reliza-iz-ci))
   1. Для этого нужно перейти на [страницу](https://a.yandex-team.ru/projects/frontend/ci/releases/timeline?dir=frontend%2Fservices%2Fabc&id=release).
   2. Нажать в правом верхнем углу страницы кнопку "Run release"
   3. Выбрать флоу (release-flow / hotfix-flow)

2. Что произойдет при отправке формы:
   1. Отведется релизная ветка вида `releases/frontend/abc/v<version>`.
   2. На событие пуша ветки в трендбоксе автоматически запустятся проверки и выкатка в [preprod](https://abc-preprod.test.yandex-team.ru)
   3. Создастся релизный тикет в очереди [SEAREL](https://st.yandex-team.ru/SEAREL). [Список релизных задач в Трекере](https://st.yandex-team.ru/SEAREL/order:updated:false/filter?resolution=empty()&components=81335)
   4. После завершения всех проверок, в релизный тикет добавится комментарий с их статусами.

   - [Про работу с релизными ветками и хотфиксами](https://docs.yandex-team.ru/devtools/src/arc/branches#release-branches)

3. Проверить, что все проверки прошли успешно, релиз задеплоился в [preprod](https://abc-preprod.test.yandex-team.ru). 

4. Проверить все задачи попавшие в релиз:
   - Перевести тикет в статус `Ready for Regress` / `Готово к регрессу` ([Воркфлоу релизных тикетов](https://wiki.yandex-team.ru/test/serp/searelworkflow/)).
   - Призвать тестирование в комментарий в релизном тикете и попросить одобрить релиз.
   - Тестировщик проверяет тикеты, попавшие в релиз, в препроде. Необходимая тщательность проверки определяется для каждого релиза отдельно. При необходимости можно задеплоить в unstable и проверить продакшен версию.

5. Если нашлись баги, вмержить фикс в `master` и отвести релиз заново. При этом старый релиз закроется как «Некорректный».

6. Если багов нет, перевести задачу в статус `Ready for Production`.

7. Задеплоить продакшн ручками в Deploy протестированную на препроде версию:
   1. Находим и копируем значение поля `tag` из диффа последней ревизии на [препроде](https://deploy.yandex-team.ru/stages/tools_abc-www_preprod/history)
   2. Заходим в [конфиг прода](https://deploy.yandex-team.ru/stages/tools_abc-www_production/config/du-front/box-front), нажимаем `edit`, меняем тег версии на новый, жмем `update`, оставляем описание релиза, жмем `Save as draft`.
   3. Призываем в комментарий в релизном тикете коллег (можно продублировать в чат) и просим подтвердить и засабмитить созданный деплой-тикет во вкладке [Deploy tickets](https://deploy.yandex-team.ru/stages/tools_abc-www_production/deploy-tickets).

8. После того, как задеплоился продакшн, закрыть связанные задачи и перевести релизный тикет в статус «Закрыт». Без этого не запустится нужная Sandbox-таска, не выставится релизный тег, без которого будет неправильно формироваться Changelog.
