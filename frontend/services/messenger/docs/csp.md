# CSP

## Генерация

Необходимо генерировать набор csp правил для 3 окружений:

- разработка (для локальной разработкой под темпларом)
- тестинг (для бет)
- продакшен (для прода)

А в рамках проектов, еще для разных окружений - бекендов:

- продакшен (для внешнего прода)
- тестинг (для использования внутреннего тестинга бекенда)
- альфа (для использования альфа версии бекенда, если он есть)

## Сборка

Собирается все это плагном в webpack:

```
require('../../config/webpack/plugins/csp')('Путь до генерируемого CSP.json', { объект с окружениями }),
```

Путь до генерируемого csp.json обычно хранится в paths.js в поле csp.
Это позволяет подставлять csp на сервере. Обычно он выглядит так: ```'serviceName/csp.json'```

Объект с окружениями можно реквайрить оттуда, где он будет собираться или лежать сразу собранный.
Обычно он выглядит так:

```
{
    production: {
        production: '......',
        development: '......',
        testing: '......'
    },
    testing: {
        production: '......',
        development: '......',
        testing: '......'
    },
    development: {
        production: '......',
        development: '......',
        testing: '......'
    }
}
```

## Использование

Сейчас есть проблема с использованием заголовков - они не всегда
проксируются аппхостом. Например, в залипаниях.

Поэтому сейчас все CSP правила будут поставляться только через
HTML. Для этого в теле html файла, необходимо вставить строчку:
```<meta http-equiv="Content-Security-Policy" content="%CSP_CONTENT%">```
