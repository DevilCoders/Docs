# Mockey

![](mockey_logo.png)

Инструмент для локального мокирования http-запросов. Позволяет обновлять моки без пересборки основного приложения. Представляет из себя отдельное облегченное (на java, без зависимостей) приложение, которое устанавливается на устройство рядом с основным приложением.

## Как мне замокировать запрос

1. Создать новый файл формата `.json` в папке с `raw` ресурсами (`src/main/res/raw/`);
2. Описать матчер для запроса:
   ```
   {
      "enabled": true, // Включен ли данный мок. Позволяет отключать мок не удаляя файл. Опциональный параметр, по умолчанию true.
      "matcher": {
        "url-regex": "https://ipa.market.yandex.ru/api/v1/.*", // Регулярное выражение для выбора запросов для мокирования по url. Обязательный параметр.
        "body-regex": ".*apps_home_page.*" // Регулярное выражение для выбора запросов для мокирования по body. Опциональный параметр.
      },
      ..
   }
   ```
3. Описать мок ответа:
   ```
   {
      ..,
      "response": {
        "code": 200, // HTTP-код ответа от сервера. Опциональный параметр, по умолчанию 200.
        "message": "200 OK", // HTTP-сообщение от сервера. Опциональный параметр, по умолчанию 200 OK.
        "body": { .. } // Тело ответа от сервера. Опциональный параметр, по умолчанию null.
      }
   }
   ```

## Как мне включить мокирование

1. Убедиться, что установлена `qa` сборка основного приложения;
2. Включить в настройках разработчика опцию "Подменять запросы через Mockey";
3. Вызвать из терминала команду `sh mockey-install`;
4. Дождаться завершения работы команды.
При успешном перехвате запроса на устройстве появится уведомление с обезьянкой и описанием перехваченного запроса.
   
## Как мне выключить мокирование

Изменить свойство `enabled` в матчере на значение `false` либо вызвать из терминала команду `sh mockey-uninstall`.