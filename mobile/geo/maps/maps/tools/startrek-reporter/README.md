# Startrek reporter

Startrek reporter имеет 2 основные функции:
- отписывается в ticket'е о выложенной сборке на beta
- переводит тикет в статус "Готово к тестированию"

Startrek reporter запускается в двух режимах:

- в конце сборки, чтобы 
  - отписаться в тикете, указав ссылку на beta
  - в случае, если все сборки в pr'е готовы, то перевести тикет в тестирование
- в [специальной конфигурации](https://teamcity.yandex-team.ru/buildConfiguration/MobileNew_Monorepo_Navi_Infra_StartrekReport),
  запускаемой по кнопке "Ревью пройдено"/"Review completed" для поддержания тэга "wait\_review", где происходит только попытка перевести тикет в тестирование

## Не переводить автоматически в тестирование

Startrek-reporter'у можно указать, чтобы тикет не переводился автоматически в тестирование.
Для этого достаточно любую из строк "forbid testing" или "handbrake" (капитализация не важна) написать в одно из нескольких мест:
- в описание pr'а
- в комментарий в pr'е, при этом комментарии в статусах "resolved" и "dropped" игнорируются

В этом случае программист сам является ответственным за перевод в тестирование.

Примечание: на данный момент строка "wait\_review" тоже работает как "forbid testing" или "handbrake", но это деталь реализации, завязываться на это нельзя, это может поменяться в любой момент.

## Запуск

Считается, что для запуска из тикета будет использоваться только конфигурация выше.
Чтобы запустить startrek-reporter после сборки, нужно ему передать 3 аргумента:
- `--reviewId` - числовое id pr'а
- `--buildKey` - произвольная строка, [используемая как текст ссылки в тикете](https://a.yandex-team.ru/arc_vcs/mobile/geo/maps/maps/tools/startrek-reporter/src/main/kotlin/ru/yandex/yandexmaps/tools/startrekreporter/TicketDescriptionComposer.kt?rev=r9029796#L58)
- `--buildValue` - произвольная ссылка

Стоит учесть, что startrek reporter использует `buildKey` как ключ при обновлении описания тикета,
то есть при существовании двух сборок с одинаковым `buildKey`, но разным `buildValue`, получится гонка, где эти сборки будут бороться за одно и то же место в тикете и перезаписывать друг друга.
