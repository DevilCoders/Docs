# Работа с трекером

## Создание SPI 

Можно создать пустой SPI с шаблоном из тикенатора:

 - `/newspi <сервис> <тема>` 
 - `/newtestspi <сервис> <тема>`  - заведет тикет в очереди TEST

**Cервис** - можно указать явно (использовав /  в названии), тогда сервис будет искаться строго по совпадению с именем, например: `web/ -> web` , `spi-tools/yaincbot -> spi-tools/yaincbot` . Если не указать / в названии сервиса, то бот попытается найти сервис по вхождению подстроки в название сервиса и предложит выбрать его самому.

**Tема** - название тикета SPI (не больше 220 символов). Вместо указания темы, можно вызвать команду ответом на другое сообщение, тогда тема будет взята из него.

## Уведомление о создании тикета

**Способ 1** : с помощью языка запросов
Позволяет получать уведомления только о создании тикетов.

{% note info %}

Команду может запускать только администратор чата

{% endnote %}

Есть команда `/startrek`

С помощью этой команды можно подписаться на абсолютно любую очередь. Достаточно будет передать ей фильтр на [языке запросов стартрека](https://doc.yandex-team.ru/tracker/external/user/query-filter.html).

Накликать фильтр и проверить его можно [тут](https://st.yandex-team.ru/issues). Надо нажать вверху справа на "Язык запросов".

Почитать как оно работает можно [на этой странице](https://doc.yandex-team.ru/tracker/external/user/query-filter.html).

Некоторые полезные запросы:
 - `Queue: ОЧЕРЕДЬ ` - простейшие уведомления обо всех тикетах в очереди
 - `Queue: ОЧЕРЕДЬ Followers: me() Resolution: empty() ` - Уведомление о тикетах из очереди, за которыми вы наблюдаете
 - `Queue: ОЧЕРЕДЬ Assignee: me() Resolution: empty()` - Уведомление о тикетах из очереди, исполнителем которых вы являетесь


{% note warning %}

И не забудьте включить фильтры с помощью команды /startrek set [on|enable|enabled] 

{% endnote %}

Некоторые **правила**:
 - На **одну очередь** можно использовать **только один фильтр**. Если попробовать передать другой фильтр на ту же очередь, то бот просто заменит старый.
 - **Нельзя** передавать параметр **Key** в фильтре, иначе бот не сможет получить новых тикетов. Но в общем сам бот не разрешит передать этот параметр.
 - Все остальное работать будет как и полагается, даже параметр "me()" будет заменятся вашим логином.

Как оно работает и что можно делать:

 - `/startrek set {фильтр}` - Добавить новый или изменить существующий фильтр
 - `/startrek set on|enable|enabled` - Включить сами уведомления
 - `/startrek set off|disable|disabled` - Выключить уведомления
 - `/startrek list|status|info` - Посмотреть информацию о существующих фильтрах и посмотреть, включены ли уведомления, а так же номер последнего обработанного тикета
 - `/startrek get {очередь}` - Получить запрос и последний тикет для очереди
 - `/startrek rm|delete|remove {очередь} - Удалить фильтр на очередь

TODO: Способ второй - по триггерам

## Создание тикета

Чтобы ускорить работу в чатах поддержки, бот умеет создавать тикеты по команде в ответ на оригинальное сообщение.

Для разных очередей используются отдельные команды:

 - `/newticketrtc`  - создать задачу в RTCSUPPORT
 - `/newticketqloud`  - создать задачу в QLOUDSUPPORT
 - `/newticketmetrics`  - создать задачу в METRICSSUPPORT
 - `/newticketbsduty`  - создать задачу в BSDUTY
 - `/newticketimgdevops`  - создать задачу в IMGDEVOPS
 - `/newticketpdbdevops`  - создать задачу в PDBDEVOPS
 - `/newticketsaassup`  - создать задачу в SAASSUP
 - `/newticketjupyter`  - создать задачу в JUPYTER
 - `/newticketbalancer`  - создать задачу в BALANCERSUPPORT
 - `/newticketblndr`  - создать задачу в BLNDR
 - `/newticketvideodevops`  - создать задачу в VIDEODEVOPS
 - `/newticketnocreq`  - создать задачу в NOCREQUEST
 - `/newticketerrorbooster`  - создать задачу в ERRORBOOSTER
 - `/newticketlbops`  - создать задачу в LBOPS
 - `/newticketyaincbot`  - создать задачу в YAINCBOT
 - `/newtickettest`  - создать задачу в TEST
