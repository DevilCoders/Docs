# Желтый протокол
Желтый протокол - формат работы с инцидентом, в котором необходимо участие Марти.  
Подразумевается, что задета одна вертикаль.
Он может быть запущен:
- Вручную в любом чате с ботом дежурной смены Yaincbot при помощи команды `/proto yellow`
  > Марти может использовать просто `/proto`
- При эскалации протокола зеленого уровня в желтый.

Также желтый протокол может запустить служба PR, сценарий действий для такого случая описан на страничке ["Взаимодействие с PR"](../pr)
> Марти является координатором инцидента с момента получения информации о нем и до момента передачи инцидента дежурному девопсу (либо до окончания инцидента)
## Сценарий действий {#protocols-yellow-scenario}
Ниже описаны сценарии действий для Марти и Дежурных девопсов
{% list tabs %}

- Для Марти

   - Марти запускает желтый протокол сам в следующих случаях:
     - На мониторингах наблюдаются Crit'ы и/или Disaster'ы (хотя тут, скорее всего, уже стартует флоу)
     - Инцидент вызван релизом, и требуется его откат
     > Если выкатка релиза совпадает с началом инцидента, оповестить дежурных об этом и спросить стоит ли его откатить.
     - Получена информация об инциденте от коллег
     - Поступило сообщение о проблеме в КБФ
     - Требуется закрытие локации
     > Во время инцидентов, требующих закрытия локации для купирования необходимо приостановить все релизы и выставить manual lock в [rviewer](https://rviewer.yandex-team.ru/schedule)


   - Марти становится участником инцидента желтого уровня (его добавляет бот YaIncBot) в случаях:
     - Эскалация зеленого инцидента в желтый, из-за того, что инцидент не был принят в работу дежурными девопсами.
     - Призыв Марти командой /marty в чат инцидента

   - Марти должен найти и добавить в чат ответственных за сервис, ввести их в курс дела, и, в идеале, делегировать координацию.
     > Например: `Добрый день, коллеги! В КБФ поступила жалоба о том, что ваш сервис отдает Service Unavaliable в проде. Подскажите, знаете ли вы что-то о проблеме?`
   
     - При отсутствии ответа от дежурного в течение 5 минут - необходимо позвонить дежурному.
     - Далее эсклацию следует делать по следующей схеме, если с каждым шагом нет результата:
       - шаг 0: Звонок дежурному(+ призыв в чат).
       - шаг 1: Звонок в запасного дежурного, если таковой обозначен в схеме дежурств сервиса(+ призыв в чат).
       - шаг 2: Звонок в рук-ля сервиса (+ призыв в чат).
       - шаг 3: Звонок в любого другого дежурного из релевантной крутилки дежурств сервиса(+ призыв в чат).
       - шаг 4: Продолжаем попытки до рук-ля сервиса (даже если кто-то из других дежурных взял в работу)
       - Повторять Шаг 3, 4 пока есть дежурные в списке.
       - Шаг 5: Звоним рук-лю рук-ля сервиса. (рук-ль + 1).
       - Повторить шаг 6, пока не упремся по иерархии в уровень @ironpeter - 2.

   - Локализовать инцидент до сервиса/вертикали/локации по сработавшим алертам (если они видны на иконостасе)

   - Определить критичность инцидента
     - Сработали DISASTER алёрты - высокая критичность.
       Срабатывание Disaster алёртов подразумевает выполнение [регламентного действия](actions) по согласованию с дежурными (например закрытие вертикали в локации)
     - Сработали CRITICAL алёрты - средняя критичность.
       Срабатывание Critical алёртов подразумевает эскалацию в дежурных девопсов cервиса.
     - Информация о проблеме приходит от коллег без изменения статусов мониторингов (проблема принесена ногами) - средняя критичность.
     - Переход одного или нескольких светофоров в NO_DATA - низкая критичность. Подразумевает эскалацию в дежурных девопсов сервиса.

   - Предоставить дежурным все необходимую информацию:
     - Какие алерты сработали, какие вертикали/сервисы задевает (ссылки на алерты и графики)
     - Какие релизы/работы были в момент начала проблемы (смотреть можно в инфре, [вот один из пресетов для web, images, video](https://infra.yandex-team.ru/timeline?preset=RsermoJ6k5F))

   - Убедиться, что дежурные занимаются проблемой (и делают это продуктивно).
     Если видим что разбор проблемы не идет или идет "вяло" - призываем дополнительных людей (это могут быть как руководители, так и доп. дежурные)

   - Периодически запрашивать статусы от дежурных, занимающихся проблемой, и обновлять статус в запине с помощью команды `/proto status %текст статуса%` либо писать реплай на сообщение от бота (которое запрашивает статус)

   - Для Дежурного от сервиса

     - Координировать инцидент, если ему была делегирована эта роль
     - При необходимости привлечь коллег/попросить о помощи с эскалацией Марти
     - Выявить причины инцидента
     - Направлять починку и по необходимости запрашивать дополнительную информацию от Марти
     - Устранить причины инцидента

{% endlist %}

## Чеклист инцидента {#protocols-yellow-checklist}
- **Дежурные приняли инцидент в работу**
  > Основной задачей марти в рамках желтого инцидента является эскалация в нужных людей и совершение регламентных действий при необходимости
- **Было устранено влияние на пользователей**
- **Если инцидент вызван релизом или работами, то релиз - откачен, а работы - остановлены**
- **Мониторинги вернулись в норму**
- **Был создан и привязан к протоколу SPI**

## Эскалация {#protocols-yellow-escalation}
***До Оранжевого:***
- Выяснилось что инцидент задел больше одной вертикали (с поправкой на масштаб инцидента и тенденцию к расширению)

***До Красного:***
- Получена информация об освещении инцидента в СМИ
- Инцидент отразился на доле с подтверждением от аналититков
- Получена информации о росте количества пострадавших сервисов и наличия проявлений инцидента на сети/инфраструктуре
