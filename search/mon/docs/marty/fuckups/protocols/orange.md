# Оранжевый протокол
Оранжевый протокол - формат работы с инцидентом, в котором необходимо участие Марти.  
Подразумевается, что задето несколько вертикалей или сервис + инфраструктура.
>Особенность межсервисных проблем в том, что очень сложно заниматься координацией в нескольких местах одновеменно,
> поэтому координацию и разбор следует проводить в отдельном чате, созданном для решения конкретного инцидента с привлечением команд всех задетых сервисов

Он может быть запущен:
- Вручную в любом чате с ботом дежурной смены Yaincbot при помощи команды `/proto orange`
- При эскалации протоколов желтого или зеленого уровня в оранжевый.

> Марти является координатором инцидента с момента получения информации о нем и до момента передачи координации другому координатору (либо до окончания инцидента)
## Сценарий действий {#protocols-orange-scenario}
Ниже описаны сценарии действий для Марти и Дежурных девопсов
{% list tabs %}

- Для Марти
  - Марти эскалирует инцидент из желтого в оранжевый или запускает оранжевый протокол сам в следующих случаях:
    - На мониторингах нескольких сервисов наблюдаются Crit/Disaster/NoData (Для случая с NoData один из возможных виновников - YASM)
    - Задело сервис + инфраструктуру
    - Получена информация от коллег об инцидентах у нескольких сервисов

  - Найти и добавить в чат ответственных за все задетые сервисы, ввести их в курс дела, и выбрать координатора из занимающихся проблемой специалистов (либо из Инфраструктурного Координационного чата).
    > Необходимо ТОЧНО убедиться что выбранный вами координатор принял координацию инцидента!

  - Сделать мартикаст вида
    ```
    Обнаружена проблема N. О связанных проблемах сообщайте в чат %ссылка на чат координации%.
    ```
  - Локализовать инцидент до сервиса, компоненты, локации, инфраструктуры или сети
    - В случае срабатывания мониторингов инфраструктуры/сети наряду с сервисными целесообразнее объявить красный протокол или уточнить влияние у RTC/NOC
    - Если локализуется до одного из ДЦ - закрыть ДЦ полностью.

  - Предоставить дежурным все необходимую информацию:
    - Какие алерты сработали, какие вертикали/сервисы задевает (ссылки на алерты и графики)
    - Какие релизы/работы были в момент начала проблемы (смотреть можно в инфре, [вот один из пресетов для web, images, video](https://infra.yandex-team.ru/timeline?preset=RsermoJ6k5F))
    - Информация от других команд и сервисов, в т.ч. принесенная "ногами" во время инцидента
    > Возможно, отличной идеей будет предложить перейти в Zoom для упрощения координации. Создать конференцию можно с помощью бота командой `/proto zoom`

  - Убедиться, что дежурные занимаются проблемой (и делают это продуктивно).
      Если видим что разбор проблемы не идет или идет "вяло" - призываем дополнительных людей (это могут быть как руководители, так и доп. дежурные)

  - Периодически запрашивать статусы от дежурных, занимающихся проблемой, и обновлять статус в запине с помощью команды `/proto status %текст статуса%` либо писать реплай на сообщение от бота (которое запрашивает статус)

  - По окончании инцидента сделать мартикаст вида
    ```
    Инцидент N устранен. Разбор будет в SPI: %ссылка на SPI%
    ```

  > Особенности Оранжевого протокола с точки зрения марти (в отличие от желтого):
  > - Мартикасты по обнаружению и окончанию инцидента
  > - Выбор более опытного координатора при необходимости
  > - Взаимодействие с несколькими командами в одном чате

- Для Координатора

  Задачи: принимать централизованные решения, сокращать время починки, давать информацию пострадавшим сервисам

  - Координатор должен полностью понимать картину происходящего
  - Координатор принимает от сервисов информацию об их состоянии
  - Координатор информирует инженеров, занимающихся починкой о состоянии сервисов
  - Координатор подключает к решению проблемы дополнительные команды при необходимости
  - Координатор берет на себя ответственность за принятие важных решений в процессе починки


- Для Дежурного от сервиса

  - Координировать инцидент, c того момента, как ему была делегирована эта роль
  - При необходимости привлечь коллег/попросить о помощи с эскалацией Марти
  - Выявить причины инцидента
  - Направлять починку и по необходимости запрашивать дополнительную информацию от Марти
  - Устранить причины инцидента

{% endlist %}

## Чеклист инцидента {#protocols-orange-checklist}
- **Создан чат координации, и в него добавлены все дежурные от пострадавших сервисов**
  > В этом вся суть оранжевого протокола - координация нескольких команд в одном месте
- **Сделан мартикаст о проблеме**
  > Необходимо оповестить другие сервисы о проблеме. Возможно, дежурные других сервисов прямо сейчас пытаются понять источник проблемы сами, не зная о глобальных проблемах.
- **В чате есть вся информация, относящаяся к проблеме (сработавшие алерты, релизы, работы в момент начала инцидента)**
  > Это сократит время поиска и решения проблемы
- **Выбран координатор**
  > Необходимо выбрать одного координатора, обладающего компетенцией и навыками координировать действия нескольких команд
- **Устранено влияние на пользователей**
- **Сделан мартикаст об окончании инцидента**
- **Заведен и привязан к протоколу SPI**

## Эскалация {#protocols-orange-escalation}
***До Красного:***
- Получена информация об освещении инцидента в СМИ
- Инцидент отразился на доле с подтверждением от аналититков
- Получена информации о росте количества пострадавших сервисов и наличия проявлений инцидента на сети/инфраструктуре

