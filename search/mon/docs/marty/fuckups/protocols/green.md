# Зеленый протокол
Зеленый протокол - формат работы с инцидентом, обрабатываемым силами команды самого сервиса. Участие дежурной смены не требуется.  
Он может быть запущен:
- Вручную в любом чате с ботом дежурной смены Yaincbot при помощи команды `/proto green` или просто `/proto`
  > Второй вариант - только для дежурных сервиса. Если марти использует эту команду - запустится желтый протокол
- Автоматически при срабатывании алерта, подключенного к flow.

Дежурная смена может не участвовать в координации инцидента зеленого протокола до призыва командой `/marty`.  
При призыве дежурного Марти в протокол автоматически произойдёт эскалация до желтого уровня
## Сценарий действий {#protocols-green-scenario}
Ниже описаны сценарии действий для Марти и Дежурных девопсов
{% list tabs %}

- Для Марти

  В инцидентах зеленого уровня обычно не предполагается участие Марти.  
  Однако же стоит присматривать за "зелеными" инцидентами, ведь потенциально они могут "вырасти" в инциденты желтого+ уровней.

- Для Дежурного от сервиса

  - Команда сервиса узнает о проблеме в своем сервисе, либо срабатывает алерт, подключенный к flow.

  - Команда сервиса запускает зеленый протокол командой `/proto green`, либо протокол запускается автоматически.
    - В случае ручного запуска протокола, бот отвечает сообщением, в котором предлагается либо создать новый чат для протокола, либо продолжить в том же чате, где вызвана команда `/proto green`
    - В случае автоматического запуска по flow дежурный сервиса принимает инцидент в работу кнопкой ***"Принять в работу"*** в сообщении бота.

  - Дежурный сервиса оценивает проблему, далее либо устраняет её сам, либо призывает и координирует людей, способных это сделать.
    В случае, если источником инцидента является инфраструктура, необходимо призвать в чат протокола дежурного Marty с помощью команды `/marty` и обратиться в [RTC Support](https://t.me/joinchat/Be0kOD50fVxMoi_8hPvG6Q) (самостоятельно или через дежурного Marty) с описанием того, как проявляется проблема.  
    Желательно приложить лог исследования проблемы - это ускорит процесс починки.

  - Дежурный сервиса указывает статус протокола командой`/proto status <текст с состоянием сервиса, обстоятельствами инцидента, предпринятыми действиями>//`.  
    Это поможет другим дежурным избежать дублирования действий на этапе диагностики.

  - В случаях, если:
    - инцидент затрагивает другие вертикали
    - для устранения инцидента необходимо привлечение специалистов из других сервисов, но есть проблемы с привлечением коллег или
    - получена информация об освещении аварии Яндекса в СМИ, целесообразно передать координацию инцидента в Дежурную смену вызовом команды `/marty`.  
      После этого в чат призовется текущий дежурный Marty и протокол будет преобразован в желтый.

  - В процессе починки дежурный сервиса периодически, раз в 10-15 минут, обновляет статус протокола повторным вызовом команды из пункта 4.
    Это поможет подключающимся в протокол людям понимать, что уже было сделано для решения проблемы, не читая сообщения с начала протокола.

  - Дежурный сервиса [заводит формальный SPI](https://wiki.yandex-team.ru/jandekspoisk/sepe/dezhurnajasmena/procedures/ZavedenieV3/).
    На этапе починки в нем достаточно указать корректную компоненту, понятное название и, по возможности, приложить графики, на которых видно проблему.  
    Завести SPI можно прямо из чата командой `/newspi <компонента, как в warden> <название тикета>`

  - Дежурный сервиса привязывает SPI к протоколу командой `/proto SPI-#####`, где ##### - номер тикета в очереди SPI.

  - После завершения инцидента дежурный сервиса завершает протокол командой `/proto finish` или кнопкой "Завершить инцидент" в сообщении бота.  
    При этом история сообщений с момента начала протокола до вызова команды finish будет перенесена в привязанный тикет SPI.  
    Дальнейший разбор инцидента можно продолжить в тикете.

  - Команда сервиса разбирает SPI.

{% endlist %}

## Чеклист инцидента {#protocols-green-checklist}
- **Инцидент принят в работу кнопкой "Принять в работу" в сообщении бота**
  > _Это поможет другим дежурным увидеть, что проблема не "упала на пол" и избежать дублирования действий._
- **В чате протокола есть текущий статус проблемы.**
  > _Указать статус протокола можно командой `/proto status текст с состоянием сервиса, обстоятельствами инцидента, предпринятыми действиями`.
  > Это также поможет другим дежурным избежать дублирования действий на этапе диагностики._
- **Устранено влияние на пользователей**
  > _Основная задача дежурного - устранить влияние инцидента на пользователей, либо скоординировать людей, способных это сделать.
  > Пункты выше призваны помочь избежать недостатка информации и лишнего отвлечения дежурного от починки проблемы._
- **Заведен SPI**
  > _На этапе починки в нем достаточно указать корректный компонент, понятное название и, по возможности, приложить графики, на которых видно проблему.
  > Завести SPI можно прямо из чата командой `/newspi <компонент, как в warden> <название тикета>`._
- **SPI привязан к протоколу**
  > _Это можно сделать командой `/proto SPI-#####, где ##### - номер тикета в очереди SPI.`.
  > Также в ряде случаев это происходит автоматически, например если SPI создается в рамках flow._

## Эскалация {#protocols-green-escalation}
***До Желтого:***
- Если кнопка "Принять в работу" не будет нажата дежурным в течение 5 минут
- Если будет призван Марти командой /marty

***До Оранжевого:***
- Выяснилось что инцидент задел больше одной вертикали

***До Красного:***
- Получена информация об освещении инцидента в СМИ
- Инцидент отразился на доле с подтверждением от аналититков
- Получена информации о росте количества пострадавших сервисов и наличия проявлений инцидента на сети/инфраструктуре
