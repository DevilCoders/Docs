# RemorphParser

Remorph-парсер позволяет запустить правила [Remorph](rules-remorph.md), [TokenLogic](rules-tokenlogic.md) или [Char](rules-char.md) на одном или нескольких текстовых файлах и посмотреть все найденные результаты.

Код парсера лежит в аркадии [здесь](https://arcadia.yandex.ru/arc/trunk/arcadia/tools/remorphparser/).

Параметры запуска:

```
remorphparser <опции> <файлы>
```

Можно указать сразу несколько файлов для обработки. Если файлы не указать совсем, то парсер будет читать из стандартного потока ввода.

В опциях парсеру можно указать либо файл с правилами, либо [факт-дескриптор](facts.md). В зависимости от этого различаются остальные опции.


## Общие опции {#obshhieopcii}

#|
|| **Короткая опция** | **Длинная опция** | **Описание** ||

|| `o` | `output` | Задает файл выдачи.

Если не указана, то результат выдается в stdout. ||

|| `l` (lower-case L) | `lang` | Задает языки входных документов.

Список языков задается через запятую.

По умолчанию используется `rus`. ||

|| `p` | `per-line` | Считать что новая строка начинает новое предложение.

Если опция не указана, то выделение предложений происходит только с учетом правил пунктуации. ||

|| `t` | `format` | Задает формат входных документов.

Поддерживаются следующие форматы:
- `text` - обычный текстовой файл (используется по умолчанию);
    
- `arc` - Яндекс-архив;
    
- `tarcview` - вывод программы tarcview для Яндекс-архива;
    
- `query` - список запросов (один запрос на строку) с необязательным кодом региона через табуляцию (код региона игнорируется);
    
- `index` - текстовый файл, который будет обработан через создание `Direct Text`.
    
Для формата `tarcview` автоматически включается опция `per-line`.

Документы формата `arc` не могут быть обработаны через стандартный поток ввода.

Формат `query` обрабатывается через построение дерева запроса. ||

|| `e` | `encoding` | Задает кодировку входных документов, в том числе читаемых с консоли.

По умолчанию используется UTF-8. ||

|| `j` | `threads` | Включает многопоточную обработку документов.

Опциональный аргумент задает максимальное число используемых потоков.

Если не задан, то устанавливается равным количеству процессоров на машине. ||

|| `g` | `gzt-file` | Задает используемый файл газетира.

Этот параметр обязателен, если правила используют газетирные статьи.

При запуске с файлом фактов данный параметр позволяет переопределить используемый газетир. ||

|| `u` | `unmatched` | Выводить текст всех предложений, включая те, где нет ни одного найденного результата. ||

|| `h` | `out-mode` | Задает режим выводя результатов:

- `short` - выводятся только основные поля результата (например, только prime поля фактов или только именованные поля результатов работы правил);
    
- `full` - выводятся все поля результата;
    
- `corpus` - результаты выводятся в режиме, оптимальном для сравнения корпусов.
    
По-умолчанию используется режим `short`. ||

|| `v` | `verbose` | Если указан, то в stderr будет писаться различная отладочная информация.

Необязательный аргумент параметра задает уровень детализации.

Допустимые значения аргумента:

- `err[or]`
    
- `warn[ing]`
    
- `notice`
    
- `info`
    
- `debug`
    
- `detail`
    
- `verbose`
    
или соответствующие числа 1-7.

Нулевое значение отключает отладочную выдачу. По умолчанию, если задана опция без аргумента, используется уровень `info`. ||

|| | `monitor` | Включает мониторинг времени обработки документов.

В `stderr` выводятся имена тех документов, обработка которых занял большее время, чем указанное в параметре аргумента.

Время можно задать в секундах (пустой суффикс или суффикс `s`), миллисекундах (`ms`), микросекундах (`us`) или наносекундах (`ns`). ||

|| | `filter-lang` | Задает фильтр документов для arc/tarcview формата по указанным языкам.

Список языков задается через запятую. Remorph будет обрабатывать только документы, чей язык входит в указанный список.

Если перед списком указать !, ~ или -, то фильтр будет работать в инверсном режиме (исключать из обработки документы, чей язык входит в указанный список). ||

|| | `filter-encoding` | Задает фильтр документов для arc/tarcview формата по указанным кодировкам.

Список кодировок задается через запятую. Remorph будет обрабатывать только документы, чья кодировка входит в указанный список.

Если перед списком указать !, ~ или -, то фильтр будет работать в инверсном режиме (исключать из обработки документы, чья кодировка входит в указанный список). ||

|| | `filter-mime` | Задает фильтр документов для arc/tarcview формата по указанным MIME-типам.

Список типов задается через запятую. Remorph будет обрабатывать только документы, чей MIME-тип входит в указанный список.

Если перед списком указать `!`, `~` или `-`, то фильтр будет работать в инверсном режиме (исключать из обработки документы, чей тип входит в указанный список). ||

|| `s` | `split` | Задает режим разбиения мультитокенов на отдельные символы:

- `minimal` - разделяет только мультитокены, состоящие из двух слов или слова и числа, разделенных точкой;
    
- `smart` - разделяет все мультитокены за исключением тех, которые состоят только из слов, разделенных дефисом или апострофом;
    
- `all` - разделяет все мультитокены. Дополнительно, создаются отдельные символы для префиксов и суффиксов токенов. 
    
По-умолчанию используется режим `minimal`. ||

|| | `query-punct` | Включает обработку символов пунктуации в режиме `--format=query`.

По умолчанию, при обработке запросов вся пунктуация игнорируется.

При задании данной опции, для каждого символа пунктуации будет создан отдельный символ. ||

|| | `max-tokens` | Задает максимальное число токенов в предложении.

По умолчанию используется лимит в 100 токенов.

При задании нулевого значения число токенов в предложении не ограничивается. ||
|#


## Опции для запуска с файлом правил {#opciidljazapuskasfajjlompravil}

#|
|| **Короткая опция** | **Длинная опция** | **Описание** ||

|| `r` | `remorph` | Задает файл с правилами [Remorph](rules-remorph.md). ||

|| | `tokenlogic` | Задает файл с правилами [TokenLogic](rules-tokenlogic.md). ||

|| | `char` | Задает файл [Char](rules-char.md). ||

|| `m` | `mode` | Режим поиска вхождений:

- `match` - ищется только первый результат любого правила, покрывающего предложение целиком;
    
- `match-all` - ищутся результаты для всех правил, покрывающих предложение целиком;
    
- `match-best` - ищутся результаты для всех правил, покрывающих предложение целиком, и из них выбираются только те, которые наилучшим образом покрывают предложение;
    
- `search` - ищется только первый результат любого правила;
    
- `search-all` - ищутся результаты для всех правил;
    
- `search-best` - ищутся результаты для всех правил, и из них выбираются только те, которые наилучшим образом покрывают предложение;
    
- `solutions` - ищутся результаты для всех правил, и для них выводятся все возможные непересекающиеся покрытия (не больше 50-ти покрытий). 
    
По умолчанию используется режим `search-best`. ||

|| | `all-gzt` | Не снимать омонимию по газетирным статьям. В поиске участвуют все варианты. ||

|| | `rank` | [Метод ранжирования](coverage-ranking.md) покрытий результатов работы. 

Упорядоченная по убыванию приоритета последовательность сортирующих критериев, разделенных запятыми.

Актуально для `--mode=match-best`, `--mode=search-best` и `--mode=search-solutions`. ||

|| | `rank-gzt` | [Метод ранжирования](coverage-ranking.md) покрытий результатов работы газеттира.

Упорядоченная по убыванию приоритета последовательность сортирующих критериев, разделенных запятыми.

Актуально, только если не задана опция `--all-gzt`. ||
|#



## Опции для запуска факт-дескриптором {#opciidljazapuskasfactsfakt-deskriptorom}

#|
|| **Короткая опция** | **Длинная опция** | **Описание** ||

|| `f` | `facts` | Задает файл с [факт-дескриптором](facts.md). ||

|| `k` | `fact-ambig` | Задает режим снятия омонимии для фактов:

- `best` - выводятся непересекающиеся факты, наилучшим образом покрывающие предложение
    
- `all` - выводятся все найденные факты
    
- `solutions` - выводятся все возможные непересекающиеся покрытия (не больше 50-ти покрытий)
    
По-умолчанию используется режим `best`. ||

|| | `rank` | [Метод ранжирования](coverage-ranking.md) покрытий фактов.

Упорядоченная по убыванию приоритета последовательность сортирующих критериев, разделенных запятыми.

Актуально для `--fact-ambig=best` и `--fact-ambig=solutions`. ||
|#


