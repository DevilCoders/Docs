# Интеграция с газетиром

Библиотека remorph тесно интегрирована с другой библиотекой - `gazetteer`.


## Исполнение газетира {#ispolneniegazetira}

При исполнении правил, первым этапом Remorph осуществляет поиск газетирных статей с использованием переданного газетирного словаря. Найденные статьи приписываются соответствующим литералам.

Один литерал (и простой, и составной) может ссылаться на несколько статей. Если статья захватывает несколько слов, то они объединяются в один составной литерал, с которым уже работает Remorph.


## Снятие омонимии {#snjatieomonimii}

Поиск газетирных статей может осуществляться в двух режимах.

В первом режиме, из всех статей выбираются только непересекающиеся статьи, максимально покрывающие текст. Данный единственный вариант покрытия газетиром передается в Remorph.

Во втором режиме используются все варианты покрытия газетиром. Для конфликтующих статей создаются отдельные варианты покрытий. Таким образом в Remorph в этом режиме отдается дерево возможных вариантов, на каждом из которых исполняются правила.

Выбор режима для матчера осуществляется программным путем через метод `SetResolveGazetteerAmbiguity()`.

Для фактов, режим задается в proto-файле фактов через свойство `ambig_gazetteer`.


### Доминанты {#dominanty}

При использовании газетира в режиме поиска всех вариантов покрытий иногда необходимо фиксировать некоторые статьи, что бы Remorph не использовал альтернативные варианты при их наличии. Такие газетирные статьи называются доминантными.

Например, у нас есть две статьи "цирк на проспекте вернадского" и "проспект вернадского". Первая статья является доминантной.

Для текста "рядом с метро проспект вернадского" будет создано два варианта покрытий:
1. [рядом] [с] [метро] [проспект] [вернадского]
    
1. [рядом] [с] [метро] [проспект вернадского]
    
Для текста "рядом с цирком на проспекте вернадского" будет создан только один вариант покрытия (доминантная статья исключает альтернативный вариант разбора):
1. [рядом] [с] [цирком на проспекте вернадского]
    
Если покрытие с доминантной статьей конфликтует с другой статьей, то выбирается покрытие с доминантой, а конфликтующие покрытия удаляются. Если конфликтуют доминантные статьи, то из них выбирается только одна, образующая наибольшее покрытие.

Список доминантных статей можно задать через коллекцию, которая доступна через метод `GetDominantArticles()` матчера.

Для фактов список доминантных статей задается в proto-файле фактов через свойство `dominants`.


## Фильтры {#filtry}

Иногда заранее известно, что на определенном тексте (или на покрытии газетиром) текущие правила ничего не найдут. Для отсечения таких покрытий используется фильтр статей. Работает он следующим образом - если хотя бы один литерал из варианта покрытия содержит хотя бы одну статью из фильтра, то правила применяются к этому покрытию.

Список статей фильтра можно задать через коллекцию, которая доступна через метод `GetRequiredArticles()` матчера.

Для фактов список фильтрующих статей задается в proto-файле фактов через свойство `filter`. Если коллекция фильтров пустая, то фильтрация не выполняется.


## Использование в правилах {#ispolzovanievpravilax}

Литералы правил могут ссылаться на найденные газетирные статьи через атрибут `gzt`. Если статья нигде не используется в условиях литералов, но необходимо что бы Remorph не игнорировал ее, то используется директива [use-gzt](rules-remorph.md).


## Неочевидности и грабли {#neochevidnostiigrabli}

1. Remorph игнорирует все газетирные статьи, которые не используются в правилах. Как следствие, такие статьи:
    
    - не печатается в отладочной выдаче Remorph;
    
    - игнорируются, даже если они указаны в фильтре и найдены в тексте.
    
1. В Remorph зашито ограничение на максимальное число вариантов покрытий - 200. Если количество вариантов превышает этот лимит, то выполняется принудительное снятие омонимии.

