# "Обычные" годовые корзины

Корзины 2022 собираем за февраль 2021-январь 2022.

Собираем корзинки для каждого потока независимо.
Поток = страна (сейчас RU-UA-BY-KZ-UZ без UA) * источник (maps, navi, mobile_maps, touch_maps, serp) * драг (first, drag)

3 этапа сбора

## Майнинг

### Что делаем
* Берем только наши запросы
* определеяем страну
* конвертируем окно в h3-hex
* считаем для каждого запроса частоты по месяцам

### Берем запросы
* usecase == "search"
* не из саджеста
* не переход из колдунщика (их получим с серпа)
* не язык запросов
* не координатный запрос (там качество ок :) )

### Ключ агрегации
* query -> normal_query
* Спан округляем до h3 хекса
* страну определяем по ull, если нет по региону запроса
* время округляем до часа
* yandexuid

### Агрегация
Агрегируем подсчитывая частоты за каждый месяц.
Тащим с собой несколько случайных оригинальных reqid.

### Запуск
./basket_gathering_2022 run mine_year


# Семплирование

### Что делаем
* берем нужную страну
* семплируем
* джойним семп к reqid
* джойним сразу все семплы к геокубу
* делим на потоки и копируем в результирующие таблицы

### Семплирование
Берем кубики кастомизированные для нас @vlad-nem и используем.
* Используем кастомный 'rotation_period': 'GEO_202202'
* Генерируем 1 корзину за раз
* Генерируем "корзину" в 200к запросов (дальше возьмем из нее топ)

### Запуск
./basket_gathering_2022 run sample_year_graph

# Шайбовые корзины корзины

Корзины 2022 собираем за февраль 2021-январь 2022.

Собираем корзинки для каждого потока независимо.
Поток = страна (сейчас RU) * источник (maps, mobile_maps, touch_maps)

## Майнинг

### Берем запросы
* usecase == "search"
* только с правильным оридженом origin IN ("maps-category", "maps-m-category", "maps-m-places-home")
    OR String::StartsWith(origin, "mobile-maps-category-"))
* type == "RequestWindow" (не хотим брать топонимы)
* только первые запросы

### Ключ агрегации
* query -> normal_query
* Спан округляем до h3 хекса
* страну определяем по ull, если нет по региону запроса
* время округляем до часа
* yandexuid

### Агрегация
Агрегируем подсчитывая частоты за каждый месяц.
Тащим с собой несколько случайных оригинальных reqid.

### Запуск
./basket_gathering_2022 run mine_pucks







