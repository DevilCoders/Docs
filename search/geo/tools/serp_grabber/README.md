Скрипты для разбора ответов геопоиска на серпе (то есть очередная долбилка).
======================================================

Сборка
----------------
```bash
cd ${ARCADIA}/search/geo/tools/serp_grabber && ya make -j20 . && ./serp_grabber --help
```

Типичное применение
-------------------------------------------------------

- Есть какой-то срез серповых запросов в tsv виде - запрос, регион.
- Вам нужно отобрать какую-то часть запросов, провести простые вычисления и т.п., причём, с учётом серповых особенностей. (Например, с какими-то флагами noapache, или нужны результаты работы его правил).
- Скрипт отправляет запрос в основной поиск Яндекса парсит результаты из json_dump, обрабатывает и выводит результат.

*Например, для чтения свойства верхнего метапоиска нужно написать 5 строк (из них полторы содержательные)*:
```
$ echo "школа 411	213" | ./serp_grabber --method='org_mx_type'
> школа 411	213	sure_company
```
---
**Метод** - это функция из модуля methods.py (добавляйте свои под задачи).
При вызове serp_grabber можно добавить флаги, поменять хост.
```
$ echo 'кафе Пушкин	213' | ./serp_grabber --method='upper_property' --arg='ApplyBlender.factors' | awk '{print $863}'
```
---
Подробная инструкция, на случай, если нужно вытащить какое-то поле из данных, доступных в json_dump.
-------------------------------------------------------

Рассмотрим для примера значение из правила запросного визарда (Geov).

1.  Смотрим в куке значение Geov -- *0.6399343014*
2. Добавляем в адресную строку браузера *&json_dump=1*.
3. В некоторых случаях визардные правила помечены как отладочные и видны в куке или в браузере с кукой, а при скачках - не доступны.  Помогает флаг *&dbgwzr=2*.
4. Находим по тексту значение Geov (тут часто нужно выбрать наиболее удобное упоминание).
5. Ищем путь к нему в json'e.  *Вот это бывает сложно; облегчают задачи редакторы с поддержкой json. Ну или хотя бы соответствующий плагин в браузере, например jsonView (искать по json)*.
6. В плагине при наведении на поле высвечивается его адрес:
```javascript
  &json_dump=search.request_wizards.Geov.Val
```
7. Далее выводим `./serp_grabber --help`
8. Теоретически, можно запускать
```bash
 $ cat basket | ./serp_grabber --method='print_json' --flags='&json_dump=search.request_wizards.Geov.Val'
```
Но тогда будет выводиться весь json который запрашивается по умолчанию (свойства верхнего и  json колдунщика) + Geov в конце.  Но если нужен только json с Geov, то добавляем флаг
```bash
  ./serp_grabber --touch --method='print_json' --flags='&json_dump=search.request_wizards.Geov.Val' --no-def-flags=1
```
Получаем что-то такое:
``` bash
  $ head serp20k | ./serp_grabber --method='print_json' --flags='&json_dump=search.request_wizards.Geov.Val'  --no-def-flags=1
  > одноклассники   6       {'search.request_wizards.Geov.Val': '-0.002200067509'}
  > курскпромбанк орел      10      {'search.request_wizards.Geov.Val': '0.274435252'}
  > боги удачи      21666   {'search.request_wizards.Geov.Val': '0.002415471943'}
  > Is anybody home?        2       {'search.request_wizards.Geov.Val': '0.006123089232'}
  > зарегистрироваться в контакте   39      {'search.request_wizards.Geov.Val': '0.007915881462'}
  > вконтакте       213     {'search.request_wizards.Geov.Val': '0.01109895855'}
  > когда была смена денег в россии 50      {'search.request_wizards.Geov.Val': '-0.01218234655'}
  > авито   195     {'search.request_wizards.Geov.Val': '-0.01534979884'}
```
  Тут можно выпарсить значение grep'ом.

  *Ну, конечно, можно при желании написать свой метод в 5 строчек и вывести сразу (ну, и с другими данными) нужном формате. Можно дописать 5 строк в метод print_json и вытаскивать данные по пути, указанному в ` --arg`.*

