# N

В данном разделе приведено описание метрик, первой буквой в названии которой является <q>N</q> (без учета [оцененности](naming.md#judged)). {#list}

## ndcg {#ndcg}

Мера отклонения выдачи от [идеального ответа](../reference/term.md#ideal-resp). 

### Расчет метрики {#ndcg-calc}

Значение метрики **ndcg** равно отношению значения функции $dcg$ от первых n результатов выдачи системы к значению функции $dcg$ от идеального ответа для первых n результатов выдачи системы:

$(1) { } ndcg = \frac{dcg(sysAnswer)}{dcg(idealAnswer)} { ,}$
 
где:

* $sysAnswer$ — выдача системы;
* $idealAnswer$ — идеальная выдача.

Оценка идеального ответа производится с помощью функции $dcg$. Функция $dcg$ вычисляется по формуле:

$(2) { } dcg = \sum\limits_{i=1}^{n} conf(i) * \frac{1}{log_{2}(i+1)} { ,}$
 
где $conf(i)$ — вес $i$-го документа выдачи.

В формуле (2) суммируются веса первых n элементов выдачи с поправкой на удаленность релевантных элементов от ее начала. Данная поправка выполняется при помощи логарифмического отношения, которое понижает условный вес элементов, по мере их удаления от первой позиции выдачи. Информация о весах документов представлена в разделе [Условные вероятностные веса оцененных документов](http://doc.yandex-team.ru/analytics/metrics/reference/ElementsWeights.xml) документа [Оценка качества поиска](http://doc.yandex-team.ru/analytics/metrics/concepts/About.xml).

{% note info %}

Метрика **ndcg** принимает неопределенное значение (<q>undefined</q>), если значение функции $dcg$ от вектора идеального ответа равно нулю (если в идеальном ответе не содержится релевантных документов). Запрос, оцененный по метрике **ndcg** значением <q>undefined</q>, исключается из дальнейшего анализа.

{% endnote %}


### Корректировка условного веса элемента в зависимости от позиции в выдаче {#ndcg-correct}

Допустим, что витальный элемент (V) находится на первой позиции выдачи. Тогда в результате поправки его условный вес не изменится:

$ndcg(V_{1}) = 0,61 * \frac{1}{log_{2}(1+1)} = 0,61 { ,}$
 
где $V_{1}$ — витальный элемент на первой позиции выдачи.

Если витальный элемент находится на второй позиции, его условный вес уменьшится:

$ndcg(V_{2}) = 0,61 * \frac{1}{log_{2}(2+1)} /approx 0,385 { ,}$
 
где $V_{2}$ — витальный элемент на второй позиции выдачи.

> ## Пример 1 {#ex1}
> 
> Рассмотрим следующую выдачу:
> 
> $(1) { } /left( /begin{array}{l} S// IR// IR// R-// V// R /end{array} /right)$
> 
> Идеальный ответ (2) содержит те же элементы, что и поисковая выдача (1), но в порядке, соответствующем их весам, от большего к меньшему:
> 
> $(2) { } /left( /begin{array}{l} V// R// R-// IR// IR// S /end{array} /right)$

> ## Пример 2 {#ex1}
> 
> Рассчитаем метрику **ndcg** для результатов выдачи трех различных поисковых систем по одному и тому же запросу.
> 
> Допустим, что поисковые системы вернули следующие результаты на первых четырех позициях (где витальные документы (V) в выдачах разных систем идентичны, а все нерелевантные документы (IR) различаются):
> 
> #|
> || **Я** | **G** | **Mail** ||
> || $/left( /begin{array}{l} V// R// IR// R /end{array} /right)$ | $/left( /begin{array}{l} S// S// IR// V /end{array} /right)$ | $/left( /begin{array}{l} IR// IR// R-// IR /end{array} /right)$ ||
> |#
> 
> 
> На основе этих результатов может быть построен следующий идеальный ответ:
> 
> ${ } /left( /begin{array}{l} V// R// R// R-// IR// IR// IR// IR// IR// S// S /end{array} /right)$
> Идеальный ответ получен упорядочением результатов выдачи всех трех систем, согласно весам элементов и перечисленным в начале раздела правилам.
> 
> Мера отклонения выдачи от идеального ответа является отношением оценки вектора системы к оценке идеального вектора (оценка выполняется при помощи функции $dcg$).
> 
> Минимальным отклонением от идеального ответа по метрике **ndcg** в данном примере обладает первая система (Я).

[К списку метрик](#list).


## normalized-p {#normalized-p}

Доля релевантных документов (оцененных, как <q>R+</q> и выше) в первых n результатах выдачи.

### Расчет метрики {#normalized-p-calc}

Значение метрики рассчитывается по формуле:

$normalized{-}p = \frac{\sum\limits_{i=1}^{n} m_{i}}{n} { , где }$
 
$n$ — общее количество документов выдачи.

$m_{i}= /left/{ /begin{array}{ll} 1 {,} & {если документ имеет оценку R+ или выше} // 0 {,}& {если документ имеет оценку ниже R+} /end{array} /right.$

{% include [ndcg-backtolist](../_includes/concepts/n/id-ndcg/backtolist.md) %}



## not-answers {#not-answers}

Доля запросов, для которых при формировании поискового ответа получен неответ хотя бы от одного из источников.

### Расчет метрики {#not-answers-calc}

Для запроса является бинарной и принимает значения:

- <q>0</q> — при формировании поисковой выдачи неответы не получены.
- <q>1</q> — при формировании поисковой выдачи получен неответ по крайней мере от одного из источников.

При расчете значения для потока выполняется усреднение по количеству поисковых запросов:

$not{-}answers = \frac{\sum\limits_{i=1}^{n} p_i }{n} { ,}$
 
где:

* $p_{i}$ — значение метрики для $i$-го запроса;
* $n$ — количество запросов, для которых выполняется усреднение.

{% include [ndcg-backtolist](../_includes/concepts/n/id-ndcg/backtolist.md) %}



## not-answers-avg {#not-answers-avg}

Среднее количество неответов на запрос. Рассчитывается только для тех запросов, в которых присутствуют неответы.

### Расчет метрики {#not-answers-avg-calc}

Значение метрики равно отношению суммарного количества неответивших источников к количеству запросов, при формировании которых получены неответы:

$not{-}answers{-}avg = \frac{\sum\limits_{i=1}^{n} p_i }{n} { ,}$
 
где:

* $p_{i}$ — количество неответивших источников для $i$-го запроса;
* $n$ — количество запросов, при формировании ответа на которые получены неответы.

{% include [ndcg-backtolist](../_includes/concepts/n/id-ndcg/backtolist.md) %}


