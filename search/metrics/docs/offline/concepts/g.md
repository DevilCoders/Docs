# G

В данном разделе приведено описание метрик, первой буквой в названии которой является <q>G</q> (без учета [оцененности](naming.md#judged)). {#list}

## garbage-count {#garbage-count}

Доля документов c оценкой <q>Невозможно</q>, в первых $n$ результатах поисковой выдачи. 

### Расчет метрики {#garbage-count-calc}

Значение метрики равно отношению количества документов, которым выставлена оценка <q>Невозможно</q> к общему числу документов ($n$):

$garbage{-}count = \frac{n_{garbage}}{n} { ,}$
 
где $n_{garbage}$ — количество документов в первых n результатах поиска, имеющих оценку <q>Невозможно</q>.

{% include [bad-count-judgeadv](../_includes/concepts/b/id-bad-count/judgeadv.md) %}


[К списку метрик](#list).


## geo-irrel {#geo-irrel}

Доля документов в первых $n$ результатах поисковой выдачи, оцененных как <q>нерелевантный</q> (<q>R-</q>) по [шкале оценки геопоиска](http://ang2.yandex-team.ru/wiki/-view?page=geopoisk#otsenki).

### Расчет метрики {#geo-irrel-calc}

Значение метрики равно отношению количества нерелевантных документов $n_{R-}$ к общему числу документов ($n$):

$geo{-}irrel = \frac{n_{R-}}{n}$
 
{% include [garbage-count-backtolist](../_includes/concepts/g/id-garbage-count/backtolist.md) %}



## geo-pfound {#geo-pfound}

Оценка привлекательности выдачи геопоиска. Учитывает произвольный порядок просмотра результатов поиска.

### Расчет метрики {#geo-pfound-calc}

Метрика рассчитывается как сумма произведений вероятностей просмотра и аттрактивности документов выдачи геопоиска.

Аттрактивность документа ($attract_{d}$) — коэффициент, который добавляется документом к оценке всей выдачи (вклад впечатления от данного документа в общее впечатление от выдачи). Значение зависит от оценки документа (см. [таблицу ниже](#geo-pfound-table)).

Для вычисления метрики перебираются оценки, которые может иметь первый просмотренный документ, и для каждой возможной оценки в формулу добавляется слагаемое, соответствующее первому документу с этой оценкой.

Значение метрики для пустой выдачи равно нулю:

$geo{-}pfound_{/varnothing} = 0$
 
Значение метрики для выдачи, состоящей из одного элемента, равно аттрактивности данного документа:

$geo{-}pfound_{d} = attract_{d}$
 
Значение метрики в общем случае рассчитывается по формуле:

$geo{-}pfound_{(d_1{, }/ldots{, }d_k)} = \sum\limits_{i=1}^{k} p_i * ( attract_{d_i} + (1 - pBreak_{d_i} ) * geo{-}pfound_{(d_1{, }/ldots{, }d_{i-1}{, }d_{i+1}{ ,}/ldots{, }d_k)} ) { ,}$
 
где:

* $d_i$ — $i$-ый документ в выдаче;
* $k$ — общее количество документов в выдаче;
* $pBreak(d_i)$ — вероятность прекращения дальнейшего просмотра выдачи после $i$-го документа (пользователь устал или получил нужную информацию). Значение зависит от оценки $i$-го документа (см. [таблицу](#geo-pfound-table));
* $attract(d_i)$ — аттрактивность $i$-го документа документа выдачи (см. [таблицу](#geo-pfound-table)).
* $p_i$ — вероятность просмотра $i$-го документа выдачи.

Вероятность просмотра рассчитывается для первого документа с данной оценкой.
 $p_i = P_{random}(i) + P_{first}(i) + P_{best}(i) { ,}$
 
где:

* $P_{random}(i)= /left/{ /begin{array}{ll} 0,5 * \frac{k_i}{k} {,} & {если i-ый документ является первым из документов с оценкой m} // 0 {,}& {если i-ый документ не первый с оценкой m} /end{array} /right. {;}$
* $k_i$ — количество документов выдачи с оценкой $m$;
* $P_{first}(i) = 0,3$ — если $i=1 {;}$
* $P_{best}(i) = 0,2$ — если $i$-ый документ является первым из документов выдачи с максимальной оценкой.

Базовые значения коэффициентов $attract$ и $pBreak$: {#geo-pfound-table}

#|
|| **Оценка документа** | **Аттрактивность (attract)** | **Вероятность прекращения 
просмотра (pBreak)** ||
|| Нерелевантный (IR) | - 0,03 | 0,2 ||
|| Релевантный- (R-) | 0,1 | 0,1 ||
|| Релевантный+ (R+) | 0,2 | 0,15 ||
|| Витальный (V)

Полезный (U) | 0,6 | 0,25 ||
|#

К базовым значениям коэффициентов $attract$ и $pBreak$ добавляются бонусные для первых встреченных нерелевантной, релевантной и витальной оценок.

Бонусные значения коэффициентов $attract$ и $pBreak$:

#|
|| **Оценка документа** | **Бонус к аттрактивности (attract)** | **Бонус к вероятности 
прекращения просмотра (pBreak)** ||
|| Нерелевантный (IRR) | - 0,1 | 0,2 ||
|| Релевантный (не ниже R+) | 0,2 | 0,1 ||
|| Витальный (V)

Полезный (U) | 0,6 | 0,25 ||
|#

> ## Пример 1 {#ex1}
> 
> Рассмотрим следующую выдачу:
> 
> $/left( /begin{array}{l} R+// V// R-// R-// V /end{array} /right)$
> Рассчитаем вероятность просмотра документов данной выдачи: $p_i$
> 
> #|
> || **Оценка документа** | **$P_{random}(i)$** | **$P_{first}(i)$** | **$P_best}(i)$** | **$p_i$** ||
> || R+ | $0,5 * \frac{1}{5} = 0,1$ | 0,3 | - | 0,4 ||
> || V | $0,5 * \frac{2}{5} = 0,2$ | - | 0,2 | 0,4 ||
> || R- | $0,5 * \frac{2}{5} = 0,2$ | - | - | 0,2 ||
> || R- | - | - | - | - ||
> || V | - | - | - | - ||
> |#

> ## Пример 2 {#ex2}
> 
> Рассмотрим выдачу, состоящую из трех документов с одним видом оценки (R+):
> 
> $/left( /begin{array}{l} R+// R+// R+ /end{array} /right)$
> На схеме ниже представлена очередность, в которой пользователь мог бы просматривать документы выдачи:
> 
> ![](../_assets/ex3-2.png)
> 
> Рассчитаем значение метрики **geo-pfound**:
> 
> $geo{-}pfound_{R+,R+,R+}= p_{R+} * (attract_{R+} + (1 - pBreak_{R+}) * geo{-}pfound_{R+,R+}) + 0 + 0$
> 
> $geo{-}pfound_{R+,R+,R+}= 1 * (0,4 + (1 - 0,25) * geo{-}pfound_{R+,R+})$
> 
> $geo{-}pfound_{R+,R+}= p_{R+} * (attract_{R+} + (1 - pBreak_{R+}) * geo{-}pfound_{R+}) + 0$
> 
> $geo{-}pfound_{R+}= attract_{R+} = 0,2$
> 
> $geo{-}pfound_{R+,R+}= 1 * (0,2 + (1 - 0,15) * 0,2) = 0,37$
> 
> $geo{-}pfound_{R+,R+,R+}= 0,4 + 0,75 * 0,37 = 0,6775 $

> ## Пример 3 {#ex3}
> 
> Рассмотрим выдачу, состоящую из трех документов с двумя видами оценок:
> 
> $/left( /begin{array}{l} R+// R+// V /end{array} /right)$
> 
> На схеме ниже представлены варианты очередности, в которой пользователь мог бы просматривать документы выдачи:
> 
> ![](../_assets/ex4-2.png)
> 
> Рассчитаем значение метрики **geo-pfound**:
> 
> $geo{-}pfound_{R+,R+,V}= p_{R+} * (attract_{R+} + (1 - pBreak_{R+}) * geo{-}pfound _{R+,V}) + 0 + p_{V} * (attract_{V} + (1 - pBreak_{V}) * geo{-}pfound_{R+,R+})$
> 
> $(1) { } geo{-}pfound_{R+,V}= p_{R+} * (attract_{R+} + (1 - pBreak_{R+}) * geo{-}pfound_{V}) + p_{V} * (attract_{V} + (1 - pBreak_{V}) * geo{-}pfound_{R+})$
> 
> $(2) { } geo{-}pfound_{R+,R+}= p_{R+} * (attract_{R+} + (1 - pBreak_{R+}) * geo{-}pfound_{R+}) + 0$

{% include [garbage-count-backtolist](../_includes/concepts/g/id-garbage-count/backtolist.md) %}



## geo-rel  {#geo-rel}

Отклонение релевантного документа от первой позиции в первых $n$ результатах поисковой выдачи.

Релевантными считаются документы, имеющие оценки <q>R+</q> и выше.

### Расчет метрики {#geo-rel-calc}

Для расчета метрики используется формула:

$geo{-}rel = \frac{deep - i}{deep}, i /in [0; min /{ deep; serplength /}), i /in /mathbb{N} { ,}$
 
где:

* $deep$ — глубина ($n$);
* $serplength$ — длина поисковой выдачи;
* $i$ — позиция (начиная с нуля) первого релевантного документа.

Метрика принимает значение 0, если релевантный документ отсутствует в пределах заданной глубины выдачи (n).

> ## Пример 1 {#ex2-1}
> 
> Рассмотрим следующую выдачу:
> 
> $/left( /begin{array}{l} NOT{ }JUDGED// IR// IR// R+//R- /end{array} /right)$
>
> В данном случае $serplength = 5$, $deep = 10$ и, следовательно, $serplength < deep$. Таким образом $i /in [0; 5)$.
> 
> Т. к. нумерация начинается с нуля, а первый релевантный документ находится на четвертой позиции, то, $i=3$, и формула принимает вид:
> 
> $geo{-}rel{-}10 = \frac{10 - 3}{10} = 0,7$

> ## Пример 2 {#ex2-2}
> 
> Рассмотрим следующую выдачу:
> 
> $/left( /begin{array}{l} NOT{ }JUDGED// IR// NOT{ }JUDGED// IR// NOT{ }JUDGED// R+// NOT{ }JUDGED// IR// IR// IR// R- /end{array} /right)$
> 
> В данном случае $serplength = 11$, $deep = 10$ и, следовательно, $deep < serplength$. Таким образом, $i /in [0; 10)$.
> 
> Т. к. нумерация начинается с нуля, а первый релевантный документ находится на четвертой позиции, то, $i=5$, и формула принимает вид:
> 
> $geo{-}rel{-}10 = \frac{10 - 5}{10} = 0,5$

> ## Пример 3 {#ex2-3}
> 
> Рассмотрим следующую выдачу:
> 
> $/left( /begin{array}{l} NOT{ }JUDGED// IR// NOT{ }JUDGED// NOT{ }JUDGED// /end{array} /right)$
> 
> В данном случае $serplength = 4$, $deep = 10$ и, следовательно, $serplength < deep$. Таким образом $i /in [0; 4)$.
> 
> Однако релевантных документов в данном диапазоне нет и, следовательно:
> 
> $geo{-}rel{-}10 = 0$

{% include [garbage-count-backtolist](../_includes/concepts/g/id-garbage-count/backtolist.md) %}



## geo-rel-count {#geo-rel-count}

Доля запросов, для которых найдено не менее $n$ релевантных (<q>R+</q> и выше) документов.

### Расчет метрики {#geo-rel-count-calc}

Является бинарной и принимает значения:

- <q>0</q> — в выдаче отсутствуют релевантные документы.
- <q>1</q> — в выдаче присутствует по крайней мере один релевантный документ.

Для потока отражает среднее значение метрики по потоку.

{% include [garbage-count-backtolist](../_includes/concepts/g/id-garbage-count/backtolist.md) %}



## geoshard {#geoshard}

Доля документов, полученных из [геошарда](http://wiki.yandex-team.ru/jandekspoisk/tematicheskiepoiski/geopoisk/Geoshard), в первых $n$ результатах поисковой выдачи.

### Расчет метрики {#geoshard-calc}

Значение метрики рассчитывается по формуле:

$geoshard = \frac{\sum\limits_{i=1}^{n} m_{i}}{n} { , где }$
 
$m_{i}= /left/{ /begin{array}{ll} 1 {,} & {если источник документа — геошард} // 0 {,}& {если геошард не является источником документа} /end{array} /right.$

{% include [garbage-count-backtolist](../_includes/concepts/g/id-garbage-count/backtolist.md) %}



## geoshard-queries {#geoshard-queries}

Наличие в первых $n$ результатах поисковой выдачи документов, пришедших из [геошарда](http://wiki.yandex-team.ru/jandekspoisk/tematicheskiepoiski/geopoisk/Geoshard).

### Расчет метрики {#geoshard-queries-calc}

Для запроса является бинарной и принимает значения:

- <q>1</q> — в первой десятке выдачи присутствует хотя бы один документ из геошарда;
- <q>0</q> — документы из геошарда отсутствуют.

Для потока отражает долю запросов, первой десятке поисковой выдачи по которым присутствует хотя бы один документ из геошарда.

{% include [garbage-count-backtolist](../_includes/concepts/g/id-garbage-count/backtolist.md) %}



## good-count {#good-count}

Доля документов с оценкой <q>Годится</q>, в первых n результатах поисковой выдачи.

### Расчет метрики {#good-count-calc}

Значение метрики равно отношению количества документов, которым выставлена оценка <q>Годится</q>, к общему числу документов ($n$):

$good{-}count = \frac{n_{good}}{n} { ,}$
 
где $n_{good}$ — количество документов в первых n результатах поиска, имеющих оценку <q>Годится</q>.

{% include [bad-count-judgeadv](../_includes/concepts/b/id-bad-count/judgeadv.md) %}


{% include [garbage-count-backtolist](../_includes/concepts/g/id-garbage-count/backtolist.md) %}



## incorrect-geo-ref {#incorrect-geo-ref}

Доля документов в первых $n$ результатах поисковой выдачи, оцененных как <q>неправильная привязка</q> по [шкале оценки геопривязки](http://ang2.yandex-team.ru/wiki/-view?page=geopoisk#otsenkageoprivyazki).

### Расчет метрики {#incorrect-geo-ref-calc}

Значение метрики равно отношению количества документов с неправильной привязкой $n_{incorrect-geo-ref}$ к общему числу документов ($n$):

$incorrect{-}geo{-}ref = \frac{n_{incorrect-geo-ref}}{n)}$
 
{% include [garbage-count-backtolist](../_includes/concepts/g/id-garbage-count/backtolist.md) %}


