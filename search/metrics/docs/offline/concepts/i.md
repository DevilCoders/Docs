# I

В данном разделе приведено описание метрик, первой буквой в названии которой является <q>I</q> (без учета [оцененности](naming.md#judged)). {#list}

## images-MAP {#images-map}

Близость расположения релевантных картинок к началу выдачи с условными [весами картинок](http://doc.yandex-team.ru/analytics/metrics/reference/ElementsWeights.xml#imagesweights) (метрика средней точности). 

### Расчет метрики {#images-map-calc}

Расчет метрики аналогичен расчету метрики [MAP](m.md#map), но для расчета $prec\_rel(i)$ используются веса, отличные от используемых в сервисе <q>Web</q> (cм. приложение [Условные и вероятностные веса оцененных документов](https://doc.yandex-team.ru/analytics/metrics/reference/ElementsWeights.xml#imagesweights) документа [Оценка качества поиска](http://doc.yandex-team.ru/analytics/metrics/concepts/About.xml)).

Таким образом $prec\_rel(i)$ рассчитывается по формуле:

$ prec\_rel(i) = \frac{W_{R+}(i) * n_{R+}(i) + W_{R-}(i) * n_{R-}(i)}{i * {W_{R+}}} { ,}$
 
где:

* $n_{R+}(i)$ — количество документов среди первых $i$ результатов, имеющих оценки <q>R+</q>;
* $n_{R-}(i)$ — количество документов среди первых $i$ результатов, имеющих оценки <q>R-</q>.
* $W_{R+}(i)$ — вес оценки <q>R+</q> (cм. приложение [Условные и вероятностные веса оцененных документов](https://doc.yandex-team.ru/analytics/metrics/reference/ElementsWeights.xml#imagesweights) документа [Оценка качества поиска](http://doc.yandex-team.ru/analytics/metrics/concepts/About.xml)).
* $W_{R-}(i)$ — вес оценки <q>R-</q> (cм. приложение [Условные и вероятностные веса оцененных документов](https://doc.yandex-team.ru/analytics/metrics/reference/ElementsWeights.xml#imagesweights) документа [Оценка качества поиска](http://doc.yandex-team.ru/analytics/metrics/concepts/About.xml)).

[К списку метрик](#list).


## images-ndcg {#images-ndcg}

Мера отклонения выдачи картинок от [идеального ответа](../reference/term.md#ideal-resp).

### Расчет метрики {#ndcg-calc}

Значение метрики **ndcg** равно отношению значения функции $dcg$ от первых n результатов выдачи системы к значению функции $dcg$ от идеального ответа для первых n результатов выдачи системы:

$(1) { } ndcg = \frac{dcg(sysAnswer)}{dcg(idealAnswer)} { ,}$
 
где:

* $sysAnswer$ — выдача системы;
* $idealAnswer$ — идеальная выдача.

Оценка идеального ответа производится с помощью функции $dcg$. Функция $dcg$ вычисляется по формуле:

$(2) { } dcg = \sum\limits_{i=1}^{n} conf(i) * \frac{1}{log_{2}(i+1)} { ,}$
 
где $conf(i)$ — вес $i$-го документа выдачи.

В формуле (2) суммируются веса первых n элементов выдачи с поправкой на удаленность релевантных элементов от ее начала. Данная поправка выполняется при помощи логарифмического отношения, которое понижает условный вес элементов, по мере их удаления от первой позиции выдачи. Информация о весах документов представлена в разделе [Условные вероятностные веса оцененных документов](http://doc.yandex-team.ru/analytics/metrics/reference/ElementsWeights.xml) документа [Оценка качества поиска](http://doc.yandex-team.ru/analytics/metrics/concepts/About.xml).

{% note info %}

Метрика **ndcg** принимает неопределенное значение (<q>undefined</q>), если значение функции $dcg$ от вектора идеального ответа равно нулю (если в идеальном ответе не содержится релевантных документов). Запрос, оцененный по метрике **ndcg** значением <q>undefined</q>, исключается из дальнейшего анализа.

{% endnote %}


### Корректировка условного веса элемента в зависимости от позиции в выдаче {#ndcg-correct}

Допустим, что витальный элемент (V) находится на первой позиции выдачи. Тогда в результате поправки его условный вес не изменится:

$ndcg(V_{1}) = 0,61 * \frac{1}{log_{2}(1+1)} = 0,61 { ,}$
 
где $V_{1}$ — витальный элемент на первой позиции выдачи.

Если витальный элемент находится на второй позиции, его условный вес уменьшится:

$ndcg(V_{2}) = 0,61 * \frac{1}{log_{2}(2+1)} /approx 0,385 { ,}$
 
где $V_{2}$ — витальный элемент на второй позиции выдачи.

Пример расчета метрики представлен в разделе [ndcg](n.md#ndcg).


## images-p {#images-p}

Средняя оценка релевантности первого документа по шкале картинок или доля релевантных документов (оцененных, как «R+» по [шкале картинок](http://doc.yandex-team.ru/analytics/metrics/reference/ElementsWeights.xml#imagesweights)) в первых n результатах поисковой выдачи.

### Расчет метрики {#pn-calc}

При расчете средней оценки релевантности первого документа не учитываются выдачи, на первой позиции которых находится неоцененный документ. Документы, имеющие оценки <q>V</q>, <q>U</q>, <q>R+</q> принимаются за единицу, а <q>R-</q>, <q>IR</q>, <q>\_404</q>, <q>SP</q> — за ноль.

При расчете доли релевантных документов значение метрики равно отношению количества документов, имеющих оценку <q>R+</q> и выше, к общему количеству документов (n):

$images{-}p = \frac{n_{rel+up}}{n} { ,}$
 
где $n_{rel+up}$ — количество документов в первых n результатах поиска, имеющих оценку <q>R+</q> и выше.

Информация о градации оценок релевантности картинок и их весах представлена в разделе [Условные и вероятностные веса оцененных документов](https://doc.yandex-team.ru/analytics/metrics/reference/ElementsWeights.xml#imagesweights) документа [Оценка качества поиска](http://doc.yandex-team.ru/analytics/metrics/concepts/About.xml).

{% include [images-map-backtolist](../_includes/concepts/i/id-images-map/backtolist.md) %}



## images-normalized-p {#images-normalized-p}

Скорректированная доля релевантных документов (оцененных, как «R+» по [шкале картинок](http://doc.yandex-team.ru/analytics/metrics/reference/ElementsWeights.xml#imagesweights)) в первых n результатах выдачи, нормированная на вес документов, имеющих оценку <q>R+</q> (0,6).

### Расчет метрики {#images-normalized-p-calc}

Значение метрики равно отношению количества документов, имеющих оценку <q>R+</q> и выше, к общему количеству документов выдачи (n):

$images{-}normalized{-}p = \frac{n_{rel+up}}{n} { ,}$
 
где:

* $n_{rel+up}$ — количество документов в первых n результатах поиска, имеющих оценку <q>R+</q> и выше.
* $n$ — общее количество документов выдачи.

Полученное значение делится на 0,6.

{% include [images-map-backtolist](../_includes/concepts/i/id-images-map/backtolist.md) %}



## images-404 {#images-404}

Доля картинок, оцененных как <q>\_404</q>, в первых n результатах выдачи поиска по картинкам.

### Расчет метрики {#images-404-calc}

Значение метрики рассчитывается по формуле:

$images{-}404 = \frac{\sum\limits_{i=1}^{n} m_{i}}{n} { , где }$
 
$n$ — общее количество документов выдачи.

$m_{i}= /left/{ /begin{array}{ll} 1 {,} & {если документ имеет оценку \_404} // 0 {,}& {если документ имеет оценку отличную от \_404} /end{array} /right.$

{% include [images-map-backtolist](../_includes/concepts/i/id-images-map/backtolist.md) %}


