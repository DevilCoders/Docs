Мониторинги колдунщиков, удобный пуш событий в голован
======================================================

Ответственный: maxim98@

Правило переранжирования MonitorWizard позволяет удобно добавлять сигналы следующих событий в Голован:
1) наличие в группировках d, e и wizplaces (центральная, правая колонка и карусель на серпе) определённых колдунщиков,
2) формат источника в ноапаче (nonempty, empty, unanswer, partial)
3) search\_props\`ы верхнего

1.Настройка мониторингов и push'а сигналов в голован
-------------------------------------------------------

Первоначально этот проект задумывался как мониторинг колдунщиков (отсюда и название). Принцип работы следующий:
алгоритм пробегается последовательно по документам группировок d и e (Важно! в целях оптимизации рассматриваются
только документы, умещающиеся на странице). Затем, для каждого документы запускается проверка на то, является ли
он [этот документ] колдунщиком. К сожалению, колдунщики делались разными командами в разное время, поэтому не 
существует общего механизма идентификации колдунщика. На текущий момент поддерживается идентификация по полям в 
\_SerpInfo, \_Markers и ServerDescr в документе.

Пример кода для push'а сигнала о наличии колдунщика abracadabra в правой колонке в Голован
```json
{
    "Wizards": {
        "signals": {
            "web-desktop-ru-right": [ "...", "abracadabra", "..." ]
        },
        "description": {
            "abracadabra": [
                {
                    "attribute": "_SerpInfo",
                    "path": "type",
                    "result": "abraca"
                },
                {
                    "attribute": "_Markers",
                    "result": "dabra"
                }
            ]
        }
    }
}
```
Здесь проверяется, что в \_SerpInfo документа по пути type лежит поле abraca и что хотя бы один маркер равен dabra.
После этого в интерфейсе Голована можно будет найти сигнал unistat-WizardMonitor-iznanka-desktop-ru-central-abracadabra\_dmmm
Алёрт можно настроить самому через интерфейс Голована или добавить в поле notifications похожее содержимое
```json
{
    "Wizards": {
        "notifications": {
            "abracadabra": {
                "your_login": {
                    "CRIT": ["sms", "telegram", "email"],
                    "WARN": ["telegram"],
                    "prj": ["web-main"]
                }
            }
        }
    }
}
```
**Как собрать панель колдунщиков и добавить алёрт**
После того, как выкатился ваш коммит и в головане стали появлятся сигналы, можно включать уведомления (по умолчанию сигналы приходят с 10 утра и до 10 вечера). Чтобы это сделать, нужно собрать генератор панели (он обновит список алёртов и сгенерирует панель, которую можно вставить в голован и увидеть состояния алёртов и графиков).


2.Форматы ответа источника в noapache
---------------------------------------
С помощью этой функциональности в Голован можно пушить сигналы о формате ответов различных источников.
Указываем имя и тип нужного формата. Сейчас доступны
1) unanswer -- источник не ответил
2) empty -- источник ответил пустой группировкой
3) nonempty -- источник ответил непустой группировкой
4) partial -- не все базовые поиски вернули ответ


3.search\_props и записи LocalScheme
---------------------------------------
Эта функциональность позволяет пушить информацию из GlobalScheme и search\_props верхнего. Для этого, надо написать небольшой handler в monitor.cpp (примеры там имеются), который будет описывать при каких условиях надо пушить сигнал. Кроме того, можно в conf.json описывать когда этот handler будет работать (на каких срезах, интентах и при каких условиях). Например, handler может обрабатывать срабатывания фильтров, поэтому можно флагом запретить использовать интент далее). Можно отключить зависимость от наличия интента, или включить зависимость от наличия группировки. 
