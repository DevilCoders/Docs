Передача данных от одного переранжирования другому
==================================================

Передача атрибутов
==================

**Q**: У нас есть 2 переранжирования Antispam и FilterBanned, И мы хотим информацию из Antispam протащить в FilterBanned. В конфиге Antispam идет после FilterBanned.
   Но Antispam работает на стадии AfterMerge, а FilterBanned на стадии AfterFetch. В Antispam записываем в документы через setGta() значение. Но в Filterbanned его не видно.
   Как сделать правильно, чтобы атрибут был виден в FilterBanned?

**A**: Должен помочь метод MutableMetaAttrs (см. [mergedres.h](https://a.yandex-team.ru/arc/trunk/arcadia/search/meta/mergedres.h)). Эти атрибуты (если
   не предпринимать специальных действий) живут в течение одного цикла слияний/переранжирований и не едут дальше наверх. Самое то для передачи данных между переранжированиями.
   Если цикл слияния будет повторен, эти атрибуты нужно добавлять ко всем нужным документам заново.

Передача данных, не привязанных к документу
===========================================

**Q**: Как мне передать данные, которые не привязаны к конкретному документу?

**A**: Используйте Clipboard(). Для этого и предназначался (c) vmordovin@

Передача документов со среднего метапоиска WEB на верхний
===========================================

**Q**: Как правильно передать документы со среднего метапоиска на верхний?

**A**: Обычный сценарий заключается в том, что верхний метапоиск может заранее указать группировки и их характеристики.
Пример [0](https://a.yandex-team.ru/arc/trunk/arcadia/search/begemot/rules/src_setup/web/rule.cpp?rev=5622474#L601).
Пример [1](https://a.yandex-team.ru/arc/trunk/arcadia/search/web/adjust_client_params/wizard_carousel/adjuster.cpp?rev=3996989#L12).
Пример [2](https://a.yandex-team.ru/arc/trunk/arcadia/search/web/rearrange/wizard_carousel/wizard_carousel.cpp?rev=5339506#L109).
Недостаток данного метода в том, что работать будет не очень - будет посылаться на базовый, мёржиться, переранжироваться.

Чтобы этого избежать, для пересылки документов со среднего на верхний создан специальный транспорт - правила UserGroupingsSave/UserGroupingsLoad.
Пример [отправки](https://a.yandex-team.ru/arc/trunk/arcadia/search/web/rearrange/img_quick_group_by_relevance/img_quick_group_by_relevance.cpp?rev=5624474#L139) группировки на среднем.
Пример [получения](https://a.yandex-team.ru/arc/trunk/arcadia/search/web/rearrange/img_quick_group_by_relevance/img_quick_group_by_relevance.cpp?rev=5624474#L175) группировки на верхнем.
Чтобы группировка была послана, отправляющее правило на среднем должно быть до UserGroupingsSave (либо отправлять ещё на этапе AfterMerge).
Чтобы группировка была получена, принимающее правило на верхнем должно быть после UserGroupingsLoad (либо получать уже на этапе AfterFetch).

Отладка работы правил
===========================================
**Q**: В коде правила написано `if (IsDbg())` { как включить этот режим?

**A**: Отладочный режим для конкретного правила включется параметром `&rearr=ПРАВИЛО_dbg=1`, где `ПРАВИЛО` - имя правила переранжирования. Пример `&rearr=Stocks_dbg=1`

