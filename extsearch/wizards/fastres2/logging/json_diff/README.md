# Нахождение диффа между версиями колдунщика

Поэтапно это происходит следующим ообразом:
1. Дампим json'ы предыдущей и текущей версии в строку, которую преобарзуем в набор байтов. **Важный момент** русские символы кодируются двумя байтами! Чтобы сохранить побайтное представление сткроки, в файл записываем символы разделенные пробелом. Это верно для всех символов, однако после `\n` пробел не нужен, поскольку он будет перенесен на новую строку и это нарушит логику.
2. Выполняем команду `diff -u previous_wizard.txt current_wizard.txt > output.txt`. Таким образом находим дифф между сдампленными колдунщиками и сохраняем результат в файл
3. Читаем полученный файл
    1. Проверяем, что он не пуст, поскольку пустые файлы означают идентичность колдунщиков
    2. Пропускаем первые 2 строки, поскольку они базовые и имеют вид
    ```
    ---previous wizard <datetime>
    +++current wizard <datetime>
    ```
    3. Выполняем полезное чтение по следующим правилам:
        1. Читаем символ в массив
        2. Если прочитанный символ - первый символ строки и это:
            - символ - `@`, то последующая строка добавлена утилутой `diff` и не содержит лишних пробелов. Поэтому ее нужно прочитать полностью до конца
            - символ - `+, -, ' '`, то последующий пробел является символом, добавленным утилутой, поэтому пропускать его нельзя.
        3. Проверяем, что прочитанный символ не `\n` и мы можем пропустить чтение следующего символа (поскольку он на самом деле может быть - fake пробел)
        4. Если символ  - `\n`, то необходимо собранный массив байтов в массив массивов байтов (его можно считать массивом строк прочитанного файла)
        5. Возвращаемся к п.1.
    4. Раскрашиваем прочитанный массив строк и разворачиваем его в простой массив байтов
4. Удаляем использованные файлы и возвращаем результат

### Обоснование почему без этого не работает
Конкретного ответа нет, есть предположения. В ходе починки диффа, обнаружил, что файлы содержащие сдампленные колдунщики, могли быть в разной кодировке. Поскольку русские символы интерпретируются по-разному, после применения утилуты `diff` некоторые диффы становились битыми, ломаясь как раз на русских символах. Были попытки явно задать кодировку, но это не помогло. Стабильно 1-3 диффа из 1000 ломались.

Текущий вариант записи в файл *ломает* двубайтное представление русских символов, поскольку между этими двумя байтами вставляем фейковый ascii символ (пробел). Таким образом каждый символ представляется одним байтом, используется одинковая кодировка файлов.
