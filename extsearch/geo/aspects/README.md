### Описание полей аспекта в Алтае

* [message Aspect в company.proto](https://a.yandex-team.ru/arc/trunk/arcadia/sprav/protos/company.proto?rev=r9041376#L96)
* [пример аспекта](https://altay.yandex-team.ru/aspect/3502043159)

###
* `id` - уникальный идентификатор аспекта
* `commit_id` - id последнего коммита-изменения аспекта
* `publishing_status` - принимает два значения `publish` и `obsolete`. Статус `obsolete` обозначает, что аспект должен игноририроваться всеми существующими процессами
* `model_id`- привязанные к аспекту енумы/фичи/рубрики. Планируется использовать для выделения аспектов из запроса (выделяем фичу и маппим её в аспект)
* `photo.image_embedding`:
  * `name` - синоним аспекта, по которому он выделяется на фото (по близости эмбеддингов фото и текста синонима). Также используется для инициализации обучающего пула для классификатора данного аспекта. 
  * `threshold` - задает порог близости между эмбеддингами фото и текста синонима, по которому считается факт наличия аспекта на фото (ставить `-1`, что порог подбирался автоматически путем разметки небольших сэмплов в Толоке)
* `photo.tags` - тег Алтае, по которому проставляется аспект (в Алтае есть свои классификаторы фотографий, и некоторые классы совпадают с аспектами, в этом случае используем их)
* `bert` - поле используется в модели извлечения аспекта из текста отзыва. Текст из этого поля конкатенируется с текстом отзыва и на полученном тексте делается инференс. Может быть как одним словом синонимом аспекта, так и несколькими синонимами через пробел как [тут](https://altay.yandex-team.ru/aspect/3502044645)
* `regexps` - регулярки для аспекта
* `menu_regexps` - регулярки от 1орг для выделения аспектов из меню
* `names` - название аспекта. Поле показывается в градуснике, во вьювере отзывов, в смарт тегах, разметке и т.д. Если поле не заполнено, то в качестве названия аспекта берется название первой сущности из поля `model_id`
* `children_aspect_ids` - id аспектов-детей. Используется в фильтрах-табиках в колдунщике ЧЗ
* `aspect_statuses` - статусы аспекта (флаги, определяющие попадание аспекта в определенные процессы):
    * `top_wizard_aspect` - табик-фильтр приходит из колдунщика по умолчанию (=верхнеуровневый фильтр)
    * `extracted_from_reviews` - аспект извлекается из отзывов. Проставляется пользователем.
    * `extracted_from_reviews_bert/regexp_prod/test` - аспект извлекается из отзывов с помощью берта/регулярок и должен быть в проде/тесте(проставляется автоматически)
    * `extracted_from_photos` - аспект извлекается из фото. Проставляется пользователем
    * `smart_tag` - для аспекта считаются смарт теги
    * `smart_tag_markup` - для аспекта работает разметка для смарт тегов (отдельный статус, потому что можем хотеть смарт тег у аспекта, но размечать проверить асессорами наличие нельзя)
    * `enable_in_wizard_ui` - пока не используется, но хочется по этому флагу аспекты прокидывать в табики колдунщика (а по умолчанию не включать)
* `aspect_types` - не используется
* `rubric_ids` - ограничение на рубрики для аспекта:
    * для аспектов со статусом `extracted_from_reviews`(аспект выделяется из отзывов) отзывы берутся только на те организации, для которых **главная рубрика** попадает в список `rubric_ids`
    * для `extracted_from_photos` - берутся фотографии тех организаций, для которых **хотя бы одна рубрика** попадает в список `rubric_ids`
* `descriptions` - описание аспекта. Используется в процессах разметки, как дополнительное описание того, что нужно найти в отзыве или на фото
* `weak_model_id` - аналогично `model_id`. Используется для показа градусника в случае, если в запросе есть рубрика или фича, привязанные к данному полю

---

### Инструкция по добавлению аспекта

#### Для нового градусника:
Обязательные поля:
* `names`/`model_id`(обязательно для `ru` и `en` локали)
* `rubric_ids`
* `bert`
* `aspect_statuses` => `extracted_from_reviews`

Опциональные поля:
* `descriptions` - если по названию аспекта непонятно о чем этот аспект, аспект слишком общий или субъективный, то имеет смысл уточнить его через это поле ([пример заказа на заполнение асессорами](https://st.yandex-team.ru/ACONTENT-108701))

#### Для нового градусника c фото:
Нужно решить, возможно ли вообще в данном аспекте выделение из фото. Является ли данный аспект объектом, который можно завпечатлеть на фото? Примеры аспекты с фотографиями: бургер, интерьер, маникюр; без фотографий: время ожидания, сервис, атмосфера.

Хороший способ проверить синоним - это посмотреть, какая по нему картиночная выдача, совпадает ли ожидание с реальностью? (пример плохого синонима: [палаты](https://yandex.ru/images/search?text=%D0%BF%D0%B0%D0%BB%D0%B0%D1%82%D1%8B), хотя имеются в виду [больничные палаты](https://yandex.ru/images/search?text=%D0%B1%D0%BE%D0%BB%D1%8C%D0%BD%D0%B8%D1%87%D0%BD%D1%8B%D0%B5%20%D0%BF%D0%B0%D0%BB%D0%B0%D1%82%D1%8B)). Потенциально плохие синонимы попадают в [таблицу](https://charts.yandex-team.ru/g/CCUFYOSUPB) на дашборде.

Часто хорошим уточнением синонима является добавлению к нему рубрики организации (`сидр` => `сидр бар`, потому что на фото организаций скорее ожидается сидр в интерьере организаций, а не на белом фоне или из рекламы).

Обязательные поля:
* см. `Аспект для нового градусника`
* `photo.image_embedding`
* `aspect_statuses` => `extracted_from_photos`

#### Для смарт тега:
Обязательные поля:
* `names`/`model_id`
* `rubric_ids`
* `descriptions`
* `aspect_statuses` => `smart_tag`

Опциональные поля:
* `aspect_statuses` => `smart_tag_markup` - добавить, если возможно проверить по сайту/соц. сетями/фотографиям наличие аспекта в организации. Критерии аналогичны статусу `extracted_from_photos`

#### Для колдунщика ЧЗ
TODO
