## Общие рекомендации

### Основные параметры поискового API

В основном запрос в поисковое API состоит из следующих частей:

* текст и окно запроса
* желаемые типы ответов
* язык, на котором хочется получить ответ

Их можно передать через параметры:

| **Название** | **Описание** | **Пример** |
| ------------ | ------------ | ---------- |
| [text](http://wiki.yandex-team.ru/maps/dev/params/text) | текст запроса | `text=москва,льва+толстого,16` |
| [ll](http://wiki.yandex-team.ru/maps/dev/params/ll) | центр окна запроса | `ll=37.5,55.6` |
| [spn](http://wiki.yandex-team.ru/maps/dev/params/spn) | размер окна запроса | `spn=1,1` |
| [lang](http://wiki.yandex-team.ru/maps/dev/params/lang) | интересующий язык ответа | `lang=en_US` |
| [type](http://wiki.yandex-team.ru/maps/dev/params/type) | тип интересующих ответов | `type=biz,geo` (по умолчанию - все типы) |

Рассмотрим подробнее параметр `type`, который ограничивает тип ответов, интересующих клиента API. Например, если известно, что
исходный запрос - это адрес, то достаточно передать `type=geo`, исключив тем самым из ответа организации и прочие виды
объектов, и оставив только топонимы. Если же исходный запрос берется из пользовательского ввода, то, например, можно передать
`type=biz,geo` чтобы одновременно обработать два основных поисковых случая -- поиск организаций и мест.

Тип объектов в ответе определяется proto-файлом его метаданных и однозначным образом связан с `type`:

| **type** | **тип ответа** | **схемы ответа** |
| -------- | -------------- | ---------------- |
| `geo` | топонимы | [proto](https://a.yandex-team.ru/arc/trunk/arcadia/maps/doc/proto/yandex/maps/proto/search/geocoder.proto) |
| `biz` | организации | [proto](https://a.yandex-team.ru/arc/trunk/arcadia/maps/doc/proto/yandex/maps/proto/search/business.proto) |
| `transit` | маршруты общественного транспорта | [proto](https://a.yandex-team.ru/arc/trunk/arcadia/maps/doc/proto/yandex/maps/proto/search/transit.proto) |

Заметим, однако, что каждый объект в ответе может содержать не одни, а несколько метаданных, и **ограничение ответов параметром type=A не означает того,
что в ответе будут исключительно метаданные типа A**. Результат будет другой: `type=A` гарантирует, что в каждом объекте будет хотя бы одни метаданные типа `A`.

Если же в запросе было указано несколько типов объектов (например `type=A,B`), то гарантируется, что в каждом ответе будут либо метаданные типа A, либо типа B,
либо оба — иначе говоря, не будет ни одного ответа, в котором нет ни тех, ни других метаданных.

Более полный список приведен в [описании API](https://a.yandex-team.ru/arc/trunk/arcadia/extsearch/geo#parameters).

Кроме того, есть набор параметров, имеющих смысл только для одного из источников. Например, id организации имеет смысл только для ППО.
Такие параметры явно квалифицируются именем источника, например: `business_oid`.

### Context

Часто возникают ситуации, когда на один пользовательский запрос (ввод текста запроса в поисковую форму) приходится несколько запросов в
API. Например, пользователь поискал 'кафе', а потом подвигал карту, или включил фильтры, или попросил вторую страницу результатов. Для связи
последующих запросов с первоначальным используются CGI-параметр `ctx`, и поле `context` из ответа API, которые нужно использовать так:

1. При первичном поиске спрашиваем без `ctx` и запоминаем значение контекста из поля `context`
2. При любых повторных запросах (drag, zoom, фильтрация ответа, следующая страница результатов) передаем (в параметре `ctx`) `context` из предыдущего ответа и запоминаем новый `context`.

Некоторый нюанс: при любых повторных запросах, не связанных с drag/zoom, (то есть, когда у вас нет в явном виде нового окна поиска для запроса), в качестве окна поиска следует использовать окно от предыдущего ответа `search.SEARCH_RESPONSE_METADATA.bounded_by`,
потому что, вообще говоря, оно может не совпадать с окном в первичном запросе. Например, из-за произошедшего autoscale'а или наличия в запросе географии.

Говоря более подробно, можно выделить два вида взаимодействия клиентов с поисковым API:

1. первичные запросы - то есть передача нового поискового запроса, никак не связанного с предыдущими действиями пользователя
2. вторичные запросы (drag, zoom) - то есть запросы, связанные с предварительно заданным первичным запросом

Для первичных запросов ничего специального при обращении в API поиска делать не нужно, а вот вторичный запрос надо
уметь связывать с предыдущим. Делается это так:  в любом ответе поиска есть поле
`search_internal.SEARCH_RESPONSE_INFO.context`, (см. [proto](https://a.yandex-team.ru/arc/trunk/arcadia/maps/doc/proto/yandex/maps/proto/search/search_internal.proto) содержимое которого можно передать в API через параметр `ctx`.
Если такой параметр передан, то поиск считает запрос вторичным, если нет - то первичным.

### Display

Ответ на вопрос - 'нужно ли делать вторичные запросы и когда', вообще говоря, зависит от набора результатов, которые вернулись при
первичном запросе. Например, перезапрашивать запрос 'Москва' при перемещении карты, наверное, не стоит (в отличие от запроса
'кафе'). Для этого в ответе поиска есть поле 'тип показа ответа' `search_internal.SEARCH_RESPONSE_INFO.display` со значениями `SINGLE` и
`MULTIPLE`

Значение `SINGLE` означает, что, скорее всего, запросу релевантен только один результат; при этом клиентам рекомендуется позиционировать карту на первый ответ поиска, и при перемещениях карты больше ничего не перезапрашивать.

Значение `MULTIPLE` означает, что, скорее всего, запросу релевантны несколько результатов и клиентам рекомендуется показать все ответы поиска сразу, и при перемещениях карты осуществлять вторичные запросы. При этом перезапросы рекомендуется делать не при любом перемещении карты, а, например, тогда, когда из нового окна пропало больше половины показанных результатов.

### Статистика

Помимо контекста, 'хорошо ведущие себя' клиенты должны передавать два параметра для учета поведения пользователей:

* `parent_reqid`
* `serpid`

`parent_reqid` - это `reqid`, который вернул сервис поиска в ответ на предыдущий запрос.

Передается всегда, кроме самого первого запроса. Нужен для того, чтобы при обработке логов выстроить полную цепочку запросов, заданных данным клиентом.

`serpid` - идентификатор 'запросной сессии'.

Сбрасывается (т.е. не передается) только тогда, когда пользователь ввел новый текст в форму запроса. При всех остальных действиях - drag'и, zoom'ы, включение фильтров и т.п. - остается неизменным (т.е. передается тот же, который вернулся в ответ на предыдущий запрос)

#### Пример работы со статистикой

| **Последовательные действия клиента** | **CGI-параметры для статистики** | **ответ сервиса** |
| ------------------------------------- | -------------------------------- | ----------------- |
| Ввод запроса `кафе` | отсутствуют | reqid=r100, serpid=s200 |
| zoom на метро парк культуры | `parent_reqid=r100&serpid=s200` | reqid=r101, serpid=s200 |
| drag (первый) | `parent_reqid=r101&serpid=s200` | reqid=r102, serpid=s200 |
| drag, drag, drag... | ... | ... |
| drag (последний) | `parent_reqid=r115&serpid=s200` | reqid=r116, serpid=s200 |
| включение фильтра 'круглосуточно' | `parent_reqid=r116&serpid=s200` | reqid=r117, serpid=s200 |
| ввод запроса 'аптека' | `parent_reqid=r117` | reqid=r118, serpid=s212 |
| drag | `parent_reqid=r118&serpid=s212` | reqid=r119, serpid=s212 |

### Схема ответа

Описание ответа сервиса в целом:

  - [response.proto](https://a.yandex-team.ru/arc/trunk/arcadia/maps/doc/proto/yandex/maps/proto/common2/response.proto)

Описание основной метадаты (SEARCH_RESPONSE_METADATA), входящей в GeoObject:

  - [search.proto](https://a.yandex-team.ru/arc/trunk/arcadia/maps/doc/proto/yandex/maps/proto/search/search.proto)

При этом отдельные части ответа описываются своими собственными схемами, см. выше.

### Ответ в protobuf-формате
На текущий момент `addrs.yandex.ru` поддерживает только один формат ответа: protobuf.

Для запросов необходимо использовать TVM аутентификацию.

Параметр `ms=pb` в запросах на этот endpoint включает protobuf-выдачу,а `hr=yes` - её human-readable вариант, например:
запрос 'кафе' в [human-readable](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&origin=guide&ll=37.6,55.7&spn=0.5,0.5&text=cafe&hr=yes) и [binary](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&origin=guide&ll=37.6,55.7&spn=0.5,0.5&text=cafe) protobuf-форматах.

## Часто встречающиеся use-cases

### Поиск произвольного пользовательского запроса

#### Поиск в текущем окне карты

Если есть пользовательский запрос и окно карты, в котором его нужно осуществить, то передаются три параметра: `text`, `ll` и `spn`.

Например, поиск 'кафе' в bounding box'е саратова [..&text=кафе&ll=46.02,51.54&spn=0.2,0.07&..](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=ru&text=кафе&ll=46.02,51.54&spn=0.2,0.07&origin=example)

#### Поиск запроса, содержащего географию

Внутри пользовательского запроса может присутствовать география, например 'кафе в москве'. При этом она будет
автоматически выделена из запроса, геокодирована, и поиск оставшейся части (в данном случае 'кафе') будет произведен в том окне,
которое получилось при геокодировании этой выделенной географии; при этом окно, указанное в параметрах ll/spn будет проигнорировано
и может быть совсем опущено из исходного запроса.

Поиск 'кафе в казани' из москвы: [..&text=кафе в казани&ll=37,55&spn=0.5,0.5&..](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=ru&text=кафе%20в%20казани&ll=37,55&spn=0.5,0.5&origin=example)

Поиск 'кафе на невском проспекте' без окна [..&text=кафе на невском проспекте&..](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=ru&text=text=кафе%20на%20невском%20проспекте&origin=example)

#### Поиск 'рядом со мной'

Для поиска объектов рядом со мной проще всего передать текущую пользовательскую точку в параметре `ll`, например
поиск 'кафе' рядом с яндексом [..&text=кафе&ll=37.588194,55.733856&..](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=ru&text=кафе&ll=37.588194,55.733856&origin=example)

#### Местоположение пользователя

Если известно текущее положение пользователя, то его можно добавить в любой поисковый запрос с помощью параметра [ull](http://wiki.yandex-team.ru/maps/dev/params/ull),
тогда сервер сможет использовать расстояние до пользователя как фактор при ранжировании результатов.

### Геокодирование

Если заранее известно, что в запросе может быть только адрес, то можно перейти в режим геокодирования,
ограничив тип ответов поиска только топонимами с помощью параметра `type=geo`.

#### Поиск произвольного адреса

Для поиска адреса достаточно передать его в `text` и ограничить тип ответов топонимами `type=geo`, например
поиск адреса 'Россия, Питер, Невский проспект, 3' [..&type=geo&text=Россия,Питер,Невский проспект,3&..](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=ru&type=geo&text=Россия,Питер,Невский%20проспект,3&origin=example)

#### Подсветка геометрии объектов

Для того, чтобы получить в ответе поиска геометрию объекта, надо добавить в запрос параметр `geometry=1`,
тогда геометрия будет присутствовать в поле `geo_object.geometry`. Для получения геометрии дома нужно передать `geometry=2`.

Геометрия ленинского проспекта [..&type=geo&text=Москва,Ленинский проспект&geometry=1&..](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=ru&type=geo&text=Москва,Ленинский%20проспект&geometry=1&origin=example)

#### Обратное геокодирование по тексту

В параметр text можно передавать и координаты, которые распознаются либо в одном из [следующих видов](https://tech.yandex.ru/maps/doc/geocoder/desc/concepts/input_params-docpage/#geocode-format), либо по умолчанию в порядке 'широта,долгота'.

Отметим, что в этом режиме геокодеру придётся приводить содержимое параметра text к одному из перечисленных видов,
так что если есть точные координаты нужной точки (lon,lat), то проще воспользоваться [обратным поиском](#обратный-поиск).

**Внимание: в параметре text, так как в нём возможен и пользовательский ввод, избран наиболее часто встречающийся
порядок координат (широта, долгота), что отличается от порядка координат в параметре ll**.

Поиск с явным указанием вида координат: [.&text=55.73377 N 37.587937 E&..](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=ru&text=55.73377%20N%2037.587937%20E&origin=example)

### Поиск по организациям (ППО)

#### Поиск организации по id

Если известен id организации, то информацию о ней можно получить, передав в поиск параметр `business_oid`, например:
поиск 'гостиницы Космос' по ее id [..&type=biz&business_oid=1092168679&..](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=ru&type=biz&business_oid=1092168679&origin=example)

#### Фильтры в организациях (параметрические)

В некоторых регионах в ответе ППО есть информация о фильтрах, которые можно включить в этом регионе,
чтобы отфильтровать выдачу по интересующим пользователя параметрам.
Фильтры в ответе упорядочены по значимости и находятся в полях `business.RESPONSE_METADATA.filter`, см. [business.proto](https://a.yandex-team.ru/arc/trunk/arcadia/maps/doc/proto/yandex/maps/proto/search/business.proto?rev=4258529#L56)

Например, см. ответ по запросу 'кафе в москве' [type=biz&text=кафе в москве](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=ru&type=biz&text=кафе%20в%20москве&origin=example)

Получив такой ответ, можно фильтровать выдачу на основе фильтров из первичного ответа. В каждом из фильтров есть `id` и набор значений,
которые можно передать через параметр `business_filter=id:value1,value2&business_filter=id2:value3,value4`
При этом несколько заданных фильтров группируются через 'и', а несколько значений одного фильтра - через 'или'.

Например, поиск кафе с wi-fi и итальянской или грузинской кухней:
 [.&type=biz&text=кафе&business_filter=type_cuisine:italian_cuisine,georgian_cuisine&business_filter=wi_fi:1](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=ru&type=biz&text=кафе&business_filter=type_cuisine:italian_cuisine,georgian_cuisine&business_filter=wi_fi:1&origin=example)

В настоящий момент поддерживаются два типа фильтров:

* `boolean_filter` - булевый
* `enum_filter` - фильтр, основанный на признаке-перечислении

Возможными значениями для `boolean_filter` являются 1 или 0. Бывают случаи, когда в какой-то степени осмысленно
указать (через 'или') сразу оба значения для булевого фильтра, например, [business_filter=wi_fi:1,0](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=ru&type=biz&text=кафе&ll=37.5,55.6&spn=0.5,0.5&business_filter=wi_fi:1,0&origin=example)
В этом случае в ответе будут присутствовать только те организации, про которые точно известно, есть ли в них wi-fi или нет.

Булевые фильтры в основном основаны на булевых признаках организации (например, `wi_fi`).
Кроме этого, есть три булевых фильтра, связанных со временем работы:

* `open_24h` - круглосуточно
* `on_duty` - дежурная
* `open_now` - работает сейчас

Информация о возможных значениях конкретного `enum_filter` приходит в ответе вместе с ним. Вот так, например, выглядит фильтр
`type_cuisine` в ответе на запрос [..&business_filter=type_cuisine:italian_cuisine,chinese_cuisine..](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=ru&type=biz&text=кафе&ll=37.5,55.6&spn=0.5,0.5&business_filter=type_cuisine:italian_cuisine,chinese_cuisine&origin=example)

enum_filter example
```
filter {
   id: "type_cuisine"
   name: "кухня"
   enum_filter {
     value {
       value {
         id: "european_cuisine"
         name: "европейская"
       }
     }
     value {
       value {
         id: "russian_cuisine"
         name: "русская"
       }
     }
     value {
       value {
         id: "italian_cuisine"
         name: "итальянская"
       }
     }
     value {
       value {
         id: "japanese_cuisine"
         name: "японская"
       }
     }
     ...
   }
}
```

#### Disabled-фильтры

У каждого фильтра есть необязательный атрибут `disabled`. Он выставляется в true в том случае, если нажатие на этот фильтр приведет к пустой выдаче поиска.

Например: поискал пользователь кафе в некоторой области, и несмотря на то, что для кафе есть фильтр 'доставка еды',
в результирующем найденном окне нет ни одного кафе с доставкой.  Клиенты, поддерживающие такой атрибут, могут скрывать такие фильтры или делать их неактивными,
чтобы лишний раз не огорчать пользователя.


#### Язык запросов в ППО

В поиске по организациям оставлен рудиментарный язык запросов: части запросов можно объединять через пробел,
что соответствует оператору `AND`, или через `|`, что соответствует оператору `OR`.
Под частью запроса понимается либо отдельное слово, либо группа слов, заключенная в круглые скобки.
Помимо этого, поддерживается поиск в зонах с использованием синтаксиса `имя_зоны:(запрос)`

В настоящее время поддерживается несколько зон.

Зона `rubric` позволяет осуществить тот частый случай, когда клиент API хочет одновременно произвести поиск по нескольким категориям объектов — например,
сразу и по кафе и по салонам красоты. Это можно сделать следующим запросом: `rubric:(кафе) | rubric:(салон красоты)`

Заметим, что в зонном поиске, так же как и в обычном, работает морфология (например, запросы `rubric:(аптека)` и `rubric:(аптеки)` тождественны) и,
помимо названий рубрик, можно использовать синонимы к рубрикам на всех языках.
(например, запрос про кафе мог выглядеть и так: `rubric:(cafe) | rubric:(beauty salons)`

Зона `category_id` также осуществляет поиск по рубрике, только рубрика задаётся внутренним id из базы организаций,
а не человеческим названием. Морфология в этом случае не работает. [пример запроса](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=ru&text=category_id%3A(184105932)&origin=example)

Зона `chain_id` осуществляет поиск по сети с заданным id из базы организаций. Например, [Сбербанки можно поискать так](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=ru&text=chain_id%3A(6003612)&origin=example)

Зона `feature` позволяет искать по заданному признаку. Признак может быть любого типа: булевый, числовой, текстовый.
Например, [круглосуточные организации ищутся так](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=ru&text=feature%3A(open_24h%3A1)&origin=example)

Все вышеперечисленные зоны можно комбинировать в одном запросе.
Например, [филиалы Райффайзенбанка, принимающие карточки "Мир" ищутся так](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=ru&text=feature%3A(accepts_card_mir%3A1)%20chain_id%3A(6003399)&origin=example)


### Обратный поиск
Этот режим включается параметром `mode=reverse`. В нём параметр `ll` задаёт точку для обратного поиска,
а параметр `type` может принимать одно из двух значений:

* `geo` - обратное геокодирование
* `biz` - 'организации в этом доме'

Этот режим удобно использовать, когда известны координаты точки в которой необходимо осуществить поиск.
Если надо поискать произвольную строчку, которая может быть координатами, а может и не быть ими,
то удобнее использовать [обратное геокодирование по тексту](#обратное-геокодирование-по-тексту)

#### Обратное геокодирование

`mode=reverse&type=geo&ll=lon,lat`

На первом месте в ответе на такой запрос будет наиболее подробный найденный топоним (например, дом),
а затем иерархия этого топонима вплоть до страны снизу вверх: `улица/район/город/область/страна`.
Если иерархия не нужна, то количество ответов можно ограничить с помощью параметра `results=1`.

Например, [поиск топонимов по координатам Яндекса](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=ru&mode=reverse&ll=37.587937,55.73377&type=geo&origin=example)

#### Организации 'в этом доме'

`mode=reverse&type=biz&ll=lon,lat`

В этом режиме в ответе будут только те организации, про которые поиск точно знает, что они находятся в доме,
в который попадает переданная в параметре `ll` точка.

Например, [поиск организаций по координатам Яндекса](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=ru&mode=reverse&ll=37.587937,55.73377&type=biz&origin=example)

#### Режим геокодирования 'Что здесь'
Режим 'что здесь', в отличии от обычного обратного геокодирования, предназначен для поиска на каком-то конкретном масштабе,
будь то нажатие на кнопку 'получить информацию' на maps.yandex.ru, или кнопка 'что здесь?' на мобильном устройстве.
При таком поиске важнее найти крупный объект, расположенный рядом (скажем, в 10 pixels от места клика),
чем более мелкий объект, хотя бы и более точно соответствующий исходным координатам.
(Например, с масштаба карты, на котором видно сразу и Москву и Питер, наверное, не имеет смысла искать отдельные дома)

Для включения этого режима надо передать текущий зум карты `z` и специальный параметр `geocoder_pin=1`, например

Клик мышкой в новгород с шестого масштаба [..&text=58.533734 31.236443&z=6&geocoder_pin=1&..](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=ru&text=58.533734%2031.236443&z=6&geocoder_pin=1&origin=example)

А вот что будет без параметра `geocoder_pin` [..&text=58.533734 31.236443&z=6&..](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=ru&text=58.533734%2031.236443&z=6&origin=example)

## Разное

#### Ответ на заданном языке

В запросе к поиску можно указать желаемый язык ответа с помощью параметра [lang](http://wiki.yandex-team.ru/maps/dev/params/lang).
Этот параметр определяет только вид ответа, и никак не влияет на процесс поиска и список найденных результатов.
При этом, если для какой-то части данных вместо информации на запрошенном языке она есть на некоторых других,
то для этой части данных будет выбран язык наиболее близкий к запрошенному.
Например, если для какой-то организации есть имя на турецком и английском, а признаки на английском и русском,
то при запросе с разными lang будет происходить следующее:

| **lang** | **имя (турецкий, английский)** | **признаки (английский,русский)** |
| -------- | ------------------------------ | --------------------------------- |
| `ru_RU` | английский | русский |
| `tr_TR` | турецкий | английский |
| `uk_UA` | английский | русский |
| `en_US` | английский | английский |
| `fr_FR` | английский | английский |

Поиск 'яндекс' для русскоязычного пользователя [..&lang=ru_RU&text=яндекс&..](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=ru_RU&text=яндекс&origin=example)

Тот же поиск для англоязычного пользователя [..&lang=en_US&text=яндекс&..](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=en_US&text=яндекс&origin=example)

#### URI

Для некоторых объектов в ответе геопоиска есть URI (находится в
`uri.GEO_OBJECT_METADATA.uri`, см. [proto](https://a.yandex-team.ru/arc/trunk/arcadia/maps/doc/proto/yandex/maps/proto/uri/uri.proto))
Такой URI можно запомнить, и впоследствии разрешить его обратно в объект, сделав запрос  с параметром `uri=...`.
**Обратите внимание, что при формировании запроса uri необходимо encode'ить**

Постоянность uri одного и того же объекта, вообще говоря, не гарантируется;
верно лишь то, что поиск и по 'старому', и по 'новому' uri вернёт один и тот же объект.

Примеры URI:

| **объект** | **uri** | **encoded uri** |
| ---------- | ------- | --------------- |
| гостиница космос | `ymapsbm1://org?oid=1092168679` | `ymapsbm1%3A//org%3Foid%3D1092168679` |
| Тихий океан | `ymapsbm1://geo?ll=-134.01%2C0.12&spn=191.70%2C121.22&text=Pacific ocean` | `ymapsbm1%3A//geo%3Fll%3D-134.01%2C0.12%3Fspn%3D191.70%2C121.22%3Ftext%3DPacific%20ocean` |

Поиск 'гостиницы Космос' по ее uri [..&uri=ymapsbm1%3A//org%3Foid%3D1092168679&..](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&uri=ymapsbm1%3A//org%3Foid%3D1092168679&origin=example)

[Подробнее про uri](https://wiki.yandex-team.ru/aleksandrstrashnov/geobookmarks)

#### Опечатки

Поисковое API умеет исправлять опечатки: [..&text=москва,льва тлстого&..](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=ru&text=москва,льва+тлстого&origin=example)

#### Постраничная выдача

Если по какому-то запросу находится много объектов, то можно их запрашивать по частям с помощью параметров `results` и `skip`.
При этом `results` ограничивает размер ответа, а `skip` задает сдвиг относительно начала.
Обратите внимание, что эти запросы также являются вторичными, и, в частности, в них надо передавать `context` и окно из предыдущего запроса.

Поиск первых пяти кафе в некотором окне [..&results=5&text=кафе&ll=37.61,55.76&spn=0.1,0.03&..](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=ru&results=5&text=кафе&ll=37.61,55.76&spn=0.1,0.03&origin=example)

Поиск следующих 5 кафе в том же окне [..&skip=5&results=5&text=кафе&ll=37.61,55.76&spn=0.1,0.03&..](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&lang=ru&skip=5&results=5&text=кафе&ll=37.61,55.76&spn=0.1,0.03&origin=example)

#### Сниппеты

Иногда в ответе API хочется получать дополнительную информацию о найденных поисковых объектах - так называемые 'сниппеты'.
Для того, чтобы получить такие сниппеты, надо их запросить через параметр `snippets`,
перечислив желаемые типы сниппетов через запятую.

Возможные значения `snippets`:

* `photos/2.x` — фотографии дома или организации
* `masstransit/2.x` — ближайшая станция метро к найденному объекту
* `panoramas/1.x` — ближайшая панорама
* `businessrating/2.x` — рейтинг найденной организации

В ответе сервиса каждый сниппет представлен как отдельные `metadata`, прицепленные к соответствующему `geo_object`, [см. примеры](https://a.yandex-team.ru/arc/trunk/arcadia/maps/doc/proto/yandex/maps/proto/search/examples)
При этом формат метаданных каждого сниппета [задан соответствующим proto](https://a.yandex-team.ru/arc/trunk/arcadia/maps/doc/proto/yandex/maps/proto/search/)

Поиск 'гостиница' в окне Москвы с запрошенными фотографиями и рейтингами [..&text=гостиница&snippets=businessrating/1.x,photos/2.x](http://addrs-testing.search.yandex.net/upper/stable/yandsearch?ms=pb&hr=yes&text=гостиница&snippets=businessrating/1.x,photos/2.x&origin=example)
