# Железный deduplicate

Очищает галереи из порций серпов от дупликатов по собранным факторам тумбов. Имеет 2 режима работы: сбор факторов и попарная дедупликация тумбов в галерее. Можно добавлять сборщики новых групп факторов и фильтры по этим группам.

Для добавления нового сборщика надо:

1. Унаследоваться от интерфейса NImages::NOntosearch::IFactorExtractor
2. Добавить сборщик в список, вовзращаемый методом NImages::NOntosearch::GetFactorExtractors()

Добавление нового фильтра происходит аналогично, но с интерфейсом NImages::NOntosearch::IDeduplicator и методом NImages::NOntosearch::GetDeduplicator(...)

Типы фильтров:

1. IFilter - фильтрует картинку по факторам, например, затекстованные картинки по ocr
2. IDeduplicator - находит похожие картинки среди загруженных в него.

## Команды
* extract-factors - извлекает факторы по заданной конфигурации
* filter-galleries - фильтрует галерею по факторам и конфигурации
* generate-configuration-file - дефолтная конфигурация
* validate-configuration - валидация конфигурации
* merge-face-factors - Добавляет в таблицу факторов лицевые факторы
* tests-face-factors - Создает таблицу, в которой содержится максимальное косинусное расстояние по всем лицам с двух картинок, а также урлы на эти картинки. Изображения берутся из галлереи, а их факторы из двух таблиц: таблицы с основными картинками и таблицы с базой вспомогательных картинок. Эта опция помогает подобрать порог для фильтрации по лицевым фичам.


## Конфигурирование и запуск

В файле `../../../configs/filters_config.json` лежат пороговые значения для отсева по разным группам факторов. Если дедупликатор активен, а значения для него не указано - операция упадет.
Можно активировать не все доступные сборщики факторов. Их полный список можно посмотреть, сгенерив дефолтную документацию
