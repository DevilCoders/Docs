# Как выкатываться в продакшен

Все действия здесь делает ответственный разработчик — человек, у кого самые большие задачи в релизе или тот, кто взялся вести релиз.



## Готовим релиз

 * Собери релиз (см. Builds.md)
 * Заведи релизный таск в стартреке (https://st.yandex-team.ru/createTicket?queue=PASSP&type=release)
   с названием `yandex-passport-frontend <version>`,
   с типом 'Релиз'
   и списком входящих в него задач (см. Сбор чейнджлога в Builds.md).
   Исполнителем поставь Наташу yanebo@, или Юлю angrybird@, если Наташа в отпуске.
   После создания переведи таск в 'Можно тестировать'.
   Пример: https://st.yandex-team.ru/PASSP-7400
 * Добавь eaandreeva@ в наблюдатели к релизному таску.
 * Переведи в статус "можно тестировать" все задачи, входящие в релиз.



## Когда катить?

Релиз можно катить, если в релизном таске
 * статус "Готов к выкладке"
 * есть отбивка "можно катить" от eaandreeva@
 * есть отчет о пройденных автотестах
 * есть коммент от тестировщика о пройденных ручных тестах и регрессии 

Обычно админы не приветствуют выкладки в пятницу, по вечерами или перед какими-то внешними событиями, типа учений.
Они об этом скажут после создания тикета в кондукторе и покатят когда посчитают нужным.


## Как катить

 * Заведи тикет в кондукторе (http://c.yandex-team.ru/tickets/new?ticket[packages][0]=yandex-passport-frontend&ticket[branch]=prestable)
   для пакета `yandex-passport-frontend`,
   в ветку `prestable`,
   версии, которая сейчас находится в тестинге
   (см. последнюю ссылку на кондуктор в релизном таске, эта версия должна подсвечиваться зеленым в дропдауне версий).
   В описание кинь ссылку на релизный таск.
 * Добавь ссылку на кондукторный тикет комментом в релизный таск 
 * Дай админам (abbat@, если его нет, то avmm@) ссылку на кондукторный тикет и напиши, что можно выкатывать
 * После выкатки в престейбл посмотри на графики ошибок в течение 5 минут: http://gr.yandex-team.ru/dashboard#portal.passport.passport.alarm
   Убедись, что на графиках ошибки в пределах фона (не больше порядка 100 ошибок в минуту) и нет резкого роста ошибок.  
   Вот так выглядит график успешной выкатки: http://jing.yandex-team.ru/files/smoogly/1403625168.png (c 18:13 была выкатка).
   Если виден резкий рост ошибок и их больше 100 в минуту, нужно откатиться (см. Как откатиться)
 * Если на графиках всё нормально, создай тикет в кондукторе в stable (найди тикет на выкатку в престейбл и нажми "в стэйбл": https://jing.yandex-team.ru/storage/smoogly/221224/1403621095.png)
 * Напиши в релизный таск ссылку на кондукторный тикет 
 * После выкатки в стейбл ещё раз посмотри на графики
 * Если графики выглядят как обычно, закрой релизный таск и все задачи релиза, кроме оставшихся открытыми минорных багов, со статусом "Решен".
 * Убери оставшиеся после выкатки открытыми минорные баги в общую очередь (действия -> сделать подзадачей -> удалить связь)
 * Размержь релиз в develop и master, поставь все необходимые теги (см. Gitflow.md)


## Как откатиться

 * Заведи тикет в кондукторе: http://c.yandex-team.ru/tickets/new?ticket[packages][0]=yandex-passport-frontend&ticket[branch]=fallback
   пакет `yandex-passport-frontend`,
   ветка `fallback`,
   версия, которая сейчас находится в проде
   (см. релизный таск предыдущего релиза, эта версия должна подсвечиваться синим в дропдауне версий).
   В описании напиши почему откатывается релиз.
 * Дай админам (abbat@, если его нет, то avmm@) ссылку на кондукторный тикет и напиши, что можно выкатывать 
 * Добавь ссылку на кондукторный тикет комментом в релизный таск
