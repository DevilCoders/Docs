## Некоторые заметки о локализации

Например, ключ с таким значением `Привет, <b>мир</b>` в таком шаблоне:

```
match .test ns-view {
    <div>
        i18n('%ufo_test');
    </div>
}
```

даст честную разметку, которая подхватится браузером — в итоге получим: Привет, **мир**

На практике это означает, что ключи в значениях которых есть неразывные пробелы или переводы строк не нужно дополнительно оборачивать в `html`.

Если в `i18n` присутствуют аргументы, то это поведение может измениться:

* если аргументы являются константами, т.е. в качестве аргумента указывается строчка, определенная на месте, получим предыдущий случай — значение ключа будет xml и будет выведено как есть
* если аргументы имеет тип xml, т.е. где-то заранее мы определили переменную в которой сформировали разметку или передает значения полей из модели — эти аргументы предвартительно будут экранироваться.

```
link = (
    <a href="{ config.links.disk }">
        "Привет, мир!"
    </a>
)
i18n('%ufo_test', link)
```

В таком случае, получим не то, что нужно: ссылка будет заэкранировать. Стоит воспользоваться `i18n_unsafe`. Его единственное отличие как раз в том, что аргумент не будут экранироваться никогда.

Однако, это экранирование все же полезно в случае вывода данных модели:

```
// есть опасность XSS, но т.к. i18n экранирует аргументы отличные от scalar — все будет хорошо
i18n('%ufo_test', resource.name)
```

Если требуется воспользоваться `i18n_unsafe`, как в случае с переменной `link` — нужно следить за экранированием потенциально опасных данных модели самостоятельно.

```
link = (
    <a href="{ config.links.disk }">
        resource.name
    </a>
)
// Открывался XSS: имя ресурса не экранируется
i18n_unsafe('%ufo_test', link)
```

В таком случае, нужно просто обернуть имя ресурса в `entityify`

```
link = (
    <a href="{ config.links.disk }">
        entityify(resource.name)
    </a>
)
// XSS нет — все хорошо
i18n_unsafe('%ufo_test', link)
```
