# Bootstrap

Клиентская точка входа в приложение.

Здесь только самый нужный код. Необходимо заботиться о размере бутстрапа.
По этой причине здесь не используется async/await или yield - это требует подключения
`regenerator-runtime`, который достаточно тяжелый.
`regenerator-runtime` мы подключаем позже, на этапе инициализации более тяжелых модулей.

### Некоторые функции, которые выполняет бутстрап:
- Подключение основных полифилов.
- Основной обработчик js ошибок.
  Чуть ранее мы навесили минимальный обработчик через inline скрипт. Он мог обработать ошибку загрузки самого бутстрапа.
  Теперь, когда бутстрап загрузился, нам нужно проинициализировать полноценную систему обработки ошибок.
- Проверка необходимости редиректа со старых урлов.
  Есть несколько хеш урлов, которые мы не можем средиректить через сервер, поскольку на сервер хеш не передается.
- Подключение последней части RUM счетчика скорости.
  Первую часть мы навесили через инлайновые скрипты.
- Настраивает функцию инициализации приложения.
  Здесь происходит только настройка функции, вызывается она в последнем инлайновом скрипте пришедшем с сервера.
  Достаточно спорное решение - дополнительная точка оптимизации, с которой можно поэкспериментировать.
  Внутри функции настраивается Sequence (есть отдельная документация), которая измеряет время выполнения каждого шага.
  Падение любого шага внутри последовательности считается фатальной ошибкой - т.е. пользователь не увидел рабочее приложение.

### Стадии инициализации проложения
- `prepare` - комбинированная стадия. Здесь параллельно грузятся необходимые модули и данные для этих модулей.
  - `handlers` - первая попытка предзагрузить данные, которые понадобятся для первой отрисовки страницы.
  - `static-load` - загрузка модулей необходимых для отрисовки страницы.
  - `static-run` - выполнение модулей необходимых для отрисовки страницы.
- `parse-prefetch` - отдельная стадия, на которой мы измеряем время парсинга загруженных данных.
  Так же здесь происходит дозапрос свалившихся моделей штатными средствами фреймворка.
- `pageinit` - последний раз пытаемся запросить свалившиеся модели, дожидаемся первой отрисовки DOM и начинаем инициализировать фреймворк.
- `first-draw` - проинициализировали фреймворк и начинаем рисовать приложение.
- `trigger-init` - финальный шаг. У нас достаточно много обработчиков, выполняющихся после отрисовки приложения.
  Выполняем их все и завершаем bootstrap последовательность.
- `log-timings` - завершающий шаг, на котором мы просто сохраняем тайминги всех предыдущих шагов на сервер.

### Модульная система
Бутстрап так же содержит дополнительную модульную систему поверх webpack.
Она необходима для загрузки модулей через альтернативные источники.

Чтобы настроить проксирование модуля существует метод `proxy`. (см. припер в `proxy-blocked-resources`).

В остальном модульная система достаточно тривиальна:
- максимально кроссбраузерные способы асинхронной загрузки js и css (`load`, `run`)
- возможность преднастроить модули необходимые для разных страниц приложения (`modules-for-page`)
- возможность настроить последовательность выполнения модулей (`priority`)

### Тестовый бутстрап
Для старых "интеграционных" тестов также собирается альтернативный бутстрап.
Там нет никаких дополнительных проверок. Только инициализируется модульная система и подключаются полифилы.
