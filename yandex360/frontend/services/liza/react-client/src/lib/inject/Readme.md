# `lib/inject`

DI-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ —Ç–æ–∫–µ–Ω–∞—Ö.
–ù–∞—à –ø–æ–¥—Ö–æ–¥ –∫ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–µ—Ç–∏–ø–∏—á–µ–Ω ‚Äî –º—ã —Ö–æ—Ç–∏–º —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å—É—â–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∏—Ö –∏–∑ –∏–Ω–∂–µ–∫—Ç–æ—Ä–∞ –¥–≤—É–º—è —Å–ø–æ—Å–æ–±–∞–º–∏:
1. –í–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞ –¥–ª—è –æ–¥–Ω–æ–≥–æ –Ω–∞–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –º–æ–¥–µ–ª–µ–π, –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å noscript'–æ–º)
2. –í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∏–º–µ—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ —Ö—Ä–∞–Ω–∏—Ç—å –∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –≤ –∫–µ—à–µ –∏–Ω–∂–µ–∫—Ç–æ—Ä–∞ –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–æ)

–û–±—â–∏–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –Ω–∞—à–µ–≥–æ DI-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ —è–≤–ª—è–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞ —Å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞–º–∏ —Å—Ç—Ä–æ–≥–æ —Å –æ–¥–Ω–∏–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º, –≤–∏–¥–∞
```typescript
class MyType {
    constructor(props: { foo: string; bar: BarType }) {
    }
}
```

## –£–∫–∞–∑—ã–≤–∞–µ–º, –∫–∞–∫ —Å–æ–∑–¥–∞–≤–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –Ω–∞—à–µ–≥–æ —Ç–∏–ø–∞

–î–ª—è —É–∫–∞–∑–∞–Ω–∏—è —Ç–æ–≥–æ, –∫–∞–∫ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–∏–ø –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¢–æ–∫–µ–Ω—ã. –í —Ç–µ–∫—É—â–µ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –¢–æ–∫–µ–Ω—ã –¥–≤—É—Ö –≤–∏–¥–æ–≤:
- `SingletonToken()` —Å–∫–∞–∂–µ—Ç –∏–Ω–∂–µ–∫—Ç–æ—Ä—É –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —ç–∫–∑–µ–º–ø–ª—è—Ä –¥–ª—è –æ–¥–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- `AlwaysNewToken()` ‚Äî —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π –∏–Ω—Å—Ç–∞–Ω—Å –∫–∞–∂–¥—ã–π —Ä–∞–∑ –∏ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å –µ–≥–æ –≤ –∫–µ—à–µ

–ü–æ—Å–∫–æ–ª—å–∫—É —Ç–æ–∫–µ–Ω —Å–≤—è–∑–∞–Ω —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Ç–∏–ø–æ–º, –¥–∞ –µ—â—ë –∏ —Å –µ–≥–æ –¥–µ–∫–æ—Ä–∏—Ä—É–µ–º—ã–º –≤–∞—Ä–∏–∞–Ω—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –∫–ª–∞—Å—Å–∞, —Ç–æ–∫–µ–Ω—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–æ–∑–¥–Ω–µ–µ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è ‚Äî —Ç–∏–ø –±—É–¥–µ—Ç –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–∫–µ–Ω–∞ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤—ã–∑–æ–≤–∞ `this`.
–ü–æ—Å–µ–º—É —Ç–æ–∫–µ–Ω—ã —è–≤–ª—è—é—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è–º–∏, –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–º–∏ –≤ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ –Ω–∞ —Ç–∏–ø–µ –∫–ª–∞—Å—Å–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä
```typescript
class MyAwesomeType {
    static Token = SingletonToken()
}
```

–ù–∞—à –∏–Ω–∂–µ–∫—Ç–æ—Ä –æ—á–µ–Ω—å —Ö–∏—Ç—ë—Ä –∏ —É–º–µ–µ—Ç —Å—Ç—Ä–æ–∏—Ç –∏–µ—Ä–∞—Ä—Ö–∏–∏ —Ç–∏–ø–æ–≤ —Å –ø—Ä–æ–ø–∞–º–∏, –≤—ã–≤–æ–¥—è –ø—Ä–æ–ø—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏–∑ –ø—Ä–æ–ø–æ–≤ –∫–ª–∞—Å—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –∏—Ö —Ö–æ—á–µ—Ç –ø–æ–ª—É—á–∏—Ç—å.
–†–∞–±–æ—Ç–∞–µ—Ç —ç—Ç–æ –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫
```typescript
class MyParentType {
    // –ó–¥–µ—Å—å –º—ã –¥–æ–ª–∂–Ω—ã —É–∫–∞–∑–∞—Ç—å, –∫–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –∏–∑ –ø—Ä–æ–ø–æ–≤ —Ç–∏–ø–∞ `MyParentType`
    // –ø–æ—Å—á–∏—Ç–∞—Ç—å –Ω–µ-–∏–Ω–∂–µ–∫—Ç–∏—Ä—É–µ–º—ã–µ –ø—Ä–æ–ø—ã —Ç–∏–ø–∞ `MyChildType`
    static Token = SingletonToken(props => ({
        child: MyChildType.Token({
            foo: props.bar,
        })
    }));

    constructor(props: { bar: string, child: MyChildType }) {
    }
}

class MyChildType {
    // –ó–¥–µ—Å—å –º—ã —É–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ –ø—Ä–æ–ø `other` –±—É–¥–µ—Ç –±—Ä–∞—Ç—å—Å—è –∏–∑ –∏–Ω–∂–µ–∫—Ç–æ—Ä–∞,
    // –∞ –ø—Ä–æ–ø `foo` –Ω–∞–¥–æ –±—É–¥–µ—Ç –ø–µ—Ä–µ–¥–∞—Ç—å –ø—Ä–∏ –∏–Ω—Å—Ç–∞–Ω—Ü–∏–∏—Ä–æ–≤–∞–Ω–∏–∏
    static Token = SingletonToken({
        other: SomeOtherType.Token() // –¢–∏–ø –æ–ø—Ä–µ–¥–µ–ª—ë–Ω –≥–¥–µ-—Ç–æ –µ—â—ë, –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –ø—Ä–∏–º–µ—Ä–∞ :)
    });

    constructor(props: { foo: string, other: SomeOtherType }) {
    }
}
```

## –ò–Ω–∂–µ–∫—Ç–∏–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

–î–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ —Ä–µ–∞–∫—Ç-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è HoC [`withInject()`](./withInject.tsx).

–í —Å–∞–º–æ–º –ø—Ä–æ—Å—Ç–æ–º –≤–∏–¥–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–±—ä—è–≤–∏—Ç—å —Ö—ç—à –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```typescript
class MyType {
    static Token = AlwaysNewToken();

    constructor(private props: { title: string }) {
    }

    public get title(): string {
        return this.props.title;
    }
}

const MyComponent: React.FC<{ myType: MyType }> = props => (
    <div>{ props.myType.title }</div>
);

export const WrappedComponent = withInject({
    myType: MyType.Token({ title: 'Dude' }),
})(MyComponent);
```

HoC –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã—á–∏—Å–ª–∏—Ç—å –ø—Ä–æ–ø—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç –ø—Ä–æ–ø–æ–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞, –ø—Ä–æ–¥–æ–ª–∂–∏–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø—Ä–∏–º–µ—Ä
```typescript
interface Props {
    title: string;
}

const MyOtherComponent: React.FC<Props & { myType: MyType }> = props => (
    <div>{ props.myType.title }</div>
);

// –ó–¥–µ—Å—å —Å–≤–æ–π—Å—Ç–≤–æ `title` –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –≤ `MyType` –±—É–¥–µ—Ç –≤–∑—è—Ç–æ –∏–∑ –ø—Ä–æ–ø–æ–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
export const WrappedOtherComponent = withInject((props: Props) => ({
    myType: MyType.Token({ title: props.title }),
}))(MyOtherComponent);
```

## –ü–æ–ª—É—á–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –∏–∑ –∏–Ω–∂–µ–∫—Ç–æ—Ä–∞ (–ø–ª–æ—Ö–∞—è –∏–¥–µ—è üòâ)

> –ü–æ–ª—É—á–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –∏–Ω–∂–µ–∫—Ç–æ—Ä–∞ –æ–±—ã—á–Ω–æ –Ω–µ —Å–ª–µ–¥—É–µ—Ç, –Ω–æ –µ—Å—Ç—å —Ä—è–¥ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤, —Ç–∞–∫–∏—Ö, –∫–∞–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ —Å—Ç–∞—Ä—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º, –≥–¥–µ –±–µ–∑ —ç—Ç–æ–≥–æ –Ω–µ –æ–±–æ–π—Ç–∏—Å—å.

–ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–∞–∫–æ–≥–æ-—Ç–æ –∫–ª–∞—Å—Å–∞ –≤–Ω—É—Ç—Ä–∏ —Ç–∏–ø–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–∞–º –∏–Ω—Å—Ç–∞–Ω—Ü–∏–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∏–Ω–∂–µ–∫—Ç–æ—Ä (–∏–º–µ–µ—Ç Token), —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∏–ø  `InjectorInstance`
```typescript
class MyType {
  public static readonly Token = SingletonToken(MyType, {
    injector: InjectableInstance.Token()
  });

  constructor(private params: { injector: InjectableInstance }) {
  }

  public method() {
    this.params.injector.Instance(OtherType.Token());
  }
}
```

–í —Å–ª—É—á–∞—è—Ö, –≥–¥–µ –Ω–∞–¥–æ –ø–æ–ª—É—á–∏—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä –≤–Ω—É—Ç—Ä–∏ —Å–ª–æ—è, –∫–æ—Ç–æ—Ä—ã–π –Ω–∏—á–µ–≥–æ –ø—Ä–æ –∏–Ω–∂–µ–∫—Ç–æ—Ä –Ω–µ –∑–Ω–∞–µ—Ç, *‚ö†Ô∏è –∫–∞–∫ –∫–∞—Ä–π–Ω—é—é –º–µ—Ä—É* –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–ª–∞—Å—Å [`lib/inject/Inject#Injector`](./Inject.ts).

```typescript
Injector.Instance(MyType.Token({
    param1,
    param2
}))
```
