# Разработка клиентского кода

Весь клиентский код живёт в папке `client`. Приблизительная структура проекта:

```
client
  entries // точки входа в клиентское приложение
    entrypointName
        store
            configureStore.js
            createRootReducer.js
            rootSaga.js
        index.js
        Root.js
  features // логически делимые фичи проекта
    featureName
      sagas
        index.js
        sagaName.js
      reducer
        index.js
        reducerName.js
      components
        ComponentName
          ComponentName.js
          ComponentName.connect.js
          ComponentName.lazy.js
          ComponentName.css
          index.js
      api.js
      selectors.js
      actions.js
  components // не связано с остальным проектом, интерфейсные компоненты
    ComponentName
      ComponentName.js
      ComponentName.css
      index.js
```

Используемые библиотеки (основные):
- [React](https://reactjs.org/)
- [Redux](https://redux.js.org/)
- [Redux-Actions](https://redux-actions.js.org/)
- [Redux-Saga](https://redux-saga.js.org/)
- [React-Router](https://reacttraining.com/react-router/)
- [PostCSS](https://postcss.org/)
- [Lego Components](https://lego.yandex-team.ru/components/)
- [Jest](https://jestjs.io/)

Локализация хранится в [Танкере](https://tanker.yandex-team.ru), ключи локализации доставляются 
в клиентский бандл при помощи [tanker-fetch](https://github.yandex-team.ru/UFO/tanker-fetch) и 
затем используются при помощи [react-tanker](https://github.yandex-team.ru/UFO/react-tanker).

## Фичи (`features`)

Представляют собой логически делимые части проекта (пример: работа с организациями).

Обычно живут в собственном куске стейта redux, соответственно, имеют свой редьюсер, свой api,
свои саги, свои компоненты.

## Бизнес-логика

На клиенте бизнес-логика состоит из нескольких частей: транспорт([ModelsApi](../../client/api/Api.js) 
и низлежащий [Api](../../client/api/Api.js)), сценарии в виде саг и редьюсеры.

Саги напрямую используют транспорт, связь между react-компонентами и сагами/редьюсерами осуществляется 
через экшны. 

### Транспорт

Транспорт пишется отдельно для каждой фичи, используется из саг. Содержит данные о том, 
какие модели использует данная фича и как в них ходить. Для каждой отдельной модели можно при 
желании настраивать кеширование.

На уровне транспорта не стоит делать ничего, кроме походов в модели, он должен только знать, какие 
параметры ему стоит пробросить в модель на сервер и вернуть результат.

В саги транспорт попадает через контекст (эффекты `setContext` и `setContext` из redux-saga). Корневой 
api попадает в контекст на уровне рутовой саги приложения, затем забирается оттуда рутовой сагой 
фичи, которая, в свою очередь, формирует локальный контекст api для дочерних саг.

### Саги

Каждая сага, по сути - отдельно взятый "сценарий" бизнес-логики. Она содержит шаги, которые 
нужно совершить в этом сценарии, чтобы достигнуть определённого результата. Самая стандартная 
будет иметь приблизительно такую принципиальную схему:
- Забрать из существующего redux-стейта нужные данные
- Скопоновать эти данные в параметры для модели
- Вызвать транспорт моделей, дождаться результата
- Бросить экшн, который попадёт в редьюсеры
- Зарепортить ошибку (опционально, бросить пользователю нотификацию), если что-то пошло не так

Так как сага - это сценарий, она должна читаться соответствующим образом; не стоит в саге без 
особой необходимости "перекладывать json", выполнять подсчёты. В саги кладётся весь асинхронный 
код, связанный с бизнес-логикой.

Саги фичей делятся на рутовые и все остальные. Рутовая сага занимается установкой контекста api 
и подписыванием остальных саг фичи на экшны при помощи эффектов `takeEvery` или `takeLatest`. 
Прочие саги занимаются обработкой экшнов.

### Редьюсеры

Редьюсер имеет только 2 задачи - принять данные и положить в нужное место в нужном формате. 
Это то самое место, в котором стоит выполнять всё перекладываение данных из одной структуры 
в другую.
