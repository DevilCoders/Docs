# Параметры запуска

### Ключи командной строки
Для разбора аргументов запуска duffman использует [commander](https://github.com/tj/commander.js)

[[src](../lib/options.js)]

#### `--dev`
Запускает duffman в dev окружении.
  - Ключи `-w` и `-g` игнорируются и выставляются в `1`.
  - [AbstractLogger](./abstract-logger.md) начинает писать логи в консоль (при наличии `DEBUG`).
  - Порт (если не указан) равен `node.sock`.

#### `-w, --workers` и `-g, --groups`
Два связанных между собой ключа. Соответствуют параметрам `workers` и `server.groups`
в [Luster](https://github.com/nodules/luster/wiki/Intro#load-balancing-workaround)-е.

`--workers <n>` — определяет количество реальных инстансов сервера, которые будут запущены.
Можно передавать значение меньше 0, тогда будет запущено `CPUs - n` воркеров.
По умолчанию запускается `CPUs - 1`.

`--groups <n>` — определяет количество виртуальных групп, на которые будут распределены TCP порты.

Так например при `-w 10 -g 10` будет запущено 10 воркеров и каждый будет слушать свой TCP порт,
а при `-w 10 -g 5` воркеры попарно будут слушать на 5 TCP портах. Последняя схема позволяет задействовать
дополнительный механизм балансировки на уровне системы. Можно передавать значение меньше 0.

#### `-p, --port`
Соответствует параметру `server.port` в [Luster](https://github.com/nodules/luster/wiki/Intro#cluster-of-the-web-workers)-е.

`--port <n>` — определяет базовый TCP порт, с которого начнется нумерация для групп воркеров.
`--port <s>` — путь к unix-сокету. Если групп воркеров больше одной, то строка должна содержать звёздочку.

Если не указан, то воркеры будут слушать на unix-сокетах с названиями `duffman.N.sock`, где `N` - это id группы.

#### `-m, --mute`
`-m`, `-mm` — Уменьшает объем информации записываемой в лог.

Duffman имеет 4 уровня логирования. Если передать `-mmmm`, то в лог будут писаться только критические сообщения.

#### `-e, --experiment`
`--experiment <s>` — используется для варьирования внутренней логики. Пример:
```js
// bin/www -e keep-alive

const options = require('./lib/options');

if (options.experiments['keep-alive']) {
  // do something
}
```
**Deprecated** в настоящее время не используется.

#### `--routes`
`--routes <s>` — путь к папке с файлами роутов. По умолчанию `/etc/duffman/init.d`.

#### `--fail-fast`
Убивать воркер в случае ошибки в процессе инициализации роутов.

#### `--ignore-exception`
Отключает самоубийство воркера в случае непойманого исключения.

#### `-P, --status-port`
`-P <s>`, `-P <n>` — служебный порт который слушает мастер-процесс. По умолчанию `$PWD/ping.sock`.

### Переменные окружения

#### `DUFFMAN_FAIL_FAST`
То же самое, что ключ `--fail-fast`.

#### `DUFFMAN_JOBS_LIMIT`
Ограничение на количество запросов обрабатываемых одним воркером. После превышения этого лимита
воркер перезапускается. По умолчанию лимита нет.

#### `DUFFMAN_CUSTOM_LOG_ARGS`
Дополнительные параметры для логирования.

#### `DEBUG`
Работает только при наличии ключа `--dev`
см. https://www.npmjs.com/package/debug
