[![oko health](https://badger.yandex-team.ru/oko/repo/UFO/tanker-fetch/health.svg)](https://oko.yandex-team.ru/repo/UFO/tanker-fetch)

# tanker-fetch
Выгружает сгенерированный Танкером JS локализации в указанную директорию.  
Для работы утилиты нужно наличие `wget` консольной утилиты.

## Оглавление

 * [Быстрый старт](#quick-start)
 * [Описание команды tanker-fetch](#description)
   * [Опции команды](#options)
   * [Настройка работы с Танкером](#setup)
   * [Пример использования](#examples)
   * [Формат ключей Танкера](#tanker-key-format)
   * [Алгоритм работы утилиты](#work-algorithm)

## <a name="quick-start"></a>Быстрый старт

Модуль поставляется во внутренний NPM-репозиторий.
Для загрузки переводов необходимо добавить модуль в ваш `package.json` проекта.

```
npm install tanker-fetch --save
```

Создать конфигурационный файл `.tanker.json`, указав в нём `project-id`.

```json
{
  "project-id": "<ваш id проекта>"
}
```

Вызвать команду загрузки переводов. Если модуль будет установлен глобально, то команда вызова будет выглядеть следующем образом:

```bash
tanker-fetch
```

Для локального вызова:

```bash
./node_modules/.bin/tanker-fetch
```

Для вызова команды с файлом конфига, отличным от дефолтного `.tanker.json`:

```bash
tanker-fetch <path-to-custom-config-file>
```

В директории вызова команды появится каталог `outputDir`, в котором будет размещены `*.js` файлы переводов.
`outputDir`- директория из одноимённой опции `outputDir` конфига, либо директория `./dist` по умолчанию.

## <a name="description"></a>Описание команды tanker-fetch

Команда `tanker-fetch` позволяет выгрузить переводы в директорию `outputDir` из Танкера в JS формате с разбиением по языкам. Таким образом, после выгрузки переводов проекта, в директории `outputDir` появится список JS файлов, соответствующий языкам локализации.

### <a name="options"></a>Опции команды

У команды есть доступные флаги:

  - `-h, --help` - выводит описание команды и доступные для неё опции
  - `-V, --version` - выводит версию утилиты
  
### <a name="setup"></a>Настройка работы с Танкером

Для работы с Танкером команда использует конфигурационный файл (по дефолту `.tanker.json`). Формат файла - JSON. В нём описываются доступные для выгрузки из Танкера параметры. Если какой-то из них не указан, то берётся значение по умолчанию.

Обязательно должен быть указан только "project-id", остальные – при необходимости.

Список доступных параметров можно посмотреть [тут](https://doc.yandex-team.ru/Tanker/tech-dscr/concepts/tr-tanker-download.xml#down-download)

Значения по умолчанию:

```json
{
  "branch-id": "master",
  "status": "unapproved",
  "safe": "ru",
  "language": "...",
  "flat-keyset": 1,
  "type": "js",
  "path": ".tmp",
  "include": "no",
  "outputDir": "./dist"
}
```
Если `language` не задан, список языков будет взят из танкера. Задавать его нужно в виде строки через запятую: `"ru,en,tr"`.

`outputDir` не используется в генераторе JS от Танкера, а служит заданием директории, где будут размещены конечные файлы переводов.

### <a name="examples"></a>Пример использования

```bash
> tanker-fetch
[14:49:44] Reading config...
[14:49:44] Config read.
[14:49:44] Requesting data from Tanker...
[14:49:47] Bash script received.
[14:49:47] Started receiving of localization...
[14:50:32] Data from Tanker received.
[14:50:32] Concatenating languages...
[14:50:32] Concatenation finished.
```

Скорость выгрузки зависит от количества и сложности ключей.

### <a name="tanker-key-format"></a>Формат ключей Танкера

Для выгрузки ключей из Такера в JS формате, они должны удовлетворять правилам, описанным на странице ["Яндекс.Танкер -> Описание технологии -> Ключи"](https://doc.yandex-team.ru/Tanker/tech-dscr/concepts/tr_keys.xml)

## <a name="work-algorithm"></a>Алгоритм работы утилиты:

1. Чтение данных из конфига и расширение его значениями по умолчанию.
2. Запрос у Танкера ключей и доступных языков перевода для проекта (если они не были перечислены в конфиге).
3. Склеивание полученных ключей из кейсетов в JS файлы соответствия языкам (`ru.js`, `en.js` и т.д.).
4. Удаление временных данных, полученных из Танкера.
