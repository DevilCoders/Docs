# socialavatars-static

Дебьяновский пакетик с иконками соц. сервисов. Собрать можно на jenkins. Выкатить кондуктором (подробности ниже в соответствующих разделах).

Если нет интерета, ставить с `PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=1`.

**Будь внимателен!**
Урлы в пакете не версионированы. Фриза нет. Выкатка каждого следующего пакета заменяет предыдущий.

## Сборка

Сборка предполагает 3 варианта:
Вариант первый (самый часто используемый, пришли, подложили, запустили) - makefile соберёт, перенесёт и закоммитит все иконки, обновленные с прошлого коммита. Запуск:
```sh
make
```

Вариант второй (пересобрать имеющуюся эталонную для проверки сборки) - указать какие конкретно файлы пересобрать. Запуск:
```sh
make files="<files>"

# (например make files="source/ya*.svg source/othersize/beru.ru.svg source/ya-food.svg")
```

Вариант третий (сборка новой Версии) - пересобрать всё с нуля в новой папке версии. Запуск:
```sh
make folder=<newversionfolder> files="*.svg"
```

Можно запускать отдельные шаги:
* generate - генерация png картинок (поддерживает опциональный параметр files)
* move - перенос картинок в папку версии и чистка временных файлов (требует обязательный параметр folder)
* updatechangelog - автоматическое обновление changelog в режиме диалога
* commit - закоммитить все изменения в git

## Сборка

* изменить версию сборки в debian/changelog (makefile делает это автоматически)
* https://common.jenkins.mail.yandex.net/job/verstka_socialavatars-static-job/

*Для разработчиков:* если нужно поменять конфиг, сначала нужно собрать джобу https://common.jenkins.mail.yandex.net/job/generate-wmi-jobs/ и только потом https://common.jenkins.mail.yandex.net/job/verstka_socialavatars-static-job/

Конфиг пишется на groovy используя плагин

https://jenkinsci.github.io/job-dsl-plugin/
https://github.com/jenkinsci/job-dsl-plugin/wiki

Находится конфиг в папке https://a.yandex-team.ru/arc_vcs/mail/yamail-wmi-jobs/ и называется socialavatars_static_job.groovy

## Деплоймент

http://c.yandex-team.ru/tickets/new?ticket[packages][0]=yandex-static-socialavatars

Вначале собираем *testing* и смотрим, что все ок, а затем *stable*.

Версию сборки указываем без "-", например "0.0.10".

## Ссылки на аватарки
Тестинг
```
http://betastatic.yastatic.net/mail/socialavatars/socialavatars/v[0-9]+/[название].png
http://betastatic.yastatic.net/mail/socialavatars/socialavatars/v[0-9]+/[название].svg
```

Стейбл
```
http://yastatic.net/mail/socialavatars/socialavatars/v[0-9]+/[название].png
http://yastatic.net/mail/socialavatars/socialavatars/v[0-9]+/[название].svg
```

## Генерация

[Если добавилась новая метка и для неё новая иконка.](https://github.yandex-team.ru/rikishi/doc/wiki/%D0%94%D0%BE%D0%BC%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5-%D0%BC%D0%B5%D1%82%D0%BA%D0%B8)

Если файл из папки `source` найден в папке `source/othersize`, то для генерации аватарок размером 16x16 и 20x20 будет использован исходник из папки `source/othersize` (там находятся картинки, более четкие на маленьких разрешениях).

Для генерации обновленны иконок воспользуйтесь:
`make generate`

Генерируем 3 png формата:
132px, 176px - для мобильных устройств
Галерея из 6 разрешений (она уже не нужна, ее вроде никто не используем, но нам не сложно)

И один svg формат:
Берем оригинальный svg и чистим от мусора с помощью svgo.

Для переноса в нужную папку получившихся png иконок и добавления туда же svg файлов можно воспользоваться командами:
`make move folder=<version>`

Новую версию (folder) создавать не нужно, если выполняется только добавление новых спрайтов.
Новую версию (folder) желательно создавать, если например удалили/редактировали существующие иконки, поправили какие-либо ошибки в svg файлах.

## Подготовка svg иконки

Все исходники имеют цвет фона `#919090`. Часто дизайнеры отдают svg с другим цветом, например `#909090`. Это не всегда заметно при просмотре svg, но сильно заметно после генерации спрайта. Поэтому перед генерацией необходимо проверить цвет фона.

После генерации спринта смотрим, чтобы все отображалось корректно, не было пикселизации иконки, чтобы длинный текст читался хорошо. В противном случае нужно потюнить саму иконку в подходящем редакторе, или просить переделать дизайнеров.
