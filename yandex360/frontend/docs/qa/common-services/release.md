# Релизы

## Модель релизов

Релизы катаются ежеденельно по **модели 2-1(1)**:
* один релиз админки;
* один релиз тюнинга;
* один релиз на остальные приложения (клиент, паблик, редактор и тд)*

**бывают проекты, которые требуют релиза нескольких приложений, поэтому, при благоприятных обстоятельствах, можем выкатить еще один релиз - (1)*

## График релизов

* **сборка:** с понедельника по пятницу (включительно)
* **выкатка:** понедельник - четверг (включительно)

Расписание по приложениям:

**Приложение** | **День/время сборки** | **День/время выкатки**
:--- | ---: | :---:
Админка | понедельник или среда, с 17:00 | вторник или четверг, любое рабочее
Тюнинг | понедельник или среда, с 17:00 | вторник или четверг, любое рабочее
Клиент, Паблик, Заметки и тд | понедельник - пятница, с 17:00 | понедельник - четверг, любое рабочее


{% cut "FAQ по модели и расписанию" %}

**Q:** Почему модель 2-1(1)? Почему нельзя просто собрать и выкатить в любой день и время?

**A:** По всем приложениям наблюдается неравномерная нагрузка - одни приложения могут релизится еженедельно, в то время как в других релизы могут происходить один раз в несколько месяцев. Чтобы отбалансировать нагрузку на дежурных, вводится релизная модель, которая позволит проводить до трех обязательных релизов еженедельно, сохраняя гибкую модель выкаток

----

**Q:** Почему админка и тюнинг собираются и выкатываются в определенные дни, а остальные сервисы - в доступный рабочий интервал?

**A:** Значение "2" в модели подразумевает, что мы обеспечиваем релизы приложений с высокой нагрузкой. В текущий момент времени у нас стабильно выкатывается релиз админки и тюнинга еженедельно - для них мы бронируем определенные дни, чтобы гарантированно их выкатить на текущей неделе. Для остальных приложений сейчас нельзя выделить определенный день для сборки и выкатки, поэтому предлагается собирать их по востребованию, исходя из критериев преложенных далее

----

**Q:** Что делать, если по одному из приложений с высокой нагрузкой в день сборки нет задач?

**A:** Сборка такого релиза переносится на следующий ближайший день сборки

----

**Q:** Что делать, если по остальным приложениям (клиент, паблик и тд) нет задач?

**A:** Если набор задач не удовлетворяет предложенным ниже критериям, переносим сборки до их первого удовлетворения

{% endcut %}


## Критерии сборки релиза

* три и более задач в влиты в транк и ожидают релиза;
* одна задача с высоким приоритетом (например, не крит/блокер, но задача влияет на деньги и/или репутацию);
* задача с дедлайном, который будет нарушен при сборке в другой день

Если, хотя бы, один из критериев соблюдается - собираем релиз

Сложные внештатные ситуациии в духе "Три задачи в транке есть, но вот-вот придет из тестирования критичная задача" остаются на усмотрение дежурных и могут решаться коллективно

# Сценарий проведения релиза

## Cборка релиза и запуск регресса

1. Дежурный тестировщик уточняет у команды тестирования и разработки, есть ли задачи, которые должны попасть в ближайший релиз:
   * **если такие задачи есть**, то ждем их мержа в trunk и только после этого собираем релиз
   * **если задача не успевает дотестироваться до 17:00**, она автоматически уходит в следующий релиз (если позволяет приоритет)
   * **если что-то уже мержится в trunk и пробило 17:00** - ждем мержа данной задачи или группы задач и собираем релиз
2. дежурный разработчик и дежурный тестировщик, должны убедиться, что нет задач в статусе `Tested`. Если такие задачи есть, то перед сборкой релиза их нужно замержить в trunk. Найти такие задачи [можно на борде](https://st.yandex-team.ru/agile/board/5857)
3. дежурный разработчик собираем релиз и выкатывает его на любой свободный номерной престейбл
4. совместно с дежурным тестировщиком нужно убедиться, что автотесты на релизом билде проходят и нет падений тестов связанных с релизном
5. когда с автотестами все хорошо, дежурный разработчик [запускает регресс по форме, переводя тикет в статуст "Можно тестировать"](https://docs.yandex-team.ru/psfront/dev/launching-regression);
6. дежурный тестировщик берет тикет в работу (переводит тикет в статус `Testing`)


## Разбор регресса

1. после завершения регресса дежурный тестировщик разбирает результаты регресса, исследуя заведенные асессороские тикеты
2. после разбора регресса, родительский асессорский тикет закрывается

## Cмоук-тесты

1. дежурный тестировщик собирает версию ассептансов и проходит их вручную
2. когда ассептансы успешно пройдены, релиз отдается на выкатку (используем макрос `Релиз протестирован`)

## Выкатка релиза

1. дежурный разработчик запрашивает разрешение на выкатку в релизном чате (`#disk-roll` в Телеграм)
2. после получения аппрува от девопсов разработчик выкатывает релиз
3. после выкатки разработчик сигнализирует дежурному тестировщику, что релиз в проде
4. дежурный тестировщик проверяет, что прод вообще открылся
5. разработчик мержит релиз в trunk и закрывает релизный тикет

## Решение проблем

## Проблемы в релизе

{% list tabs %}

- Проблема в релизном билде

  **Что делаем:**

    * дежурный тестировщик должен убедиться, что проблема действительно релизная
    * если проблема в релизе, заводится подзадача к релизному тикету с описанием проблемы
      * если проблему нашел асессор, то линкуем тикет `DISKEXP` с багом в нашей очереди
      * асессорский тикет переводится в статус `Открыт/Передано разработке`
    * проблему чинит дежурный разработчик
    * после починки, фикс проверяет дежурный тестировщик и если все ок, фикс добавляется в релизную сборку

- Проблема на стадии ассептансов

  **Что делаем:**

    * ассептансы останавливаются
    * заводится подзадача к релизному тикету с описанием проблемы
    * проблему чинит дежурный разработчик
    * после починки, фикс проверяет дежурный тестировщик и если все ок, фикс добавляется в релизную сборку

- Ошибки в проде после релиза

  **Что делаем:**

    * если не понимаем природу ошибок или как чинить - **откатываем релиз и после разбираемся**
    * заводится подзадача к релизному тикету с описанием проблемы
    * если релизный тикет был закрыт - переоткрываем его
    * после починки, фикс проверяет дежурный тестировщик и если все ок, фикс добавляется в релизную сборку


{% endlist %}
