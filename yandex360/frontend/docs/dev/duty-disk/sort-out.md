# Разбор саппортных тикетов

{% note warning %}

Нужно регулярно разбирать новые саппортные задачи, упавшие на нашу команду.
Разбор задачи должен быть быстрым – тут нам не нужно фиксить баги, только понять на чьей стороне проблема.

{% endnote %}

## Инструменты

### Очевидные баги
По некоторым обращениям очевидно, что это интерфейсный баг. Например, пользователь жалуется, что у него 1 элемент наехал на другой.
* Если баг легко воспроизводится - сразу клонируем его [к нам в очередь](#zbp).
* Если нужна помощь в воспроизведении - тикет можно перевести `В тестирование` с соответствующей просьбой.

### HAR-файл
Большинство проблем можно увидеть через HAR-файлы. В HAR-файле указаны все запросы из браузера пользователя – там можно посмотреть как сам запрос, так и ответ на него.
Чтобы просмотреть HAR-файл, нужно открыть в браузере `about:blank`, открыть консоль в разделе `Network` и перетащить на него файл.

HAR-файлы из Chromium и Firefox могут быть несовместимы. Поэтому если HAR не открылся в одном браузере – можно попытать удачи в другом, либо заранее посмотреть в каком браузере работает пользователь

Дальше ищем интересующий нас запрос. Например, если проблема с листингом файлов – это запрос за моделькой ресурсов, если проблема с регистрацией организации – это запрос с принятием соглашения или подтверждением реквизитов.

Если запрос завершился ошибкой, либо вернул некорректные данные – осталось определить, на чьей стороне проблема.

Запрос мог упасть
* либо на бэкенде
* либо на нашем фронтбэке
  * в обработке формирования запроса в бэк
  * в обработке ответа бэка.

После понимания местонахождения ошибки действуем следующим образом:
* если ошибка на стороне фронтбэка – клонируем баг [к нам в очередь](#zbp)
* если ошибка на стороне бэкенда – [передаём тикет в бэкенд](#back)

Иногда пользователи присылают кривой HAR-файл – куда не попал момент самого бага, или вообще в файле работа с другим сервисом.

Из такого HAR-файла можно достать куку `yandexuid` и проверить с ней [Error Booster](#booster)

### Error Booster {#booster}
В бустере есть следующие проекты:
* [Клиент Диска / Доксы](https://error.yandex-team.ru/projects/disk)
* [Паблик](https://error.yandex-team.ru/projects/disk-public)
* [Заметки](https://error.yandex-team.ru/projects/disk-notes)
* [DocViewer](https://error.yandex-team.ru/projects/docviewer)
* [B2B-админка](https://error.yandex-team.ru/projects/sarah)
* [Тюнинг](https://error.yandex-team.ru/projects/ps-tuning)
* [Телемост](https://error.yandex-team.ru/projects/telemost)
* [Редактор (Р7-офис)](https://error.yandex-team.ru/projects/only-office)

Если какого-то проекта тут нет - возможно, его просто забыли указать

В бустере можно найти ошибки, случившиеся в браузерном JS. Ошибку по пользователю легко найти, зная `yandexuid` либо `ip` пользователя и примерное время возникновения ошибки.
В фильтре сверху выбираем нужную дату и в поле фильтрации делаем фильтр по `yandexuid` / `ip`. Если в получившемся результате есть ошибки - проверяем, связаны ли они с описанной в тикете ситуацией.

Также через бустер можно оценить массовость некоторых проблем, найдя нужную ошибку по её сообщению и убрав фильтр по
пользователю.

### Логи (YT / ClickHouse)
[Список таблиц с логами](https://wiki.yandex-team.ru/disk/admin/disk_clickhouse/#spisoktablicslogamivclickhouseklastere)

В логах ищем запросы по пользователю (по `uid` / куке `yandexuid` / куке `yandex_login`) в указанное в тикете время.

В логах `duffman-http` / логах ноды могут быть запросы бэкенда, завершившиеся статус-кодом >= 400 - в этом случае
перекидываем тикет в бэкенд, прикрепив запрос с проблемным запросом.

В логах `duffman-access` / логах ноды могут быть какие-то падения нашего серверного JS - в этом случае, если понимаем,
где и почему упало - клонируем баг к нам в очередь, если не понимаем, то пробуем разобраться (сильно не упарываясь),
либо попросить помощи у коллег.

В логах nginx могут быть запросы, завершившиеся статус-кодом >= 400 - это показатель того, что что-то пошло не так в
апстриме. Логи `nginx` можно связать с логами `duffman`-а / Node по `ycrid` / `request_id` и поискать проблемы уже там

### Ничего нет / информации недостаточно
В этом случае запрашиваем дополнительную информацию через саппорт.

## Что делать с тикетом

### Ответ пользователю / запрос дополнительной информации
Если понимаем, что пользователь просто что-то делает не так, либо его проблему уже решили – пишем об этом и переводим тикет `В поддержку`.

Если нам не хватает информации (информации вообще нет, либо прикреплён некорректный HAR) – просим саппорт запросить информацию / корректный HAR и также переводим тикет `В поддержку`.

### Клонирование в нашу очередь {#zbp}
В случае, когда мы разобрались, что это наш баг
* клонируем тикет в очередь `CHEMODAN` с типом `Ошибка`
* выставляем ему в поле `Компоненты` значение `Disk Frontend` + компонент нужного проекта
* добавляем тег `Разметить_для_приоритизации`

Позже в тикет придёт дежурный от QA, расставит нужных тегов и робот оценит вес бага (поле `Вес 1` в тикете).  Исходный саппортный тикет переводим в статус `В очередь`.

Иногда бывает, что про проблему мы уже знаем и тикет есть. В этом случае связываем саппортный тикет с нашим и
саппортный тикет также переводим в статус `В очередь`.

Если при разборе ситуации уже понятно как фиксить проблему и фикс быстрый (условно, не более 10 минут), то можно сразу
пофиксить баг в рамках `CHEMODAN`-тикета

### Помощь с воспроизведением
Помочь с воспроизведением какой-то особо изощрённой ситуации может дежурный от QA.

Например, мы примерно понимаем, какая ошибка произошла, но сами воспроизвести не можем и подозреваем, что ошибка
возникает на каком-то изощрённом пользователе или в изощрённой ситуации.

Для помощи переводим тикет в статус `В тестирование` с конкретной просьбой.

### Передача в бэкенд {#back}
Для передачи в бэкенд убираем у тикета компонент `Web` и ставим компонент `mpfs`.

### Передача в менеджера
Изредка бывает, что пользователь пожаловался на поведение, которое было задумано специально таким.

Либо про поведение, которое не учёл ни менеджер, ни разработчик. В этом случае переводим тикет `На менеджера` и, если знаем, призываем менеджера, который занимался данным фукнционалом

### Не знаю что делать
Спроси у коллег ;-)

Как минимум коллеги подскажут, в какую сторону смотреть.

Как максимум - сразу скажут, что проблема известная и может даже скинут тикет
