# Gestures

## GestureDataListener

GestureDataListener -Точка входа для жестов. Каждые примерно 30мс дергается onDataReady с данными датчика.

Чем GestureDataListener занимается:
- Предпосчитывает средние, отклонения и т.п. и передает это в обработчики, реализация которых в папке gesturesDataProcessors.
- Обрабатывает ивенты из обработчиков и решает какому отдать предпочтение, если их несколько. Дергает внешние колбеки
- Отправляет данные датчика в метрику (Если включен флаг)
- Собирает данные датчика и дебажных событий gesturesDataProcessors и пишет в csv.

В GestureDataListener не обрабатываются сами жесты, в нем только обрабатываются их пересечения.
GestureDataListener ничего не знает про колонку и не должен, все интеграция делается через его колбеки.

У GestureDataListener есть большой класс настроек, который умеет парситься из json и который можно переопределять
в конфиге или в космодроме. Менять настройки нельзя, можно пересоздать GestureDataListener с другими.

## ThereminVoxDataGenerator

Реализация Терменвокса на тофе. ThereminVoxDataGenerator и GestureDataListener сейчас не работают одновременно. Их нужно
переключать. @penguin-diver за подробностями

## Интеграция

Скорости ради интеграция была сделана внутри ButtonsEndpoint, чтобы имитировать нажатия кнопок паузы и
активации/деактивации алисы. Логику интеграции нужно перенести в отдельный сервис и дергать методы SDK вместо
имитации кнопок.

В ButtonsEndpoint обрабатываются колбеки GestureDataListener, а также обработка локального конфига, конфига из
космодрома, внешних команд.

### Конфиг

И локальный, и космодромный конфиг задается в виде массива json-ов, каждый елемент - настройка для GestureDataListener
и самой интеграции. Между этими настройками можно переключаться. Индекс текущей настройки в том массиве лежит на диске
в data/quasar/data/gestures.dat.

### Внешние команды

Сейчас через при включенном aliced/LocalVins можно сказать Алисе след. команды:
- Сыграй пентатонику: отключит GestureDataListener, вклюит ThereminVoxDataGenerator
- Хватит: если активен ThereminVoxDataGenerator, выключит его и включит GestureDataListener
- Включи режим жестов n: переключит настройку GestureDataListener и его интеграции на n - 1 в массиве настроек
- Включи запись: начнет сохранять в данные датчика и дебажную инфу жестов.
- Останови запись: сдампит это в scv файлик.
- Я сегодня не использовал жесты: отправит соотв. событие в метрику. Идея была в том, чтобы собрать данные о ложных
  срабатываниях.

В проде должны работать первые два пункта (через нормальный Vins), LocalVins в проде быть не должно (отключается в
конфиге aliced)


