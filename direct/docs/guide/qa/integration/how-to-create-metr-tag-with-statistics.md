# Как создать счетчик Метрики со статистикой

{% note warning %}

Тестовый сайт:  
[Cсылка на внутренний сайт](https://pages.github.yandex-team.ru/sonick/direct-metr-tag/) - недоступен извне  
Репозиторий внутреннего сайта когда-то жил тут: `https://github.yandex-team.ru/sonick/direct-metr-tag`   
[Cсылка на внешний сайт](https://helenii.github.io/test-site/) - торчит во внешнюю сеть  
[Репозиторий внешнего сайта](https://github.com/helenii/test-site)   
Тестовый логин со счетчиком для тестирования `51709736`: sonick-4, пароль в [Секретнице](https://yav.yandex-team.ru/edit/secret/sec-01f75zkvdh9ez8trkjtshgevps/explore/versions)  

{% endnote %}

## Как сгенерить тестовые данные на счетчике 51709736

### Если вам нужно сгенерить визиты
Зайти на тестовый сайт (доступный вне сети Яндекса или внутренний в зависимости от вашей задачи) из разных браузеров или каждый раз в новом окне инкогнито, в противном случае визиты склеятся и получится 1 визит, так как посетитель определяется по куке. 
Визиты приезжают в статистику за ~10 минут. Смотреть можно на любых средах Метрики, так статистику Метрика всегда читает из прода КликХауса.

### Если нужно сгенерить другие данные
Зайти на тестовый сайт (доступный вне сети Яндекса или внутренний в зависимости от вашей задачи)
Открыть консоль и отправить из нее JS события согласно [документации](https://yandex.ru/support/metrica/objects/method-reference.html) кода счетчика (это могут быть достижения целей, параметры визитов и прочее)  

### Как проверить, что визиты доехали

1. Заходим в Метрику через 10-20 минут после отправки события (на прод, ТС - не имеет значения, Метрика статистику берет из прода на всех своих средах)
2. Смотрим на статистику визитов [на странице списка счетчиков](https://metrika.yandex.ru/list/?ulogin=sonick-4) или в [любом отчете](https://metrika.yandex.ru/stat/sources?period=week&accuracy=1&id=51709736&stateHash=61079f86cf7f7000182e4035)
 
 {% cut "скриншот" %}

   ![alt text](https://jing.yandex-team.ru/files/sonick/2021-06-02_12-24-46.png "скрин")

 {% endcut %}

3. Статистику по другим событиям смотрим в отчетах Метрики. _С вопросами как и где приходите к [sonick](https://staff.yandex-team.ru/sonick)_

## Если вам нужна статистика на своем новом счетчике

1. В [проде Метрики](https://metrika.yandex.ru/) создаем счетчик под любым своим логином с любыми параметрами

{% note alert %}

Доедет этот счетчик до тестовой среды Метрики только в понедельник при условии, что создали вы его не позже ночи с четверга на пятницу (в этой время снимается снапшот). Новые цели и все, что живет в настройках счетчика тоже живет в mysql и приедет только с переналивкой.  
Если вы не успели, то ждите следующего понедельника.  
В случае, если задача срочная, то можно обратиться к [дежурному по инфраструктуре Метрики](https://abc.yandex-team.ru/services/mtrsadmin/duty/) для внепланового довоза данных на тестовую среду.   
**Старайтесь не пользоваться срочной опцией! Нужно заранее готовить тестовые данные на этапе разработки задач, если в этом есть необходимость.**  

{% endnote %}

2. Открываем или выкачиваем репозиторий с тестовым сайтом (в шапке страницы)
3. В файл `index.html` добавляем код своего счетчика и добавляем его id в информационную строку со списком счетчиков на странице (можно прямо через гитхаб), чтоыб не открывая код было понятно какие тестовые счетчики есть на сайте 

### Как добавить счетчик на сайт

1. В Метрике открыть настройки счетчика (шестеренка напротив счетчика)
1. Скопировать код счетчика по кнопке "Скопировать код"

 {% cut "скриншот" %}

   ![alt text](https://jing.yandex-team.ru/files/sonick/2021-06-02_11-48-33.png "скрин")

 {% endcut %}

1. Вставить скопированный код в `index.html` сразу после кода счетчика, который там уже есть

 {% cut "скриншот" %}

   ![alt text](https://jing.yandex-team.ru/files/sonick/2021-06-02_11-34-22.png "скрин")

 {% endcut %}

1. Добавить в строку _Here you can find 51709736 tag_ через запятую `id` своего счетчика - это информационная строка для понимания, какие счетчики установлены на странице, чтобы не заглядывать в консоль или в код.

 {% cut "id счетчика есть в коде счетчика и в Метрике" %}

   ![alt text](https://jing.yandex-team.ru/files/sonick/2021-06-02_11-40-30.png "скрин")

 {% endcut %}

1. Мержим изменения, при необходимости создаем PR и ждем ревью
1. Заходим на тестовый сайт (ссылки на оба сайта в шапке страницы) и убеждаемся, что изменения доехали (новый счетчик в информационной строке появился)
1. Генерим необходимые для тестирования данные по инструкции выше
