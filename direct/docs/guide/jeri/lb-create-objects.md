# Создание топиков/консьюмеров и других штук в LogBroker

**Инструкция app-duty**

## Порядок

1. Ресурсы в LB не бесконечные и небесплатные. Задайся вопросом: можем ли мы обойтись без этих новых объектов? Если "не знаю" или "можем" — стоп, иди разбираться, консультируйся с mspirit@
2. Объекты в LB создаем по json-описаниям и с тикетом DIRECTMIGR. Если нет json-ов в транке или тикета — сделай/попроси сделать. [Инструкция](../dev/how-to-create-lb-topics-etc.md)
Пример тикета: [DIRECTMIGR-1793](https://st.yandex-team.ru/DIRECTMIGR-1793)
3. Сгенерируй команды для создания объекта, если их нет в тикете. Для этого зайди на `ppcdev`, в [примонтированном репозитории Аркадии](https://docs.yandex-team.ru/devtools/intro/quick-start-guide#mount) в каталог `direct/schemata/logbroker`, и запусти  ```./create-topic.py $path_to_topic.json```, где `$path_to_topic.json` - путь к json-файлу с описанием топика. Пример готовой команды:  
```./create-topic.py lbkx/direct/direct-ppcdict-binlog-log-json-query.topic.json```  
Запуск команды - действие безопасное, она ничего в сторонних системах не делает, только выводит на экран список команд для создания топика.  
Можно попробовать запустить вышеуказанную команду локально, но ее запуск скорее всего завершится с ошибками. Если ты спец по питону, то можешь попробовать их исправить, иначе запускай с `ppcdev`.

   {% cut "Как можно попробовать починить локальный запуск (для спецов)" %}

    Создать `virtualenv` и [ставить пакеты туда](https://python-scripts.com/virtualenv), (про репозиторий с пакетами можно [почитать тут](https://wiki.yandex-team.ru/pypi/))

   {% endcut %}
4. Скрипт из п.3 написал на stdout несколько команд с программой logbroker. Посмотри на них, и если все нравится — пойди на ppcback и выполни эти команды оттуда. Если не знаешь, на что именно смотреть — спроси совета у других дежурных.

## Ссылки

1. [Инструкция разработчика](../dev/how-to-create-lb-topics-etc.md)
2. [Есть README на скрипты в репозитории](https://a.yandex-team.ru/arc/trunk/arcadia/direct/schemata/logbroker)
3. Пример тикета-миграции: [DIRECTMIGR-1793](https://st.yandex-team.ru/DIRECTMIGR-1793)
