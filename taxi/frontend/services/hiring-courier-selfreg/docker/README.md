# Порядок файлов сборки

Все шаги указаны в том порядке, в котором собирает их CI. При создании своих файлов `<step>.default` (где step — имя шага, заголовки ниже), шаги из этого файла будут работать вместо файлов по умолчанию.

## Install

* Назначение: установить любые зависимости проекта (apt get, npm install и другие).   
* Опционально создание своего файла: **да**.  
* Имя файла: `install.dockerfile`.  

Все необходимые зависимости нужно устанавливать в файле `install.dockerfile`. 

Если не создать файл в своей папке `docker`, [подставится файл по умолчанию](/tools/docker/monorepo-templates/templates/base/install/install.default.dockerfile).

## Test

* Назначение: запустить линтинг и тесты вашего сервиса.  
* Опционально создание своего файла: **да**.  
* Имя файла: `test.dockerfile`.  

Можно поменять стандартный запуск тестов (lint/test) на необходимые вам в проекте. Для этого создайте файл `test.dockerfile`.

Если не создать файл в своей папке `docker`, [подставится файл по умолчанию](/tools/docker/monorepo-templates/templates/base/test/test.default.dockerfile).

## Builder

* Назначение: **сборка** вашего сервиса без копирования инфраструктурных конфигов в образ.  
* Опционально создание своего файла: **нет**.  
* Имя файла: `builder.dockerfile`.  

Здесь вы указываете только шаг сборки вашего проекта, не нужно заниматься копированием файлов nginx, syslog, crontab, prestart_scripts и других. Для этого есть следующий шаг. Проект собирается не в rtc-образе, а в нодовом образе, здесь нет никаких секдистов и всех остальных вещей клауна. 

Если не создать файл в своей папке `docker`, [подставится файл по умолчанию](/tools/docker/monorepo-templates/templates/base/builder/builder.default.dockerfile).

## Stage

* Назначение: скопировать ваше собранное приложение, инфраструктурные конфиги, файлы и скрипты в папки финального образа rtc.  
* Опционально создание своего файла: **нет**.  
* Имя файла: `stage.dockerfile`.  

На этом шаге уже подключается базовый образ RTC, куда нужно скопировать собранный ранее вами проект (вам доступен ваш образ под именем стейджа `app_base`), инфраструктурные файлы (nginx, syslog, prestart_scripts и другие), а также любой другой флоу, который не относится к билду проекта.

Если не создать файл в своей папке `docker`, [подставится файл по умолчанию](/tools/docker/monorepo-templates/templates/production/stage/stage.default.dockerfile).
