# I18n

## Где хранятся переводы

Для переводов используется [Tanker](https://tanker.yandex-team.ru/?project=taxi&branch=master), следующие кейсеты из него:

| Кейсет                                                                                      | Назначение                                                                                              | Bunker                                                           |
| ------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- |
| [corp-client](https://tanker.yandex-team.ru/?project=taxi&branch=master&keyset=corp-client) | для интерфейса Корп клиента и некоторых служебных вещей, используемых в Бизнес-Аккауте (он же КК лайт). | https://bunker.yandex-team.ru/taxi-corp-client/tanker            |
| [corp-light](https://tanker.yandex-team.ru/?project=taxi&branch=master&keyset=corp-light)   | для интерфейса Бизнес-Аккаунта                                                                          | https://bunker.yandex-team.ru/taxi-corp-client/tanker-corp-light |

## Какие инструменты есть

-   Скрипт scripts/i18n/upload - парсит указанную директорию и выгружает то что напарсил в указанный кейсет Танкера. Поддерживает опцию "просто посмотреть что выгрузится".
-   Скрипт scripts/i18n/extract - парсит указанную директорию и складывает в указанный json-файл то что напарсил.

Оба скрипта могут кидать ворнинги в консоль, если находят нелегитимное использование функции `t`.

## Процесс работы с переводами

Перед автоматической выгрузкой надо [получить oAuth-токен](https://nda.ya.ru/3SjQY7) в Танкере и положить его в файл tanker-token.txt в корне проекта.

### 1. Пишем код. Когда надо вставлять переводимый текст, делаем так:

```javascript
const t = useI18n();

return (
    <div>
        /* Ключ без дефолтного перевода */
        {t('context.subcontext.keyname')}
        /* Ключ с дефолтным переводом на русский */
        {t('context.subcontext.keyname', 'Текст ключа на русском')}
        /* TODO: Сделать такое - сразу несколько дефолтных переводов */
        {t('context.subcontext.keyname', {ru: 'Текст ключа на русском', en: 'Key text in English'})}
        /* Ключ с дефолтным переводом на русский и поддержкой параметра */
        {t('context.subcontext.keyname', 'Текст ключа на русском c {param}', {param: 'параметром'})}
        /* Ключ с дефолтным переводом на русский и поддержкой параметра в виде HTML-элементов */
        {t('context.subcontext.keyname', 'Текст ключа на русском c <param>', {
            param: () => (
                <div>
                    Здесь можно сделать разметку и она вставится прямо в текст в виде
                    react-элементов
                </div>
            ),
        })}
    </div>
);
```

#### Важно соблюдать следующие правила:

1. Так или иначе всегда получать функцию `t` из хука `useI18n`. Потом можно передавать её куда угодно через любой механизм.
2. Не вычислять значения ключей - они должны быть статическими. Если ключ выбирается из нескольких возможных, делаем карту:

```javascript

const getMessageFor = (t, someParameter) => ({
    someParameterValue: t('some-key'),
    someOtherParameterValue: t('some-other-key')
}[someParameter]);

const MyComponent = () => {
    const t = useI18n();
    ...
    return <div>{getMessageFor(t, someParameter)}</div>;
};
```

### 2. Выкладываем новые ключи в Танкер

Для этого запускаем:

-   Для корп клиента `npm i18n:upload:client`
-   Для Бизнес Аккаунта `npm i18n:upload:light`

После этого в Танкер будут выгружены все свежедобавленные ключи. Изменённые и удалённые ключи затронуты не будут.
После выгрузки скрипт пишет в консоль список URL новых ключей, чтобы их было удобно отдать на переводы.

### 3. Отписываемся в тикет

В тикет надо отписать список ключей из предыдущего пункта и скрин, на котором видно где эти ключи участвуют.
Потом призвать ответственного за задачу менеджера (Анну Анциферову или Анну Симакову), чтобы кто-то из них заказал взрослые переводы.

### 4. Опционально: сделать переводы на английский

Перевести самостоятельно на английский, если тексты простые и не требуют сложных выражений.
