# Описание правил валидации форм

## Предметная область

Найм работает с анкетами. Анкета заполняется частями. Работа над одними
и теми же полями требует разных правил обращения с данными, например, в
части обязательности заполнения.

Пример анкеты (оператор должен заполнить `call_name` и контактный номер
телефона, но может заполнить всё кроме `sign_aggeement`; на последующих
этапах заполняются все данные):

    call_name           Николай
    first_name          Николай
    last_name           Петров
    birthday            1997-01-03
    sign_aggeement      yes
    contact_phone       +79123003040
    additional_phone    +79254003020


Отсюда требование: уметь определять разные правила заполнения анкетных
данных в зависимости от ситуации.


## Формы

Сервис оперирует понятием форм. Форма определяет набор полей и правила
их заполнения. Должны быть простыми как формы, так и правила заполнения,
так как в будущем будем задавать их без разработки из админки.

Отсюда особенности:
- Формы плоские.
- Значения полей представлены строками. Для значений определены правила
  валидации, но интепретация значений осуществляется вне сервера.
- При заполнении пустые символы (пробелы, переносы строк, и т.д.)
  обрезаются, пустое поле считается незаполненным.


## Сценарии использования

Сервис сценариев будет требовать заполнения всех required полей формы,
валидируя их в соответствии с заданными правилами. Интерпретируются
только персональные данные, которые заменяются на `personal_id`.

Для сервиса анкет почти все формы должны создаваться без required, так
как данные обрабатываются другими сервисами.


## Сервис и либа

Сервис предоставляет api для создания новых форм, получения правил их
валидации, а также библиотеку для применения валидации на клиенте.


## Спецификация и заполнение

Пример заполнения формы:

    {
        "field_values": [
            {
                "field_name": "call_name",
                "field_value": "Николай"
            },
            {
                "field_name": "sex",
                "field_value": "male"
            },
            {
                "field_name": "contact_phone",
                "field_value": "+79120000001"
            },
            {
                "field_name": "scout_notes",
                "field_value": "Звонить только утром!"
            }
        ]
    }

Спецификация формы:

    {
        "name": "st/driver/scouts/filling-form/v1",
        "description": "Заполнение скаутом при первом контакте с водителем",
        "fields_specification": [
            {
                "field_name": "call_name",
                "validation_rules": [
                    {
                        "name": "required",
                        "values": [{"value": "yes"}]
                    }
                ],
                "properties": []
            },
            {
                "field_name": "sex",
                "validation_rules": [
                    {
                        "name": "required",
                        "values": [{"value": "yes"}]
                    },
                    {
                        "name": "enum",
                        "values": [{"value": "male"}, {"value": "female"}]
                    }
                ],
                "properties": []
            },
            {
                "field_name": "contact_phone",
                "validation_rules": [
                    {
                        "name": "required",
                        "values": [{"value": "yes"}]
                    }
                ],
                "properties": [
                    # Not supportted yet
                    # {
                    #     "name": "type_trait",
                    #     "values": [{"value": "phone_number"}]
                    # },
                    {
                        "name": "personal",
                        "values": [{"value": "yes"}]
                    }
                ]
            },
            {
                "field_name": "scout_notes",
                "validation_rules": [],
                "properties": []
            }
        ]
    }
