## YDB

{% note warning %}

YDB как источник сейчас находится в разработке. Не использовать!

{% endnote %}

### Добавление секретов

* [Как добавить секрет yav](../../docs/arcadia/secrets.md#how_to_add_yav)
* [Как добавить секрет strongbox](../../docs/arcadia/secrets.md#how_to_add_strongbox)
* [Как использовать секрет в правиле](../../docs/arcadia/secrets.md#how_to_use_secret)
<br>
<br>

### Описание схемы yaml файла

* `connection`:
    * `secret` — алиас секрета в config.yaml
* `replicate_by` — поле, по которому нужно реплицировать.
Это должно быть поле, хранящее дату и выставляющееся в БД.
Также для корректной работы по этому полю необходимо иметь индекс.
* `table` — имя таблицы.
* `replicate_by_index_view` - имя индекса по полю, по которому нужно реплицировать
* `primary_key` — список имен ключевых колонок.
* `timezone` — по умолчанию `UTC`. Нужно явно выставить иную в случае,
  если поле `replicate_by` по каким-то причинам выставляется не в `UTC`.


### Ограничения { #ydb_response_limitations }

На выполнение запросов со стороны YDB накладываются [следующие ограничения](https://ydb.yandex-team.ru/docs/concepts/limits-ydb#ogranicheniya-pri-vypolnenii-zaprosov). По умолчанию значение параметра `data_chunk_size` (количество документов в одном чанке, которое за раз вычитывает репликация) для YDB равно 1000. Это может иметь следующие последсвтвия:

* **Дедлок**: если в вашей таблице хранится слишком много документов (больше 1000), у которых
    * не заполнено поле, по которому идёт репликация;
    * одинаковое значение в поле, по которому идёт репликация.

  Репликация не сможет сдвинуться - произойдёт дедлок.
* **Низкая скорость репликации**: в некоторых ситуациях маленький размер чанка может негативно сказаться на скорости репликации.

Если выставить для `data_chunk_size` значение большее, чем 1000, предварительно не повысив это ограничение для базы на стороне YDB, то будет прокинута ошибка `YdbTruncatedResponseError`. Чтобы этого избежать, попросите YDB повысить для вашей базы лимит. Для этого заведите тикет в очереди `YDBREQUESTS`. [Пример](https://st.yandex-team.ru/YDBREQUESTS-1519) такого тикета.
