## Mongo
* `replicate_by` — поле, по которому нужно реплицировать. Это должно быть поле, хранящее дату и выставляющееся в монгу
  исключительно через `$currentDate`. Также для корректной работы по этому полю необходимо иметь индекс.
* `replicate_by_type` - нужно указывать это поле, если тип поля для репликации отличается
от типа Date. Доступная опция: `bson_timestamp`.

### Секреты
Секреты для mongo нужно добавлять в секдист [replication](https://tariff-editor.taxi.yandex-team.ru/services/38/edit/356017/secrets?service_name=replication).
### Описание параметров подключения
Возможны два варианта указания параметров подключения для правила - либо в самом правиле, либо в схеме в schemas/mongo.
Если в репозитории [schemas](https://github.yandex-team.ru/taxi/schemas/tree/develop/schemas/mongo) схемы еще 
нет - предпочтительнее указывать параметры в самом правиле. Если схема описана в репозитории, то предпочтительнее вариант schemas/mongo. Оба варианта одновременно использовать нельзя.
#### Параметры подключения в правиле
Необходимо в source в правиле добавить ключ connection с таким содержимым:
 * `secdist_path`: имя ключа в секдисте с секретами для этого правила. Аналог ключа `connection` в schemas/mongo.
 * `database`: имя БД, к которой необходимо подключаться. Аналог ключа `database` в schemas/mongo.

Также в ключе `source.collection` необходимо указать имя коллекции, аналогично ключу `collection` в schemas/mongo.
Пример корректного описания параметров подключения в правиле:
```
source:
    type: mongo
    collection_name: accepted_eulas
    connection:
        secdist_path: users
        database: dbusers
```
#### Параметры подключения в schemas/mongo
* `collection_name` — алиас коллекции из schemas/mongo. Если необходимый yaml-файл коллекции отсутствует в репозитории dwh,
  его надо скопировать из репозитория [schemas](https://github.yandex-team.ru/taxi/schemas/tree/develop/schemas/mongo)
  в репозиторий dwh по пути [schemas/mongo](https://github.yandex-team.ru/taxi-dwh/dwh/tree/develop/schemas/mongo). Если настройки
  подключения к коллекции были изменены в репозитории schemas, соответствующие изменения
  нужно добавить и в репозиторий dwh, иначе репликация из источника будет сломана.

## FAQ
### Какой маппер выбрать для сырого слоя YT, $raw или $bson?
В целом особой разницы нет, в любом случае в YT данные попадают как есть, просто в $raw это yson, а в $bson - байтовая строка. Если нет каких-то специфических причин, по которым хочется иметь в YT именно байтовую строку (например, ее можно погрузить как есть обратно в mongo), то можно выбрать любой. Обычно выбирают $raw.
