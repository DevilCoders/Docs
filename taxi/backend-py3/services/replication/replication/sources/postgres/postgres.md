## Postgres
* [Как добавить секрет yav](../../docs/arcadia/secrets.md#how_to_add_yav)
* [Как добавить секрет strongbox](../../docs/arcadia/secrets.md#how_to_add_strongbox)
* [Как использовать секрет в правиле](../../docs/arcadia/secrets.md#how_to_use_secret)
<br>
<br>
* `connection`:
    * `secret` — алиас секрета в config.yaml
* `replicate_by` — поле, по которому нужно реплицировать.
Если тип репликации - `int`, это должен быть целочисленный автроинкремент.
При репликации по дате, это должно быть поле, выставляющееся в постгрес
исключительно через `now() AT TIME ZONE UTC` при использовании TIMESTAMP,
`now()` для TIMESTAMPTZ.
Также для корректной работы по этому полю необходимо иметь индекс.
* `table` — имя таблицы.
* `primary_key` — список имен ключевых колонок.
* `replicate_by_type` — если репликация происходит по автоинкременту или по TIMESTAMP,
это поле указывать не нужно. При репликации по TIMESTAMPTZ нужно указать `timestampz`.
Подробнее об отличиях и предпочтительном типе таймстемпа можно прочитать
на [вики](https://wiki.yandex-team.ru/taxi/backend/userver/postgres/timestamp-vs-timestamptz/).
* `timezone` — поле необходимо указывать если поле `replicate_by` или другие даты в документе не содержат информации о часовом
поясе (TIMESTAMP) и при этом выставляются не в `UTC`. Все даты без таймзоны **будут явно сконвертированы** в `UTC` из `timezone`.
* `raw_select` — поле, в котором можно указать кастомные запросы для получения данных из базы.
    * `data` — полный запрос для получения данных из базы (поле для репликации и первичный ключ должны
       обязательно быть в списке выбранных колонок).
       Можно использовать общие подстановки из
       `{rule_scope}/plugins/config.yaml`: `consts` -> `postgres`.
    * `data_query_has_conditions` — булевый флаг, обязателен при указании `data`. Нужно указать, содержатся ли
       условия в кастомном запросе данных.
    * `data_query_replicate_by` — указать кастомное поле для запроса по дате,
       например, тут может фигурировать имя таблицы "table.updated".
       В итоговых документах все равно должно быть поле указанное в replicate_by правила.
    * `min_replicate_by` — полный запрос для получения минимального значения поля репликации в базе. Обязательно также
       указать `max_replicate_by`.
    * `max_replicate_by` — полный запрос для получения максимального значения поля репликации в базе.
    * `replicate_by_has_conditions` — булевый флаг, обязателен при указании `min/max_replicate_by`.
       Нужно указать, содержатся ли условия в кастомном запросе минимального/максимального значения поля репликации.
* `table_settings` - тут можно указать, по какому принципу можно получать таблицы из базы данных.
  Используется вместо `table`.
  У каждого способа получения есть свои параметры.
    * `type` — способ получения таблиц. На данный момент доступна только одна опция -
      получение по префиксу названия таблицы, **by_prefix**.
    * `prefix` (для `type` == **by_prefix**) - префикс, по которому нужно доставать таблицы по имени.
* `conditions` - список условий, по которым нужно фильтровать строки в таблице
  (сейчас поддерживается только конъюнкция условий - их объединение с помощью оператора
  AND).
    * `field` — столбец для фильтрации
    * `operator` — бинарный оператор условия. На данный момент поддерживаются
    только операторы сравнения постгреса ('>=', '<=', ...). Оператор обязательно
    нужно указывать в кавычках.
    * `value` — значение, по которому проверяется, выполняется ли условие.
* `prepared_statement_disabled` — выставьте true, если **prepared statements** не поддерживаются настройками pg bouncer.
* `connection_json_decoder` — выставьте true, если хотите, чтобы ваши json/jsonb колонки декодировались как объекты, а не строки.
* `broken_date_default` — только для источников, содержащих битые даты! Выставьте значение даты по умолчанию
   для случая, когда в столбце типа date/timestamptz/timestamp может лежать год больше datetime.MAXYEAR(9999),
   стандартный кодек не может распарсить такую дату.
   Дату нужно передавать в кавычках, в формате YYYY-MM-DD, пример: '2021-01-01'
