## Пропуск невалидных документов
Для того, чтобы не прерывать процесс репликации из-за несущественного количества
**невалидных документов** (документов, которые не соответствуют схеме таргета или схеме маппера),
существует механизм, позволяющий пропускать такие документы.


Для каждой команды ответственных для каждого таргета каждого правила подсчитывается количество
невалидных документов. Полученное число сравнивается со следующими порогами:

* `invalid_docs_limit` - (_целое число_) максимальное число невалидных документов,
  при котором репликация может быть продолжена;
* `invalid_docs_alert` - (_целое число_) число невалидных документов,
  при котором будет зажигаться алерт.

### Мониторинг очереди
В рамках монран проверки невалидных документов также выполняется подсчёт **старых документов**
в очереди - документов, которые были добавлены в очередь достаточно давно, чтобы быть удалёнными
из неё, но по каким-то причнинам всё ещё находящиеся в ней. Это число сравнивается с пороговым
значением `queue_docs_alert` - (_целое число_) числом, при котором будет зажигаться алерт.
Если не задано, то будет использоваться `invalid_docs_alert`.

### Для чего это нужно
Если в процессе репликации возникают проблемы с небольшим количеством документов при вставке в
таргеты или в процессе маппинга данных, то, чтобы не прерывать процесс, рекомендуется подключить
этот механизм.

### Как включить пропуск невалидных документов
По умолчанию механизм считается выключенным и репликация полностью останавливается. Чтобы включить пропуск невалидных документов, необходимо задать соответствующие пороговые значения.
Сделать это можно в админке. Для этого необходимо выбрать нужную группу правил -> нажать снизу
кнопку **изменить** -> выбрать **инструмент:** `invalid_docs` -> **action:** `change_thresholds`
-> нажать `+` -> указать имя правила и задать значения. Если значения для интересующего правила
уже заданы, то можно их изменить. **Рекомендация**: выставляйте небольшие значения
(несколько единиц). Если необходимо выставить значения выше, то стоит выключить
правило и исправить проблему. Возможные способы исправления:

* поправить маппер;
* поправить схему таргета;
* поправить сами документы на источнике.

После исправления документов не забудьте обновить поле инкремента (replicate_by) или подвинуть поле репликации назад.

### Как подписаться на мониторинг
Подробнее про то, как подписаться на алерты, [здесь](responsible.md). Алерт о невалидных
документах называется **replication-{responsible}-invalid-docs**, где **{responsible}** -
ваша команда.
