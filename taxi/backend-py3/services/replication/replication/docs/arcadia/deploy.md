## Процесс выкатки в **testing** **dwh/replication_rules**
1. Когда пул-реквест готов и прошёл все [тесты]({{ link_to_test_rules }}) — нужно проверить
его работоспособность в **testing**.

    1. На пул-реквест нужно выставить плашку `taxi/deploy:testing`
    и [выкатить **replication_rules**]({{ link_to_replication_rules_teamcity_customs }})
    в **testing** - **Custom (testing)**, бранч **replication_rules**.

    2. Инициализировать правила через админку в разделе {{ description_replication_admin }}.
    Для этого нужно выбрать группу правил, нажать
    **Изменить** -> **change_state** -> **init**
    выбрав все таргеты вашего правила и создать [драфт](drafts.md#change_state).
        * В **testing** нужно окнуть его самому и дождаться его выполнения
        * В **production** нужен OK [ответственных](responsible.md)

    3. В админке репликации, выбрать группу правил и убедиться, что крон-таски нужного правила отрабатывают без ошибок.
    Ссылки на крон-таски будут находиться справа от каждого приемника в правиле. Для лучшего понимания деталей в
    крон-таске следует читать логи уровня **INFO** и выше. [Подробнее про диагностику](diagnostic.md).

2. Пройти [ревью](responsible.md#review-pull-requests) и замерджить код.

## Процесс выкатки в **production** **dwh/replication_rules**

1. По ссылке [**replication_rules**]({{ link_to_replication_rules_teamcity }})
выбрать **Releases/auto release** (бранч **replication_rules**) и там нажать
**run**. После сборки в тимсити появится
ссылка на релизный тикет.
При выкатке следить нужно только за своими активными правилами, ссылки на кроны есть в админке.
При добавлении нового правила достаточно просто докатить релиз.

2. Подождать пока в тикете бот отпишется об успешном прохождении тестов.
Отправить в [чат репликации]({{ link_to_replication_telegram_chat }}) ссылку на созданный
драфт (о нем отпишется робот в комментариях) и попросить ок.
{{ admin_alert_message }})

3. В самом конце, если драфт завершен успешно, нужно закрыть релизный startrek-тикет.

{% note warning %}

Недокаченный релизный тикет закрывать нельзя!

{% endnote %}

Есть 2 варианта:
* Попросить в чате репликации
* Самостоятельно: через менеджера перевести в статус "Готов к выкладке", а потом "Закрыть (для LXC)"


## FAQ
### Как откатить релиз правил?
[По ссылке](https://tariff-editor.taxi.yandex-team.ru/drafts?services_names=replication&entities=replication_draft&zones=deploy_sandbox_resources)
находим предыдущий релиз, и клонируем нужный драфт. Далее по обычному флоу пункта 2.

### Как присоединиться к релизу?
Делайте это только с согласованием с автором текущего релиза.
[Общая инструкция](https://wiki.yandex-team.ru/taxi/backend/deploy/?from=%2Ftaxi%2Fbackend%2Fbasichowto%2Fdeploy%2F#priattachitsjaktekushhemurelizudokatka) по докатке есть на вики.
