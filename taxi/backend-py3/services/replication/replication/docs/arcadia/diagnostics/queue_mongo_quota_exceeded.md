# Что делать в случае переполнения очереди

Для очереди `queue_mongo` иногда появляются ошибки вида:
`Quota exceeded for {rule_name}: occupied space=6000.73 Mb > quota=6000 Mb`.

Ошибка про то, что квота очереди переполнена, при записи вида `source -> queue_mongo`.
Такое бывает, когда таргеты читающие из нее не могут записать в конечные базы
(yt например). Нужно смотреть на все таргеты вида `queue_mongo -> *`

## Определяем проблему
Первым делом стоит открыть админку вашего правила и проверить, нет ли еще
   репликации с алертами из очереди (`queue_mongo -> *`). Они будут подсвечены красным, в случае проблем.

## Типичные сценарии
- Какой-то таргет выключен (**disabled**). В этом случае, его нужно либо включить,
  либо удалить: **change_state -> remove** (с потерей состояния репликации). Очередь начнет разгребаться
- Выключенных таргетов нет, но есть алерты, при этом если перейти в по ссылке в крон или логи **ext** таргета -
  видны массовые ошибки при завершеннии таких задач.
  В этом случае нужно либо чинить ошибки этого таргета, либо тоже его удалять.
- Алертов и проблем выше нет. Происходит ли перезагрузка всей истории? Если да, то, возможно,
  вам стоит [шардировать](../faq.md#queue_migration)
  очередь, чтобы прогрузка была эффективнее и быстрее.
- Алертов нет и очередь уже шардирована. Нужно смотреть, во что вы упиратесь, возможно,
  во вставку в **YT** (или другой таргет).
  Стоит поискать ошибки в логах, возможно, для YT у вас не стоит бандл (tablet_cell_bundle), либо на каком-то
  кокнретном кластере сейчас технические работы. В случае проблем с бандлом,
  вам стоит либо добавить его в [правила](../yt_prefixes.md),
  либо расширить его ресурсы (обращайтесь к владельцам вашего бандла).
- Если и это не помогает, можно временно расширить квоту.
  Сейчас это делается через запрос в чат поддержки.
