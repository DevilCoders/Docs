## Проверка работы с источником { #source_validation }
Перед тем как добавить новый источник, стоит проверить, что репликация может подключиться
к источнику и получить всю необходимую для работы репликации информацию.
Для этого можно воспользоваться драфтом **source_validation**.
Пример [драфта](https://tariff-editor.taxi.tst.yandex-team.ru/replications/draft/619002).

Перед тем как проверить источник и секрет, необходимо [добавить секрет](secrets.md)
для сервиса репликации. Секреты используются в зависимости от типа окружения.
То есть для тестинга, будет использоваться секрет заведенный для тестинга.

Чтобы создать драфт на проверку секрета или источника, необходимо:
1. В админке репликации найти группу правил которая использует тот же секрет, что и новый источник.
   Например, группа правил [driver_tutorials](https://tariff-editor.taxi.yandex-team.ru/replications/show/driver_tutorials)

    ![Rule Scope](_images/source_validation_1_scope.png "Окно выбора группы правил" =400x240)

2. Затем перейти в раздел управления репликации, нажав на кнопку **Изменить**

    ![Edit Rule Scope](_images/source_validation_2_edit.png "Кнопка изменить" =400x200)

3. Откроется интерфейс управления репликацией
   ([testing](https://tariff-editor.taxi.tst.yandex-team.ru/replications/create-draft/driver_tutorials) /
   [production](https://tariff-editor.taxi.yandex-team.ru/replications/create-draft/driver_tutorials))
4. Необходимо из выпадающего списка **Инструменты** выбрать **source_validation** и указать требуемые поля

    ![Draft Open](_images/source_validation_3_draft.png "Выбор инструмента" =500x275)

    ![Draft Fields](_images/source_validation_4_draft.png "Заполнение полей" =500x650)

    Нужно указать:
     - Тип секрета strongbox или yav, [подробнее](secrets.md), в будущем он будет в значениях plugins/config.yaml
     - Ключ секрета, пометка **1**: **STRONGBOX_ID** для strongbox или **sec-123...** для yav
     - Тип вашего источника
     - Таблица вашего источника для проверки, пометка **2**: лучше указать полное имя в соответствии со схемой, даже если она **public**
     - Поле репликации, пометка **3**: опционально, можно указать во втором запуске, но по нему также будут и проверки выполнения конкретных запросов

    Остается создать драфт, пометка **4**.

5. После запустить драфт и дождаться завершение выполнения.
Пример драфта для проверки [driver_tutorials](https://tariff-editor.taxi.yandex-team.ru/replications/draft/974956)

{% note warning %}

Если драфт выполнился с ошибкой, это значит что с секретом
или источником возникли проблемы. Скорее всего репликация не сможет работать правильным образом.
Чтобы исправить проблему, нужно посмотреть сообщение об ошибке в самом низу драфта.

{% endnote %}

## Как читать результат
- `[shard0] connection: SUCCESS` - успешно подключились к источнику
- `[shard0] primary keys ...` - первичный ключ источника, могут быть проблемы для его определения у view
- `[shard0] schema` - полное описание схемы источника
- `[shard0] indexes` - какие в таблице есть индексы, доступные для репликации
- `QUERY PLAN for select` - тут будет указан запрос, который будет использован в репликации и результат его исполнения планировщиком. Стоит смотреть, был ли выполнен **Index Scan** и на реальный **Execution time**
- `[shard0] driver_tutorials.shown_tooltips size is 4453 MB, which is more than 10 MB, so it should be loaded as increment` - будет указан текущий размер таблицы и рекомендация, какой тип репликации стоит выбрать. Для view может быть указан некорректный результат

