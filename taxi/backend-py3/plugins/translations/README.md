Работа с переводами в стиле Unix

Если у Вас кодогенерированный сервис, то для того чтобы включить работу
с переводами необходимо выполнить следующие действия.

1. Прямо или опосредовано (это может сделать какой-то из зависимых плагинов)
добавить в service.yaml секцию


```yaml
translations:
    - keyset
```

2. Разметить строки которые нужно переводить при помощи следующего кода


```python
from taxi.i18n import _


def foo():
    txt = _('Hello, world')
    do_something(txt)

    return _('File not found')

```

Символ подчёркивания выбран поскольку он совместим с традиционным `xgettext`.

3. Если где-то у Вас в сервисе каким-то способом требуется явно задать язык
выдачи (например пользователь определяет на каком языке с ним говорить), то
можно добавить явную установку контекста:

```
    from taxi import i18n


    ...

    with i18n.set_context(languages=('ru', 'ua')):
        print(_('Hello, world!')
```

### Экспорт в танкер

Для того чтобы извлечь строки для перевода из Вашего кода необходимо
использовать стандартную утилиту `xgettext`:

```txt
xgettext -o- *.py
```

Для удобства в общем Makefile реализована цель, которая обходит все файлы
сервиса. Можно написать `make tanker-<service-name>`, например:

```txt
make tanker-hiring-forms
```

B каталоге `generated` будет сгенерирован файл который можно использовать для
того чтобы передать переводы в танкер. Имя сгенерированного
файла - `tanker.po` (Используется стандартный `po`-формат).


### Интеграция

Интеграция ручек с `i18n` выполнена по факту подключения плагина
`translations`.

Ручки "понимают" заголовок `Accept-Language` и переводятся к значению,
переданному в нём.

Иногда требуется еще что-то проинтегрировать. Например `cron`-скрипт может
обрабатывать множество записей в БД каждая из которых требует связи с нужным
языком, который берётся из БД.

В этом случае можно делать следующим образом:

```python

from taxi.i18n import _
from taxi import i18n

def language_for_record(record):
    if record['phone'].startswith('+7'):
        return 'ru'
    return 'en'

for record in records:
    language = language_for_record(record)
    i18n.set_context(languages=language)
    send_sms(record['phone'], _('Hello, world'))

```

В итоге пользователям с телефонами начинающимися на `+7` будет отправлено
переведённое на русский язык сообщение, остальным - по английски.


### Особенности

1. Если переводов не найдено ни в одном языке - возвращается оригинал строки
2. Ключем к переводу является собственно строка перевода (это в общем-то
   традиционный Unix подход)
3. Если Вам по коду по какой-то причине нужны коды для строк, можно сделать
   их себе:

```python
messages = {
    'ER_NOT_FOUND': _('Not found'),
    'ER_ACCESS': _('Access denied')
}

...

print(messages['ER_NOT_FOUND'])
```


