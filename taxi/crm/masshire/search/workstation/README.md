# Модуль поиска для масснайма

## Логирование

### Общая информация

Логи параллельно пишутся в UnifiedAgent, который доставляет их на YT, и в файл на диске, чтобы можно было оперативно посмотреть записи на конкретной машине.
Доставка логов на YT отстаёт на единицы часов даже если использовать 30m интервалы.
За ротацию логов отвечает само приложение, поскольку встроенные логгеры в Java это умеют, необходимости в `logrotate` нет.
`pilorama` и `push_client` не используются.

### Логирование запросов

Поскольку запросы к нам приходят в виде ProtoBuf сообщений, их не получится логировать как строку запроса для HTTP.
Сообщения логируются в виде JSON с помощью стандартного преобразования proto в JSON.
Это позволит использовать встроенные функции для работы с JSON в CHYT/YQL.
При этом логи начинают зависить от названий полей в .proto.
Если поменять названия полей, то запросы к логам со старыми названиями полей перестанут работать.

Пример запроса в виде JSON:

```json
{"query":{"keyword_queries":[{"text":"водитель"}],"age":{"to":"42"},"salary":{"range":{"to":"100000"}},"experience":{"levels":["EXPERIENCE_LEVEL_MIDDLE"]},"genders":{"ids":["male"]},"job_sites":{"job_sites":["JOB_SITE_HEAD_HUNTER","JOB_SITE_SUPER_JOB"]}},"page_size":10}
```

### Доставка логов в YT

Доставка логов в YT делается средствами UnifiedAgent.
Для access-логов и логов приложения используются отдельные таблицы и отдельные proto-сообщения.
Разделение на разные топики производится средствами UnifiedAgent.

Полезная нагрузка передаётся в виде proto-сообщений, которые содержат все необходимые метаданные.
Поля и их типы в таблице с логами соответствуют полям и типам в proto-сообщении для логов.

