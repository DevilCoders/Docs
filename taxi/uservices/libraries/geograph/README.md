# Библиотека uservices для работы с графом
## Общие структуры и классы
### Graph
::graph::Graph - это базовый класс, который поддерживает в памяти данные графа
дорожного движения (в теории - можно загрузить и пешеходный граф) и позволяет
работать с ним.
Граф сам по себе неизменяемая сущность, его не получится отредактировать - но
можно загрузить новый.
Основная документация находится в ::graph::Graph
## Поиск объектов на индексе
### Общая схема

Мы предоставляем 2 шаблонных класса:
 1. Индес объектов на графе ::graph::GraphObjectIndex
 2. Поиск объектов на графе по индексу - ::graph::DijkstraObjectSearcher.

Первый хранит в себе объекты привязанные к графу, а второй осуществляем 
поиск по этому индексу с помощью алгоритм Дейкстры.

### ::graph::GraphObjectIndex (индекс объектов)
Индекс объектов который хранит пользовательские объекты и их позиции на
графе. Каждому объекту сопоставленно: ключ (параметр шаблона), значение(параметр шаблона), позиция на графе. 
Позиции добавляются семейством методов Insert, удаляются - методами Remove.
Insert можно передать сразу все желаемые позиции, или же передавать позиции
по одной. Класс является потоко-безопасным на чтение, но не на запись.

### ::graph::DijkstraObjectSearcher (поиск объектов на графе)
::graph::DijkstraObjectSearcher осуществляет поиск объектов на графе по индексу ::graph::GraphObjectIndex с помощью алгортимы Дейкстры.
В конструкторе принимает коллбэк для обработки результатов поиска (который может в случае чего остановить поиск),
и лимит по кол-ву рёбер для алгортима Дейкстры.
Если поиск завершился раньше работы алгоритмы с помощью определённого пользователем коллбэка - значение возвращенное коллбэком прокидывается из ф-ии Search.
Коллбэк не должен кидать исключений, но если он это сделает - то оно будет залогировано с помощью LOG_ERROR, потому что мы не можем прокидывать исключения в код библиотеки поиска.
Есть класс ::graph::DijkstraObjectStoringSearcher который просто сохраняет все найденные объекты в массив (используется копирование для ключей и значений).


### Что нужно для организации поиска.
Для организации поиска нужно создать и регулярно обновлять индекс ::graph::GraphObjectIndex с объектами в потоко-безопасной манере и использовать ::graph::DijkstraObjectSearcher на нем. Ниже приведен модельный пример, использующий библиотеку geobus для получения информации о водителях.
\snippet        examples/search_on_graph_test.cpp CODE_BLOCK2

#### Поиск водителей по цепочке
\snippet        examples/search_chain_demo_test.cpp CODE_BLOCK3

## Тестирование
Если вы хотите использовать граф в юнит-тестах, вам сюда: ::graph::test::GraphTestFixture
