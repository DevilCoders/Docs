Есть три группы параметров, влияющих на наше мнение о водителе:

1. Объективные характеристики водителя и его автомобиля.
2. История работы водителя в сервисе.
3. Характеристики водителя в контексте конкретного заказа, на который ищется исполнитель.

### Объективные характеристики

1. Наличие лицензии.

   Мы хотим дать сильное, почти непреодолимое преимущество для водителей, у которых есть лицензия. Сверка лицензии происходит по госномеру автомобиля по базе, предоставляемой департаментом транспорта города.

   Для водителей без лицензии действует коэффициент `.1`.

2. Распознаваемая марка и модель автомобиля.

   Указанная в профиле водителя марка автомобиля должна существовать в базе данных Яндекс.Авто. Это позволяет не только показывать пользователю в приложении грамотное и красивое название автомобиля, но и дополнительно классифицировать машины внутри сервиса, не присылая "логаны" на заказы по тарифу "комфорт".

   Для водителей с нераспознанной маркой/моделью действует коэффициент `.8`.

3. Одновременная регистрация в нескольких таксопарках/диспетчерских.

   Особое требование партнеров: если водитель работает на автомобиле таксопарка, но при этом еще и берет заказы через терминалы других диспетчерских, мы должны в первую очередь предлагать заказ через терминал таксопарка.

   Для водителя диспетчерской, если он ездит на машине другого таксопарка, действует коэффициент `.1`.

4. Бонусы и штрафы, наложенные на весь таксопарк.

   Если партнер чем-то провинился или, наоборот, заслужил поощрение - именно в этом месте мы применяем бонусы и штрафы ко всем его водителям.

   Коэффициент задается вручную через админку или автоматизированными средствами мониторинга.

5. Бонусы и штрафы, наложенные на конкретного водителя.

   Аналогично предыдущему пункту, но для конкретных водителей.

### История работы

Каждый назначенный водителю заказ оценивается по шкале `-1..1`. Учитываются только те заказы, которые либо успешно завершены, либо отменены пользователем, либо провалены таксопарком.

В оценку заказа входят параметры:

1. Пользовательские оценки.

   Оценка за каждый заказ линейно переводится из шкалы `1..5` в шкалу `-1..1`, затем умножается на коэффициент `1/2`. Если заказ не оценен пользователем, то этот параметр считается равным `0`.

2. Опоздания.

   Опоздание водителя от 0 до 10 минут линейно переводится в шкалу `1..-1`, а более 10 минут - в `-1`, затем умножается на коэффициент `1/4`.

3. Качество передачи местоположения во время выполнения заказа.

   Соотношение свежих и устаревших сигналов местоположения водителя линейно переводится в шкалу `-1..1` (`-1`, если все сигналы устаревшие, `1` - если все свежие), затем умножается на коэффициент `1/4`.

После этого оценка заказа умножается на два коэффициента: 

1. Возраст заказа.

   Чем старше заказ, тем меньший вклад он вносит в общую оценку водителя.

   `1 / (age/10 + 1)`, где `age` - возраст заказа в днях

2. Правдоподобность заказа.

   Если заказ выполнен подозрительно быстро или отменен через минуту после создания - он не должен сильно влиять на итоговую оценку, потому что с высокой вероятностью мог быть сфальсифицирован.

   `d/g`, где `d` - продолжительность заказа, `g` - правдоподобная продолжительность заказа такого типа; если `d > g` - то коэффициент считать равным `1`

   Правдоподобная продолжительность заказов:
   - 30 минут, если заказ успешно завершен
   - 15 минут, если заказ отменен пользователем или провален таксопарком

После этого все оценки складываются и вместе составляют итоговую оценку истории работы водителя в сервисе (чем выше оценка - тем лучше история).


### Характеристики в контексте заказа

1. Статус водителя (свободен или занят).

   Для занятых водителей действует коэффициент `.1`.

2. Прогнозируемое время в пути до места подачи.

   Если водитель не успевает приехать, для него действует коэффициент `.1`. Если успевает, прогнозируемое время прибытия линейно переводится в коэффициент `.8..1`.

3. Предпочтения пользователя.

   Если пользователь уже ездил с этим водителем и оценил его отрицательно (от 1 до 3 звезд) - действует коэффициент `.05`. Если положительно - действует коэффициент `1`. В остальных случаях действует коэффициент `.9`.

### Пример

Для простоты будем считать, что по всем объективным характеристикам у водителей коэффициент 1, заказы правдоподобны, у пользователей нет предпочтений.

Пусть в нашей системе работает три водителя:

1. Сергей, без опыта.

   Рейтинг по истории работы - `0`.

2. Валерик, работает один месяц, выполнил 30 заказов (по одному в день). 

   За всю историю своей работы Валерик получил четыре оценки 5 и две оценки 1. На два заказа без оценок он опоздал на 10 минут. Свежесть треков - 40%.

   Рейтинг по истории работы - `2.51`.

3. Бобочон, работает одну неделю, выполнил 14 заказов (по два в день). 

   За всю историю своей работы Бобочон получил по одной оценке каждого вида (от 1 до 5), остальные 9 заказов остались без оценки. На тот заказ, по которому водитель получил оценку 1, он опоздал на 15 минут. Еще одно опоздание на 5 минут осталось без оценки. Свежесть треков - 75%.

   Рейтинг по истории работы - `3.1`.

Мы хотим распределить заказ, на который нужно подать машину через 10 минут. Рассмотрим категории водителей в разных ситуациях.

Сергей:
- занят/не успевает - `0`
- занят/приедет через 5 минут - `0`
- занят/приедет сразу - `0`
- свободен/не успевает - `0`
- свободен/приедет через 5 минут - `0`
- свободен/приедет сразу - `0`

Валерик:
- занят/не успевает - `0.0251`
- занят/приедет через 5 минут - `0.2259`
- занят/приедет сразу - `0.251`
- свободен/не успевает - `0.251`
- свободен/приедет через 5 минут - `2.259`
- свободен/приедет сразу - `2.51`

Бобочон:
- занят/не успевает - `0.031`
- занят/приедет через 5 минут - `0.279`
- занят/приедет сразу - `0.31`
- свободен/не успевает - `0.31`
- свободен/приедет через 5 минут - `2.79`
- свободен/приедет сразу - `3.1`

### Слабые места

1. Есть ощущение, что по текущей ситуации с оценками и опозданиями подавляющее большинство водителей будет иметь оценку по истории выше нуля. В этом случае сильно угнетаются новички.

2. Оценка по истории может быть как положительной, так и отрицательной. Совершенно нелогично умножать отрицательную оценку на понижающий коэффициент, например, для занятых и не успевающих водителей.

3. Большое преимущество получают виртуальные водители, которые хватают все заказы подряд и передают их реальным исполнителям.