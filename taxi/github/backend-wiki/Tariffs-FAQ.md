# Часто задаваемые вопросы

Данный документ является неофициальным дополнением к
[документации протокола][doc]. Документ содержит ответы на наиболее
часто задаваемые вопросы.

Если после прочтения документации протокола и данного документа у Вас
остались вопросы по заполнению тарифов, Вы можете задать их на
[taxi-tarif@yandex-team.ru][mailto].

## Тарифы заполнены, почему не идут заказы?

Пожалуйста, обратите внимание, что **не идут заказы != поступает мало заказов**. Последнее выходит за рамки технических проблем, по крайней мере связанных с импортами тарифов.

Возможные причины:

  * тарифам ещё не проставлены категории
  * тарифы в новом и старом форматах не совпадают; например, если у Вас есть два тарифа - например, "Эконом" и "Комфорт" - они должны быть заполнены как в старом, так и в новом (1.0) форматах, у них должны совпадать идентификаторы и проставлены категории

## Пример заполненных тарифов

Примеры заполненных тарифов можно найти [в кабинете][tariffs-faq].

Для Москвы:

  * тариф moscow1 описывает тарификацию по времени
  * тариф moscow2 - тарификацию по расстоянию

Для Питера (и других городов):

  * тариф spb1 описывает тарификацию по расстоянию

## При импорте какая-то непонятная ошибка

Ещё до импорта тарифов проверьте, что Ваш xml-файл с тарифами валиден с
точки зрения [RelaxNG-схемы][scheme]. Если xml-файл невалиден, то тарифы
точно не будут импортированы.

Для валидации можно воспользоваться бесплатным [jing][jing] (см.
[Как валидировать схему при помощи jing](#howto-jing)).

При заполнении тарифов важно помнить следующее.

Первое - расписание для дневных/ночных/выходных и прочих тарифов должно
быть заполнено для всех дней недели (от Monday до Sunday) и **для
праздничных** дней (Holiday). Также нужно учесть, что временные
интервалы дневных/ночных/... тарифов не должны пересекаться.

Второе - определённый в схеме порядок элементов важен. Например, услуги
должны быть заполнены в следующем порядке: `taximeter`, `paid_dispatch`,
`continue_transfer`, `waiting`, `conditioner`, `no_smoking`,
`will_smoke`, `child_chair`, `universal`, `animal_transport`, `other`.

Третье - есть обязательные услуги, которые должны быть заполнены. Для
`<FreeRoute>` должны быть заполнены `taximeter` и `waiting`, для
`<FixedRoute>` - `waiting`.


<h2 id="#howto-jing">Как валидировать схему при помощи jing</h2>

Порядок установки:

  1. jing написан на Java, поэтому сначала установите Java Runtime
     Environment; после установки откройте командную строку и проверьте,
     что у вас выполняется команда `java`.

  2. [Загрузите][jing-download] jing (он в архиве .zip) и распакуйте
     архив.

  3. **Прямо в распакованный архив** положите файл со [схемой][scheme] и
     файл с тарифами.

После этого можно проверять тарифы. В командной строке Windows набирайте
команды:

    cd \path\to\jing
    java -jar bin\jing.jar tariffs_1_0.rng tariffs.xml

Для Linux:

    cd /path/to/jing
    java -jar bin/jing.jar tariffs_1_0.rng tariffs.xml

Здесь tariffs.xml - это файл с тарифами.

Если тарифы заполнены корректно, выполнение программы просто завершится
без какого либо вывода. В случае ошибок можно увидеть что-то навроде:

    tariffs.xml:55:51: error: value of attribute "Type" is invalid; must be equal to "continue_transfer", "paid_dispatch" or "waiting"
    tariffs.xml:56:39: error: element "MinPrice" not allowed here; expected element "Area", "FreeTime" or "TransferLocations"
    tariffs.xml:57:35: error: element "Service" incomplete; expected element "Area", "FreeTime" or "TransferLocations"

В этом трейсе важна самая первая строчка - в ней содержится номер строки
в XML-файле с тарифами, на которой споткнулся валидатор. В приведённом
примере валидатор споткнулся на 55 строке, потому что в файле с тарифами
не было обязательной услуги `waiting`.


[doc]: /static/doc/taxi-server-protocol.pdf "документация протокола"
[scheme]: /static/doc/tariffs_1_0.rng "RelaxNG-схема"
[jing]: http://www.thaiopensource.com/relaxng/jing.html
[jing-download]: http://code.google.com/p/jing-trang/downloads/detail?name=jing-20091111.zip&can=2&q=
[mailto]: mailto:taxi-tarif@yandex-team.ru?subject=%D0%92%D0%BE%D0%BF%D1%80%D0%BE%D1%81%20%D0%BF%D0%BE%20%D1%82%D0%B0%D1%80%D0%B8%D1%84%D0%B0%D0%BC&body=%D0%9A%D0%BE%D0%BC%D0%BF%D0%B0%D0%BD%D0%B8%D1%8F%20NAME%20%28clid%3DCLID%29.%0A%D0%92%D0%BE%D0%BF%D1%80%D0%BE%D1%81 "Написать на taxi-tarif@yandex-team.ru"
[tariffs-faq]: /static/doc/tariffs-faq.xml "примеры тарифов"