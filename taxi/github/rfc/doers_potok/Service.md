
  
**Название сервиса**

doers_potok

**Какую продуктовую проблему решает сервис?**
Сервис является ядром всего бекенда, он взаимодействует с регистрацией и входом пользователей в сервис, выдает информацию о них и отдает ленту для каждого пользователя по запрошенным фильтрам.



**Почему нельзя решить эту задачу без разработки нового сервиса существующими решениями?**

Существующих решений под выдачу ленты нет.


**Как именно сервис будет решать поставленные перед ним задачи?**

1. Логин/регистрация
Проверка JWT token от Яндекс Паспорта.
При первом заходе мы регистрируем пользователя у себя (проверяем его JWT, если пользователя с таким ya_uid нет, то записываем в БД, иначе пропускаем в систему).
2. Получение Ленты
По местоположению пользователю выдается лента вакансий/соискателей для пользователя (фильтруется по координатам), которая показывается фронтом пользователю.
3. Обновление информации о пользователе
Update запрос для редактирования статуса активен ли пользователь или нет (он сам обновляет эту информацию в зависимости от того, ищет ли он работу/соискателей)
4. Выдача списка профессий
5. Выдача списка точек с вакансиями/соискателями

**Разрабатывается один сервис или система?**

Один сервис.

**С кем взаимодействует сервис?**

1. С микросервисом doers_stories для получения временных ссылок на видео для вакансий/соискателей

**Какие базы использует?**

Postgres.

**Какие периодические процессы?**

Нет.

**Планируется обработка персональных данных**

Да (проверка токена Yandex ID).

**Какие данные и по какой схеме сервис будет хранить в базе?**

На старте – представлено ниже.
Cхема может поменяться.

![photo_2021-10-11_14-18-02](https://media.github.yandex-team.ru/user/13227/files/b0bcb800-2a9e-11ec-9d42-4c3a264bff83)
Places - таблица заведений у работодателя
Jobs - таблица вакансий в заведении 
То есть у одного работодателя может быть несколько заведений
У одного заведения может быть несколько вакансий

**Какой объем данных будет храниться и какой объем будет изменяться в единицу времени?**

Таблицы: Employers + Employees
300 b * 300k = 90 million ~ 100Mb
Вес одной строки * кол-во пользователей
Таблица: Places
300b * 150k * 5 ~ 250 Mb
Вес одной строки * кол-во employers * 5 заведений у каждого
Таблица: Jobs
300b * 150k * 5 * 5 ~ 1250 Mb
Вес одной строки * кол-во employers * 5 заведений у каждого * 5 вакансий у каждого заведения

Cумма: (1250 Mb + 250 Mb + 100 Mb) * 1.5 ~ 2.5 Gb
Умножаем на 1.5 для запаса

Рассчитываем, что максимально в базу одновременно будут писать 50 человек (регистрироваться + добавлять заведения и места)

50 * 300b/s = 15 Kb/s

**Какие операции над данными заложены?**

Сreate
Get
Delete
Update

**Есть ли какой-то стейт в памяти, как он обновляется и валидируется?**

Нет.

**Какая нагрузка ожидается?**

125 RPS

200k - кол - во пользователей активных за день (максимум)
Каждый пользователь откроет приложение 2 раза в день и 2 раза получит точки для отображения на фильтре.

200k * 2 * 2 = 800k

Пользователю отгрузим ленту 5 раз (1 пользователь посмотрит 50 вакансий/соискателей в день (это отгружаем по 5 запросов)
200k * 5  = 1000k

Берем 2/3 нагрузки за 1/3 времени
(1 M + 0.8M) * (2 / 3) * / 8h / 3600s= 125 RPS (в пике)
(1 M + 0.8M)  / 24h / 3600s= 20 RPS (в среднем)
**Какие фолбеки предусмотрены на сам этот сервис?**

Если сервис недоступен - не отдаём ленту, не регистрируем пользователя, не отдаём точки.

**Какие фолбеки предусмотрены внутри этого сервиса на взаимодействие с другими сервисами?**

Если недоступен PostgreSQL - сервис недоступен
Если не доступен сервис doers_stories - сервис недоступен

**Какие возможности масштабируемости закладываются?**

Увеличение базы, увеличение ram/cpu на инстансе, увеличение количество инстансов сервиса.

**Какие точки отказа есть в сервисе?**

- Отказ Postgres
- Отказ сервиса doers_stories

**Укажите ключевые продуктовые метрики сервиса, за которыми планируете следить**

- Количество откликов пользователя, количество отказов
- Количество назначенных встреч
- Количество успешных встреч
- Количество не успешных встреч
- Время прошедшее от регистрации до загрузки истории о себе


**Укажите технические метрики**

- Количество запросов.
- Максимальное и среднее время ответа на запросы по типам запросов.
- Нагрузка на CPU и RAM
- Размер базы.

**Какая функциональность ожидается в сервисе в будущем?**

Постобработка видео

**Какое изменение нагрузки планируется?**

Прямо пропорционально количеству пользователей.

**Активно ли будет изменяться сервис?**

Да
