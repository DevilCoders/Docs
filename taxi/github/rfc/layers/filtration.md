# Фильтрация остановок и машинок транспорта по типу транспорта на экране транспорта.

## Бэк

### сервис layers

1. В режиме транспорта из эксперимента **layers_transport_filter** берем опции по фильтрации,
   которые возвращаем в ручке /v2/objects.
   Опции в эксперименте содержат:
      - Танкерный ключ для локализации текста опции
      - Тег иконки транспорта
      - LayersContext, который нужно добавить в повторный запрос ручки /v2/objects
      - Список actions, которые должны выполнить клиенты после нажатия на опцию фильтрации
      - id опции (используется на клиенте для сопоставления опций при перезапросах в /v2/objects)
      - transport_type из сервиса masstransit
      - мб еще что-то для настройки размеров

   Пример:
```
{
  "options": [
    {
      "id": "filter_option_0",
      "text": "bus_key",
      "image_tag": "bus_tag",
      "transport_type": "bus",
      "layers_context": {
        "type": "masstransit",
        "filter": [
          "bus"
        ]
      },
      actions: [
        {
          "type": "filter_transport",
          "vehicle_types": ["bus"]
        }
      ]
    },
    {
      "id": "filter_option_1",
      "text": "tram_key",
      "image_tag": "tram_tag",
      "transport_type": "tram",
      "layers_context": {
        "type": "masstransit",
        "filter": [
          "tram"
        ]
      },
      actions: [
        {
          "type": "filter_transport",
          "vehicle_types": ["tram"]
        }
      ]
    }
  ]
}
```

2. Опции в ответе ручки содержат:
      - Локализованный текст опции
      - Тег иконки транспорта
      - LayersContext, который нужно добавить в повторный запрос ручки /v2/objects
      - Список actions, которые должны выполнить клиенты после нажатия на опцию фильтрации
      - id опции (используется на клиенте для сопоставления опций при перезапросах в /v2/objects)
      - мб еще что-то для настройки размеров

   Пример:
```
{
  "options": [
    {
      "id": "filter_option_0",
      "text": "Автобус",
      "image_tag": "bus_tag",
      "layers_context": {
        "type": "masstransit",
        "filter": [
          "bus"
        ]
      },
      actions: [
        {
          "type": "filter_transport",
          "vehicle_types": ["bus"]
        }
      ]
    },
    {
      "id": "filter_option_1",
      "text": "Трамвай",
      "image_tag": "tram_tag",
      "layers_context": {
        "type": "masstransit",
        "filter": [
          "tram"
        ]
      },
      actions: [
        {
          "type": "filter_transport",
          "vehicle_types": ["tram"]
        }
      ]
    },
    {
      "id": "__default__",
      "text": "",          // текст не нужен
      "image_tag": "",     // тег не нужен
      "layers_context": {
        // какой-то контекст
      },
      "actions": [
      ]
    }
  ]
}
```

3. Принимать LayersContext из предыдущего пункта и фильтровать остановки в соответствии с
   параметрами фильтрации, указанными в этом LayersContext.


## Клиенты

1. Отображать опции в соответствии с тем, что пришло от сервиса layers (порядок, тексты, иконки, мб что-то еще). Дефолтный option не отображается.
2. При нажатии на какую-то опцию:
   - делать повторный запрос в ручку v2/objects с добавлением layers_context в запрос
   - выполнять перечисленные actions (в данном случае надо будет фильтровать на карте машинки транспорта)
3. Если отключили/отжали опцию, или в новом ответе не пришла зажатая на данный момент опция, то используем дефолтную опцию и выполняем пункт 2. Если список actions пуст или actions отсутствуют,
   то никакой фильтрации не должно быть, и весь транспорт должен быть на карте.
4. Если в ответе нет опций или нет default опции, то отрисовывать кнопки фильтрации не нужно. (Со стороны бэка наличие default опции обязательно, если есть другие опции).
