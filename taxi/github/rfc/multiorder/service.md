## Опросник для ревью комитетом

**Название сервиса**

multiorder

**Какую продуктовую проблему решает сервис?**

Решает проблему инкапсуляции логики определния доступности мультизаказа для пользователя.

**Почему нельзя решить эту задачу без разработки нового сервиса существующими решениями?**

Существующие решение сейчас находится в backend-cpp. И в рамках отказа от backend-cpp и разработки новой системы поллинга, пришло время вынести данную логику в отдельный сервис

**Как именно сервис будет решать поставленные перед ним задачи?**

Переносим логику из backend-cpp as is, с небольшим рефакторингом по необходимости.
Для этого, как минимум, придётся притащить в зависимостях коллекции *lock.

**Разрабатывается один сервис или система?**

Сервис

**Сколько и какие сервисы входят в систему?**

...

**С кем взаимодействует сервис?**

1. Какие (микро-)сервисы и как используются.
2. Как гарантируется идемпотентность внешний операций.
3. Как поддерживается консистентность данных при частичных отказах.
4. Как организованы ретраи внешних сервисов.

**Какие базы использует?**

Нужен доступ до существующих mongo коллекций.

`dbtaxi.phonelocks`
`dbtaxi.distlocks`
`dbtaxi.cardlocks`

В будущем, необходимо будет продумать отказ от данных коллекций

**Какие периодические процессы?**

...

**Прикрепите схему того, где этот сервис находится в текущей инфраструктуре**

1. Как технически проект влияет на цикл заказа.
2. Кто будет потребителями сервиса.

Влияние на цикл заказа:
Влияет на цикл, определяя возможность мультизаказа.

При отказе от протокольного launch, запрос в новый сервис будет делаться из api-proxy/launch.

В новой системе поллинга, из какого-то из партов также, будет делаться запрос в данный сервис.

**Какие данные и по какой схеме сервис будет хранить в базе?**

...

**Какой объем данных будет храниться и какой объем будет изменяться в единицу времени?**

...

**Какие операции над данными заложены?**

...

**Есть ли какой-то стейт в памяти, как он обновляется и валидируется?**

...

**Какая нагрузка ожидается?**

На первом этапе, ожидается нагрузка соизмеримая с нагрузкой ручки `launch` ~700rps.

**Какие фолбеки предусмотрены на сам этот сервис?**

Фолбек в api-proxy, позволяющий делать мультизаказа, по умолчанию, во всех случаях, кроме, тех, когда `supported_features` не содержит `multiorder`

**Какие фолбеки предусмотрены внутри этого сервиса на взаимодействие с другими сервисами?**

order-core - Считаем что активных аказов - нет
user-api - без телефона, сервис не работает
antifraud - считаем что пользователь не спамер
dbtaxi.*locks - пока что фолбек не продуман.

**Какие возможности масштабируемости закладываются?**

предусмотрена возможность горизонтального масштабирования

**Какие точки отказа есть в сервисе?**

mongo

**Укажите ключевые продуктовые метрики сервиса, за которыми планируете следить**

...

**Укажите технические метрики**

Обычный набор метрик

**Какая функциональность ожидается в сервисе в будущем?**

Этапы разработки:

1. Пройти архревью
2. Создать сервис
3. Согласовать АПИ
4. Перести логику из backend-cpp
5. Добавить реализацию в api-proxy
6. Запуск на процент и сравнением ответов из backend-cpp лонча
7. Фикс багов
8. Запуск на 100%
9. Отключение вычисления возможности мультизаказа в протокольном лонче

**Какое изменение нагрузки планируется?**

Увеличение нагрузки планируется. Но на данный момент, сложно оценить точно значение.

**Активно ли будет изменяться сервис?**

Нет
