## План
1. Делаем эксперимент `unite_total_price`
2. В преобразовании `yaplus_cashback` проверяем этот эксп и, если попадаем в него:
	2.1. Не уменьшаем стоимость поездки
	2.2. Добавляем мету `unite_total_price_enabled`: 1
	2.3. Добавляем мету `agent_cashback_rate`: 1
	2.3. Добавляем мету `user_ride_price`: `total_price*0.9`.
	2.4. `cashback_calc_coeff` - 0. Эта мета нужна для расчета допуслуги, зануляем ее.
	2.5  `cashback_tariff_multiplier` - не выпускаем. Используется в процессе для уменьшения стоимости поездки, а ее не надо уменьшать. cpc на ней считает кешбек, при отсутствии - не будет.
    2.6 `cashback_fixed_price` - выпускаем правильную. Чтобы показывалась в `routestats` как начисляемый кешбек.
    2.7 `user_total_price` - выпускаем с полной стоимостью поездки. Мы во многих местах полагаемся на эту мету, пока не переделаем - придется ее выпускать.
3. В преобразовании `yaplus_cashback` же, под нашим экспом проверяем `payment_type_is_cash`. Это будет означать сброс на кеш и нам надо уменьшить стоимость поздки до 0.9.
4. Добавляем преобразование `yaplus_cashback_driver`. В самом начале проверяе наш эксп и если попали - то уменьшаем поездку на 0.9. Водительскую-то нужно уменьшать.
5. Правим `routestats`, точнее функцию `GetCashbackValueNewPricingWay` - она должна считать маркетинговый кешбек не на основе полной стоимости, как сейчас, а на основе `user_ride_price`
6. Правим `current-prices-calculator`. По наличию меты `unite_total_price_enabled`:
	3.1. Считаем `cashback_price` по `agent_cashback_rate`
	3.2. Не прибавляем `cashback_price` к `user_total_price`
	3.3. `cashback_price` оставляем, антифрод, кажется, нормально разберется с таким кейсом, а `totw` продолжит показывать кешбек.
	3.4 Считаем маркетинговый кешбек не на основе полной стоимости, как сейчас, а на основе `user_ride_price`
7. Правим `requestconfirm`. По наличию меты `unite_total_price_enabled`:
	4.1. `user_ride_price` кладем в `order.cost`
	4.2. `cashback_fixed_price` кладем в `order.cashback_cost`
	
## Артефакты
1. Мастеркард сейчас дает 15% кешбека на Ультиму. Сейчас эти 15% счиются от 900 рублей, а начнут считаться с 1000. Сейчас Мастеркард+Плюс дают фактически 23.5% кешбека, а начнут давать честные 25%. Любопытно, что брендинг обещает именно 25%. Нужно будет обсудить с менеджерами, ок ли, что мы начнем считать 15% от общей стоимости (поездка+кешбек).
*Обсудил - надо сохранить текущее поведение. Поэтому в плане появятся пункты, чтобы это сделать. *
2. Надо разобраться, как будет работать расчет проекта благотворительности, который `charity_price`. 
*Реальный расчет для списания идет уже после оплаты, мы на него не повлияем. Расчет для `current-prices` основан на `user_total_price`, если она будет нормальная, то расчет будет корректным. А она будет нормальная.*
3. Надо подумать, не разорвет ли Мишино промотирование повышенных тарифов
*Не разорвет. Промка смотрит или в `user_total_price` или в итоговую цену и ей нужна именно 1000. Так что там в любом случае будет все ок*