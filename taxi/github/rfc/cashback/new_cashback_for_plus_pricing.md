Отдельно распишу варианты, как можно все организовать на прайсинге.

## Почему вариантов несколько
У нас вариативные сценарии: рассмотрим пока платная подача + выделение услуги кешбека. 
**Upd**
Оказывается, на поездку с композитной оплатой кешбек давать не нужно. Ни кешбека, ни скидки. Поэтому пересечение кешбека и композики невозможно.

Поездка 1000 рублей + 500 рублей платная подача, 10% нужно выделить в отдельную услугу.

Ситуация получается такая:
- в routestats нужно показать цену 1500
- в оффер нужно записать цену поездки без ПП и без услуги кешбека - 900 и цену услуги кешбека 100. Потому что в оффере все едет без ПП
- где-то там же нужно положить цену ПП 500
- и каким-то образом, если ПП применится и общая цена станет 1500 - ее нужно разделить на 1350 поездка + 150 кешбек

В принципе, если будет сложно, думаю можно оставить кешбек со стоимости без ПП - то есть 100.

## Вариант 1 - еще одна display_price и прайсинг учится доставать правильные меты
Преобразование:
- Плюс эмиттит в столбце "Главная" мету order_complete_display_price 1000, в столбце "Плат. подача" - 1500
- В столбце "Главная" цену ставим 900, в столбце "Плат. подача" - 1350
- Эмиттим в столбце "Главная" мету cashback_price 100, в столбце "Плат. подача" - 150
- Эмиттим в обоих столбцах cashback_coeff 0.(1)

Код:
- В routestats подменяем цену на order_complete_display_price
- При этом прайсинг должен научиться по дефолту доставать все цены и меты из столбца "Плат. подача"(обсудил с Сашей Андрияновым, это в любом случае нужно будет сделать)
- В оффер в fixed_price пишем 900. Все остальные данные останутся в pricing_data
- В totw достаем order_complete_display_price
- При этом прайсинг должен обеспечить, чтобы мы достали мету из additional_prices с ПП, если ПП есть и из основных цен, если ПП нет
- В requestconfirm нужно проверить, была ли ПП и в order.cost нужно переложить 900 или 1350, а в cashback_cost 100 или 150.
- Все действия делаем под проверкой на безнал, то есть если будет сброс на кеш, мы просто забываем наши меты и показываем основные поля, в которых цена без кешбека

Почему нельзя использовать ту же display_price, что композитка, если все равно не пересекутся преобразования?
display_price от композитки - она для tariff_description_final, фейковая, только для routestats
display_price от Плюса - для tariff_description, это эффективная итоговая стоимость для пассажира, и может использоваться и в totw тоже

## Вариант 2 - cashback_price отдельно и прайсинг учится доставать правильные меты
Преобразование:
- Плюс в столбце "Главная" цену ставим 900, в столбце "Плат. подача" - 1350
- Эмиттим в столбце "Главная" мету cashback_price 100, в столбце "Плат. подача" - 150
- Эмиттим в обоих столбцах cashback_coeff 0.(1)

Код:
- В коде,который формирует цену, которая станет зачеркнутой `result.main.value = price + paid_supply_price.value_or(0);` прибавляем еще мету cashback_price из столбца "Плат. подача". Получится 900 + (1350 - 900) + 150 = 1500.
- В оффер в fixed_price пишем 900. Все остальные данные останутся в pricing_data
- В totw достаем мету cashback_price из additional_prices с ПП, если ПП есть и из основных цен, если ПП нет.
- И считаем цена + ПП + нужная cashback_price. 900 + 0 + 100 = 1000, если нет ПП и 900 + 450 + 150 = 1500, если есть.
- В requestconfirm нужно проверить, была ли ПП и в order.cost нужно переложить 900 или 1350, а в cashback_cost 100 или 150.
- Все действия делаем под проверкой на безнал, то есть если будет сброс на кеш, мы просто "потеряем" cashback_price

После обсуждения с Сашей Андрияновым, что в routestats в любом случае нужно будет доставать меты из ПП, у нас фактически пропадает проблема с ПП и этот вариант выходит в лидеры.
Чем лучше 1: мне не очень нравится идея писать в ордер display_price: у меня есть ощущение, что правильнее все-таки суммировать нужные части на ходу.

## Вариант 3 - оставляем цену пассажира 1500, цену кешбека не выделяем, эмиттим коэффициент 0.1 и выделяем cashback_cost из cost в конце
Фактически это нынешний вариант и мы возвращаемся к старым мучениям и корнер кейсам. С платной подачей сверху.
Преобразование:
- Плюс в столбце "Главная" цену ставим 1000, в столбце "Плат. подача" - 1500. 
- А для водителя В столбце "Главная" цену ставим 900, в столбце "Плат. подача" - 1350. 
- Эмиттим в обоих столбцах cashback_additonal_service_rate 0.1

Код:
- тотв для кейса сброса на кеш - нужно опустить цену до 900 или 1350, в зависимости от ПП
- в requestconfirm разделить 1000 на 900+100. Ну или 1500 на 1350+150, не принципиально
- патч цены при установке диспетчером или водителем - а в этом кейсе придет цена водителя 1800 и нужно насчитать еще 200 cashback_cost

## Вариант 4 - делаем цену пассажира 1350, цену кешбека не выделяем, эмиттим множитель 1.(1) и в конце навешиваем cashback_cost сверху
Преобразование:
- В столбце "Главная" цену ставим 900, в столбце "Плат. подача" - 1350. 
- И для водителя в столбце "Главная" цену ставим 900, в столбце "Плат. подача" - 1350. 
- Эмиттим в обоих столбцах cashback_multiplier 1.(1) и cashback_coeff 0.(1)

Код:
- В коде,который формирует цену, которая станет зачеркнутой `result.main.value = price + paid_supply_price.value_or(0);` умножаем на cashback_multiplier. 900 превратится в 1000, а 1350 - в 1500.
- В оффер в fixed_price пишем 900. Все остальные данные останутся в pricing_data
- В totw достаем посчитанную цену домножаем на cashback_multiplier. 900 превратится в 1000, а 1350 - в 1500. 
- Так можно делать и с fixed_price и с cost. Возможно, чуть расползутся округления, но в принципе пофиг. Минималку, которая показывается при поездке без точки Б, трогать не нужно.
- В requestconfirm нужно полученный итоговый cost умножить на cashback_coeff и итог записать в cashback_cost
- Все действия делаем под проверкой на безнал, то есть если будет сброс на кеш, мы просто "потеряем" cashback_multiplier

Аналог варианта 2, но "фиксу кешбека" не выделяем.

### Какие моменты остались
Скидки - по идее отработают до всех преобразований и не должны мешать  
Антисурж - пока не представляю.