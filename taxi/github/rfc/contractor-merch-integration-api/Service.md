**Название сервиса**

contractor-merch-integration-api

**Какую продуктовую проблему решает сервис?**

Интеграция оплаты со счёта водителя такси и внешних сервисов для маркетплейса водителей(на первом этапе интеграция с сервисом Моби.Деньги)

**Почему нельзя решить эту задачу без разработки нового сервиса существующими решениями?**

Делаем интеграцию внешних сервисов с биллингом яндекса (выступаем по факту как прокси) - готовых решений для написания бизнес логики на этом этапе нет

**Как именно сервис будет решать поставленные перед ним задачи?**

1. Пользователь демонстрирует QR-код для оплаты покупки
2. Касса Сканирует QR-код и инициирует запрос на оплату
3. ПЦ МОБИ валидирует принадлежность QR-кода Яндексу и инициирует запрос
на авторизацию в contractor-merch-integration-api
4. contractor-merch-integration-api обрабатывает запрос, передаёт запрос в contractor-merch-payments для валидации QR кода, баланса и создания платежа(также в зависимости от типа платежа ждём акцептование его у водителя)
5. Ждём пока contractor-merch-payments подтвердит что платёж прошёл и возвращаем ПЦ статус платежа
6. ПЦ МОБИ возвращает статус платежа в кассу. Касса фискализирует чек

**Разрабатывается один сервис или система?**

Один сервис

**С кем взаимодействует сервис?**

1. МОБИ - получение запросов на оплату, возврат статусов платежей
2. С contractor-merch-payments для управления балансом водителя и контроля статуса платежей

**Какие базы использует?**

PostgreSQL

**Какие периодические процессы?**

Нет

**Планируется обработка персональных данных**

Нет

**Какие данные и по какой схеме сервис будет хранить в базе?**

В начале планируем хранить мап айдишников транзакций:
```javascript
{
    "mobi_transaction_id" : "айдишник транзакции ПЦ - целое число, номер транзакции в ПЦ передаётся при запросе на создание платежа от Моби, необходим для возврата статусов"
    "ya_transaction_id" : "наш айдишник транзакции - строка идентификатор для создания и проверки платежей в сервисе contractor-merch-payment"
}
```
**Какой объем данных будет храниться и какой объем будет изменяться в единицу времени?**

PostgreSQL - хранение до 50Mb в месяц изменение до 0.1Kb/s

**Какие операции над данными заложены?**

Сreate
Get
Update

**Есть ли какой-то стейт в памяти, как он обновляется и валидируется?**

Нет

**Какая нагрузка ожидается?**
Не больше 35 rps

**Какие фолбеки предусмотрены на сам этот сервис?**

Если сервис недоступен - невозможно провести оплату у партнёров через сервис партнёров

**Какие фолбеки предусмотрены внутри этого сервиса на взаимодействие с другими сервисами?**

Если недоступен contractor-merch-payment или PostgreSQL - сервис также недоступен

**Какие возможности масштабируемости закладываются?**

Увеличение базы, увеличение ram/cpu на инстансе, увеличение количество инстансов сервиса

**Какие точки отказа есть в сервисе?**

- Отказ contractor-merch-payment
- Отказ PostgreSQL

**Укажите ключевые продуктовые метрики сервиса, за которыми планируете следить**

- Частота оплат для разлчных партнёров
- Частота отмены и рефандов покупок

**Укажите технические метрики**

- Количество запросов
- Максимальное и среднее время ответа на запросы по типам запросов

**Какая функциональность ожидается в сервисе в будущем?**

Изменение апи для интеграции не только с сервисом Моби.Денег

**Какое изменение нагрузки планируется?**

Прямо пропорционально произведению количества партнёров и водителей

**Активно ли будет изменяться сервис?**

Нет


