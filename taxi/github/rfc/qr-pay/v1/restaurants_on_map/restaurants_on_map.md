# В результате обсуждений решения по задаче Рестораны на карте https://st.yandex-team.ru/TAXIBACKEND-30874 пришли к следующему:

Объекты для карты отдаются ручкой сервиса layers. При тапе на объект ресторана будет открываться карточка ресторана. Карточка, возможно, будет такой же, как сейчас открывается из списка ресторанов. В ручку сервиса layers приходит информация о том, какую область видит пользователь (bbox) на карте, она по этой информации отдаёт уже объекты, которые видны.

На этапе MVP фильтрация ресторанов по bbox будет временно сделана в сервисе layers (делать её будет Павел Некрасов). В нашем сервисе iiko-integration будет создана ручка, котороая отдаёт список всех ресторанов. layers будет ходить в нашу ручку приблизительно 1 раз в минуту (на самом деле 6, так как 6 инстансов) и кэшировать результат на своей стороне.
Возможно, будет нужно доработать/сделать другую версию ручки, которая отдаёт подробности по id ресторана, это проясниться, когда устаканится дизайн и договоримся с клиентами (по итогам дополню).

# Касательно ручки, которая отдаёт рестораны

Существующая ручка, которая отдаёт рестораны, имеет много лишних параметров и заточена под клиентов. К тому же нужно сделать акцент на том, что с qr оплатой в перспективе могут быть не только рестораны. Поэтому будет разработана новая ручка.

API привожу в файле qr_objects.yaml (рядом с файлом описания).
Ручка максимально простая, ничего не принимает и отдаёт только массив ресторанов.
По каждому ресторану будет отдаваться:
 - id в сервисе qr оплаты;
 - танкерный ключ названия (чтоб проще было кэшировать не локализуем ключ на нашей стороне)
 - позиция ресторана (долгота и широта)
 - процент кэшбека в ресторане
 - тип заведения (чтоб не забыть, что в перспективе с qr могут быть не только рестораны)

В случае, если сервис отключён конфигом IIKO_INTEGRATION_SERVICE_AVAILABLE, список объектов будет пустым, а параметр service_available в корне ответа будет иметь значение false. Иначе service_available будет иметь значение true, а в списке будут возвращены имеющиеся объекты.

# Update после того, как договорились делать новую карточку и слать для неё данные в той же ручке qr-objects

Для отображения карточки ресторанов потребуется добавить (сама карточка формируется в layers, с нас только данные):
- url картинки (если есть);
- адрес: на русском и английском;
- номер телефона;
- часы работы: на русском и английском (если есть);
- geosearch_id (id заведения в геопоиске, чуть подробнее ниже)

geosearch_id потребуется в дальнейшем, чтоб привязываться к информации по заведениям из геопоиска. Отуда будут грузиться множество заведений с информацией по ним, а по geosearch_id будут искаться те, в которых можно платить по QR, и помечаться.
В наших конфигах пока что отсутствует этот id. Но, по идее, он получается в скрипте для заполнения конфигов ресторанов [тут](https://github.yandex-team.ru/taxi/tools-py3/blob/master/taxi_imports_py3/get_restaurant_info.py#L214), где его можно просто начать также выводить для ресторанов. Для тех, которые уже есть в конфиге, можно будет дописать просто руками.
