## Что мы хотим сделать:
Передавать на клиенты информацию для отображения фичи qr-оплаты:
- Нужно передать статику (подписи для экранов, диплинки для кнопок, [1](https://st.yandex-team.ru/TAXIBACKEND-27406/attachments/16391810?), [2](https://st.yandex-team.ru/TAXIBACKEND-27406/attachments/16391813?), [3](https://st.yandex-team.ru/TAXIBACKEND-27406/attachments/16391815?), [4](https://st.yandex-team.ru/TAXIBACKEND-27406/attachments/16391818?))
- Эксперимент доступности точки входа через раздел [Плюса](https://st.yandex-team.ru/TAXIBACKEND-27406/attachments/16389421?)


## Варианты:
### /launch и /products
В /products эксперимент кнопки в Плюсе т.к. эта ручка знает о местонахождении пользователя.
Чтобы не нагружать ручку с высоким рпс сатикой кладем ее в /launch.

Плюсы:
- контролируем все точки входа в фичу в одной ручке (эксперимент в /products и [qr-кнопка](https://st.yandex-team.ru/TAXIBACKEND-27084/attachments/15895115?) которая будет делаься на следующих этапах)
- оперативно реагируем на изменение положения пользователя - /products дергается на каждое перемещение пина

Минусы:
- /products еще под экспериментом, рискованно полагаться на эту ручку
- раздуваем ответ блокирующей ручки


### /zoneinfo
Все передаем одним экспериментом в /zoneinfo

Плюсы:
- обходимся одним экспериментом

Минусы:
- раздуваем ответ блокирующей ручки


### /launch и /zoneinfo
В /zoneinfo передаем эксперимент кнопки в Плюсе, в /launch остальное

Плюсы:
- ...

Минусы:
- вмешиваемся в 2 блокирующие ручки, для /launch раздуваем ответ


### /stories или /paymentmethods (используются разделом Плюса) и /launch
Для отображения раздела Плюса нет специальных ручек - испольются эксперименты из /launch, /stories и /paymentmethods.
Можно подселить статику в одну из этих ручек.
В /zoneinfo передаем эксперимент кнопки в Плюсе.

Плюсы:
- ...

Минусы:
- по логике эти ручки нам совсем не подходят
- нужны доработки в api-proxy yml или на беке чтобы прокинуть в них эксперимент
- нужны доработки их на клиенте
- не получится брать статику из кеша в кейсе открытия камеры через приложение


### Отдельная ручка для статики и /zoneinfo
Делаем новую ручку специално для статики.
В /zoneinfo передаем эксперимент кнопки в Плюсе.

Плюсы:
- 100% не аффектим другие части приложения

Минусы:
- дольше ждем получения статики  - нужно последовательно дернуть две ручки
- нужны доработки их на беке
- нужны доработки их на клиенте
- не получится использовать кеш без доработок


### /finalsuggest и /translations
В /finalsuggest передаем эксперимент кнопки в Плюсе.
Статику хардкодим на клиентах, при необходимости обновляем ее через /translations

Плюсы:
- оперативно следим за пином пользователя

Минусы:
- может задержаться релиз клиентов - нужно определиться с текстами, дождаться всех переводов
- высоконагруженная ручка (ограничения на размер и сложность условий эксперимента)
- блокирующая ручка для цикла заказа


### /zoneinfo и /translations
В /zoneinfo передаем эксперимент кнопки в Плюсе.
Статику хардкодим на клиентах, при необходимости обновляем ее через /translations

Плюсы:
- ручка редко дергается есть кеш, добавление эксперимента в нее мало увеличит нагрузку

Минусы:
- может задержаться релиз клиентов - нужно определиться с текстами, дождаться всех переводов
- блокирующая ручка для цикла заказа


## Итоговый вариант:

Решили использовать /zoneinfo и хардкодить статику на клиентах.
Использование /zoneinfo позволит минимально нагружать блокирующие ручки и не потребует доработок на клиентах/беке.

Все преводы оставляем на клиентах. При необходимости обновляем их через /translations. Так мы не будем лишний раз раздувать ответы ручек.
Для добавления ключа в ручку нужно добавить его в танкер и выполнить [скрипт](https://github.yandex-team.ru/taxi/tools/blob/05544523a49b8881b36259cd1e02ef7bcb46fab2/db/add_to_metadata_keyset_mappings.py)


Ключи для статики:
```json
{
  "common_strings.qr_pay.scanner_screen.title": "Отсканируйте код на чеке",
  "common_strings.qr_pay.scanner_screen.missing_camera_permition.title": "Нет доступа к камере",
  "common_strings.qr_pay.scanner_screen.missing_camera_permition.description": "Чтобы сканировать через приложение разрешите доступ к камере в настройках",
  "common_strings.qr_pay.scanner_screen.missing_camera_permition.settings_button_text": "В настройки",
  "common_strings.qr_pay.order.default_error.title": "Не удалось найти заказ",
  "common_strings.qr_pay.order.default_error.description": "Заказ не получается найти. Попросите официанта проверить всё ли в порядке",
  "common_strings.qr_pay.order.default_error.scan_button_text": "Сканировать код еще раз",
  "common_strings.qr_pay.preorder_screen.add_card": "Добавить карту для оплаты",
  "common_strings.qr_pay.preorder_screen.pay_button.text": "Оплатить",
  "common_strings.qr_pay.pay_in_progress.pay_button.text": "Оплата",
  "common_strings.qr_pay.pay_in_progress.notification": "Оплата ресторана",
  "common_strings.qr_pay.cashback_screen.pay_success_notification": "Счёт оплачен: подробности в истории заказов.",
  "common_strings.qr_pay.preorder_screen.cashback": "Кэшбек на Плюс"
}
```

Приблизительный формат экспреимента:
```json
{
  "enabled": true,
  "title": "Получить кешбек в ресторане",
  "deeplink": "yandextaxi://route?start-lat=1&start-lon=2&end-lat=3&end-lon=4"
}
```
