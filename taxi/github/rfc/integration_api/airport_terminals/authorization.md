## Авторизация
Ниже рассмотрены авторизации пользователя для создания заказа на стойке
### По флоу схожим с флоу колцентра
Как проходит в колцентре?  
Во-первых, 2 участника - оператор и пользователь.  
Оператор логинится через паспорт получает куки сессии, с которыми делает запросы в cc-authproxy по ходу создания заказа.  
Пользователь сообщает оператору необходимые для заказа данные - телефон, точки А-Б, комментарии. Все эти данные вводит оператор.  
В dbusers пользователь для заказа создаётся (или подтягивается существующий) в ручке profile, для работы ручки нужен только номер телефона. profile возвращает user_id пользователя, этот user_id используется в остальных ручках int-api  

![image](images/callcenter.png)

Какие изменения в этом флоу для терминалов?
1. Нужна своя авторизационная прокси (наподобии cc-auth)
1. Оператора нет, но всё равно нужен аккаунт "псевдооператора" в паспорте, чтобы залогиниться и делать запросы в int-api
1. Оператора нет, пользователь берёт на себя его функции - заполняет номер телефона, данные для поездки
1. После ввода номер телефона его необходимо подтвердить кодом из смс. До этого считаем, что "оператор" не может делать заказ этому пользователю

TODO возможная проблема - созданного пользователя из ручки profile получаем только после введения (и подтверждения) номера телефона. Смогу ли работать ручки до этого момента без user_id?

Плюсы подхода:
+ уже сейчас работает для колцентра, можно использовать (с небольшими доработками)
+ от пользователя нужен только номер телефона

Минусы подхода:
- нужно заводить псевдооператоров (TODO можно ли одного на город/локацию?)
- в аккаунт псевдооператора нужно войти, чтобы терминал был готов к работе
- подключение яндексовых бонусов (я.плюс) затруднено/невозможно

### Неофониш в паспорте
Пользователь делает честный логин как неофониш и делает заказ от своего имени

1. Нужна своя авторизационная прокси (наподобии passenger-authorizer)
1. Для неофонишной авторизации нужно ввести номер телефона И фамилию + имя
1. Подтверждение СМС на стороне паспорта
1. С точки зрения авторизации флоу заказа не отличается от заказа в турбоаппе
1. Пользователя необходимо разлогинивать после успешного заказа/после определённого времени

Плюсы:
+ нет костылей (псевдооператора)
+ не нужно делать своё подтверждение телефона смской
+ проще в будущем подключать всякие яндексовые бонусы, например я.плюс

Минусы:
- <details>
        <summary>продуктово очень не хотим такую авторизацию</summary>
        
        1. чтобы снизить порог входа и максимально упростить флоу заказа, в аэропорту люди очень уставшие, чтобы вводить еще имя/фамилию 
        2. мало кто захочет авторизовываться на чужом устройстве еще и в центре аэропорта, если сделаем авторизацию, будут прорастать и твои карты, и поездки, больше шансов взлома / перехвата твоего аккаунта, если ты отошел от терминала
        
    </details>

- TODO возможно нельзя сделать внутри турбоаппа, обязательно нужен редирект на страницу паспорта для авторизации
- пользователю нужно дополнительно вводить свои имя и фамилию


### Легаси авторизация в вебе через auth
https://wiki.yandex-team.ru/taxi/backend/architecture/zalogin/avtorizacija-cherez-zalogin/#avtorizacijanawebenocredentials  
Этот метод авторизации планируется выпилить из такси  


### Другие варианты авторизации
TODO возможно есть ещё варианты?

### Дополнительные моменты
Можно использовать access-control, для заведения временного пользователя с ttl и задания прав на ручки заказа. Это даст аудит на дергание ручек + четкая система ролей и guest пользователей
