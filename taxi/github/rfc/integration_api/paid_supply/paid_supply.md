**Author:** @artmbogatov

**Comments deadline:** 2022-01-21

# Резюме

## Изменения в ручке /estimate
Добавлен объект **paid_supply** в ответ ручки ручки /estimate
Поле представляет собой объект, содержащий следующую информацию о платной подаче:

**state** -- состояние платной подачи (possible (выключена, но
при некоторых изменениях заказа (см. поле enable_conditions) становится возможной), dropped(изначально подача была платной, 
но потом произошёл сброс на бесплатную подачу))
Отсутствие объекта paid_supply трактуется как бесплатная подача. Наличие объекта paid_supply без поля state трактуется как включенная платная подача
**free_cancel_timeout_sec** -- число, содержащая время (в секундах), в течение которого отмена будет бесплатной
**enable_conditions** -- условия, при соблюдении которых платная подача станет возможной (change_payment_type_to_cashless -- нужно сменить способ оплаты на безналичный рассчёт, define_point_b -- нужно добавить точку Б)
**paid_supply_price_raw** -- число, содержащее стоимость платной подачи (в суммарной стоимости поездки уже учтена эта компонента)
**paid_supply_price** -- строка со стоимостью платной подачи

## Изменения в ручке /orders/search
Добавлен объект **paid_supply** в ответ ручки ручки /orders/search
Поле представляет собой объект, содержащий следующую информацию о платной подаче:
**state** -- состояние платной подачи (возможно только значение dropped(изначально подача была платной, но потом произошёл сброс на бесплатную подачу))
Отсутствие объекта paid_supply трактуется как бесплатная подача. Наличие объекта paid_supply без поля state трактуется как включенная платная подача
**paid_supply_price_raw** -- число стоимость платной подачи (в суммарной стоимости поездки уже учтена эта компонента)
**paid_supply_price** -- строка со стоимостью платной подачи

# Мотивация, задача

Цель -- поддержать в int-api платную подачу, расширить API ручек для управления и мониторинга флоу платной подачи

# Детальное описание

см. схемы ручек

# Недостатки

### Почему не делать? Что мы ухудшим?

В ближайшем будущем планируется переход на флоу routestats, в котором уже поддержана платная подача, т.е. поход в ручку int-api /estimate будет роутится в /routestats, а плагины /routestats позволят скорректировать существующие различия в поведении между /routestats и /estimate

# Обоснование и альтернативы

Решение продублировать в /estimate флоу платной подачи имеет следующие обоснования:
-- Сроки реализации: потребность в платной подачи имеется уже сейчас и выглядит критичной для ряда потребителей, при этом переход на флоу /routestats будет выполнен в среднесрочной перспективе (не раньше, чем через несколько месяцев)

-- Даже после полного перехода на флоу /routestats нам потребуется фолбечный вариант "протокольного" /estimate

-- Необходимо поправить API ответа c информацией о платной подаче. Сейчас, когда пп недоступна из-за, например, отсутствия точки Б, /routestats сигнализирует об этом локализированным человекочитаемым сообщением, которое, конечно, не смогут распарсить внешние потребители /estimate

# История и предшественники

На данный момент, логика платной подачи реализована в ручке /routestats

# Вопросы на обсуждение

### Какие детали мы хотим уточнить в процессе обсуждения?

Хотим утвердить схему ручек /estimate и /orders/search
Продумать совместимость с /routestats

## Затрагиваемые сервисы

integration-api

# Комментарии/возражения (вписываются после публикации в #architecture)
--
# Резюме встреч

### Встреча1

