### Название сервиса

fleet-customers

### Какую продуктовую проблему решает сервис?

Хранение данных о пассажирах SaaS-парков, нужных для автозаполнения заказа, и персонализированных настроек пассажиров.

### Почему нельзя решить эту задачу без разработки нового сервиса существующими решениями?

Нет подходящего сервиса для этой задачи.

user-api умеет хранить имя пользователя, но оно глобально, что для данной задачи неприемлемо (нельзя давать возможность из любого парка при заполнении заказа получать по номеру телефона ПД любого пользователя планеты).

Прочие параметры (признак отправки СМС-оповещений по статусам заказа, опции заказов, регулярные маршруты и т. п.) специфичны для пассажиров парков (или даже SaaS-парков), закидывать их в какую-то общую урну кажется неразумным.

### Как именно сервис будет решать поставленные перед ним задачи?

- Выдавать данные о пассажире фронту:
  - при вводе телефона в форме создания заказа из парка (обмениваем через personal телефон на `personal_phone_id`, ищем у себя в базе запись по `park_id + personal_phone_id`);
  - при просмотре профиля пассажира в парке.
- Добавлять или обновлять данные о пассажире после создания заказа из парка (рабочая гипотеза -- автоматически при каждом создании заказа).
- Изменять данные о пассажире при редактировании профиля пассажира с фронта.
- Удалять данные о пассажире по запросу с фронта ("по кнопке").

[Тикет на бэкенд](https://st.yandex-team.ru/FLEETBACK-2540).

### Разрабатывается один сервис или система?

Один сервис.

### С кем взаимодействует сервис?

- диспетчерская (через сервис fleet-authproxy)
- сервис personal

### Какие базы использует?

PostgreSQL (новая база fleet_customers).

### Какие периодические процессы?

Нет.

### Планируется ли обработка персональных даннных?

На начальном этапе -- обмен телефона на `personal_phone_id`, [позже](https://st.yandex-team.ru/TAXIORDER-1845) -- также обмен имени на `personal_name_id`.

Также на первом этапе планируется подключение к [taxi-takeout](https://wiki.yandex-team.ru/taxi/backend/architecture/taxi-takeout/udalenie-dannyx-po-takeout/).

### Какие данные и по какой схеме сервис будет хранить в базе?

Данные:
- `park_id`
- `personal_phone_id`
- `sms_enabled`
- прочие данные, появляющиеся по мере разработки (`personal_name_id`, опции заказа, любимые локации, периодические маршруты)

Примерная схема:
- основная таблица с PK `park_id + personal_phone_id` -- для скалярных данных
- дополнительные таблицы с независимым PK с FK на `park_id + personal_phone_id` из основной таблицы -- для векторных данных (любимые локации и периодические маршруты)

### Какой объем данных будет храниться и какой объем будет изменяться в единицу времени?

Пропорционально числу пассажиров, делающих заказы через диспетчеров SaaS-парков. Количество записей в ближайший год -- до 5 млн (менее 1 ГБ), количество изменений -- до 50 тыс в сутки (менее 1 КБ/с).

### Какие операции над данными заложены?

Вставка, чтение и изменение данных.

### Есть ли какой-то стейт в памяти, как он обновляется и валидируется?

Нет.

### Какая нагрузка ожидается?

Пропорционально числу заказов, создаваемых диспетчерами в SaaS-парках в единицу времени. В этом году ожидаем 1 rps.
### Какие фолбеки предусмотрены на сам этот сервис?

Пока не планируются.

### Какие фолбеки предусмотрены внутри этого сервиса на взаимодействие с другими сервисами?

Пока не планируются.

### Какие возможности масштабируемости закладываются?

Горизонтальное масштабирование инстансами сервиса.

### Какие точки отказа есть в сервисе?

- отказ PostgreSQL
- отказ personal

### Укажите ключевые продуктовые метрики сервиса, за которыми планируете следить

- запросов данных о пассажире в единицу времени
- обновлений данных о пассажире в единицу времени

### Укажите технические метрики

- rps, тайминги и ошибки ручек сервиса
- потребление ресурсов базой пассажиров

### Какая функциональность ожидается в сервисе в будущем?

Только расширение набора данных о пассажире.

### Какое изменение нагрузки планируется?

Пропорционально числу заказов, создаваемых диспетчерами в SaaS-парках в единицу времени.

### Активно ли будет изменяться сервис?

Да.
