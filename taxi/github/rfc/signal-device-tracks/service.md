**Название сервиса**

signal-device-tracks

**Какую продуктовую проблему решает сервис?**

Построение и отображение в админке перемещений камер по карте с отметками о происходивших в точках событиях.

**Почему нельзя решить эту задачу без разработки нового сервиса существующими решениями?**

Часть задачи решает сервис yagr. В нем поднят отдельный пайплайн для камер, который принимает точки, притягивает их к графу дорог, и отдает точки за нужный временной промежуток.

Нам на своей стороне нужно:
1. Начать принимать от камеры точки (одна точка в секунду, слать будем батчами)
2. Отправлять эти точки в yagr
3. Отдельно принимать от signal-device-api инфу о событиях (может теряться в (1) из-за архитектуры железки), досылать точки в yagr и на своей запоминать, что это – точки с событиями
4. Отдавать в админку треки (построенные yagr) + к некоторым точкам приклеивать мета-информацию о событиях, произошедших в них


**Как именно сервис будет решать поставленные перед ним задачи?**

1. Камера периодически грузит нам батч точек (с точностью раз в секунду)
2. Сервис отправляет их в yagr
3. signal-device-api отдельно сообщает сервису о событиях, происходящих с камерой. Сервис так же отправляет их в yagr (чтобы не потерять, если точка была потеряна в (1)) и сохраняет в своей базе мета-информацию о точке
4. При запросах из админки сервис выгружает трек из yagr, цепляет к нужным точкам мета-информацию и отдает на фронт

**Разрабатывается один сервис или система?**

Один сервис.

**С кем взаимодействует сервис?**

1. С камерой (принимает батчами данные о перемещениях), авторизация камер через signal-device-api
2. С signal-device-api, который будет отдельно досылать данные о произошедших событиях (чтобы мы точно не потеряли их из треков + запомнили, что эти точки нужно дополнить метой)
3. С yagr – будет отправлять туда точки и забирать треки
4. С фронтом – будет принимать запросы на трек перемещений определенной камеры и отдавать точки вместе с указанием, в каких из них происходили некоторые события

**Какие базы использует?**

Postgres.

**Какие периодические процессы?**

Нет.

**Планируется обработка персональных данных**

Нет.

**Какие данные и по какой схеме сервис будет хранить в базе?**

На старте – представлено ниже.

После этого посмотрим, какие будут требоваия к отображению треков (и что кроме треков захотим отображать), схема может поменяться.

```javascript
{
  "device_id": "айдишник девайса",
  "event_id": "айдишник ивента",
  "event_type": "тип события",
  "event_at": "таймстамп"
}
```

**Какой объем данных будет храниться и какой объем будет изменяться в единицу времени?**

До 10 gb

Изменений до 0.3Mb/s

**Какие операции над данными заложены?**

Create

**Есть ли какой-то стейт в памяти, как он обновляется и валидируется?**

Нет.

**Какая нагрузка ожидается?**

10 RPS от камер на старте с линейным ростом по количеству камер (30 до конца года)/
до 1 rps от админки.

**Какие фолбеки предусмотрены на сам этот сервис?**

Если сервис недоступен, не показываем в админке треки и не сохраняем новые точки.

**Какие фолбеки предусмотрены внутри этого сервиса на взаимодействие с другими сервисами?**

Если недоступен yagr, сервис не работает.
Если недоступен Postgres: создаем и показываем треки, но не отмечаем на них точки с событиями.

**Какие возможности масштабируемости закладываются?**

Увеличение базы, увеличение ram/cpu на инстансе, увеличение количество инстансов сервиса.

**Какие точки отказа есть в сервисе?**

- Отказ Postgres
- Отказ yagr

**Укажите ключевые продуктовые метрики сервиса, за которыми планируете следить**

- Количество событий разных типов на треках

**Укажите технические метрики**

- Количество запросов.
- Максимальное и среднее время ответа на запросы по типам запросов.
- Размер базы.

**Какая функциональность ожидается в сервисе в будущем?**

Фичи, связанные с отслеживанием геопозиций и историей перемещений камер

**Какое изменение нагрузки планируется?**

Прямо пропорционально количеству камер.

**Активно ли будет изменяться сервис?**

Могут появляться доп. фичи для отображения треков или что-то другое, связанное с геопозициями камер
