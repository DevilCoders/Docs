# Промо точки на карте

## 1. Как добавляем промо-точки
Подмешиваем точки в persuggest/finalsuggest.
Только в **action=pindrop**, **type=a** и **sticky=true**.
Отличить главный/редактирование точки А пока не можем - отдаем всегда.

Нужные для пользователя типы промо-точек проверяем
(пока) по третьим экспериментам.

Подмешиваем точки в видимую часть экрана под адресом.
Предполагали для этого получать "gold_bbox",
но с iphone сейчас приходит bbox, который совпадает с gold_bbox.

Подмешиваем на бэке, выбирая точку эвристически.
Если для конкретной промки точка должна быть на дороге -
притягиваем к графу.

Промо-точка имеет наименьший приоритет перед другими видами точек.

## 2. Поведение промо-точек
В options.actions точки добавится новый с указанием id промки.

Клиент кеширует промо-точки на своей стороне, чтобы они не ездили по карте.
Клиент оставляет точку на карте: получения такой же точки в последующем finalsuggest
не меняет ее координату. Точка сбрасывается с карты, если расстояние от пина до нее
становится больше переданного в параметре cache в метрах.
Еще один параметр кеша - время жизни точки time_to_live в секундах.
Превышение приводит к исчезновению точки навсегда.
Вопрос к Гоше - ок ли такое поведение?
Что делать, если расстояние превышено, ttl еще нет и пришла новая версия точки с тем же id?

## 3. Пример ответа точки:
Запрос в finalsuggest не меняется.
Меняется/добавляется только ответ точки.

​```
{
  "points": [{
    "id": "123.443",
    "geometry": [37, 55],
    "bubble": {
      "id": "gruzovoj",
      "hide_after_tap": true,
      "text": "Попробуй грузовик",
      "max_per_session": 10,
      "max_per_user": 10
    },
    "cache": {
      "distance": 600 // расстояние от пина до объекта, при превышении которого клиент инвалидирует кэш
    }
    "image_tag": "my_promo_tag",
    "options": [{
      "on": "tap",
      "keep_pin": true,
      "actions": [{
        "type": "show_screen_through_promo",
        "promo_id": "123123123",
        "deeplink": "yataxi://screen_gruzovik"
      }],
    }],
    "type": "promo"
  }] 
}
​```