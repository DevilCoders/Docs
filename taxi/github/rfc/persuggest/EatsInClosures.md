# Доставка еды и лавки в зоны перекрытий

## Проблема
В зонах перекрытий возникает конфликт на главном экране: еду/лавку должно быть можно заказать, а такси нужно выталкивать  
Тикет с обсуждением: https://st.yandex-team.ru/TAXIPROJECTS-1623  
Тикет с беком: https://st.yandex-team.ru/TAXIBACKEND-29966

## Решение
1. Вводится новый режим(`state.current_mode`)=`main`, с которым клиенты должны вызывать `/finalsuggest` на главном экране.
2. На беке адрес обрабатывается как адрес еды/лавки, и к ответу добавляется алерт для такси:  
    ```json 
   { ...
        "condition_actions": [
            {
                "conditions": ["to_taxi_in_zone"],
                "actions": [
                    {"type": "show_popup", ...}, 
                    {"type": "pull_out_of_zone"}
                ]
            }
        ]
   }```
3. Если пользователь идет по флоу еды/лавки, то все ок.
4. Если пользователь идет по флоу такси (выбирает шоткат такси или нажимает на кнопку выбора т. B (to_taxi_in_zone)),
 то показывается алерт и происходит вызов `/finalsuggest` с `state.current_mode=""` и `action=pin_drop` от текущей точки.
5. Если бек не ответил на ретраи, то фолбечимся на первый или ближайший пп 
(из первого ответа `/finalsuggest` `{"points": [...]}`).

## Изменения в АПИ
1. Новый режим `state.current_mode = main` для `/finalsuggest`.
2. `condition_actions` в ответе `/finalsuggest` см. изменения 4_0_finalsuggest.yaml
3. Убирается `alert` из корня при попадании адреса в перекрытие (он заменятся на попап в `condition_actions`)


## Эксперимент
Функциональность закрывается экспериментами `main_mode_for_closures` и `condition_actions`. Клиенты, поддерживающие 
данный эксперименты перестанут получать `alert` в корне в перекрытиях, но будут получать необходимые `condition_actions`
* Эксперимент `condition_actions` нужен для ограничения версии клиентов поддерживающих `condition_actions`.
* Эксперимент `main_mode_for_closures` нужен для ограничения даной функциональности, также в этом эксперименте есть 
параметр `use_eats_flow_inside_closure` (true|false) - выбор типа работы `/finalsuggest` внутри зоны.
