# Притягивание к правильной дороге

## Проблема

Мапкит строит маршрут в некоторых ситуациях от ближайшей дороги, которая не доступна для пешехода, который находится в точке А.
Эпик: https://st.yandex-team.ru/TAXIBACKEND-31686

## 0. Решение без клиентской разработки

1. Используем режим(`state.current_mode`)=`main`. В этом режиме строим предположение о плохо построенном маршруте: сравниваем ближайшую точку из ответов двух ручек yaga-adjust (старая и новая с проверкой на мосты/тоннели). Добавляем condition_action на перезапрос finalsuggest.
    ```json 
   { ...
        "condition_actions": [
            {
                "conditions": ["to_taxi"],
                "actions": [
                    {"type": "show_popup", ...}, 
                    {"type": "pull_out_of_zone"}
                ]
            }
        ]
   }```
2. Если пользователь идет по пути еды/лавки, то все ок.

3. Если по флоу такси, то показываем алерт и вызываем `/finalsuggest` с `state.current_mode=""` и `action=pin_drop от текущей точки

4. Если бэк не отвечает, то используем ответ из пункта 1.


## Эксперимент
В эксперименте adjust_to_road_conditional делаем:
1. рубильник
2. задаем порог расстояния между точками от ручек yaga-adjust, после которого начинаем отдавать conditional_action
3. рубильник для alert
4. параметры alert

## Возможные метрики

Ожидаем уменьшения:

1. Среднее время подачи, мин
driving_time_min

2. Доля заказов со звонком
has_phone_call

3. Доля заказов с чатом
has_chat

4. Среднее время ожидания, мин
waiting_time
