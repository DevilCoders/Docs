В рамках rfc "Бюджет" и "Дискомфорт" - одна сущность для обозначения тарифа, который дешевле эконома и предсталяет собой объединение механик снижения цены.  

## Реализация

__Высокоуровнево__:  
* На уровне `protocol` строим несколько альтернатив (что делается уже сейчас) и отдаём их в `uroutestats` - то есть доработки *практически* не требуются. Единственное - сейчас альтпин не отдастся при наличии других альтернатив, нужно убрать это ограничение в случае доступности "Дискомфорта".  
* На уровне `uroutestats` объединяем специальным плагином альтернативы в тариф.  
* Всё в цикле заказа, начиная с `/3.0/orderdraft`, остаётся без изменений.  

## Доработки на бэке

Потребуются следующие доработки:  
* `/3.0/zoneinfo`:  
  * В `protocol`:  
    * Расширяем массив `max_tariffs` новым тарифом (подробнее ниже).  
* `/3.0/routestats`:  
  * В uservice'ном routestats:  
    * Удаление некоторых альтернатив.  
    * Добавление нового `service_level` ("Дискомфорт") с прокидыванием всей необходимой инфы из выбранной альтернативы в тело этого `service_level`.  
  * В `protocol`:  
    * Строить альтпин при наличии других альтернатив, используемых в "Дискомфорте".  
* `/zonaltariffdescription`:  
  * В `protocol`:  
    * Добавление нового тарифа.  

Есть 2 варианта добавить "Дискомфорт" в качестве тарифа:  
* Костылить экспериментами в `routestats`/`zoneinfo`  
* Завести тариф в Админке  

Тариф в Админке (полная аналогия "Эконому", которая, в общем-то, ничего собственного, кроме названия, описания и доступности, не имеет, а существует только номинально) чреват рассинхронами с неизвестных мест, однако этот вариант имеет плюсы:  
* "Комбо" тоже строится из альтернатив, однако имеет свою категорию в Админке.  
* visibility helper и другие штуки, завязанные на админочные тарифы, будут работать консистентно.  
* Нужно стремиться к тому, чтоб то, что выглядело как тариф, было тарифом.  

## API

Запрос в `/3.0/routestats` расширяется следующим полем:  
```json
{
  ...,
  "discomfort": { // optional. Отсылаем, если "Дискомфорт" доступен (по ответу zoneinfo)
    "alternatives_types": ["altpin_b", "perfect_chain"] // required. Список механик, на которые дал согласие пользователь
  },
  ...
}
```

Поле `alternatives_types` используем на бэкенде для настройки отображения тарифа "Дискомфорт" (выбираем доступную альтернативу с наименьшей ценой).  
В случае доступности тарифа "Дискомфорт" родственные альтернативы с бэка не отдаём клиентам.  

`/3.0/routestats` отдаёт тариф примерно следующим образом:
```json
{
  ...,
  "service_levels": [
    ...,
    {
      // Данные поля просто взяты из `service_level` соответственной альтернативы (кроме `name`, `service_level`, а также некоторые закомментированы, т.к. не актуальны в тарифе)
      "brandings": [],
      "cars": [
        "Hyundai Solaris",
        "Kia Rio",
        "Volkswagen Polo"
      ],
      "class": "discomfort",
      "description": "Поездка 119 $SIGN$$CURRENCY$, ~4 мин",
      "description_parts": {
        "prefix": "",
        "suffix": "",
        "value": "От 119 $SIGN$$CURRENCY$"
      },
      "details": [
        {
          "description": "всего",
          "price": "177 $SIGN$$CURRENCY$"
        }
      ],
      "details_tariff": [
        {
          "type": "price",
          "value": "от 101 $SIGN$$CURRENCY$"
        },
        {
          "type": "icon",
          "value": "от 101 $SIGN$$CURRENCY$"
        },
        {
          "type": "comment",
          "value": "включено 2 мин., далее 9 $SIGN$$CURRENCY$/мин."
        },
        {
          "type": "comment",
          "value": "включено 1 км, далее 9 $SIGN$$CURRENCY$/км"
        }
      ],
      "discount": "other",
      /* 
        "estimated_waiting": {
          "message": "2 мин",
          "seconds": 120
        },
      */
      "is_fixed_price": true,
      "is_hidden": false,
      "name": "Бюджет",
      "offer": "605508ebe8876170b5a75ca65f60c6c9",
      "original_price": "177 $SIGN$$CURRENCY$",
      "paid_options": {
        "color_button": true,
        "display_card_icon": true,
        "show_order_popup": false,
        "value": 1
      },
      "pin_description": "Отсюда 119 $SIGN$$CURRENCY$",
      "price": "110 $SIGN$$CURRENCY$",
      "service_level": 503,
      "summary_style": {
        "order_button": {
          "fill": {
            "color": "#fce004",
            "type": "solid"
          },
          "text_color": "#000000"
        },
        "surge_icon": {
          "color": "#fce004",
          "text_color": "#FFFFFF",
          "type": "default"
        }
      },
      "tariff_requirements": {
      },
      "widget": {
        "accessibility_info": {
          "hint": "узнать детали",
          "label": "уровень спроса",
          "value": "уровень спроса"
        },
        "content": {
          "additional_icons": [
          ],
          "balance": {
            "balance": 37,
            "color": "#FFC618",
            "leading_icon": "badge_surge_widget_car",
            "trail_icon": "badge_surge_widget_human",
            "value_icon": "badge_ruble_final"
          }
        },
        "payload": {
          "balance": 37,
          "surge_color": "#FFC618"
        },
        "type": "surge_balance"
      },
      
      // Поля, которые характерны для той или иной альтернативы ("altpin_b", "perfect_chain")
      // Схема поля повторяет схему соответствующей альтернативы, за исключением поля `service_levels`
      "alternative_extra": {
        ...
      }
    },
    ...
  ]
}
```

## Проблемы

Пока проблема только в алгоритмах эффективности: как "подружить" несколько механик снижения цены между собой. Идеальные цепочки и альтпины - это 2 различные альтернативы (идеальные цепочки и долгий поиск смогли подружить, они живут в одной альтернативе). Для альтернатив имеем свои собственные офферы, `routestats` должен объединить несколько офферов в один и выдать его клиенту.  
По словам Антона мы будем уметь объединять механики не раньше 2023 года (если будем).  

