#### Название сервиса
hiring-api

#### Задачи сервиса
##### Какую продуктовую проблему решает сервис?
Сервис принимает данные из различных лэндингов / очередей / прочее, прогоняет по Экспериментам3, обогащая их данными, и создаёт тикеты / лиды в CRM (SalesForce и Zendesk найма)

##### Почему нельзя решить эту задачу без разработки нового сервиса существующими решениями?
Существующие решения - deprecated функционал.

##### Как именно сервис будет решать поставленные перед ним задачи?
- Принимать данные
- Валидировать данные
- Обогащать Экспериментами3
- Класть в очередь stq, которая создаст тикеты

##### Разрабатывается один сервис или система?
- [x] Один
- [ ] Система

#### Взаимодействие
##### Сервис внутренний или внешний?
- [x] Внутренний
- [ ] Внешний

##### С кем взаимодействует сервис?
- hiring-authoproxy
- experiments3
- personal
- configs (конфиг "Продублировать ли заявку в infranaim-api?")
- infranaim-api

##### Использование Passenger Authorizer
https://wiki.yandex-team.ru/taxi/backend/architecture/passenger-authorizer/
- [ ] Да

##### Использование Driver-authorizer
https://wiki.yandex-team.ru/taxi/backend/architecture/driver-authorizer/
- [ ] Да

##### Залогиненность
Залогиненность означает возможность запуска сервиса в доменах yandex.ru|yandex-team.ru, возможность залогинить пользователя, возможность проверить или выставить cookie
- [ ] Да
	
##### Использование Blackbox
https://doc.yandex-team.ru/blackbox/concepts/about.xml
- [ ] Да

##### Использование MDS
https://wiki.yandex-team.ru/mds/s3-api/
- [ ] Да

##### Какие базы использует?
- [ ] PostgreSQL
- [ ] Mongo
- [ ] Redis
- [ ] Other
- [x] Не использует

##### Какие периодические процессы?
Две очереди stq: отправка в salesforce и отправка в infranaim-api.

#### Хранение и обработка данных
##### Планируется обработка персональных данных
Удостоверения личности, данные банковских карт, финансовая информация, ФИО + номер телефона, персональные прогнозы (как у Крипты) и т.д. 
- [x] Да

##### Какие данные и по какой схеме сервис будет хранить в базе?
- В stq будет лежать pd_id телефона - точно, pd_id остального (ВУ, логин telegram, почта) - если пришло;

##### Какой объем данных будет храниться и какой объем будет изменяться в единицу времени?
Не более 10 Mb хранения и 10 Mb обработки в минуту. 

##### Какие операции над данными заложены?
- Валидация;
- Обогащение в exp3;
- Складывание в stq.

##### Есть ли какой-то стейт в памяти, как он обновляется и валидируется?
Нет

#### Отказоустойчивость и масштабируемость
##### Какая нагрузка ожидается?
На данный момент пиковое значение в минуту - 130 заявок. В среднем приходит от 10 до 50 в рабочее время и до 10 - в ночное (по МСК).

##### Какие фолбеки предусмотрены на сам этот сервис?
Никаких. Если сервис недоступен, то заявки не будут приняты.  

##### Какие фолбеки предусмотрены внутри этого сервиса на взаимодействие с другими сервисами?
- hiring-authoproxy. Если недоступен hiring-authoproxy, то заявка не прилетит в hiring-api;
- experiments3. Если недоступны эксперименты, то не получится корректно разметить данные, что повлечёт некорректную аналитику, следовательно, предпочтительнее отвергнуть данные.
- personal. Если personal не ответил, то в salesforce и в infranaim-api полетят реальные данные. В случае, если пришли pd_id, заявка будет отвергнута.
- configs. Если не пришли конфиги, то сервис попытается отправить данные в infranaim-api.
- infranaim-api. Если сервис не ответил, то stq пытается переотправить. На графиках будет виден рост очереди.

##### Какие возможности масштабируемости закладываются?
Сервис должен уметь создавать тикеты / лиды для любой цели. На данный момент это водители и курьеры.

##### Какие точки отказа есть в сервисе?
Интеграции с
- experiments3
- personal

#### Метрики
##### Укажите ключевые продуктовые метрики сервиса, за которыми планируете следить
- Количество заявок

##### Укажите технические метрики
- Среднее время обработки заявки
- rps
- очереди stq 

#### Планы роста
##### Какая функциональность ожидается в сервисе в будущем?
- Обновление тикетов / лидов
- Создание / редактирование endpoint'ов. Endpoint - точка входа заявки, от него зависит:
  - соответствие токена
  - набор принимаемых полей
  - комментарий и тема тикета / лида по умолчанию 
- Создание / редактирование разметок. Разметка - объект, определённым образом обогащающий пришедшие данные
- Хранение токенов в секретнице вместо secdist'а

##### Какое изменение нагрузки планируется?
Нагрузка должна расти постоянно, но не более 254 запросов в секунду.

##### Активно ли будет изменяться сервис?
- [x] Да

#### Общая информация
##### Менеджер
@ikolbey

##### Релиз (предполагаемая дата)
29.04.2020

##### Язык, на котором пишется сервис
- [ ] C++
- [x] Python3
- [ ] Other

##### Ссылка на тикет, в рамках которого идет разработка
[NAIMBACKEND-264](https://st.yandex-team.ru/NAIMBACKEND-264)

##### Дополнительные согласования
Нет

##### Комментарий
hiring-api - несколько урезанная копия существующего infranaim-api. Какое-то время оба сервиса будут работать параллельно, но с полным переходом из Zendesk в Salesforce останется только hiring-api. 
