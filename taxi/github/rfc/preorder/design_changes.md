# Изменения для [нового дизайна предзаказа](https://wiki.yandex-team.ru/users/boldov/preorder-additions/)

Новый дизайн потребует доработок в ручках /taxiontheway и /preorder/v1/availability

### /preorder/v1/availability
Для [экрана выбора времени](https://wiki.yandex-team.ru/users/boldov/preorder-additions/#vyborvremeni) нужно передавать
заголовок "Заказ ко времени" и инструкцию (список подписей с иконками).

Изменения API:
```json
{
    "user_info": {
        "option_name": "Заказ ко времени",
        "items": [
            {
                "title": "Оповестим за 5 мин до подачи, если машин не будет",
                "icon_image_tag": "mds-img.jpg"
            }
        ]
    }
}
```
**user_info** - опциональное поле - если не пришло - не показываем инструкцию

**option_name** - обязательное поле

**items** - пункты инструкции/описания. обязательное поле, всегда не пусто

**title** - подпись пункта инструкции. обязательное поле

**icon_image_tag** - ссылка на иконку пункта инструкции в mds. обязательное поле


На начальном этапе можно добавить с помощью экспериментов.

### /taxiontheway
Для [экрана поездки](https://wiki.yandex-team.ru/users/boldov/preorder-additions/#vovremjazakaza) нужно передавать инструкцию, свой заголовок и подзаголовок (как в букинге) и флаги: скрытия карточки
поездки после заказа (аналогично нажати "Заказать еще такси") и перемещения блока кнопок  ("Отменить поездку" и 
"Заказать еще такси") на верх карточки.

Изменения API:
```json
{
  "notifications": {
    "requirement_card_title": {
      "type": "requirement_card_title",
      "items": [
        {
          "title": "Оповестим за 5 мин до подачи, если машин не будет",
          "icon_image_tag": "mds-img.jpg"
        },
        {
          "title": "Точная цена - когда найдем машину",
          "icon_image_tag": "mds-img.jpg"
        }
      ]
    }
  },
  "status_info": {
    "translations": {
      "card_title_template": "Поездка $DUE_DAY$, $DUE_TIME$",
      "card_subtitle_template": "Начнем искать за 10-30 мин до подачи"
    }
  }
}
```
**notifications** - используем уе существующее поле

**requirement.card.title** - опционаьное поле - если не пришло не показываем инструкцию

**type** - обязательное поле

**items** - обязательное поле, всегда не пусто

**title** - обязательное поле

**icon_image_tag** - бязательное поле

**status_info** - уже используется для времени платного ожидания

**translations** - эта доработка совпадает с букингом

**card_title_template** - жирная подпись вверху карточки. опциональное поле. если отсутствует берем из клиентского хардкода по статусам как сейчас

**card_subtitle_template** - подпись под card_subtitle_template. опциональное поле. если отсутствует берем из клиентского хардкода по статусам как сейчас


Утверждены шаблоны вида:
```
$DUE_DAY$  - день заказа (сегодня, завтра, просто дата) в зависимости от настроек устройства (считается от request.due)
$DUE_TIME$ - время заказа ("12:40") в зависимости от настроек устройства (берется из request.due)
```

На начальном этапе description хочу брать из конфига, в будущем их стоит внести в отдельную ручку сервиса предзаказа.

### [Пуши](https://wiki.yandex-team.ru/users/boldov/preorder-additions/#searching)
Новые пуши трегерят от изменений статуса заказа, по этому будем присылать их с бека, а не делать локально.

Пуши о неудавшемся поиске уже реализованы. Пример с тестинга:
```
Unable to find a taxi for 18:16
```
Для предзаказа их дорабатывать не будем.
