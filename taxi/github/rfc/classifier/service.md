**Название сервиса**

Сервис классификации - classifier

**Какую продуктовую проблему решает сервис?**

Для заданных параметров транспорта (ТС) и, вероятно, исполнителя, сервис по
определённой бизнес логике определяет тарифы, которые теоретически могут быть
доступны исполнителю с этим транспортом.

**Почему нельзя решить эту задачу без разработки нового сервиса существующими решениями?**

Данная задача уже решается в старом сервисе tracker и в новом candidates.
Тем не менее, существующее решение устарело и нуждается в переработке,
также есть потребность консолидировать знания по классификации в едином месте
(сейчас код размазан по backend-cpp, uservices и backend).

**Как именно сервис будет решать поставленные перед ним задачи?**

В сервисе будут ручки для настройки классификатора через tariff-editor, а также
ручки для выполнения классификации по заданным параметрам в заданной зоне.

Для сервиса candidates будет разработана специальная библиотека, выполняющая
классификацию без дополнительных походов в сервис.

**Разрабатывается один сервис или система?**

Один сервис (classifier) и библиотека для candidates (вероятно тоже classifier).

**Сколько и какие сервисы входят в систему?**

- Сервис classifier
- Библиотека classifier

**С кем взаимодействует сервис?**

Планируется взаимодействие сервиса только с собственной базой.
Из tariff-editor запросы будут просто повторяться при ошибках.
В библиотеке для candidates будет организован кэш.

**Какие базы использует?**

PGaaS, для хранения настроек классификатора.

**Какие периодические процессы?**

Вероятно на этапе сверок потребуется периодический процесс синхронизации
данных текущего классификатора в новый формат.

**Прикрепите схему того, где этот сервис находится в текущей инфраструктуре**

Логика сервиса будет использована в candidates через библиотеку.
Ручки сервиса будут вызываться преимущественно через tariff-editor.

**Какие данные и по какой схеме сервис будет хранить в базе?**

Параметры классификации в разрезе тарифных зон.

**Какой объем данных будет храниться и какой объем будет изменяться в единицу времени?**

Сейчас база включает порядка 1000 классификаторов.
Каждый классификатор содержит до пары десятков тарифов.
Итого общее число записей в базе сейчас до 20 тыс.
В единицу времени изменений будет мало, ими можно пренебречь.

**Какие операции над данными заложены?**

Чтение, запись.

**Есть ли какой-то стейт в памяти, как он обновляется и валидируется?**

В библиотеке будет кэш правил классификации c инкрементальным обновлением.

**Какая нагрузка ожидается?**

На сервис большой нагрузки (из tariff-editor) не предвидится.

**Какие фолбеки предусмотрены на сам этот сервис?**

Отсутствуют, библиотека в candidates должна работать надёжно.

**Какие фолбеки предусмотрены внутри этого сервиса на взаимодействие с другими сервисами?**

Кэш на базой.

**Какие возможности масштабируемости закладываются?**

Горизонтальное масштабирование.

**Какие точки отказа есть в сервисе?**

База.

**Укажите ключевые продуктовые метрики сервиса, за которыми планируете следить**

- Число классификаторов
- Число правил для тарифа внутри классификатора
- Частота использования параметров сущностей
- Понятность и удобство использования и интерпретации (не совсем метрика)

**Укажите технические метрики**

- Размер базы
- Время классификации

**Какая функциональность ожидается в сервисе в будущем?**

Этапы разработки:

1. Структура базы и формирование бизнес логики
2. Периодический процесс синхронизации старых правил в новый формат
3. Библиотека для candidates
4. Интеграции с candidates и сверка результатов
5. Ручки для tariff-editor
6. Удаление кода из backend и backend-cpp

**Какое изменение нагрузки планируется?**

Нагрузка от tariff-editor незначительная и не должна сильно измениться.

**Активно ли будет изменяться сервис?**

Активных изменений не планируется.
