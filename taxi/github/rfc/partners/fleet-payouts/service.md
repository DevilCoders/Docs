**Название сервиса**

fleet-payouts

**Какую продуктовую проблему решает сервис?**

Сервис будут отвечать за денежные выплаты паркам. У него будет два режима - моментальная выплата по ручке и периодическая выплата (N - период будем указывать в конфиге). Для всех парков период будет одинаковый.
В Оптеуме будет кнопка - произвести выплату. По нажатию на нее, будет дергаться ручка данного сервиса, ставиться задача по выплате денег парку (если они у него есть). Плюс, выставим лимит, сколько можно снимать денег за 1 раз.
Предполагается, что нажатие на кнопку, и соответственно, выплату мы будем делать не чаще, чем K часов (K задается в конфиге).

**Почему нельзя решить эту задачу без разработки нового сервиса существующими решениями?**

К данному сервису предъявляются особые требования
Он должен быть отказоустойчивым (попросим завести 3 машины). В нем должна быть только логика с выплатами. Логирование действий пользователей должно храниться очень долго

**Как именно сервис будет решать поставленные перед ним задачи?**

У сервиса будет ручка для моментальной выплаты, которая будет дергать ручки биллинга. Также у сервиса будут переодические выплаты тем паркам, которые не получали выплаты в течение N дней

**Разрабатывается один сервис или система?**

Один сервис на С++ в uservices

**С кем взаимодействует сервис?**

Оптеум
Биллинг

**Какие базы использует?**

PG fleet-payouts (новая база)

**Какие периодические процессы?**

Совершать выплаты паркам, которым не производилась выплата в течение N дней.
Конфигурировать данные периодические действия пока не планируется.

Данные действия будут проходить в PeriodicTask'ах внутри сервиса
Синхронизация будет осуществляться с помощью DistLock компоненты

**Планируется обработка персональных данных?**

Нет

**Какие данные и по какой схеме сервис будет хранить в базе?**

Сервис будет хранить по каждому парку время последний выплаты, доп. параметры

**Какой объем данных будет храниться и какой объем будет изменяться в единицу времени?**

Объем данных будет небольшой (единицы ГБ)
Объем изменяющихся данных менее 1 MB/sec

**Какие операции над данными заложены?**

SELECT и UPDATE

**Есть ли какой-то стейт в памяти, как он обновляется и валидируется?**

Нет

**Какая нагрузка ожидается?**

Если данная фича будет очень популярна, то максмальная нагрузка будет количество парков ~80000 / секунд в одном дне 86400

~1 rps

Пиковые нагрузки нужно будет проработать с биллингом, какую нагрузку они могут держать, в худшем случае делать очередь задач

**Какие фолбеки предусмотрены на сам этот сервис?**

Не предусмотрены

**Какие фолбеки предусмотрены внутри этого сервиса на взаимодействие с другими сервисами?**

Хождение в биллинг будет с троттлингом

**Какие возможности масштабируемости закладываются?**

Масштабируемость данного сервиса напрямую зависит от масштабируемости биллинга
Если будет расти активность вывода средств по кнопке, можно использовать очередь для похода в биллинг

**Какие точки отказа есть в сервисе?**

База данных
Биллинг

**Укажите ключевые продуктовые метрики сервиса, за которыми планируете следить?**

Сколько парков будут пользоваться моментальными выплатами

**Укажите технические метрики?**

Max/Avg qps на Базу данных
Max/Avg rps на Биллинг

**Какая функциональность ожидается в сервисе в будущем?**

Ожидается, что этот сервис будет отвечать за все выплаты паркам
Монетизация данной фичи, делая ее доступной только по услуге

**Какое изменение нагрузки планируется?**

Ожидается линейный рост

**Активно ли будет изменяться сервис?**

Активно
