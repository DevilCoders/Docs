**Название сервиса**

driver-random-bonus

**Какую продуктовую проблему решает сервис?**

Показывает водителям "случайные награды" для удержания их на линии в приложении Uberdriver (впоследствии, возможно и в Таксометре).

**Почему нельзя решить эту задачу без разработки нового сервиса существующими решениями?**

Наиболее близкий по смыслу сервис subventions-view отображает только субсидии, приходящие из биллинга.
Обработка разнородных наград - смены, промокоды, повышенный приоритет, физические награды, выходит за рамки его ответственности.

**Как именно сервис будет решать поставленные перед ним задачи?**

поллинговая ручка для Таксометра, будет отдавать текущую случайную награду для отображения
награды будут работать по обычному флоу, например, субсидия типа "персональная цель" или "0% комиссии сервиса на следующие N заказов", или "повышенный приоритет на N часов"
Факт выдачи случайной награды = наличие соответствующего водительского тега. Теги будут запрашиваться в сервисе driver-tags. Соответствие награда <-> тег будет фиксировано (или расширяться очень медленно).

в будущем:
ручка для принятия/отклонения предложения о награде
ручка детализации награды - подробный текст, времмя начала, время окончания, прогресс и т.п.
(вероятно) ручка "казино" - после длительной работы водителя он может дёрнуть ручку и ему предложатся 2-3 награды на выбор (варианты тоже определяются по тегам)

**Этапы разработки**

1. 
Заводим новый сервис с ручкой поллинга

2. 
Добавляем ручки "принять/отклонить предложение" и "показать детализаию текущей награды".

3.
Ручка "казино"

**Разрабатывается один сервис или система?**

Один сервис

**С кем взаимодействует сервис?**

 - driver-tags для определения наличия наград

**Какие базы использует?**

Никакие

**Какие периодические процессы?**

Нет

**Планируется обработка персональных данных**

Нет

**Какие данные и по какой схеме сервис будет хранить в базе?**

-

**Какой объем данных будет храниться и какой объем будет изменяться в единицу времени?**

—

**Какие операции над данными заложены?**

—

**Есть ли какой-то стейт в памяти, как он обновляется и валидируется?**

Нет

**Какая нагрузка ожидается?**

Интервал поллинга около 5 минут, в uberdriver всего порядка 100к водителей, в худшем случае получается 350 rps. Одновременно на линии в несколько раз меньше водителей, т.е. ожидается несколько десятков rps
все остальные ручки очень редкие, в сумме порядка 1 rps

**Какие фолбеки предусмотрены на сам этот сервис?**

Если недоступен сам сервис - ничего страшного, награда не отобразится, хотя и сработает как нужно, если соответствующий сервис работает штатно.

**Какие фолбеки предусмотрены внутри этого сервиса на взаимодействие с другими сервисами?**

Если недоступен driver-tags - награда не отобразится. Сработает ли - зависит от соответствующего сервиса.

**Какие возможности масштабируемости закладываются?**

Сервис масштабируется горизонтально - rps растёт пропорционально количеству водителей в uberdriver.

**Какие точки отказа есть в сервисе?**

Внешний поход в driver-tags

**Укажите ключевые продуктовые метрики сервиса, за которыми планируете следить**

Продуктовые метрики собираются аналитиками - поставщиками соответсвующих тегов.

**Укажите технические метрики**

стандартные

**Какая функциональность ожидается в сервисе в будущем?**

ручка для принятия/отклонения предложения о награде
ручка детализации награды - подробный текст, времмя начала, время окончания, прогресс и т.п.
(вероятно) ручка "казино" - после длительной работы водителя он может дёрнуть ручку и ему предложатся 2-3 награды на выбор (варианты тоже определяются по тегам)

**Какое изменение нагрузки планируется?**

x2-x3 в течение года, пропорционально росту uberdriver

**Активно ли будет изменяться сервис?**

В зависимости от успешности. Если идея не сработает и эффетивность не вырастет, сервис и функциональность будут удалены

## Архитектура

### API

GET ручка `/driver/v1/random-bonus/v1/polling`

Ответ ручки: Список текущих случайных наград.
Формат награды прорабатывается с клиентом.

### Клиентская логика

Водительское приложение опрашивает ручку для поллинга.
Ручка возвращает список наград, каждая из которых отрисовывается на клиенте.

### Технические ограничения

-

### Как раскатываем

В ручку будет ходить приложение uberdriver, начиная с некоторой версии.

### Безопасность

Не планируется работать с ПД

