## Бизнес задача

### Описание

Большое количество заказов из разных сервисов, могут заполонить весь экран мультизаказа.

Нужно разгрузить экран мультизаказа, сгрупировав часть заказов вместе. А часть заказов раскидать по экранам сервисов.

Для этого нужно изменить визуал одновременного трекинга нескольких заказов. 

### Задача

На экране мультизаказа будет расположена мини-карточка "схлопнутых заказов", при нажатии на которую будет раскрываться список заказов.
На экране с EatsKit и Нативной шторы, сверху должны распологаться заказы сервиса либо виджет "схлопнутых заказов"

Мини-карточка будет реализована на базе новой технологии виджетов. Так же уже существующие карточки заказов будут описаны с точки зрения виджетов.

Заказы, которые будут показываться как "схлопнутых заказов" или расположенные в разных сервисах, не должны показываться на экране мультизаказа

### Виджет "Схлопнутых заказов"

<img src="./static/short_orders_widget.jpg" width="200" />

**JSON:**
```JavaScript
{
    "type": "orders_widget",
    "id": "123456",
     "payload": {
        "orders": [
        {
            "id": "order_1",
            "service": "market"
        },
        {
            "id": "order_2",
            "service": "Adidas"
        },
        {
            "id": "order_3",
            "service": "Zara"
        }]
}

```

**YAML**
```yaml
OrdersWidgetPayload:
    type: object
    additionalProperties: false 
    required:
        - orders
    properties:
        orders:
            type: object
            additionalProperties: false 
            required:
                - id
                - service
            properties:
                id:
                    type: string
                service:
                    type: string

```


### Виджеты заказов:

```JavaScript
{
    "type": "order_widget",
    "id": "123456",
    "payload": {
        "service": "taxi",
        "order_id": "123"
    }
}
```

**YAML**
```yaml
OrderWidgetPayload:
    type: object
    additionalProperties: false 
    required:
        - service
        - order_id
    properties:
        order_id:
            type: string
        service:
            type: string

```

### Новая ручка описывающая виджеты для экрана

Новая ручка будет возвращать список виджетов для запрошеного экрана.

В ручку будут уходить список заказов и признак экрана (main, eats, grocery etc)
Область для виджетов на каждом экране своя. На мульти заказу: сверху шорткатов над картой, На шторах сервисов: сверху над шторой

Экраны, для которых будет запрашиваться информация
- EatKit сервисы (будет передаваться название сервиса)
- Нативная штора (будет передаваться название сервиса)
- Главная / Мультизаказ (будет передаваться на бек как main)


#### Нюансы переходов на Мультизаказ

После оформления заказа, клиент дергает ручку и если ответ содержит виджеты заказов или "Схлопнутых заказов" открывает Мультизаказ. Если в ответе нет таких виджетов остается на главном.

У ручки будет 3 основные стратегии:
- При заказе с WebView (Маркет, Еда, Лавка и тд), ручка является блокирующей, на случай если заказ является "долгим" и его отображени будет не на мультизаказе, а в шторе самого сервиса
- При заказах из саммари (такси, доставка) и так же сервисов, где необходим переход без задержек, отображаем сделанный заказ, без других, ранее сделаных, заказов. После получения ответа ручки, перерисовываем экран в соответствии с ответом.
- Если ручка ответила с ошибкой, то переключаемся на старое поведение, в котором отображаем все доступные заказы.

Ручка будет блокирующей, либо нужно обдумать фалбек и обсудить поведение.

Так же при переходе на экраны Нативной шторы или EatKit сервисов, надо сверху показывать небольшой шимеринг *(хотя я бы предложил раскрывать штору показывая виджеты если такие есть, а шимеринг добавить в след версиях после расширения функционала виджетов)*

```JavaScript
{
    widgets: [
        {
            "type": "orders_widget",
            "id": "123456",
             "payload": {
                "orders": [
                {
                    "id": "order_1",
                    "service": "market"
                },
                {
                    "id": "order_2",
                    "service": "grocery"
                },
                {
                    "id": "order_3",
                    "service": "delivery"
                }]
        },
        {
            "type": "order_widget",
            "id": "123456",
            "payload": {
                "service": "taxi",
                "order_id": "123"
            }
        }
    ]
}
```
