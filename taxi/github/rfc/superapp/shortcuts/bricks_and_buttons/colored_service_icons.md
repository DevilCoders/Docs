# Продуктовое описание

Нужно научиться отображать оба варианта сервисных кнопок:

![colorful_icons](https://st.yandex-team.ru/TAXIBACKEND-28663/attachments/18928496?)


## Почему это нельзя сделать сейчас

Релевантный JSON динамических кирпичей сейчас выглядит так:
```json
{
    "title": "Service",
    "type": "eats-based:superapp|taxi:route-input|header-deeplink|taxi:header-summary-redirect",
    "width": 3,
    "height": 1,
    "icon_tag": "service_icon_tag",
    "background": {
        "color": "#F1F0ED"
    }
}
```

Есть две проблемы:
1) Иконка сервиса "монохромна" т.к. клиенты окрашивают её в цвет `text_style.color` (так была реализована функциональность `show_disabled=True`)
2) Мы не контролируем отступ между иконкой и текстом (на фигме "цветных" иконк текст имеет больший отступ)


## Обратная совместимость

В конечном счете возможны следующие представления UI динамических кирпичей:

1. Одноцветные иконки (как сейчас)
* Передаются через icon_tag
* Красятся маской в цвет text_style.color
2. Ч/б иконки
* Не-одноцветные (нужен механизм передачи disabled-состояния)
* "Маленького" размера
3. Цветные/стероидные иконки
* Не-одноцветные (нужен механизм передачи disabled-состояния)
* "Большого" размера


## Варианты решенея

### Вариант 0 [принят]

1) Необходимо на клиентах отказаться от окрашивания иконки сервиса в `text_style.color`. Бекенд будет в `icon_tag` возвращать уже "правильную" иконку.
2) Клиент в запросе v1/products передает флаг поддержки многоцветных иконок `shortcuts.multicolor_service_icons_supported: true`
3) Проблему "размеров" решаем через клиентский эксперимент `shortcuts_brick_icon_tag_size`:
```json
{
    "size": "big|small",
    "enabled": true
}
```

По этому эксперименту клиент будет резервировать место под картинку в кирпичиках.

#### Аналитика и бекенд

На бекенде предлагаются следующие изменения:
1) Передавать экспериментам3.0 кваргом свойство `multicolor_service_icons_supported` в сервисах `shortcuts` и `superapp-misc`. По нему можно будет "включать" эксперименты.
2) В эксперимент `superapp_shortcuts_brick_appearance` для каждого кирпичика добавляются обязательные поля `multicolor_tags.enabled_tag / disabled_tag`. При поддежке клиентом, их нужно подствалять в `icon_tag` в итоговом кирпичике в зависимости от доступности сервиса.


### Вариант 1 — новые типы шорткатов [не подходит]

Потребует введения как минимум двух новых типов (замена `eats-based:superapp`, `taxi:route-input`, если уже реализовали на клиентах, также `taxi:header-summary-redirect`), выглядит громоздко. Проблема передачи отступа остается.

### Вариант 2 — attributed_title [не подходит]

В существующих типах передавать на клиент свойство `attributed_title` (по аналогии с attributed_text)
```json
{
    "type": "eats-based:superapp",
    "attributed_title": {
        "items": [
            {
                "type": "image",
                "image_tag": "eats_colored_icon",
                "width": 15,
                // ...
                "vertical_alignment": "center"
            },
            {
                "type": "text",
                // ...
                "text": "Продукты"
            }
        ]
    }
}
```

Плюсы:
* Не нужны новые типы
* Позволяет передать отступ (через width изображения (уточнить у клиентов))

Вопросы:
1) Компактное отображение для отображения вертикали без иконки

* Бекенд должен как-то "понять" что кирпичик не поместится на клиент с иконокой. Сейчас клиенты рендерят для этого контент. **не знаем как эффективно решить сейчас**
* Нужно научиться "центровать" текст через API. (Это пригодится для новых разделителей)

### Вариант 3 — новые свойства [не подходит]

Например
```json
{
    "title": "Service",
    "type": "eats-based:superapp|taxi:route-input|header-deeplink|taxi:header-summary-redirect",
    "width": 3,
    "height": 1,
    "icon_tag": "monochrome_service_icon_tag",
    "colorful_icon_tag": "colorful_service_icon_tag",  // new
    "background": {
        "color": "#F1F0ED"
    }
}
```

Вопросы:
* Как передать отступ? [Потенциальный ответ: добавить еще одно свойство, например `icon_type: small_mono|big_colored|...`]

**слишком много новых свойств**