# Кнопки как независимый шорткат

## Проблема

На текущий момент кнопки достаточно сильно связаны с соответствующими сервисами (Еда, Лавка):
- Наличие кнопки зависит от доступности сервиса
- Иконка/цвет текста зависит от доступности сервиса

При этом в общем случае хотелось бы иметь кнопки как независимый элемент интерфейса, с помощью которого, например, можно отображать отдельные магазины (по кнопке на "Магнит", "Магнолию" и т.п.).

## Задача

Отвязать кнопки от сервисов, предоставив возможность отображать кнопки для отдельных сущностей. При этом пока что видится, что отдельные сущности существуют внутри сервиса, т.е. доступность отдельных сущностей проверяется как логическое "и" между доступностью сервиса и доступностью сущности.

## Решение

Здесь и ниже описывается решение для отображения магазинов с помощью шорткатов-кнопок, однако вместе с магазинами хочется продумать общую схему для других сущностей.


### Для справки

<details><summary>JSON кнопки из ответа products</summary>

```json
{
    "action": {
        "deeplink": "yandextaxi://external?service=eats",
        "type": "deeplink"
    },
    "background": {
        "color": "#F1F0ED"
    },
    "icon_size": "big",
    "icon_tag": "shortcuts_buttons_eats",
    "id": "eats_based_eats:45ef7a31ea244a7aba03e70ed11981a7",
    "service": "eats",
    "text_style": {
        "color": "#21201f"
    },
    "title": "Еда"
}
```
</details>

<details><summary>JSON шортката в ответе eda-shortcuts</summary>

```json
{
    "id": "eda-place-0b29cf1e51904f63914f292efe95c3a0",
    "scenario": "eats_place",
    "content": {
        "image_tag": "shortcuts_eats_custom_category_burgery_1",
        "title": "Макдоналдс",
        "color": "#F5F4F2"
    },
    "scenario_params": {
        "eats_place_params": {
            "action_type": "eats_place",
            "place_id": "65491",
            "slug": "mcd_pobe69",
            "delivery_time": {
                "min": 25,
                "max": 35
            },
            "rating": 4.820000171661377
        }
    }
}
```
</details>


## MVP для магазинов

1) В eda-shortcuts достаём магазины из shortlist. Определяем, что это магазин, по попаданию `brand.id` в конфиг. Существующая логика `eda-shortcuts` дедуплицирует бренды, оставив только по одному магазину каждого бренда.

2) Добавляем эксперимент, по которому N магазинов докидываются в ответ `eda-shortcuts` как отдельный объект в списке `scenario_tops` со `scenario`=`eats_based_shop`. `content` и `scenario_params` получаются, как и раньше, из `shortlist` + `shortcuts-admin`. 

3) В эксперимент `shortcuts_grid_rule` добавляем флаг `enable_shops`, который докидывает магазины после органики, но до `showcases`.

4) В `shortcuts` дописываем код, который по `scenario`=`eats_based_shop` ищет магазины, навешивает для них нужный `deeplink` и пакует их в `buttons`/`button_container`.

## Полноценное решение

1) Решение с конфигом для магазинов как будто выглядит достаточно рабочим, обсуждение того, как для других источников превращать шорткаты в кнопки, пока что оставляю открытым. 

2) Вместо `scenario` для определения кнопка/шорктат предлагается ввести новое поле `type` (=`shortcut`/`button`). Обсуждение того, откуда это поле появляется (админка шорткатов/другой источник) пока что тоже оставляем открытым.

3) Учим `blender` паковать в блок только шорткаты только одного типа: кажется, что кнопки и шорткаты рядом в одном блоке будут смотреться супер нелепо.

4) Улучшение пункта 4 из MVP, потому как для быстрой реализации там по-любому придётся накостылять, а здесь необходим аккуратный архитектурный способ добавлять секцию кнопок.

## TODO
- Посмотреть, как выглядит кнопка Еды при наличии двух кнопок с service=eats.