## Описание экспериментов, используемых для управления шорткатами

### Эксперимент `superapp_shortcuts_prefetch_strategy`

<details><summary>Схема эксперимента</summary>
<p>

```yaml
additionalProperties: false
properties:
  taxi:expected-destination:
    items:
      additionalProperties: false
      properties:
        count:
          type: integer
        strategy:
          type: string
      required:
      - count
      - strategy
      type: object
    type: array
required:
- taxi:expected-destination
type: object

```
</p>
</details>

#### Описание эксперимента
Напрямую не относится к оформлению шорткатов. Управляет стратегией загрузки дополнительных данных, необходимых для шорткатов: время поездки для таксишных шорткатов, медиа файлы для других.

А именно, при указании определённой стратегии и параметра `count` для неё, для указанного количества шорткатов их содержимое будет загружено ещё до того, как клиент их откроет.


#### Описание параметров
В корне эксперимента могут быть указаны типы шорткатов, для которых могут быть актуальны prefetch-стратегии. На текущий момент это `taxi:expected-destination` и `media-stories`.


Содержимое каждой секции:
- массив из словарей, описывающих стратегии. Каждый из словарей имеет следующую структуру:
    - `strategy` - название стратегии.
    - `count` - количество шорткатов данного типа, на которые распространяетcя данная стратегия.

Возможные стратегии:
- Секция `taxi:expected-destination`:
    - `route_eta` - использование `client-router` для получении ожидаемого времени поездки. Используется сейчас.
    - `routestats` - использование `/routestats` для расчёта стоимости поездки. Использование без серьёзных доработок крайне нежелательно в силу многократного возрастания нагрузки на `/routestats`. Подробнее [тут](https://github.yandex-team.ru/privet/rfc/blob/feature/TAXIBACKEND-26901-offer-in-taxi-shortcut/superapp/shortcuts/taxi_offers.md).
- Секция `media-stories`:
    - `disable_media` - не загружать никакие медиа-файлы
    - `images` - загружать только картинки
    - `all_media` - загружать любые медиа-файлы

### Как это работает

В составе эксперимента передаётся массив параметров стратегий для каждого из типов шорткатов. Для шорткатов, отдаваемых на клиент, `prefetch`-стратегия устанавливается в рамках квоты, заданной параметром `count` стратегии. Так, например, для эксперимента со значением
```json
{
    "media-stories": [
        {
            "strategy": "all_media",
            "count": 2
        },
        {
            "strategy": "only_json",
            "count": 3
        },
    ]
}
```
первые два шортката со сторисами загрузят все свои данные, а следующие три - только JSON.
