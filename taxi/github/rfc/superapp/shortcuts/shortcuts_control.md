# Механизм отключение шорткатов

Данный механизм необходим для нескольких целей:

1. Управление нагрузкой на ручки формирования шоркатов
2. Поддержание консистентности между доступностью и шорткатами

## Предложение по реализации данного механизма

### Исходные данные:

1. `shortcuts.supported_features` - определяет список типов поддерживаемых шорткатов (данное поле может быть отправленно клиентами, даже при отключённом эксперементе `superapp_shortcuts`);
2. Эксперимент `superapp_availablity` + доступность сервисов - определяет, доступны ли сервисы в данной точке -> нужно ли показывать соответствующий шорткат;

### Что хотим отключать:

1. Источники шорткатов
2. Блендер + остальные элементы отвечающие за формирование шорткатов из источников

### Как отключать:

Оптимальным с точки зрения производительности, является отключение вызовов неиспользуемых источников.

В `v1/availability` на основе уже имеющихся входных данных и доступности формируем новый список `supported_features` и отдаём его в ответе ручки:

#### response `v1/availability`

```
{
    ...
    "sources_scenarios": {
        "persuggest": ["taxi:expected-destination"],
        "eda-shortcuts": ["eats_place"]
    }
    ...
}
```

Отключение отдельного источника:
- Отключаем источник, если нужный тип отсутсвует в массиве поддерживаемого функционала

Отключение блендера и шорткатов:
- Проверяем массив `sources_scenarios` на существование и пустоту, в этих случаях, отключаем их.

Оптимизация:
- Получение шорткатов такси работает по проверке наличия объекта `shortcuts` в запросе/пустота `shortcuts.supported_features`. По причине того, что это core-функционал сервиса.

Минусы:
1. Увеличение таймингов на запрос ручки `v1/availability` (запрос `v1/services-positions` + `v1/availability`)

Фолбеки:

Расширяем фолбек для ручки `v1/availability`:

```
{
    ...
    "sources_scenarios": {
        "persuggest": ["taxi:expected-destination"],
    }
    ...
}
```
