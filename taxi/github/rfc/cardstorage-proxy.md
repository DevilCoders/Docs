## Опросник для ревью комитетом

**Название сервиса**

card-filter

**Какую продуктовую проблему решает сервис?**

Применяет настройки антифрода к списку карт, получаемых из cardstorage

**Почему нельзя решить эту задачу без разработки нового сервиса существующими решениями?**

Есть три варианта:
1) написать логику на agl
плюсы: нет необходимости заводить сервис, все в одном месте
минусы: сложность логики и неподдерживаемость ее в agl, невозможность следить за версиями и полноценно ревьюить код

2) положить логику в cardstorage
плюсы: нет необходимости заводить сервис, логика там же где информация для нее
минусы: переусложнение графа зависимостей cardstorage, который задумывался как кеширующий прокси сервис для трастовых методов со способами оплаты

3) завести отдельный сервис
плюсы: простота поддержки и добавление новой логики, простота добавления фолбэков
минусы: необходимость поддержки еще одного сервиса

**Как именно сервис будет решать поставленные перед ним задачи?**

api-proxy из ручек /3.0/paymentmethods и /4.0/payments/list-payment-methods будет ходить в card-filter,
card-filter будет получать список карт от cardstorage, ответ антифрода от card-antifraud (в будущем так же от afs),
применять антифрод к ответу cardstorage и проксировать дальше

**Разрабатывается один сервис или система?**
один сервис

**Сколько и какие сервисы входят в систему?**
один сервис card-filter

**С кем взаимодействует сервис?**

1. Какие (микро-)сервисы и как используются.
сервис получает данные от:
- cardstorage
- card-antifraud
- afs

кроме этого используются конфиги и эксперименты-3

2. Как гарантируется идемпотентность внешний операций.
все данные, предоставляемые сервисом - read-only

3. Как поддерживается консистентность данных при частичных отказах.
все данные, предоставляемые сервисом - read-only

4. Как организованы ретраи внешних сервисов.
стандартный механизм ретраев uservices, настраеваемый QOS конфигом и имеющим фолбэк на уменьшение ретраев при проблемах.

**Какие базы использует?**
базы данных не используются

**Какие периодические процессы?**
Периодические процессы - только связанные с конфигами и экспериментами-3. Своих периодических процессов нет.

**Прикрепите схему того, где этот сервис находится в текущей инфраструктуре**

текущая схема:
api_proxy(/3.0/paymentmethods,/4.0/payments/list-payment-methods) -> cardstorage
новая схема:
api_proxy(/3.0/paymentmethods,/4.0/payments/list-payment-methods) -> card-filter -> cardstorage

1. Как технически проект влияет на цикл заказа.
При недоступности сервиса пользователь не сможет получить список карт и
сможет пользоваться только закешированным локально списком (аналогично недоступности cardstorage)

2. Кто будет потребителями сервиса.
клиентские ручки в api-proxy (/3.0/paymentmethods,/4.0/payments/list-payment-methods),
сервис payments-eda, для списка способов оплаты при невозможности сделать заказ

**Какие данные и по какой схеме сервис будет хранить в базе?**
базы не используются

**Какой объем данных будет храниться и какой объем будет изменяться в единицу времени?**
-

**Какие операции над данными заложены?**
-

**Есть ли какой-то стейт в памяти, как он обновляется и валидируется?**
стейта нет

**Какая нагрузка ожидается?**
совокупная нагрузка на клиентские ручки /3.0/paymentmethods,/4.0/payments/list-payment-methods
текущая нагрузка в пике до 1к rps

**Какие фолбеки предусмотрены на сам этот сервис?**
фолбэк на неответ сервиса не предусмотрен, поскольку он предоставляет основную часть ответа продуктовой ручки.
со стороны клиентов есть обработка и перезапросы при недоступности продуктовой ручки.

**Какие фолбеки предусмотрены внутри этого сервиса на взаимодействие с другими сервисами?**
cardstorage - фолбэк не предусмотрен, поскольку сервис предоставляет основную часть ответа сервиса
card-antifraud - фолбэк, основанный на сервисе статистики, при недоступности сервиса - все карты становятся доступными.
afs - фолбэк, основанный на сервисе статистики, при недоступности сервиса - все карты становятся доступными.

**Какие возможности масштабируемости закладываются?**
неограниченно масштабируется горизонтально, поскольку нет стейта.

**Какие точки отказа есть в сервисе?**
сервис cardstorage

**Укажите ключевые продуктовые метрики сервиса, за которыми планируете следить**
- количество доступных по правилам антифрода карт
- количество недоступных по правилам антифрода карт

**Укажите технические метрики**
стандартные технические метрики + метрики фолбэков

**Какая функциональность ожидается в сервисе в будущем?**

Этапы разработки:

1. MVP: текущая логика из agl-ручек, поход в card-antifraud
2. Использование login_id и уровней верификации (проверяем по конфигу)
3. Проверка уровней верификации в сервисе afs

**Какое изменение нагрузки планируется?**
рост нагрузки пропорционален росту количества пользователей

**Активно ли будет изменяться сервис?**
нет

<hr>

## Бизнесовая задача
Применять антифрод на этапе получения способов оплаты

раскатка планируется в соответствии с этапами разработки:
1. MVP: текущая логика из agl-ручек, поход в card-antifraud
2. Использование login_id и уровней верификации (проверяем по конфигу)
3. Проверка уровней верификации в сервисе afs
