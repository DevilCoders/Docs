**Название сервиса**

signal-device-configs

**Какую продуктовую проблему решает сервис?**

Частичное и полное переопределение конфигов для камер усталости и доставка изменений на устройства.

**Почему нельзя решить эту задачу без разработки нового сервиса существующими решениями?**

Нет механизма доставки конфигов на камеру, позволяющего кастомизировать патчи через админку.
Сервис экспериментов не подойдет, т.к. доступ к конфигам нужно будет дать и внешним пользователям.

**Как именно сервис будет решать поставленные перед ним задачи?**

Cервис предоставляет ручки админки, позволяющие настроить оверрайды конфигов по паркам, камерам и версиям ПО камер.
Производит валидацию задаваемых в админке параметров и отдаёт патчи конфигов камерам.

**Разрабатывается один сервис или система?**

Один сервис

**С кем взаимодействует сервис?**

- signal-device-api – авторизует запросы от камер и запрашивает у нас обновления конфигов для них
- signal-device-api-admin – проверяем, что существует камера, для которой хотят создать патч
- фронтенд админки камеры – обращается к нам чтобы внести новые патчи в конфиги

**Какие базы использует?**

Новая pg signal_device_configs.

**Какие периодические процессы?**

Нет

**Планируется обработка персональных данных**

Нет

**Какие данные и по какой схеме сервис будет хранить в базе?**

```javascript
{
	"_id" : "926145376ea748b2890ea3dafdd3861c",
        "park_id": "park1",
        "serial_number"[опционально]: "camera1",
        "min_software_version": "минимальная версия прошивки, к которой применяем патч",
        "max_software_version"[опционально]: "максимальная версия прошивки, к которой применяем патч",
        "config_name": "название конфига, который патчим",
        "patch":  <jsonb с переопределяемыми частями конфига>,
        "created_at" : <timestamp>,      // время создания патча
        "updated_at" : <timestamp>,      // время обновления патча 
        "yandex_login": "автор патча", или
        "yandex_uuid": "автор патча",
	"created_by" : <login для yandex-team>|uid
}
```

+ возможно, какие-то дополнительные фильтры

**Какой объем данных будет храниться и какой объем будет изменяться в единицу времени?**

До 5 Гб

Изменений до 15кб/с

**Какие операции над данными заложены?**

read, write, update

**Есть ли какой-то стейт в памяти, как он обновляется и валидируется?**

На старте не будет
С ростом нагрузки появится кэш над апдейтами конфигов

**Какая нагрузка ожидается?**

25 rps на старте
Через год – до 5k rps

**Какие фолбеки предусмотрены на сам этот сервис?**

- Если сервис недоступен, устройства работает с последним известным ему конфигом (изначально есть дефолтные конфиги на всех камерах).
– Если сервис недоступен, админка изменения конфигов камеры не работает.

**Какие фолбеки предусмотрены внутри этого сервиса на взаимодействие с другими сервисами?**

Если база недоступна, но есть кэш, отдаем данные из него.
Если нет базы и кэша, падаем.
Если недоступен signal-device-api-admin, не даем создавать патчи на камеры

**Какие возможности масштабируемости закладываются?**

Добавление кэшей, увеличение ram/cpu на инстансе, увеличение количество инстансов сервиса, шардирование базы.

**Какие точки отказа есть в сервисе?**

Отказ БД
Отказ signal-device-api-admin

**Укажите ключевые продуктовые метрики сервиса, за которыми планируете следить**

- Частота переопределения тех или иных параметров.
- Значения, на которые парки чаще перестраивают те или иные параметры

**Укажите технические метрики**

- Среднее время ответа на запрос.
- Нагрузка на БД.

**Какая функциональность ожидается в сервисе в будущем?**

Все, связанное с конфигурированием камер усталости.

**Какое изменение нагрузки планируется?**

Прямо пропорционально количеству активных камер усталости.

**Активно ли будет изменяться сервис?**

Могут появляться новые настраиваемые конфиги/новые поля в существующих конфигах.
