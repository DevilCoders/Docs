## Опросник для ревью комитетом

> Этот опросник нужен для [архитектурного ревью комитетом](https://forms.yandex-team.ru/surveys/25357/). Его можно будет скопировать.

> После его написания можно пробежаться по списку из [этой статьи](https://stackoverflow.blog/2020/04/06/a-practical-guide-to-writing-technical-specs/). Он подскажет, какие аспекты еще стоит осветить.

**Название сервиса**

taxiroute

**Какую продуктовую проблему решает сервис?**

- Вынос высоконагруженной ручки из протокола

**Почему нельзя решить эту задачу без разработки нового сервиса существующими решениями?**

- Высокий РПС - 7к на май 2022
- Средняя критичность - всетаки без ручки можно жить, но она сильно влияет на пользовательский опыт
- Низкая частота изменений кода - можно практически законсервировать ручку после переноса

**Как именно сервис будет решать поставленные перед ним задачи?**

В сервисе будет единственная ручка `3.0/taxiroute`, которая отвечает за отрисовку маршрута на карте.

**Разрабатывается один сервис или система?**

Один сервис

**Сколько и какие сервисы входят в систему?**

-

**С кем взаимодействует сервис?**

1. `order-core` - заказ
2. `driver-trackstory` - координата водителя
3. `router` - получение маршрута
4. `tariffs` - кэш тарифов для таймзоны
5. `experiments3`

**Какие базы использует?**

В данный момент базы не использует

**Какие периодические процессы?**

Периодические процессы отсутствуют

**Прикрепите схему того, где этот сервис находится в текущей инфраструктуре**

PA -> taxiroute

**Какие данные и по какой схеме сервис будет хранить в базе?**

-

**Какой объем данных будет храниться и какой объем будет изменяться в единицу времени?**

-

**Какие операции над данными заложены?**

-

**Какие данные пользователей будут храниться в сервисе?**

-
**Есть ли какой-то стейт в памяти, как он обновляется и валидируется?**

-

**Какая нагрузка ожидается?**

На начало мая 2022 - 7к рпс

**Какие фолбеки предусмотрены на сам этот сервис?**

Ручное переключение на уровне ПА, обратно на протокол

**Какие фолбеки предусмотрены внутри этого сервиса на взаимодействие с другими сервисами?**

Повторяем логику протокола - без использования фолбеков, на какие либо сервисы.

**Какие возможности масштабируемости закладываются?**

-

**Какие точки отказа есть в сервисе?**

1. `order-core`
2. `driver-trackstory`
3. `router`

**Укажите ключевые продуктовые метрики сервиса, за которыми планируете следить**

-

**Укажите технические метрики**

-

**Какая функциональность ожидается в сервисе в будущем?**

Этапы разработки:

Все сроки написаны с учетом полной занятости

1. Подготовка - 2д
    1. Настройка окружения создание сервиса и тп - 1д
    2. Обсудить особенности запросов с клиентами - 1д
2. Реализация - 18д
    1. Реализация прокси ручки и запуск трафика в тестинге через него - 3д
    2. Удаление лишний логики из протокольной реализации(разные типы авторизации, отказаться от паркового кэша и перейти на сборку driver_id из заказа, проверить и всегда отдавать плавный трек) - 9д
    3. Реализация основного функционала сервиса as is - 5д
    4. Реализация логики сравнения ответов(если это возможно) - 1д
3. Тестирование - 3д
    1. Тестирование и отладка в тестинге
4. Запуск - 9д
    1. Переключение 1% нагрузки на новый сервис через ПА в режиме прокси со сравнением
    2. Фикс багов и включение ответа сервиса на Яндексоидов, сбор фидбека
    3. Раскатка на всех 1%
    4. Раскатка на всех 10%
    5. Раскатка на всех 50%
    6. Раскатка на всех 100%
    7. Перенос других потребителей(`/integration/turboapp/v1/taxiroute`)
5. Профилирование - 3д
    1. Найти узкие места и пофиксить, для уменьшения использования СPU
6. Мониторинги - ?

Итого: 2 + 18 + 3 + 9 + 3 = 35д работы = 7 рабочих недель

**Какое изменение нагрузки планируется?**

Рост нагрузки пропорционален росту числу заказов в сервисе

**Активно ли будет изменяться сервис?**

Нет
