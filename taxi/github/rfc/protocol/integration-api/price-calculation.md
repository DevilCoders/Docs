## Задача

Для пересчета цены отложенных заказов необходимо получать в сервисе
`delayed_price_recalc` информацию о ценообразовании:
- Цены по классам
- Сурдж
- Сурчардж
- Скидки
- Декаплинг
- Метаинформацию купона

## Решение

Cначала планировали расширить для этого ответ ручки `orders/estimate`,
но отказались от этого решения, потому что эта ручка проксируется во внешние
сервисы, в которые информацию о ценообразовании отправлять недопустимо. Кроме
того, при пересчете цены нет необходимости создавать новый оффер и пин, так как
пересчет - это джоба, запускающаяся в промежутке времени от момента создания
отложенного заказа до момента назначения водителя без участия пользователя.

Решили сделать новую ручку `/price-calculation`, которая возвращает внутреннюю
информацию о ценообразовании. Ручка не проксируется во внешние сервисы, не
создает новый оффер и пин.

В идеале эта ручка должна находиться в новом сервисе ценообразования, но пока
его нет, добавляем ее в integration-api.

[API ручки](price-calculation.yaml), согласованное Сергеем Константиновым.

### Техническое решение

Берем за основу логику расчета цены и скидок в ручке `estimate`:
- Выносим из `external/estimate.cpp` код подготовки данных для калькулятора и
обобщаем `external/lookup.cpp`:
  - Делаем `users::Source` опциональным в вынесенном коде;
  - Заменяем `product_id` на вектор названий классов для мультикласса;
- Используем логику `external/lookup.cpp` для получения цен из калькулятора;
- Используем вынесенный на первом шаге код в ручках `/price-calculation` и `orders/estimate`;
- Пишем плагины для декаплинга и купона для новой ручки;
