## Идея

Смысл в том, чтобы срезать 90% времени работы routestats для адресного (главного) экрана приложения, который использует только малую часть данных. Это должно сильно визуально ускорить прорисовку ETA на старте. Цель - легковесная ручка должна работать за 200ms в p98/p99. По задаче, постройте, пожалуйста отдельные графики на это.

Есть [прототип](https://st.yandex-team.ru/TAXIBACKEND-28647), он очень сырой/кривой, только для визуальной проверки эффекта. Вики с общей идеей и сравнением прототипа [тут](https://wiki.yandex-team.ru/users/denis-isaev/Bystryjj-routstats/).

## Реализация на мобилках

Описание [тут](https://wiki.yandex-team.ru/users/denis-isaev/Bystryjj-routstats/).

Кратко: на адресном экране шлем новый параметр в `true`, указывающий, что это легковесный роутстатс. На саммари результат этого роутстатс не переиспользуем. Аккуратно обрабатываем кучу граничных случаев.

## Реализация на бэкенде

При реализации важно помнить о корнер кейсах:

1. если выбранный тарифный класс не найден - отдаем все классы, так как клиент сам выберет нужный. По логам в проде такие кейсы есть.
2. клиент использует список тарифных классов для отрисовки заглушки при переходе на саммари, отдавать классы нужно
3. клиент использует флажок "можно ли без точки Б искать"
4. возможно, клиент использует что-то еще. Алгоритм может быть таким: берем 10 больших кусков (см. комменты ((https://st.yandex-team.ru/TAXIBACKEND-28664 тут))) и по каждому из них спрашиваем меня или клиентов используются ли они, если не используются - отключаем их.
5. очень хочется отключать походы в прайсинг. В прототипе я этого не сделал.

## API

Как определять легковесность роутстатс:

1. отдельная ручка - на мобильных клиентах делать на 2-3 дня больше, на это продуктового времени не выделено.
2. существующим доп. параметром, что уже есть:

- `skip_estimated_waiting` - не подходит семантически, так как мы ETA считать то должны. Флаг нужен для отключения расчета ETA из-за кэширования на клиенте.
- `selected_class_only` - не позволяет семантически отключить купоны, прайсинг и тп, которые могут быть нужны на саммари если даже нет точки Б.
- `estimate_waiting_selected_only` - семантически аналогично не позволяет нам для одного выбранного тарифа отключать походы в прайсинг и тп.

3. новым параметром `is_lightweight: true`, который шлется на адресном экране.

Предлагаю выбрать вариант №3 - `is_lightweight`.
