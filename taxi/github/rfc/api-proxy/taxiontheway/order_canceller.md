## –ë–∏–∑–Ω–µ—Å–æ–≤–∞—è –∑–∞–¥–∞—á–∞

–î–µ–ª–∞–µ–º –Ω–æ–≤—ã–π —Ñ–ª–æ—É –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞. –ü–æ—è–≤–ª—è—é—Ç—Å—è –Ω–æ–≤—ã–µ –ø–æ–ø–∞–ø—ã —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ç–µ–∫—Å—Ç–∞–º–∏
–∏ —ç–∫—à–µ–Ω–∞–º–∏, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞. –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å
–æ—Ç–º–µ–Ω—ã. –î–æ–±–∞–≤–ª—è–µ–º —Å–∞–±—Ç–∞–π—Ç–ª –≤ –ø—Ä–∏—á–∏–Ω—ã –æ—Ç–º–µ–Ω.

https://st.yandex-team.ru/TAXIPROJECTS-2055

–í –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–µ https://st.yandex-team.ru/TAXIBACKEND-24380 –†—É—Å–ª–∞–Ω –ê–ª–∏–µ–≤ —É–∂–µ –Ω–∞—á–∞–ª
–∏–∑—É—á–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–Ω–æ—Å–∞ –ª–æ–≥–∏–∫–∏ –æ—Ç–º–µ–Ω –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å [order_canceller.md](https://github.yandex-team.ru/taxi/rfc/blob/467fa0c6a857f81d6e95bf754cf91fb55c31b271/api-proxy/taxiontheway/order_canceller.md).

–°–≤–æ—é –ø—Ä–æ—Ä–∞–±–æ—Ç–∫—É –¥–µ–ª—é –≤ —ç—Ç–æ–º –∂–µ —Ñ–∞–π–ª–µ –∏ –¥–æ–ø–æ–ª–Ω—é –ø—Ä–æ—Ä–∞–±–æ—Ç–∫—É –†—É—Å–ª–∞–Ω–∞.

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å

–ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Å—Ç, –≥–¥–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ª–æ–≥–∏–∫–∞ —Å–≤—è–∑–∞–Ω–Ω–∞—è —Å –æ—Ç–º–µ–Ω–æ–π –∑–∞–∫–∞–∑–∞.

–í —Ä—É—á–∫–µ zoneinfo `zoneinfo.supported_feedback_choices.cancelled_reason` –ø—Ä–∏—Ö–æ–¥–∏—Ç
—Å–ø–∏—Å–æ–∫ –ø—Ä–∏—á–∏–Ω –¥–ª—è –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏—á–∏–Ω,
—É–∂–µ –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –æ—Ç–º–µ–Ω–∏–ª –∑–∞–∫–∞–∑.

–ö–ª–∏–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞–µ—Ç –≤ —Ä—É—á–∫–µ taxiontheway –æ–±—ä–µ–∫—Ç `cancel_rules`, [–æ–ø–∏—Å–∞–Ω–∏–µ –µ—Å—Ç—å —Ç—É—Ç](https://github.yandex-team.ru/taxi/backend-cpp/blob/38531553c86063286f7c7820067f6a7678218a40/protocol/docs/protocol/yaml/taxiontheway.yaml#L180)
–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ —ç—Ç–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑. –ö–ª—é—á
–ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –±–µ—Ä–µ—Ç—Å—è —á–∞—Å—Ç—å —Ç–µ–∫—Å—Ç–æ–≤ –µ—Å—Ç—å –≤ totw.cancel_rules, –≤–∏–¥ —ç–∫—Ä–∞–Ω–∞ –∑–∞–≤–∏—Å–∏—Ç
–æ—Ç totw.cancel_rules.state.

–û—Ç–º–µ–Ω–∞ –¥–µ–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ä—É—á–∫—É /taxiontheway.

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

–° –±—ç–∫–∞ –¥–æ–ª–∂–Ω—ã –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª—è:

- –∑–∞–≥–æ–ª–æ–≤–æ–∫/—Ç–µ–∫—Å—Ç –ø–æ–ø–∞–ø–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–º–µ–Ω—ã
- –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ –ø–æ–ø–∞–ø–µ (—Å–º–µ–Ω–∏—Ç—å —Ç–æ—á–∫—É –ê/–ë, –ø–æ–∑–≤–æ–Ω–∏—Ç—å –≤–æ–¥–∏—Ç–µ–ª—é –∏ –¥—Ä.)
- —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ—Ç–º–µ–Ω—ã
- —Ç–µ–∫—Å—Ç—ã –¥–ª—è –æ–∫–Ω–∞ –ø–æ—Å–ª–µ –æ—Ç–º–µ–Ω—ã, –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å —Å—Ç–æ–∏–º–æ—Å—Ç—å

–ü–æ—Å–ª–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è —Å –í–æ–ª–æ–¥–µ–π –≤—ã—è—Å–Ω–∏–ª–æ—Å—å —á—Ç–æ –¥–ª—è —É–±–µ—Ä–∞ —Ç–æ–∂–µ —Ö–æ—Ç—è—Ç —Å–¥–µ–ª–∞—Ç—å
–¥–æ—Ä–∞–±–æ—Ç–∫—É –Ω–∞ —ç–∫—Ä–∞–Ω–µ –æ—Ç–º–µ–Ω. –¢–∞–∫–∂–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–≤–æ–¥–∏—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è
—ç–∫—Ä–∞–Ω–∞ –æ—Ç–º–µ–Ω. –î–ª—è —Å—Ç–∞—Ç—É—Å–∞ search –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç
–ø—Ä–æ—à–µ–¥—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏. –ü—Ä–∏–º–µ—Ä: —á–µ—Ä–µ–∑ N –º–∏–Ω—É—Ç/—Å–µ–∫—É–Ω–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥—Ä—É–≥–æ–π —Ç–µ–∫—Å—Ç –æ —Ç–æ–º
—á—Ç–æ –¥–æ–ª–≥–∏–π –ø–æ–∏—Å–∫.

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

–í –¥–∞–Ω–Ω–æ–º –±–ª–æ–∫–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ API –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –≤–∞—Ä–∏–∞–Ω—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ –±—ç–∫–µ.

### –ü–æ–ø–∞–ø

–î–µ–ª–∞–µ–º –Ω–æ–≤—É—é —Ä—É—á–∫—É –≤ —Å–µ—Ä–≤–∏—Å–µ order-parts (–í–æ–ª–æ–¥—è –ø–æ—Å–æ–≤–µ—Ç–æ–≤–∞–ª —ç—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å),
–∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –Ω—É–∂–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã. –ü–æ–¥–∫–ª—é—á–∞–µ–º —ç—Ç—É —Ä—É—á–∫—É –≤ totw —á–µ—Ä–µ–∑
api-proxy –∏ —Ö–æ–¥–∏–º –ø–æ–¥ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–º (—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤).

–í api-proxy –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –∫–ª—é—á –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è `order_id + —Å—Ç–∞—Ç—É—Å`:

- –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ search 30—Å–µ–∫-1–º–∏–Ω (–Ω—É–∂–Ω–æ –ø–æ–¥—É–º–∞—Ç—å)
- –≤ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞ (–ø–æ–¥—É–º–∞—Ç—å: –ø–ª–∞—Ç–Ω–∞—è/–±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –æ—Ç–º–µ–Ω–∞)
- –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ waiting –æ—Ç–∫–ª—é—á–∞–µ–º –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ç–∫ —Ü–µ–Ω–∞ –≤–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏

–î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ø–∞–ø–æ–≤ –ø—Ä–∏–≤–æ–¥–∏–º –æ–±—ä–µ–∫—Ç cancel_rules –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–∏–¥—É:

```json5
{
    "cancel_rules": {
        "state": "free",
        "confirmation_notification": {
            "allowed_changes": [
                {
                    "image_tag": "other_allowed_change_test",
                    "name": "test",
                    "text": "–ò–∑–º–µ–Ω–∏—Ç—å —á—Ç–æ-—Ç–æ",
                },
                {
                    "image_tag": "other_allowed_change_extra_test",
                    "name": "extra_test",
                    "text": "–ò–∑–º–µ–Ω–∏—Ç—å —á—Ç–æ-—Ç–æ –µ—â—ë",
                },
            ],
            "cancel_button": {"title": "–ù–∞–∑–∞–¥"},
            "confirm_button": {
                "subtitle": "–ó–∞ 199 $SIGN$$CURRENCY$",
                "title": "–î–∞, –æ—Ç–º–µ–Ω–∏—Ç—å",
            },
            "text": "–ë—É–¥–µ—à—å –¥–æ–ª–∂–µ–Ω",
            "title": "–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑?",
        },
    }
}
```

–ü–æ–ª–µ `allowed_changes` –∏–º–µ–µ—Ç —Å—Ö–æ–∂–∏–π —Ñ–æ—Ä–º–∞—Ç, –∫–∞–∫ –∏ –≤ —Ç–æ—Ç–≤–µ, –ø–µ—Ä–µ–¥–∞–µ–º —Å–ø–∏—Å–æ–∫
—ç–∫—à–µ–Ω–æ–≤ –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç. –ù–∞ MVP –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ 2 —ç–∫—à–µ–Ω–∞:
–∏–∑–º–µ–Ω–∏—Ç—å –ø—É–Ω–∫—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∏ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –≤–æ–¥–∏—Ç–µ–ª–µ–º.

–ü—Ä–µ–¥–ª–∞–≥–∞—é —Å–¥–µ–ª–∞—Ç—å —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –¥–ª—è –±—ç–∫–∞, –æ—Ç–∫—É–¥–∞ –±—É–¥–µ–º –±—Ä–∞—Ç—å —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π
–∏ –≤—Å–µ –Ω—É–∂–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤. –î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç
—Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞, —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã, –∞–ø–ø–∞ –∏ –Ω–∞–ª–∏—á–∏—è –ø–ª–∞—Ç–Ω–æ–π –æ—Ç–º–µ–Ω—ã –Ω–∞
—Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç.

–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–Ω–∫–µ—Ä–Ω—ã—Ö –∫–ª—é—á–µ–π –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –≤ –∫–æ–¥–µ, –∞ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –±—É–¥–µ—Ç
–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ—Å—Ç–æ–π. –í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –Ω—É–∂–Ω–æ —è–≤–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤—Å–µ –∫–ª—é—á–∏, –∫–æ—Ç–æ—Ä—ã–µ
–º–æ–≥—É—Ç –ø–æ–ª—É—á–∏—Ç—å—Å—è.

–ü–æ–ª–µ `state_change_estimate` —É–¥–∞–ª—è–µ–º, —Ç–∫ –æ–Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞—Ö.

–ü–æ–ª–µ `message_support` –∏ `message_key` –Ω–µ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –Ω–æ–≤—ã—Ö
–∫–ª–∏–µ–Ω—Ç–∞—Ö.

–£—Ç–æ—á–Ω–∏–ª —É –∫–ª–∏–µ–Ω—Ç–æ–≤, –ø–æ—Ö–æ–∂–µ, —á—Ç–æ –ø–æ–ª–µ `show_text` –Ω–∏–∫–æ–≥–¥–∞ –Ω–∞–º –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç.
–í—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫ —á—Ç–æ –µ–≥–æ –º–æ–∂–Ω–æ –≤—ã–ø–∏–ª–∏—Ç—å –∏ —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫ —á—Ç–æ –±—ã —Ç–µ–∫—Å—Ç—ã –ø—Ä–∏—Ö–æ–¥–∏–ª–∏
–≤—Å–µ–≥–¥–∞.

### –ü—Ä–∏—á–∏–Ω—ã –æ—Ç–º–µ–Ω

–í —Ä—É—á–∫–µ zoneinfo –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å–ø–∏—Å–æ–∫ –ø—Ä–∏—á–∏–Ω –¥–ª—è –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞.

```json5
{
    "supported_feedback_choices": {
        "cancelled_reason": [
            {
                "label": "–ü–µ—Ä–µ–¥—É–º–∞–ª",
                "name": "mistaken"
            },
            // ...
            {
                "label": "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≤—è–∑–∞—Ç—å—Å—è —Å –≤–æ–¥–∏—Ç–µ–ª–µ–º",
                "name": "noreply"
            }
        ]
    }
}
```

–°–æ–≥–ª–∞—Å–Ω–æ –º–∞–∫–µ—Ç—É –≤ —Ñ–∏–≥–º–µ, —Ö–æ—Ç–∏–º –ø–∏—Å–∞—Ç—å —Å–∞–±—Ç–∞–π—Ç –ø–æ–¥ –ø—Ä–∏—á–∏–Ω–æ–π –æ—Ç–º–µ–Ω—ã. –î–æ–±–∞–≤–ª—è–µ–º
–Ω–æ–≤–æ–µ –ø–æ–ª–µ `text`

```json5
{
    "supported_feedback_choices": {
        "cancelled_reason": [
            {
                "name": "mistaken",
                "label": "–ü–µ—Ä–µ–¥—É–º–∞–ª",
                "text": "–ü–æ—Å—Ç–∞—Ä–∞–π—Ç–µ—Å—å –±–æ–ª—å—à–µ –Ω–µ –æ—Ç–º–µ–Ω—è—Ç—å ‚Äî –≤–æ–¥–∏—Ç–µ–ª–∏ –≥—Ä—É—Å—Ç—è—Ç üòî",
            }
            // ...
        ]
    }
}
```

–°—É–¥—è –ø–æ –∫–æ–¥—É, –ø—Ä–∏—á–∏–Ω—ã –æ—Ç–º–µ–Ω –¥–æ–ª–∂–Ω—ã –±—ã–ª–∏ –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ —Å–µ—Ä–≤–∏—Å–µ feedback, —Ç–∞–º
–¥–∞–∂–µ –µ—Å—Ç—å —Ç–∞–∫–∞—è —Ä—É—á–∫–∞ –∏ –≤ –∫–æ–¥–µ zoneinfo –µ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥ –∫–æ—Ç–æ—Ä—ã–π –≤–∫–ª—é—á–∞–µ—Ç –ø–æ—Ö–æ–¥ –≤
—ç—Ç—É —Ä—É—á–∫—É. –ü–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–º –ø—Ä–∏—á–∏–Ω–∞–º —ç—Ç–æ—Ç –∫–æ–Ω—Ñ–∏–≥ –≤—ã–∫–ª—é—á–µ–Ω (–∏ –≤ —Ä—É—á–∫—É –Ω–µ —Ö–æ–¥–∏–º).
–°–ª–µ–¥—É–µ—Ç –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ä—É—á–∫—É ... –≤ –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å feedback-passengers –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å —ç—Ç—É
—Ä—É—á–∫—É —á–µ—Ä–µ–∑ api-proxy. –ê –∫–æ–¥ –∏–∑ zoneinfo –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã–ø–∏–ª–∏—Ç—å.

### –°—Ç–æ–∏–º–æ—Å—Ç—å –æ—Ç–º–µ–Ω—ã

–•–æ—Ç–∏–º –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–ª–∞—Ç–Ω–æ–π –æ—Ç–º–µ–Ω—ã, –¥–æ –º–æ–º–µ–Ω—Ç–∞ –æ—Ç–º–µ–Ω—ã –Ω–∞ –∫–Ω–æ–ø–∫–µ
"–û—Ç–º–µ–Ω–∏—Ç—å" –∏ –Ω–∞ –∫–æ–ø–∫–µ –≤–Ω—É—Ç—Ä–∏ –ø–æ–ø–∞–ø–∞.

–î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ –ø–æ–ª–µ `cost` –≤ `cancel_rules` –µ—Å–ª–∏ –æ—Ç–º–µ–Ω–∞ –ø–ª–∞—Ç–Ω–∞—è –∏ –º—ã —Å–º–æ–≥–ª–∏
–≤—ã—á–∏—Å–ª–∏—Ç—å —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ.
`currency_rules` –≤ –æ—Ç–≤–µ—Ç–µ totw'–∞ —É–∂–µ –µ—Å—Ç—å. –î–æ—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –±—ç–∫–µ –≤—ã–≥–ª—è–¥–∏—Ç –Ω–µ—Å–ª–æ–∂–Ω–æ,
–Ω—É–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –º–µ—Ç–æ–¥ [CalcPaidCancelCost](https://github.yandex-team.ru/taxi/backend-cpp/blob/b6face883085c3986d905ffa4d1731a6dccdb67f/protocol/lib/src/orderkit/order_canceller.cpp#L751https://github.yandex-team.ru/taxi/backend-cpp/blob/b6face883085c3986d905ffa4d1731a6dccdb67f/protocol/lib/src/orderkit/order_canceller.cpp#L751)
—É –æ–±—ä–µ–∫—Ç–∞ `order_canceller` –∏ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –æ—Ç–≤–µ—Ç.

–ú–æ–∂–µ—Ç —Å–ª—É—á–∏—Ç—Å—è —Ç–∞–∫, —á—Ç–æ –ø–æ—Å–ª–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ø–∞–ø–ø–∞ —Å –æ–¥–Ω–æ–π —Ü–µ–Ω–æ–π, –∑–∞–∫–∞–∑ –Ω–∞ —Å–∞–º–æ–º
–¥–µ–ª–µ –æ—Ç–º–µ–Ω–∏—Ç—Å—è –ø–æ –¥—Ä—É–≥–æ–π —Ü–µ–Ω–µ. –î–ª—è —Ç–∞–∫–∏—Ö –∫–µ–π—Å–æ–≤ –Ω—É–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é,
–ø–æ—á–µ–º—É —Ç–∞–∫–æ–µ –º–æ–≥–ª–æ —Å–ª—É—á–∏—Ç—å—Å—è. –î–ª—è —ç—Ç–æ–≥–æ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –æ—Ç–≤–µ—Ç "different_cost_popup"

different_cost_popup - –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ

```json5
{
    "cancel_rules": {
        "cost": 100.0,
        // ...
        "different_cost_popup": {
            "title": "–ò—Ç–æ–≥–æ –∑–∞ –æ—Ç–º–µ–Ω—É: 100 $SIGN$$CURRENCY$",
            "text": "–û–±—ä—è—Å–Ω—è–µ–º –≤ —á–µ–º –ø—Ä–∏—á–∏–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è",
            "confirm_button": "–Ø—Å–Ω–æ"
        }
    }
}
```

### –î–æ—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–≥–∏–∫–∏ –æ—Ç–º–µ–Ω—ã

–ú–æ–∂–Ω–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ —É–ª—É—á—à–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–¥–∞. –í—ã–ø–∏–ª–∏–≤–∞–µ–º –ª–æ–≥–∏–∫—É –æ—Ç–º–µ–Ω—ã –∏–∑
–ø—Ä–æ—Ç–æ–∫–æ–ª—å–Ω–æ–≥–æ —Ç–æ—Ç–≤–∞ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä—É—á–∫–∏ /v1/tc/order-cancel –≤
order-core.

–°–∞–º–∞ –ª–æ–≥–∏–∫–∞ –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞ —É–∂–µ –µ—Å—Ç—å –≤ order-core. –ù—É–∂–Ω–æ –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–µ–º–Ω–æ–≥–æ
–¥–æ–ø–∏–ª–∏—Ç—å —Ä—É—á–∫—É —É –Ω–∏—Ö, —á—Ç–æ –±—ã –æ–Ω–∞ –ø—Ä–∏–Ω–∏–º–∞–ª–∞ —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ—Ç–º–µ–Ω—ã (—Å—á–∏—Ç–∞–µ–º –≤
–ø—Ä–∞–π—Å–∏–Ω–≥–µ) –∏ –æ–±–Ω–æ–≤–ª—è–ª–∞ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –º–æ–Ω–≥–µ. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –≤—ã–ø–∏–ª–∏—Ç—å –∏–∑
totw –∫–æ–¥ –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞–∞ –æ—Ç–º–µ–Ω—É –∑–∞–∫–∞–∑–∞. API –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∏–∫–∞–∫ –Ω–µ
–ø–æ–º–µ–Ω—è–µ—Ç—Å—è.

> –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∞ –†—É—Å–ª–∞–Ω–∞, –æ—Å—Ç–∞–≤–∏–ª –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ó–∞–≤–æ–¥–∏–º –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –∑–∞ –≤–æ–ø—Ä–æ—Å—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –æ—Ç–º–µ–Ω–æ–π –∑–∞–∫–∞–∑–∞: 
–ø—Ä–∞–≤–∏–ª–∞ –æ—Ç–º–µ–Ω—ã –∏ —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏. –ú–æ–∂–Ω–æ –∫—Å—Ç–∞—Ç–∏ –µ—â–µ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–µ–¥—Ä–∞—Å—á–µ—Ç –æ—Ç–º–µ–Ω—ã, —á—Ç–æ–±—ã
–º–æ–∂–Ω–æ –±—ã–ª–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —é–∑–µ—Ä—É —Ç–æ—á–Ω–æ, —Å–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç —Å—Ç–æ–∏—Ç—å –æ—Ç–º–µ–Ω–∞.

### API

–†—É—á–∫–∞ `POST /v1/cancel`:

–û—Ç–º–µ–Ω—è—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–π –∑–∞–∫–∞–∑ –ø–æ id.

```json
{
    "order_id": "some_order_id"
}
```

```json
{
    "cost_message": "–û—Ç 100‚ÄÜ$SIGN$$CURRENCY$",
    "cost": 100,
    "cost_message_details": {},
    "final_cost": 100
}
```

–†—É—á–∫–∞ `GET /v1/cancel_info`:

–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞. –°—Ç–æ–∏–º–æ—Å—Ç—å –æ—Ç–º–µ–Ω—ã, —Ç–µ–∫—Å—Ç—ã –¥–ª—è –ø–æ–ø–∞–ø–∞, –ø—Ä–∏—á–∏–Ω—ã –æ—Ç–º–µ–Ω—ã. 

```json
{
    "order_id": "some_order_id"
}
```

```json
{
    "cancel_disabled": false,
    "cancel_rules": {},
    "free_cancel_for_reason": false,
    "cancelled_by": ""
}
```

### v1/cancel
–¢–∞–∫ –∫–∞–∫ –º–µ—Å—Ç–æ —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–∫–æ–º —É –Ω–∞—Å –æ–¥–Ω–æ –∏ —ç—Ç–æ order-core, –∞ –æ—Ç–º–µ–Ω–∞ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ –ø—Ä–æ–∫, —Ç–æ –ø–ª–∞–Ω —Ç–∞–∫–æ–π:
1. –°—á–∏—Ç–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ—Ç–º–µ–Ω—ã —Å –ø–æ–º–æ—â—å—é –ø—Ä–∞–π—Å–∏–Ω–≥–∞
2. –í—ã–∑—ã–≤–∞–µ–º —Ä—É—á–∫—É order-core/order-cancel, –ø–µ—Ä–µ–¥–∞–µ–º –≤ –Ω–µ–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ—Ç–º–µ–Ω—ã –∏ –æ–Ω–∞ —É–∂–µ –ø—Ä–∞–≤–∏—Ç –ø—Ä–æ–∫.
####  Fallback
4** –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º
500 - –Ω–∞–º –Ω—É–∂–Ω–æ –≤—Å–µ-—Ç–∞–∫–∏ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑, –ø–æ—ç—Ç–æ–º—É –∏–ª–∏ —Ä–µ—Ç—Ä–∞–∏ –∏–∑ api-proxy –∏–ª–∏ 500 –∏ —Ä–µ—Ç—Ä–∞–∏

### v1/cancel_info
–ü—Ä–∞–≤–∏–ª–∞ –æ—Ç–º–µ–Ω—ã, —Å —É—á–µ—Ç–æ–º —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–∫–∞–∑–∞.
–ö–µ–º –±—ã–ª –æ—Ç–º–µ–Ω–µ–Ω –∑–∞–∫–∞–∑, –µ—Å–ª–∏ –æ–Ω –æ—Ç–º–µ–Ω–µ–Ω.
####  Fallback
–º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å.

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
1. –ü–æ —Å—É—Ç–∏, —ç—Ç–æ –≤—ã–Ω–µ—Å–µ–Ω–∏–µ –≤ —Å–µ—Ä–≤–∏—Å OrderCanceller –∏–∑ backend-cpp. –¢–æ–ª—å–∫–æ —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–µ–¥–µ—Ç –Ω–∞ –ø—Ä–∞–π—Å–∏–Ω–≥.
2. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–ª—é—Å: –∏–Ω—Ç-–∞–ø–∏ —Å–º–æ–∂–µ—Ç –º–æ–≥–ª–∞ –±—ã —Ç–æ–∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —ç—Ç–∏–º —Å–µ—Ä–≤–∏—Å–æ–º. 
