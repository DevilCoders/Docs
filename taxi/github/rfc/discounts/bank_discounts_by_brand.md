## Поддержка банковских скидок в различных брендах


### Как работает сейчас?

#### Создание скидки
Скидки заводятся в админке https://tariff-editor.taxi.yandex-team.ru/discounts2/user

Характерным параметром банковской скидки является поле "Фильтр по бинам", где указываются бины банковских карт, по которым в будущем можно определить платежную систему.

#### Использование скидки

__/3.0/routestats__

В `/3.0/routestats` для каждого тарифа происходит поиск подходящей скидки. 

Я.Плюс - это не скидка, а price modifier, поэтому вычисляется отдельно и может сочетаться со скидкой.

Если скидка нашлась, то пытаемся получить тег скидки, который затем передаем клиентам, чтобы они отобразили соответствующую информацию о скидке. Тег определяется по бину, указанному в скидке. Скидка может комбинироваться с Я.Плюс.

Существующие теги: _['ya_plus', 'mastercard', 'ya_plus_mastercard', 'visa']_


__/3.0/zoneinfo__

В ручке `/3.0/zoneinfo` отдаются доступные тарифы, а в тарифах прописаны тексты для потенциально возможных скидок, идентификатором скидки служит вышеуказанный тег.


### Проблемы в текущей схеме

1. Сейчас в логике происходит жесткое разделение Visa для Uber и Я.Плюс+Mastercard для yataxi/yango, в итоге информирование о скидках Visa в yataxi нет.

2. Для платежных систем у нас разные конфиги:
    - эксперимент для Mastercard https://tariff-editor.taxi.yandex-team.ru/experiments/users/edit/mastercard_discount
    - конфиг для Visa https://tariff-editor.taxi.yandex-team.ru/dev/configs/edit/VISA_DISCOUNT_PLATFORMS

3. Тексты для клиентов прописываются в виде танкерных ключей при создании скидки без разделения на бренды, в итоге во всех брендах у нас одинаковая нотификация.

### Что хотим?
1. Возможность отображать информацию о банковских скидках в любом приложении
2. Иметь единую сущность управления отображением для разных платежных систем
3. Уметь настраивать тексты для разных приложений
4. Вынести логику из `/3.0/zoneinfo` и `/3.0/routestats` в отдельный микросервис


### Задачи

#### Успех 1:

В приложениях yataxi/yango виден текст для скидки Visa (убрать жесткую привязку Visa к Uber)

_Задачи:_
- [1SP] в `/3.0/zoneinfo` для yataxi/yango научиться возвращать текст скидки Visa, если она доступна.

  Формат возвращаемых данных должен соотвествовать приложению yataxi/yango.
  
  Убедиться, что тексты скидок универсальные по приложениям yataxi/yango/yauber.
  
  Дополнительно: поддержать скидку Я.Плюс+Visa.

  см.
  - void BrandingBuilder::BuildDiscount(...)
  - https://tariff-editor.taxi.yandex-team.ru/dev/configs/edit/VISA_DISCOUNT_PLATFORMS


#### Успех 2:

Создать новый микросервис, который будет отвечать за клиентские тексты для скидок.

Привести эксперимент для Mastercard и конфиг для Visa к единобразию или объединить, чтобы:
1. Была понятна структура настройки отображения различных банковских скидок
2. Можно было настраивать отображение скидок по брендам
3. Иметь возможность кастомизировать тексты скидок по брендам

_Задачи:_
- [3SP] Проработать микросервис и взаимодействие с ним
- [1SP] Привести эксперимент для Mastercard и конфиг для Visa к единобразию или объединить
- [2SP] Реализовать микросервис
- [2SP] Использовать новый микросервис в `/3.0/zoneinfo` и `/3.0/routestats`
