# Процесс взаимодействия лаборатории с Яндексом

Ниже описана схема взаимодействия лаборатории с Яндексом посредством вызовов [HTTP API](../ref/about.md).

## 1. Регистрация заявки

Ежедневно, в начале дня лаборатория должна [получать список заявок](../ref/get-buckets.md) на текущую дату. Полученные заявки необходимо регистрировать 
в лабораторной информационной системе (ЛИС). 

После того как заявки будут зарегистрированы в ЛИС, лаборатория должна сообщить об этом Яндексу. Для этого нужно [выставить статус заявки](../ref/set-lab-status.md) в 
 `registered`.
 
Как только статус заявки будет выставлен в `registered`, Яндекс будет считать, что заявка обработана и лаборатория готова к проведению теста.
 
## 2. Подготовка комплектов документов {#prepare-documents}

Для каждой заявки необходимо подготовить комплект документов: 

 - запечатанный конверт с расходным материалом (пустым контейнером);
 - стикер с напечатанным штрихкодом;
 - договор / согласие между лабораторией и пациентом. На договоре должен быть указан штрихкод, который совпадает со штрихкодом на стикере.
 
{% note "Примечание."%}
Договор необходимо предварительно заполнить данными пациента. Это ускорит работу медработника — при посещении пациента у него уже будет подготовленный бланк договора.
{% endnote %} 
    
Каждый комплект запечатывается в отдельный конверт, на котором следует проставить данные: штрихкод, номер заявки, ФИО и адрес пациента.

Конверты сканируются лабораторией и раскладываются по сумкам (номера сумок содержатся в [ответе API](../ref/get-buckets.md#response) в полях `buckets.id`).
При сканировании конверта лаборатория должна [сообщить](../ref/put-barcode.md) Яндексу номер, закодированный в штрихкоде. Этот номер будет соответствовать номеру заявки. 

## 3. Выезд к пациентам и сбор материала

В назначенное время водитель прибывает в лабораторию. Медработник забирает необходимую сумку и выезжает с водителем по маршруту, соответствующему номеру сумки. 
Водитель будет двигаться по списку адресов, указанных в приложении «Помощь рядом».

Когда медработник прибудет на адрес, ему необходимо:

1. Через приложение просканировать штрихкод : сначала на договоре, затем на распечатанном стикере (см. пункт [Подготовка комплектов документов](#prepare-documents)). 
Это необходимо для того, чтобы у Яндекса была точная связь между комплектом документов по заявке и контейнером.
 После того как оба штрихкода просканированы, в Яндекс будет автоматически отправлен статус заявки «прибыл на адрес».

2. Проверить документы у пациента, после чего подписать договор / согласие.

3. Взять биоматериал.

4. В присутствии пациента наклеить штрихкод на контейнер.
 
5. После того как биоматериал взят, повторно просканировать штрихкод на контейнере — будет автоматически отправлен статус
 «материал взят». 
 
6. Сложить контейнер и подписанные документы в конверт и далее в сумку.

{% note "Примечание."%}
Приложение будет подсказывать медработнику последовательность действий — в виде пошаговой инструкции. Медработник должен будет следовать указаниям, фиксируя ход выполнения теста.
{% endnote %}

По окончании смены водитель доставит медработника обратно в лабораторию.

## 4. Выполнение теста

Когда лаборатория получит биоматериал, необходимо:

1. Просканировать штрихкод на контейнере и зарегистрировать прибытие материала в ЛИС.
2. Сообщить Яндексу о прибытии биоматериала — [установить статус заявки](../ref/set-lab-status.md) в `delivered`.
3. Выполнить тест.

## 5. Уведомление о результатах теста

Когда тест будет завершен, лаборатория должна зафиксировать результаты в своей системе и уведомить пациента о результатах.

После этого необходимо сообщить Яндексу об окончании теста — [установить статус заявки](../ref/set-lab-status.md)
 в `completed`.
 
 Если тест выполнить не удалось, следует выставить статус `error`. При необходимости можно указать сопутствующий комментарий (в поле `reason` в теле запроса).