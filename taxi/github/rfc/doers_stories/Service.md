**Название сервиса**

doers_stories

**Какую продуктовую проблему решает сервис?**

Загрузка и удаление видео сторис для сервиса DOERS. Получение уникальных ссылок на контент лежащих на MDS.

**Почему нельзя решить эту задачу без разработки нового сервиса существующими решениями?**

Сервис potok формирует ленту для пользователя и при формировании необходимо для каждого заведения возвращать ссылку на сторис о его месте. Также для разгрузки и для того чтобы в будущем оставить возможность для обработки видео на сервере логично выделить сторис в отдельный микросервис.

Сервис будет заниматься:
1. Загрузка видео на MDS хранилище(на стадии MVP будет работать в качестве прокси потом возможна постобработка контента) и сохранение информации о видео
2. Удаление видео и сопутствующей метаинформации
3. Изменение конкретного видео в профиле пользователя
4. Возврат уникальной временной ссылки на контент пользователя,лежащий на MDS
5. Верификация видео пользователя (на стадии проработки, вероятно будет интеграция с Яндекс толокой)
6. Возвратом и хранением контента для онбордингов


**Как именно сервис будет решать поставленные перед ним задачи?**

1. Сервис получает видео и метаинформацию от клиента(пользователь валидируется с помощью сервиса doers_potokи) и кладёт его в MDS, метаинформация кладётся в Postgres
2. При запрросе сервисом doers_potok генерируется временная ссылка для получения видео с MDS
3. Аналогично удаление чистит ссылки из листа видео пользователя

**Разрабатывается один сервис или система?**

Один сервис.

**С кем взаимодействует сервис?**

1. Клиентское приложение - получение изначального контентента и сопутствующей инфы
2. MDS - хранение видео
3. С doers_potok - отправка временных ссылок на контент, валидация пользователя

**Какие базы использует?**

Postgres, MDS

**Какие периодические процессы?**

Нет.

**Планируется обработка персональных данных**

Да.

**Какие данные и по какой схеме сервис будет хранить в базе?**

В начале планируется хранение данной метаинфы, потом возможно расширение

```javascript
{
  "id": "айдишник стоисов",
  "user_id": "айдишник юзера",
  "created_at": "таймстамп",
  "verified": "отметка о верификации видео пользователя"
  "s3_path" : "Ссылка на видео лежащее на MDS" 
}
```
**Какой объем данных будет храниться и какой объем будет изменяться в единицу времени?**

MDS - хранение до 6Tb изменение до 30Mb/s

Postgres - хранение до 100Mb изменение до 20Kb/s

**Какие операции над данными заложены?**

Сreate
Get
Delete
Update

**Есть ли какой-то стейт в памяти, как он обновляется и валидируется?**

Нет.

**Какая нагрузка ожидается?**

В пике не больше 70 RPS в среднем около 12.

**Какие фолбеки предусмотрены на сам этот сервис?**

Если сервис недоступен - сервис doers_potok на запрос ленты тоже должен возвращать 500 ошибку.

**Какие фолбеки предусмотрены внутри этого сервиса на взаимодействие с другими сервисами?**

Если недоступен MDS или PostgreSQL - сервис также недоступен.

**Какие возможности масштабируемости закладываются?**

Увеличение базы, увеличение ram/cpu на инстансе, увеличение количество инстансов сервиса.

**Какие точки отказа есть в сервисе?**

- Отказ Postgres
- Отказ MDS

**Укажите ключевые продуктовые метрики сервиса, за которыми планируете следить**

- Частота смены видео профиля пользователя.
- Частота удалений видео профиля пользователя

**Укажите технические метрики**

- Количество запросов.
- Максимальное и среднее время ответа на запросы по типам запросов.
- Размер базы.

**Какая функциональность ожидается в сервисе в будущем?**

Постобработка видео

**Какое изменение нагрузки планируется?**

Прямо пропорционально количеству пользователей.

**Активно ли будет изменяться сервис?**

Нет