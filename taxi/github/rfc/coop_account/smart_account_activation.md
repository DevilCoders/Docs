### Проблема

Сейчас аккаунты активируются просто вызовом из py2 при оплате заказа ручки {shared-payments}/internal/coop_account/activate с передачей туда id аккаунта. Поэтому существует возможность активировать аккаунт и дать возможность по нему заказать, даже если на аккаунте есть непогашенный долг.

То есть сейчас нужно производить активацию гарантированно из места, где снимется долг с долгового заказа. К тому же, надо быть уверенным, что нет 2ух долговых заказов одновременно, так как иначе оплата одного приводит к активации аккаунта, на котором по прежнему висит долговой заказ.

### Что делать

Для увеличения надёжности механизма активации можно при активации/деактивации аккаунта передавать id заказа по которому производятся эти операции. В сервисе shared-payments досоздать таблицу debts. При деактивации аккаунта писать в таблицу номер заказа, по которому происходит деактивация. При активации аккаунта удалять номер заказа, по которому происходит активация, а затем проверять есть ли на аккаунте долговые заказы, активировать только если их нет.

#### Таблица

Таблицу создать максимально простую с двумя столбцами account_id (primary key) и order_id (unique).

Сейчас аккаунтов с долгом около 11 тыс (из 5 млн). По идее, одна строка таблицы будет весить примерно 64 байта (2 id по 32 байта).  То есть для 11 тыс долговых аккаунтов (если предполагать, что они вырубаются после одного долгового заказа) таблица займёт в пределах 1 Мб, что не создаст проблем с базой shared-payments

#### Миграция

1. Сначала добавить опционально принимаемые поля order_id в ручки активации/деактивации и использовать новую логику, только если это поле пришло;
2. В py2 под конфигом начать передавать поле order_id (те аккаунты, по которым при переключении не произойдёт деактивация новым способом, фактически активируются по старой логике, так как при активации на них не окажется уже ни одного долгового заказа. То есть ничего не поломается);
3. Начать из py2 всегда отправлять order_id в ручки активации.

#### Инфо о долгах для дьюти

Надо будет расширить ручку /v1/admin/detail, добавив в неё информацию о долговых заказах. Это позволит быстрее разбирать некоторые дьюти-таски.

Затем запросить правку админки у фронтов.
