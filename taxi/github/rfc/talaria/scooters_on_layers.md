# Задача

Для возможности забронировать самокат Yango Wind необходимо отображать самокаты Wind на карте главного экрана + предоставить пользователю несколько точек входа:
  - турбокнопка/кирпичик "Самокаты" на шторе главного экрана
  - самокаты/парковки с самокатами на карте главного экрана

**Требования:**
- отображать только те самокаты, которые входят в bbox (при движении пина делать перезапрос с новым bbox)
- при тапе на самокат/парковку на карте главного экрана открывается приложение Wind (если есть возможность конкретного оффера, то будет супер)
- остальные объекты на карте, такие как: зоны замедления, зоны парковок и тд не отображаем на главном экране
- при тапе на турбокнопку/кирпичик открывается discovery режим, где есть: карта, парковки самокатов, самокаты (одиночные или на парковках), штора с кнопками QR сканера и поддержки 
- при тапе на самокат/парковку на карте discovery режима открывается приложение Wind

Фигма: https://www.figma.com/file/5j1kNertXy5bF4dQPcHq7s/Talaria?node-id=776%3A37193


**Зачем это делать**:

С продуктовой точки зрения мы сможем посмотреть на то какой приток пользователей будет у wind от yango. Всех новых пользователей в будущем вернем себе же. Планиурем реализовать это позже на этапе разработки офера (тогда у нас будет приемлемый UX, который сможем раскатить на пользователей)

С проектовой и инфраструктурной точки зрения мы делаем очень небольшой MVP в котором сразу налаживаем взаимодействие с wind и попутно натыкаемся на всевозможные подводные камни, что полезно для дальнейших проработок и реализаций.


# Предлагаемое решение

## Точка входа 

 Переиспользуем точку входа российских самакотов без изменений: передаем ту же кнопоку в /products с action:
 ```json
 "action": {
    "type": "discovery",
    "mode": "scooters"
  },
 ```
 
 по тапу этой кнопки мы сейчас идем в: 
- `/4.0/layers/v2/objects`  (modes: scoters)
- `/4.0/layers/v1/polygons` (modes: scoters)
- `/4.0/mlutp/v1/products/screen/scooters-discovery`  


## /4.0/layers/v1/polygons
В `/4.0/layers/v1/polygons` пока отдавать ничего не будем. Скорее всего можем оставить здесь все без изменений, т.к. текущие полигоны для самокатов по идее существуют только в Москве. Но при необходимости можем закрыть экспериментом 


## /4.0/layers/v2/objects

В ответе отдаем экшн `deeplink` с линком на wind, а `pick_scooter` пока убираем (но для российских самокатов тут конечно все останется по прежнему):

```json
{
  "features": [
    {     
      "id": "scooters__42",
      ...
      "properties": {        
        "options": [
          {
            "actions": [              
              {
                "dst": {
                  "position": [
                    37.53622833,
                    55.749735
                  ]
                },
                "type": "walk_route"
              },
              {
               "type": "deeplink",
               "deeplink": "wind://select?scooter=xxxxxx"
              }
            ],  
            "on": "tap"
          } 
        ],
      }
    }
  ]
}
```

Экшн walk_route - можно попробовать экспериментально оставить, но наверное у нас все плохо с пешими маршрутами в Израиле (?), поэтому скорее всего тоже убираем.


## /products/screen/scooters-discovery

В этой ручке можем оставить примерно тот же контент, но в более урезанном виде.


## Как достаем данные из wind

В ручке `/4.0/layers/v2/objects` будем ходить в виндовую ручку  `/pf/v1/boards` - она отдаст 20 ближайших самокатов по координате пина - в ответе будет все что нам нужно (коррдинаты, id, и в целом полная инфа по самокатам, которую пока никак не будем использовать). 

Также для уменьшения нагрузки все запросы в wind будем обрезать по гео с нашей стороны (по эксперименту).

### Авторизация в wind
Для быстрого старта пока будем авторизовываться по конкретному юзеру. В тестовой среде хедер авторизации выглядит так:
```
authentication: clientId=12345678-1234-1234-1234-123456789012;userId=0feed227-b7e6-4ca8-a22f-c4a599a37097;ft=firebase123
``` 

Нормальную авторизацию прорабатываем отдельно (в рамках создания сервиса авторизации)

### Диплинк

Будем использовать следующий формат диплинка: wind://select?scooter=xxxxxx

## На будущее

На следующем этапе, когда мы буде делать офер мы попытаемся создать новый унифицированный api. Тогда мы сможем как и сейчас отдавать в `/4.0/layers/v2/objects` экшн `pick_scooter`, в который бы положим для самокатов винда их `board_id`. По этому экшену клиенты будут ходить в ручку офера, в которой мы будем получать всю необходимую инфу по самокату по его board_id через виндовую ручку `/boards/<board_id>` 

Кроме того, планируем проработать вмесе с wind отображение более 20 самокатов и парковок в заданной области (по bbox).


## Оценка
- [3d] реализовать новый провайдер в layers и научить его заполнять карту самокатами винда
- [1d] адаптировать /products и /products/screen/scooters-discovery
- [0.5d] (вероятно можно не делать) спрятать под эксп `/4.0/layers/v1/polygons`
- [1d] запас на непредвиденное
ИТОГО: ~5d (1w)
