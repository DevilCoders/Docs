# Сервис для тестирования операторов коллцентра. Админка

## Бизнес-описание

1. Страничка добавления вопроса.
- ``Выбираете маршрут, требования, тариф, способ оплаты.``
- ``Если оператору при ответе на вопрос должно показываться, что у клиента уже есть заказ, то настраиваете параметры этого заказа аналогично.``
- ``Указываете на какие темы этот вопрос, сложность вопроса.``
Создаете вопрос.
2. Страничка просмотра вопросов. С фильтрами по темам, уровню сложности, названию вопроса. Возможностью удалить вопрос.
3. Страничка настроек экзамена. Здесь будем задавать, сколько вопросов, на какие темы должны попасть в экзамен. Здесь же будет список всех тем. Можно будет добавлять/удалять темы. Можно без этого обойтись см. далее.
4. Страничка просмотра результатов экзамена. С фильтром по имени сдающего, имени РГ, временному промежутку.
5. Раз в какой-то промежуток времени будем рассылать на заданную почту предупреждения о слишком давно не обновлявшихся вопросах и вопросах на которые правильно отвечает мало народу.


## Техническая реализация проекта

### Крупным планом

#### Добавление вопроса
Фронт дергает мок-ручку zoneinfo(в этой ручке у нас всегда 1 и тот же замоканный ответ, добавим такую ручку для админки, аналогичную обычной мок-ручки)
и получает список всех доступных тарифов, опций.
Фронт делает запрос к ручке exam_settings и получает список всех доступных тем и уровней сложности.
Пользователь настраивает параметры вопроса
Фронт дергает ручку admin/question

#### Просмотр вопросов
Фронт дергает ручку get_questions и получает список вопросов.
Ручка admin/question для изменения/удаления вопроса.

#### Настройка экзамена
Можно все параметры экзаменов хранить в конфиге. Обойдемся без валидации на этом этапе.

Или вариант (1)
Заведем ручку exam_settings где для каждого уровня сложности будем хранить продолжительность экзамена, кол-во вопросов и список тем.
Эта же ручка будет модифицировать настройки
При попытке изменить параметры экзамена будем проверять, что можем сгенерить подходящий вариант

####  Просмотр результатов экзамена
Ручка get_exam_results

#### Рассылка предупреждений
Заведем крон-таску, в конфиге пропишем как часто она бегает, на какие вопросы выдает предупреждения.

### Ручки
``adstart_exam`` - нужно внести изменения, что б вариант генерился сам по заданным правилам. Сам вариант будем сохранять дополнительным полем в exams_pass
``admin/exam_settings`` - в первом варианте отдает настройки экзамена из конфига. Лучше будет, если настройки экзамена будут храниться в базе,
что б при модификации можно было проверить, можем ли мы создать экзамен с заданными настройками(1).
``admin/question`` - ручка для CRUD вопроса.
При добавлении: добавляет вопрос в таблицу exam_questions. В таблице mock_responses добавляет дефолтные значения ответов всех ручек для этого вопроса. Если указано, генерирует правильный мок ответа для orders_search, paymentmethods.
При изменении/удаление применяет соответствующие изменения в таблицах. Если реализовано (1), то проверяет, можем ли мы попрежнему создать экзамен.
``admin/get_exam_results`` - возвращает результаты экзаменов для заданных пользователей.
``admin/get_questions`` - вернет список вопросов, удовлетворяющих фильтрам.

### Cron task
Заведем крон-таску, в конфиге пропишем как часто она бегает, на какие вопросы выдает предупреждения.


### Новые коллекции

#### Коллекция ``exam_settings`` опционально для (1)

```python
exam_settings = {
  'level': int,               # уровень экзамена
  'topics': string[],         # список тем, которые должны попасть в экзамен. Если тема должна попасть
                              # больше 1 ого раза, продублируем ее столько раз, сколько нужно
  'duration': int,            # время экзамена
  'num_questions': int        # кол-во вопросов в экзамене
}
```

#### Коллекция ``questions_topics`` опционально для (1)

```python
exams_pass = {
  'topic': string,            # темы для вопросов
}
```

Потребуется внести изменения в текущие базы.
В exam_questions надо будет добавить topics, date_created, difficulty_level
В exams_pass надо будет хранить не variant_id, а список вопросов экзамена
exam_variants -  станет неактуальна, надо удалить.

### Оценка сроков

Список задач:

1. ``[1.5d]`` Сохранять в базу полный отчет о прохождение экзамена и дифы с правильными ответами. Т.к. после прохождения экзамена
до просмотра результата, вопрос может измениться.
2. ``[4h]`` mock-ручка Zoneinfo для админки.
3. ``[1d]`` согласовать с фронтами API ручек admin/question, admin/get_questions, admin/get_exam_results
4. ``[2d]`` Ручка для работы с аудио
5. ``[1d]`` Ручка admin/question
6. ``[2d]`` Ручка admin/get_questions
7. ``[4h]`` Ручка admin/exam_settings базовая
8. ``[1.5d]`` Ручка admin/get_exam_results
9. ``[4h]`` Внести изменения в текущие таблицы в базе
10. ``[1.5d]`` Поправить всю логику работы с базой в части вариантов экзамена. Столько времени т.к. надо будет тестить.
11. ``[1d]`` Перейти на рандомную генерацию варианта, изменения в start_exam. В start_exam учитывать уровень сложности
12. ``[3d]`` Запас + , наверняка, у бизнеса в пути несколько изменятся хотелки.
[Optional]
13. ``[1d]`` Ручка admin/ get_questions с работой с базой
14. ``[3d]`` При изменении вопросов/настроек экзамена проверять, что по-прежнему все экзамены можно сгенерить.
15. ``[2d] + [2d]`` Cron task с варнингами о вопросах + [Optional] затянуть это в админку
Итого: 16d + [Optional] 8d
