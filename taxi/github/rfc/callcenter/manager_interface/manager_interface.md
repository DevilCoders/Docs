## Продуктовое описание

Руководителям в КЦ нужно иметь возможность работать с операторами:
 - оперативно переназначать операторов на очереди, в которых скопилось много звонков
 - определять операторов, занимающих много времени на линии

 Для простоты работы предлагается еще группировать операторов по группам (условно одна группа == один руководитель).
 Считаем, что один оператор может быть только в одной группе.

## Фичи в порядке реализации

### 0. Работа с группами операторов
#### Процесс
 - фронт однократно вызывает `GET /v1/admin/callcenters`, получает список коллцентров и групп в них (для UI)
 - на каком-то экране (например список операторов) - добавляем возможность присваивать операторов на группу (через новую ручку `POST /v1/admin/operators/add_to_group`)
 - после этого группы операторов начинают приходить в `GET /v1/admin/operators/` 

Доработки описаны ниже

### 1. Листинг операторов + упраления очередями
#### Процесс
 - фронт однократно вызывает `GET /v1/admin/callcenters`, получает список коллцентров и групп в них (для UI)
 - фронт однократно вызывает `GET /v1/admin/queues/`, получает список очередей (для UI)
 - фронт однократно вызывает `GET /v1/admin/statuses/`, получает список статусов операторов (для UI)
 - фронт вызывает `GET /v1/admin/operators/`, получает листинг операторов.
 - можно назначать операторов на очереди
 - назначение на очереди выполняется массово через существующую ручку `/callcenter_operators/v1/operator/set_queues`
 - можно видеть очереди операторов
 - фронт поллит ручку `GET /v1/admin/operators/` и получает обновленные данные (расчитываем суммарно не больше 100рпс, 1рпс с одного рабочего места)

##### О пагинации и сортировке
Из-за особенностей листинга (операторы постоянно меняются местами в списке) поддержать пагинацию при сервер-сайд сортировке/фильтрации очень сложно => делаем это на фронте.
Вместо пагинации - делаем фильтрацию операторов по группам - таким образом в одном списке будет 30-40 операторов, максимум 60 (инфа от руководителя КЦ).

#### Доработки

##### Доработка ручки `GET /v1/admin/operators/`

- Пример запроса: ```/v1/admin/operators/
?callcenter=callcenter_id_1
&group=group_id_1```
    - входные параметры query:
      - `callcenter` - id коллцентра для фильтрации по нему. опционально
      - `group` - id группы операторов внутри КЦ для фильтрации по нему. опционально
- доп поля в ответе:
    - внутри каждого оператора:
        - `queues` - массив id очередей
        - `group` - id группы операторов
        - `status` - статус по телефонии (сейчас берем из БД)
        - `status_updated_at` - время последнего изменения статуса

##### Доработка ручки `PUT /v1/operators/connection`
- записываем инфу в БД чтобы потом отдавать фронту
- также записываем таймстамп изменения

##### Доработка ручки `PUT /v1/operators/paused`
- записываем инфу в БД чтобы потом отдавать фронту
- также записываем таймстамп изменения

##### Новая ручка `GET /v1/admin/operators/queues/`
- отдает все очереди (пока например из конфига). Поля очереди:
    - `id` (PK)
    - `name` человекочитаемое название
    - `operators_online` - кол-во операторов онлайн - на этом этапе не заполняется
    - `calls_in_line` - кол-во звонков в ожидании на линии - на этом этапе не заполняется

##### Доработка ручки `GET /v1/admin/callcenters`
- добавляем в ответ внутри коллцентров - их группы, в таком виде:
    ```json
    {
        "callcenters": [
            {
                "id": "callcenter_id_1",
                "name": "КЦ Владимир",
                "groups": [
                    {
                        "id": "group_id_1",
                        "name": "Группа руководителя 1",
                    },
                    {
                        "id": "group_id_2",
                        "name": "Группа руководителя 2",
                    }
                ]
            }
        ]
    }
    ```

##### Новая ручка `PUT /v1/admin/callcenters/groups?callcenter_id={callcenter_id}`
Ручка целиком заменяет список групп коллцентра callcenter_id
Принимает массив:
```json
[
    {
        "id": "group_id_1",
        "name": "Группа руководителя 1",
    },
    {
        "id": "group_id_2",
        "name": "Группа руководителя 2",
    }
]
```

##### Новая ручка `POST /v1/admin/operators/add_to_group:
Назначает список операторов на группу в КЦ
Принимает:
- массив yandex_uid
- id коллцентра
- id группы в КЦ


##### Новая ручка `GET /v1/admin/operators/statuses/`
- отдает все статусы операторов (пока например из конфига). Поля:
    - `id` (PK)
    - `name` человекочитаемый
- Пока статусы такие:
    - `connected`
    - `disconnected`
    - `paused` (считаем что unpaused == `connected`)
