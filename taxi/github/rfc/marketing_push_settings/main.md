### Продуктовое
Описание: https://st.yandex-team.ru/TAXIPROJECTS-1707

### Требования

1. Это общая история и для Go, и для Yango, и для Uber;
2. Список сервисов в настройках не прибит жёстко (могут добавляться новые, в разных странах разные наборы); 
3. Знаем, если пользователь отключил пуши в системных настройках; на Android при включении канала должны переводить в системные настройки;
4. Настройки не переносим с устройства на устройство.

**Риски**

_вопрос:_ `Кроме недовольства клиентов, мы ничем не рискуем, если вдруг какой-то источник отправит нетранзакционный пуш (мимо crm)?`

_ответ:_ `Если юзер явно отписался от рекламных уведомлений, а мы ему их прислали, он может в суд на нас подать.
В РФ 100-500 тыс. руб. вроде как, но в Европе по GDPR в процентах от выручки штраф считается, насколько я помню – это не точно, стоит уточнить у юристов.`

### Варианты решения

Рассматривали 2 концептуально разных подхода к решению проблемы:

#### Фильтрация пушей на стороне клиентов
Клиенты ходят в эндпойнт, получают информацию о настройках пушей, меняют настройки, и сохраняют в локальном кэше.
При получении пуша по полю в payload фильтруют пуш в зависимости от настроек.

**Плюсы:** 
- Нет никаких лагов в обновлении настроек / доставки пуша - клиент поменял, пуша однозначно не будет.

**Минусы:**
- Кажется нет нормальной возможности реализовать на стороне ios: см. исследование https://st.yandex-team.ru/ITAXI-10130. 
Потенциальное решение приводит к однозначной потере большого количества пушей (по аналогии с проблемой https://st.yandex-team.ru/TAXIBACKEND-30051#5f3bf592fbb8e61ebffa8d25)

Узнаем у Xiva об альтернативных вариантах решения по задаче: https://st.yandex-team.ru/RTEC-4912

#### Фильтрация на стороне бэкенда
Потенциальная схема решения:

![scheme](https://jing.yandex-team.ru/files/ihelos/PushFilter-Page-2.png)

Клиенты ходят в эндпойнт, получают информацию о настройках пушей, меняют настройки, и переподписываются с помощью xiva.
При отправке пуша - crm или ucommunications проставляет нужные теги у пуша.

Используется функционал xiva для фильтрации пушей: https://console.push.yandex-team.ru/#api-reference-filters

**Плюсы:** 
- Не зависим от клиентов.

**Минусы:**
- Есть лаг между сохранением пользовательской настройки и получением пуша. Клиент мог отписаться **после** того, как началась асинхронная обработка отправки пуша, но при этом **до** непосредственного получения пуша на девайс.