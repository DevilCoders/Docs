У нас в клиентском приложении есть несколько источников коммуникаций для пользователя. 
Все они конфигурируются разным образом и приходят на клиенты из разных мест.

### Брэндинги (приходят в routestats)

Есть несколько промо блоков на саммари, которые сейчас приходят в протоколе в ручке /routestats. 
Эти промо блоки учитывают наличие определенных тарифов, требуют что бы была фикса или определенный способ оплаты 
(у каждого промо блока своя бизнес логика показа). 

Нет гибкого способа конфигурировать эти промо блоки, по факту они полностью захардкожены в коде. 
У каждого блока, как правило, есть свой эксепримент, который регулирует в основном включение блока. 
У некоторых есть свои конфиги, в которых можно настаивать различные правила показа блока. 
Подробнее можно посмотреть в тикетах, в рамках которого разрабатывался определенный промо блок (тикеты указаны ниже).  

Такие промо блоки приходят в ответе ручки /routestats в массиве `service_levels.brandings[]`. 
Ниже представлен список всех промо блоков, которые могут прийти в /routestats (в списке brandings).

#### Тариф дешевле (price_promo)

Промо нотификация которая приходит в том случае, когда есть более комфортный тариф и он дешевле выбранного.

Делалось тут: https://st.yandex-team.ru/TAXIBACKEND-18864

```
{
    "action": "redirect",
    "redirect_class": "comfortplus",
    "subtitle": "Выгода 17 $SIGN$$CURRENCY$",
    "title": "Выбрать Комфорт+",
    "type": "price_promo"
}
```

#### Тариф чуть дороже (tariff_upgrade_suggestion)

Хотим пересаживать пользователей на более комфортные тарифы. Показываем это промо когда тариф повышенного класса, совсем немного дороже выбранного тарифа.

Делалось тут: https://st.yandex-team.ru/TAXIBACKEND-26439

```
{
    "action": "redirect",
    "redirect_class": "ultimate",
    "title": "Сейчас «Premier»  для вас чуть дороже, чем «Комфорт»",
    "type": "tariff_upgrade_suggestion"
}
```

#### Промо тарифа (tariff_promotion) {#tariff-promotion}

Есть потребность промоутировать определенный тариф в определенной зоне. Делалось для промоутирования тарифа Курьер/Доставка. 

Делалось тут: https://st.yandex-team.ru/TAXIBACKEND-27956

```
{
    "action":"redirect",
    "redirect_class":"courier",
    "title":"Try tariff «Courier»",
    "type":"tariff_promotion"
}
```

#### Промо кэшбэка (cashback и wallet_payment_method_suggest) 

Промоутируем кэшбэк. Показываем пользователю что он может оплатить заказ кэшбэком (wallet_payment_method_suggest) и то что за поездку будет начислен кэшбэк (cashback)

Делалось тут: https://st.yandex-team.ru/TAXIBACKEND-27455

```
{
    "title": "Кешбек за поездку",
    "type": "cashback",
    "value": "+158.5",
    "tooltip": {
        "text": "Кэшбэк за поездку"
    },
}
```

```
{
    "type": "wallet_payment_method_suggest",
    "tooltip": {
        "text": "можно оплатить кэшбэком"
    }
}
```

####  Композитная оплата (complement_payment)

Частичная оплата заказа кэшбэком.

Делалось тут: https://st.yandex-team.ru/TAXIBACKEND-27027

```
{
    "payment": {
        "payment_method_id": "wallet_id/4016972052",
        "type": "personal_wallet"
    },
    "subtitle": "Оплатить Плюсом 670 $SIGN$$CURRENCY$",
    "title": "Поехать дешевле",
    "type": "complement_payment"
}
```


#### Промо плюса (plus_promotion) 

Нотификация прилетает пользователям у которых нет плюса и предлагает им активировать его.

Делалось тут: https://st.yandex-team.ru/TAXIBACKEND-25903

```
{
    "title": "Поездка может стоить на 28 $SIGN$$CURRENCY$ дешевле — с подпиской на Плюс",
    "type": "plus_promotion"
}
```

### Пользовательских нотификаций (сервис promotions)

Есть и другие типы промо блоков (пользовательских нотификаций). 
Они настраиваются через [админку](https://tariff-editor.taxi.yandex-team.ru/promotions/) и находятся в сервисе promotions. 
Клиентское приложение получает промоблоки которые там настраиваются через ручки 
/4.0/promotions/v1/list и /4.0/promotions/v1/promotion/retrieve (только нотификации, карточки и фулскрины). 
Все остальные типы уже приходят на клиент через ручки сервиса inapp-communications.

Сервис promotions сейчас активно распиливается. Админка переезжает в сервис feeds-admin, а клиентская часть в inapp-communications.

Сейчас сервис поддерживает следующие типы коммуникаций: нотификации, карточки, фулскрины, сторисы в шорткатах, объекты на карте.

Про нотификации, карточки и фулскрины можно подробнее ознакомиться на [этой странице](https://wiki.yandex-team.ru/users/nekit/kommunikacija-v-prilozhenii/) 
Про сторисы в шорткатах [тут](https://st.yandex-team.ru/TAXIPROJECTS-983)
Про объекты на карте [тут](https://wiki.yandex-team.ru/users/vladazh/pro-obekty-na-karte/)

### Истории (сервис stories)

Не путать с историями в шорткатах. Сервис taxi-stories отвечает за истории которые отображаются на клиентах во время поездки. 
Для настройки этих историй есть своя [админка](https://tariff-editor.taxi.tst.yandex-team.ru/stories)

Подробнее можно почитать [тут](https://wiki.yandex-team.ru/taxi/clientproduct/stories/)


