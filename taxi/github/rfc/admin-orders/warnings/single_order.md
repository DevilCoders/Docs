# ПРОБЛЕМА

Ручка карточки заказа /v1/order/get/ ходит во множество коллекций и сервисов
(назовём их общим термином "источник данных").

При этом, если один источник данных по какой-то причине не отдаёт данные
(недоступен, сломан, некорректно работает и прочее), то почти всегда пользователь
увидит ошибку 500. 

# ЧТО ХОТИМ

Хотим, чтобы при 500 ошибке от одного или нескольких сервисов на карточке заказа
показывались остальные данные, которые удалось получить.

В идеале вместо недоступных данных в интерфейсе карточки заказа пользователь
должен увидеть предупреждение о том, что часть данных отсутствует, и кнопку
для повторной загрузки данных (всей ручки или конкретно данного блока данных).

# Варианты API

С точки зрения фронтенда, оба первых варианта примерно одинаково просто реализовать.

## item со старыми данными + warnings в виде вложенных объектов

### схема
```json
[
  {
    "item": {
      ...  # всё то, что раньше приходило в ручке
    },
    "warnings": {
      "performers_info": {
        "message": "не удалось получить данные по исполнителю",
        "code": "performers error",
        "level": "error",
        "actions": [
          {
            "text": "Перезагрузить страницу",
            "action": "reload"
          }
        ]
      },
      "user_info": {
        "excluded_parks": {
          "message": "не удалось получить данные по субсидиям",
          "code": "subventions error",
          "level": "error",
          "actions": [
            {
              "text": "Перезагрузить страницу",
              "action": "reload"
            }
          ]
        }
      }
    }
  }
]
```

### плюсы

+ легко собирать ответ на бэке в зависимости от поведения источника данных:
    либо записать ошибку в warnings, либо записать полученный результат в item 

### минусы

- для каждого нового поля в ответе (если оно берётся из отдельного источника данных)
    нужно определять его и внутри item, и внутри warnings

## item со старыми данными + warnings в виде плоского списка

```json
[
  {
    "item": {
      ...  # всё то, что раньше приходило в ручке
    },
    "warnings": [
      {
        "field": "performers_info",
        "message": "не удалось получить данные по исполнителю",
        "code": "performers error",
        "level": "error",
        "actions": [
          {
            "text": "Перезагрузить страницу",
            "action": "reload"
          }
        ]
      },
      {
        "field": "user_info.excluded_parks",
        "message": "не удалось получить данные по исключённым паркам",
        "code": "excluded_parks error",
        "level": "error",
        "actions": [
          {
            "text": "Перезагрузить страницу",
            "action": "reload"
          }
        ]
      }
    ]
  }
]
```

### плюсы

+ простая схема в yaml,
    т.к. не нужно описывать в схеме все варианты вложенных полей внутри warnings
+ не нужно дополнять схему при расширении ответа ручки
    (т.е. при добавлении источников данных и, как следствие, полей внутри items)

### минусы

- на бэке немного сложнее собирать ответ

## items[0] со старыми данными + warnings в любом виде

Хочется ещё обсудить, насколько проще будет (фронтенду), если универсализировать схему
для разных ручек, т.е. везде использовать для ответа ручки поле items, при этом
в ручках, которые сейчас возвращают объект и планируют переходить на схему с варнингами,
объект ответа будет находиться в `items[0]`. 


### схема
```json
[
  {
    "items": [
      {
        ...  # всё то, что раньше приходило в ручке
      }
    ],
    "warnings": {
        ... # warnings в любом из предыдущих двух форматов (многоуровневый объект либо плоский список)
    }
  }
]
```

### плюсы

+ подходит любым  ручкам с json-контентом, вне зависимости от того,
    возвращают ли они список либо объект 

### минусы

- ???
