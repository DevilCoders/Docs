**Название сервиса**

tariffs-promotions

**Какую продуктовую проблему решает сервис?**

Промотирование тарифов повышенного класса.
Создает промоблоки для саммари в которых может меняться текст и картинка в зависимости от цен.

**Почему нельзя решить эту задачу без разработки нового сервиса существующими решениями?**

Сервис будет содержать исключительно логику работы с промоблоками для тарифов

**Как именно сервис будет решать поставленные перед ним задачи?**

Сервис будет одним "источников" промоблоков для `/inapp-communications/promos-on-summary`

Предоставляет ручку: `/tariffs-promotions/v1/promotions`

###### Ручка GET /tariffs-promotions/v1/promotions
Строит промоблоки для отображения на саммари

На вход принимает `offer_id` в качестве get параметра
В ответе отдает список из PromoblockItem, заданный в
[inapp-communications/definitions/PromoblockClientInfo](https://github.yandex-team.ru/taxi/uservices/blob/a203c25c35d5c9ce8efd8d92d64b143d0911ae59/services/inapp-communications/docs/yaml/definitions.yaml#L1232)

Основное флоу работы:
* идет запрос в сервис order_offers для получения цен
* на основании информации о ценах, создаются контексты для промоблоков
* из кэш-компоненты promo_block_cache_component берутся шаблоны промоблоков [проработка компоненты](https://github.yandex-team.ru/taxi/rfc/blob/master/promotions/promo_block_cache_component.md)
* контексты накладываются на шаблоны

Основная логика ручки будет закрыта [экспериментом](https://st.yandex-team.ru/TAXIBACKEND-31057#5f5f90b89fcae332923f762d)

Потребитель : `/inapp-communications/promos-on-summary`

**С кем взаимодействует сервис?**

Потребитель : `/inapp-communications/promos-on-summary` (забирает список готовых промоблоков)

Обращается в:
  - order_offers (за ценами)
  - promotions через  кэш-компоненту promo_block_cache_component (за шаблонами промоблоков)

**Какие базы использует?**

Напрямую не работает с базами.
Через сервис order_offers ходит в одноименную базу.(только на чтение)

**Какая нагрузка ожидается?**

На первом этапе: максимум 5% от routestats ~50 rps.
В дальнейшем планируется нагрузка равная routestats ~1-2k rps.

**Какие фолбеки предусмотрены на сам этот сервис?**

Фолбеки не предусмотрены.
Функциональность сервиса не влияет на основное флоу заказа такси,
поэтому при недоступности сервиса пользователю не будет показаны промоблоки.

**Какие точки отказа есть в сервисе?**

отказ order_offers или promotions

**Укажите ключевые продуктовые метрики сервиса, за которыми планируете следить**

- количество заказав на повышенных тарифах
- количество отданых промо (показаных)

**Укажите технические метрики**

- время работы запросов в order_offers
- количество неудачных походов в order_offers (не нашли в базе offer_id, не смогли получить цены)
- время работы ручки

**Развитие сервиса**

#####Этап 0:

Ручка для генерации промо повышенных классов с жестким ограничением,
что она создает нагрузку на order_offers не более 5% от роутстатс

#####Этап 1:

Проверка гипотез, если фича взлетает, тогда будет сделан более безопасный для базы order_offers вариант:
либо через прямое отправление цен из routestats в наш сервис,
либо через отправление цен при помощи logbroker

#####Этап 2:

Перенос других промоблоков (брэндингов) из routestats:
 - Промо кэшбэка (cashback и wallet_payment_method_suggest)
 - Композитная оплата (complement_payment)
 - Промо плюса (plus_promotion)
Более подробно описаны в [rfc](https://github.yandex-team.ru/taxi/rfc/pull/435/files)
