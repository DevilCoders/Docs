# Платные дороги в Норвегии

## Завязка

В Норвегии платных дорог много. Шлагбаумов нет, списания проводятся автоматически в момент проезда, считывается номер автомобиля, позднее со счета владельца, привязанного к номеру автомобиля, производится списание.

Юридически запрещено списывать деньги с пользователя только тогда, когда проезд по платной дороге был. Коммуницировать пользователю, что он платит за платную дорогу - нельзя. Давать ему выбирать платный или бесплатный маршрут нельзя.

## Кульминация

После согласований с региональным менеджером пришли к выводу, что в Норвегии к каждой поездке мы добавляем фиксированную сумму.
Важно учитывать, что:
1) Пользователь должен видеть конечную сумму заказа с надбавкой за платную дорогу;
2) В чеке отображаем надбавку как отдельный пункт, помечаем как "Extra charges";
3) Эта надбавка не облагается комиссией;
4) Далее эту надбавку компенсируем водителю по аналогии с чаевыми.

## Развязка

А теперь примерный план реализации:

1)  Заводим конфиг 3.0 `TOLL_ROADS_PRICES_BY_COUNTRIES`, в котором указываем размер фиксированной надбавки в зависимости от страны (на будущее);
2)  Настраиваем преобразование цены в прайсинге ([тык](https://tariff-editor.taxi.tst.yandex-team.ru/price-conversion-rules/new))
    Если конфиг TOLL_ROADS_PRICES_BY_COUNTRIES в статусе `enabled = true`, если для данной страны найдена надбавка, добавляем ее к цене; создаем две новых меты:
     - `toll_roads_basic_order_price` - цена заказа без добавления этой надбавки;
     - `toll_roads_price` - размер надбавки

3) В ручке `requestconfirm` прокидывать в заказ размер надбавки в поле `order.toll_road_cost`, в `order.cost` пишем цену поездки без учета этой надбавки([тык](https://github.yandex-team.ru/taxi/backend-cpp/blob/5700248a3a25a987b910c8c3a4fe1fa90bdc2cdd/protocol/lib/src/views/requestconfirm/taxi_requestconfirm.cpp#L797));
4) В STQ-таске `update_transactions` прокидывать новое поле `sum_to_pay.toll_road_cost` ([тык](https://github.yandex-team.ru/taxi/backend/blob/develop/taxi/internal/order_kit/invoice_handler.py#L5175)).
5) В биллинге нужно будет это новое поле поддержать, в корзине и чеке оно должно быть отдельной строчкой и без комиссии.
