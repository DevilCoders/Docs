# Чеклист по взрослению сервиса в продукте

Данный чеклист не является чем-то обязательным, скорее помогает разработчику "не забыть" что-то в процессе разработки, помогая быстро проверить свой сервис на готовность к следующему этапу развития.

1) Некоторые чекпоинты иногда можно сделать этапом ранее (например, продуктовые дашборды иногда можно сделать к моменту выхода на Стафф)
2) Чекпоинты почти никогда нельзя перенести на следующий этап (например, нельзя выкатывать сервис на Такси без алертов)

## Как рождается сервис

Новые сервисы в Такси проходят следующие высокоуровневые стадии взросления:

1) RFC
1) Техническая настройка
1) Задеплоено в прод, не ожидается "реальных" клиентских запросов
1) Раскатка на команду Такси (включая dry run)
1) Раскатка на стaфф
1) Публичный релиз (ака раскатка на всех)


## RFC

Хорошее РФЦ нового сервиса содержит в себе:
- [ ] Ссылка на тикет в TAXIPROJECTS (если есть)
- [ ] Ответ на вопрос "Какую проблему решает этот сервис" (ака "Продуктовое описание")
- [ ] Описание архитектуры: из чего состоит (web/stq/postgres/YT), что использует, от чего зависит, как организовано взаимодействие. Например [так](https://github.yandex-team.ru/taxi/rfc/pull/121#discussion_r2473134).
- [ ] Описан API и приглашен фронтенд
- [ ] Описан клиентский флоу
- [ ] Оценен ожидаемый RPS (суммарный/ручек в отдельности)
- [ ] Оценен ожидаемый объем данных для хранения (базы данных, MDS, ...) и QPS
- [ ] Описана критичность, продуманы фолбеки
- [ ] Определен MVP
- [ ] Проект разбит на этапы, этапы состоят из оцененных задач (загляните вниз по чеклисту чтобы не забыть в оценке дашборды/документацию), [пример](https://github.yandex-team.ru/taxi/rfc/blob/master/promotions/main.md#декомпозиция-задач-и-оценка)
- [ ] Запланировать подключение к [takeout](https://wiki.yandex-team.ru/users/e-usov/taxi-takeout/#podkljucheniedopolnitelnyxservisov-istochnikovbezkoda) если [нужно](https://wiki.yandex-team.ru/users/omaz/flow/GDPR-portability/data/#vygruzhatnuzhno)
- [ ] Продуманы и запланированы моках для фронтенда (помните, что хорошие моки дают возможность генерить разные флоу)

После написания rfc можно пробежаться по списку из [этой статьи](https://stackoverflow.blog/2020/04/06/a-practical-guide-to-writing-technical-specs/). Он подскажет, какие аспекты еще стоит осветить.

Почти всё в последствии можно перенести на страничку сервиса.

## Техническая настройка

- [ ] [Форма заявки на создание окружения нового сервиса](https://wiki.yandex-team.ru/taxi/backend/forms/newservice/)
- [ ] Настроен [TVM](https://wiki.yandex-team.ru/taxi/backend/architecture/tvm2) до нужных сервисов
- [ ] Настроены дырки в [панчере](http://puncher.yandex-team.ru) до нужных окружений

## Задеплоено в прод, не ожидается "реальных" клиентских запросов

В продовый сервис не ходит никто кроме связки (разработчик, тестировщик, менеджер).

Ожидается, что для перехода на этот этап нужно иметь следующее:

- [ ] Сервис есть в таблице "[Микросервисы](https://wiki.yandex-team.ru/taxi/backend/microservices/)"
- [ ] Сделан функциональный [дашборд в Графане](https://wiki.yandex-team.ru/taxi/backend/graphite/#generacijadashbordov)
- [ ] У сервиса есть вики-страничка с описанием (пример:
[Новые коммуникации](https://wiki.yandex-team.ru/taxi/backend/architecture/promotionsv2/)

## Раскатка на команду Такси

(В продовый сервис ходит кто-то кроме разработчика)

По [эксперименту3.0](https://wiki.yandex-team.ru/taxi/backend/architecture/experiments3/Manual/#ispolzovaniejeksperimentovnakomandu) в сервис начинают приходить пользователи из команды Такси.

Ожидается, что на этом этапе:
- [ ] Настроены [алерты в Juggler](https://wiki.yandex-team.ru/taxi/ml/kak-delat-monitoringi/)
- [ ] На странице сервиса описан эксперимент, по которому включается флоу нового сервиса
- [ ] Реализован и описан конфиг-рубильник, позволяющий максимально деградировать сервис без негативного влияния на систему в целом
- [ ] Верифицированы таймауты и ретраи (частая проблема: таймаут Passenger Authorizer'а меньше суммарных таймаутов внутри сервиса)
- [ ] Если с прошлого этапа были добавлены новые ручки, они должны быть добавлены в дашборд в Графане

## Раскатка на стафф

Главное отличие от предыдущего этапа — нагрузка на сервис должна возрасти.

- [ ] Если были добавлены новые ручки / таски, добавить их в дашборд в Графане

## Публичный релиз

- [ ] Все известные косяки задокументированы и на них есть менеджерский ОК
- [ ] Создан продуктовый дашборд
- [ ] Настроена репликация логов в YT (пример донастройки [тут](https://st.yandex-team.ru/TAXIADMIN-9275) и [тут](https://st.yandex-team.ru/TAXIADMIN-10362))
- [ ] Настроена [репликация данных](https://pages.github.yandex-team.ru/taxi/schemas/Taxi_Documentation/replication-docs/replication-service/) в YT (если требуется)
- [ ] Если были добавлены новые ручки / таски, добавить их в дашборд в Графане
