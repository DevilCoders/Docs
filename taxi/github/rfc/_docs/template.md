## Опросник для ревью комитетом

> Этот опросник нужен для [архитектурного ревью комитетом](https://forms.yandex-team.ru/surveys/25357/). Его можно будет скопировать.

> После его написания можно пробежаться по списку из [этой статьи](https://stackoverflow.blog/2020/04/06/a-practical-guide-to-writing-technical-specs/). Он подскажет, какие аспекты еще стоит осветить.

**Название сервиса**

Имя сервиса

**Какую продуктовую проблему решает сервис?**

Гипотеза: мы должны соптимизировать метрику M за счет D. Текущее значение метрики X, планируем Y после включения на всех.

**Почему нельзя решить эту задачу без разработки нового сервиса существующими решениями?**

...

**Как именно сервис будет решать поставленные перед ним задачи?**

Нужно показывать заказы из Алисы в приложении. [Ссылка на тикет с продуктовым описанием](https://st.yandex-team.ru/TAXIBACKEND-23489).

[Ссылка на дизайн](https://www.figma.com/proto/0RGir5KL41AsE4Peb8W2mHOS/%D0%9F%D0%B5%D1%80%D1%81%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5-%D1%86%D0%B5%D0%BB%D0%B8?node-id=206%3A574&viewport=542%2C477%2C0.17429456114768982&scaling=min-zoom&redirected=1).

**Разрабатывается один сервис или система?**

...

**Сколько и какие сервисы входят в систему?**

...

**С кем взаимодействует сервис?**

1. Какие (микро-)сервисы и как используются.
2. Как гарантируется идемпотентность внешний операций.
3. Как поддерживается консистентность данных при частичных отказах.
4. Как организованы ретраи внешних сервисов.

**Какие базы использует?**

Какие СУБД и почему используются. Какие БД в них будут использоваться.


**Какие периодические процессы?**

...

**Прикрепите схему того, где этот сервис находится в текущей инфраструктуре**

1. Как технически проект влияет на цикл заказа.
2. Кто будет потребителями сервиса.

**Какие данные и по какой схеме сервис будет хранить в базе?**

Какие таблицы, индексы, уровни изоляции транзакций, особенности запросов и тп.
Объем хранимых данных, как их подразумевается чистить. Ресурсы под СУБД (cpu, ram, disk).

**Какой объем данных будет храниться и какой объем будет изменяться в единицу времени?**

...

**Какие операции над данными заложены?**

...

**Какие данные пользователей будут храниться в сервисе?**

По европейским законам практически любые данные пользователей, 
которые можно связать с его идентификатором (например, с телефоном, id, адресом), будут считаться персональными.
Анонимизируются ли такие данные? Если нет - продумать подключение к `takeout`.

**Есть ли какой-то стейт в памяти, как он обновляется и валидируется?**

...

**Какая нагрузка ожидается?**

Ожидается нагрузка 1000 RPS на ручку `/orders`, это рассчитано следующим образом: ...
Нагрузочное тестирование делается/(не делается).

**Какие фолбеки предусмотрены на сам этот сервис?**

...

**Какие фолбеки предусмотрены внутри этого сервиса на взаимодействие с другими сервисами?**

Фолбэк на каждый компонент должен быть описан. Какие особенности будут при отключении ДЦ. Как будет тестироваться отказоустойчивость.

**Какие возможности масштабируемости закладываются?**

...

**Какие точки отказа есть в сервисе?**

...

**Укажите ключевые продуктовые метрики сервиса, за которыми планируете следить**

...

**Укажите технические метрики**

...

**Какая функциональность ожидается в сервисе в будущем?**

Этапы разработки:

1. MVP: заглушки на сервере для быстрого тестирования клиентов -  3д
  * либо обоснование почему заглушки не нужны.
2. Показ заказов в заново открытом приложении - 10д
  * Подзадача 1, без нее нельзя запускаться так как X - 3д
  * Подзадача 2, без нее нельзя запускаться так как Y - 2д
  * Интеграция с клиентами - 5д
3. Показ заказов всегда - пушим их юзеру - 6д
  * Подзадача 1 - 3д
  * Подзадача 2 - 3д
4. Подчистка техдолга - 7д
  * Подзадача 1 - 3д
  * Подзадача 2 - 4д

**Какое изменение нагрузки планируется?**

...

**Активно ли будет изменяться сервис?**

...

<hr>

> Ниже - не жесткий шаблон, а скорее чеклист того, о чем надо подумать, с примерами заполнения.
> Если ты точно уверен, что какой-то раздел не относится к твоей проработке - не включай его.

## Бизнесовая задача

### Продуктовые ограничения

#### Этап 1

1. Если приложение уже открыто, новые заказы не появятся: для этого нужно делать пуши.

#### Этап 2

1. В кейсе X с вероятностью Y заказы могут не показаться.
2. 15% пушей не доходят, поэтому новые заказы не появятся у части юзеров с открытым приложением.

#### Все этапы

1. Если юзер не залогинен в приложении, заказы через Алису не покажутся.

## Архитектура

### API

#### `Alice`

Ручка `/orders`:

```json
{
    "orders": [
        {
            "ID": 123,
        },
    ],
}
```

Здесь описание ошибочных ответов и различных нюансов использования. Можно в формате `openapi` прикладывать `yaml`-ы.
Идемпотентность ручки гарантируется за счет X.

### Клиентская логика

1. Используется ли web-view. Если нет, то почему.
2. Когда и как (паралелльно/последовательно) дергать ручки.
3. Как ретраить. Что делать при ошибках.
4. Откуда брать тексты (лучше с сервера).

### Технические ограничения

Чем мы осознанно жертвуем: алертами, отсутствием запаса под xN рост, редкие гонки, отсутутвие необходимого рефакторинга и тп. ВСЕ должно быть четко описано и скоммуницировано менеджеру и ревьюеру архитектуры.

### Как раскатываем

#### Раскатка этапа 1

1. По эксперименту X на стафф.
2. На город Y.
3. По остальным городам.

#### Техническая раскатка

За раскатку отвечает эксперимент 3.0, который работает в ручке `/launch` и может раскатываться по следующим аргументам: `personal_phone_id`, `phone_id`, `country`, `yandex_uid`.

### Безопасность

1. Как подключаемся к `GDPR takeout`.
Если сервис хранит неанонимизированные данные пользователей, надо уметь:
- выгружать эти данные;
- удалять данные, если нет необходимости хранить вечно.

Это можно сделать, подключившись к сервису `takeout`.
Подробности про `takeout` можно посмотреть на [вики](https://wiki.yandex-team.ru/users/e-usov/taxi-takeout/)
2. Как работаем с ПД.
