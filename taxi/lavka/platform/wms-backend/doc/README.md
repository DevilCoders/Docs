## Бакенд лавки

Бакенд построен на основе шардированной БД PostgreSQL. На начальном этапе
используется 2-шард-база для хранения остатков на складах и 1-шард-база
для хранения настроек складов итп.

Выделяется несколько групп API

1. API работы с пикером кладовщика (TSD)
2. API для интеграции с Яндекс.Еда (приём заказов)
3. API для работы админки при помощи которой осуществляется настройка системы
4. API для интеграции с системами статистики, выгрузок, мониторинга.

В перспективе

1. API мобильного приложения заказа
2. API мобильного приложения курьера
3. API интеграции с курьерским ПО Еды

Все API доступны извне Яндекса, поскольку мобильные приложения,
их использующие, а так же прочие части - используются извне
Яндекса.

### Организация бакенда

Бакенд организован как монолитное MVC-приложение с прицелом миграции от
архитектуры Model-VC к архитектуре Microservice-VC.

Части API выделяются в отдельные swagger/openAPI yaml-файлы.
Свагер-спецификации используются на бакендах рантайм, таким образом
всегда поддерживается актуальность.


### Аутентификация и Авторизация рабочих мест

Аутентификация пользователя производится при помощи yandex-oauth.
В результате аутентификации мы знаем что пользователь - тот за кого он
себя выдаёт.

Авторизация доступа построена на системе ролей пользователей:
Аутентифицированному пользователю может быть назначена роль, а так же
склад к которому он привязан.

Таким образом осуществляется инициация работы пользователя.

**Важно**: добавление пользователей в работу может выполняться сотрудниками
склада (имеющими соответствующие права), таким образом сотрудники складов
не всегда являются сотрудниками сервиса `abc` яндекса.

Однако для базисных вещей интеграцию с сервисом `abc` в будущем мы планируем
сделать.

### Структура хранилища

Хранилище хранит следующие базовые сущности (а так же некоторые другие)

1. Роли пользователей (связка `id` пользователя - его права в системе).
Персональные данные в этом месте не требуются: Аутентификацию производит
внешняя по отношению к Лавке система.
2. Номенклатуру товаров
3. Список складов, работу которых обеспечивает система
  - Настройки складов (ассортимент, итп)
4. Список остатков товаров на складах
  - партия
  - товар
  - остаток
  - резерв
5. Список проводок по остаткам на складах
  - остаток
  - ордер
  - количество
6. Список ордеров, модифицирующих остатки на складе


Особенности: Список проводок по остатку на складе хранится на том же шарде, что
и сам остаток. Таким образом, система модификации цифры в остатке выполняется
атомарно в пределах одного шарда.

