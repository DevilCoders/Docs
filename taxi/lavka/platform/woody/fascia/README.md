**Fascia** - это обвязка кодобазы проекта.
Make, Dockerfiles, docker-compose, text configs, bash scripts.
Здесь это фреймворк для тестирования make-рецептов проекта.
Тестируем поднятие базы, сервера бэкенда, настройку окружения.

# Кратко. Для пользователей make-рецептов
Всё что нужно знать для разработки сервиса - это список команд в makefile.
Все поддерживаемые сценарии использования makefile находятся в fascia/test_fascia.sh. Установка, запуск базы, приложения, тестов.

# Мотивация
## Название Фасция
* Фасция - это связанные в единое полено прутья. "Обвязка" - частый синоним
* У нас это система из конфигов и скриптов, что собирают кодобазу в работающее приложение

## Раз. Проблема
* Разработчики на своих локальных машинах используют и дописывают под себя разные наборы рецептов
* Локальную среду мы не контролируем, она у каждого своя
  добавляются новые зависимости
* Каждый дописывает под себя новый рецепт, он по разным причинам работает только у него на машине
* Запуск на других машинах происходит или через долгий парный дебаг

## Два. Решение
* Новые рецепты совместимы
  * Совместимость
    * Нам нужно добавлять рецепты в Makefiles совместимо с разными машинами
  * Единообразие
    * Одну и ту же штуку разные разработчики делают одним и тем же образом
* Инструкция по установке всегда работает
  * Актуальна. Не сыпется от обновления версии pip-пакета, например
  * Переносима. Работает на разных машинах
  * Консистентна. Дописывание новой apt-зависимости не ломает установку в целом

## Три. Реализация
* Тестирование make-рецептов
  * Тестирует bash-скрипт, что запускает user stories
  * Каждая user story состоит из набора рецептов
* Пример user story
  * Локальная разработка на бэкэнде
    * make start_dbn - запускаем базу и nginx
    * make migrations - миграции на базе
    * curl nginx_host/ping - nginx отвечает на http-запросы
    * make test-lavka - существующие тесты бэкэнда работают
* Один тест - одна user story
* Поддерживаются только рецепты и user stories из файла с тестами
  * Если мы хотим новую story, мы добавляем в Make новые рецепты и дописываем файл с тестами,
    или просим об этом @andrew-zak
  * Например мы хотим отдельный рецепт для запуска баз вместе с clickhouse

# Как работает Фасция
Раздел для тех, кто собрался менять makefile.

После изменения make-файлов или каких конфигов,
в docker compose сервисе fascia запускаем команды
```
make build_fascia
make up_fascia
make bash_fascia

# inside the container
make setup_fascia_in
make test_fascia_in

# outside container. To cleanup
make down_fascia
```

Как работают тесты
- dc.yml сервис fascia эмулирует локальную машину на Ubuntu 20.04.
- make setup_local - устанавливает woody в фасция-сервис
- fascia/test_fascia.sh - тестирует кейсы запуска проекта
