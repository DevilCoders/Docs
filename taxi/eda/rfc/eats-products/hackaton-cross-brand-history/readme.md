# Закупидон (Кросс-брендовая история покупок пользователя)

## MVP решение

Добавляется баннер на главной Еды, по которому можно провалиться в новый экран, 
где будет будут отображаться магазины, в которых есть товары, которые пользователь уже покупал.

С точки зрения бэка были расммотрены 2 варианта:

1. Сделать одну ручку и отдавать полный ответ, который содержит все необходимые данные, позволяющие фронту отобразить все магазины со всеми товарами

Плюсы: 
   - фронт получит все данные сразу и при переключении между магазинами не будет прогрузки.

Минусы:
   - ручка получится тяжелая, потому прогрузку всех данных пользователь может ждать долго. 
   - при увеличении количества магазинов, которые нужно будет показать пользователю, тайминги будут прямо пропроционально расти 

2. Сделать 2 ручки: получение плейсов и получение товаров в этом плейсе.

Плюсы: 
   - обе ручки будут легче, чем в 1ом варианте
   - при увеличении количества магазинов ничего не поменяется

Минусы:
   - при переключении на другой магазин, товары которого еще не были прогружены, будет небольшая загрузка

Так как время разработки обоих вариантов примерно одинаковое, то решили остановиться на 2ом варианте

### Разработки на бэкенде

На бекэнде потребуется реализовать 3 ручки: 2 в eats-products, 1 в eats-nomenclature

#### Разработки в eats-products

##### Ручка получения магазинов

```/api/v1/cross-brand-history/places```

Ручка будет отдавать список магазинов, в которых есть товары, которые пользователь уже покупал. 
В том числе магазине, где пользователь еще не делал закупки, но там есть товары, которые он покупал в других брендах
В магазине, где у пользователя еще не было покупок, нужно добавить соответствующий баннер, который будет отображен на фронте

Так как для ответа необходимо знать все магазины, которые есть в каталоге по данным пользователя (местоположение и т.д.), то есть 2 варианта решения:
1. Ходить на бэке в ручку каталога /internal/v1/catalog-for-layout и получать все данные о магазинах оттуда

Минусы:
   - у этой ручки каталога большие тайминги(до 1 секунды)
   - делаем дополнительный запрос, хотя фронт уже получил эту информацию

2. Получать список магазинов с фронта, так как главная приложения уже была открыта и список магазинов уже был получен

Плюсы: 
   - не нужно дополнительно ходить в каталог, потому тайминги ручки будут значительно ниже
    
Минусы:
   - если пользователь перешел по линку в вебе напрямую, не заходя на главную? Правда ли в этом случае запроса в каталог не будет?

В рамках хакатона ыыбрали 2ой вариант, так как 1ый вариант сильно увеличивает тайминги ручки и время разработки

##### Ручка получения товаров в магазине

```/api/v1/cross-brand-history/products```

Ручка будет отдавать список товаров в магазине, разбитый на 2 категории: 
"Только в этом магазине", "Не только в этом магазине" (Названия будут изменены на более удачные)

На вход будут подаваться запрошенный магазин и список всех магазинов для корректного построения 2ой категории

#### Разработки в eats-nomenclture

```/v1/products/public_id_by_sku_id```

Ручка, которая позволит получить public_id товаров по соответствующим sku_id в магазине

На входе: массив sku_id товаров, place_id, флаг, позволяющий возвращать только доступные
На выходе: массив пар sku_id и public_id

### Разработки на фронтенде

Когда пользователь в первый раз попадает на экран кросс-брендовой истории по нажатию на баннер, 
необходимо поочередно вызвать ручку получения магазинов,
а затем ручку получения товаров для первого магазина из списка

Когда пользователь открывает другой магазин, по которому товары еще не были запрошены,
то вызывать ручку получения товаров для выбранного магазина, передав ему результат вызова первой ручки (список магазинов)
