== Цели
- добавить в отображение товаров цену за 1 кг (чтобы можно было легко сравнивать)
- показывать при добавлении вес, а не количество квантов


== Дизайн
https://www.figma.com/file/Aqu5YdqsmXGBZfnh0AOzH5/Товар?node-id=2246%3A25760

== Этапы
Самые основные места, где надо показывать вес добавленных товаров - это меню и
корзина (ими пользуется 100% сделавших заказ). Поиск тоже важен, им сейчас
пользуется около 30% и из них 70% добавляют товар. Поэтому, а также потому, 
что прорастить в поиск кванты сильно сложнее чем в корзину и меню, предлагается
разбить на два этапа:

Этап 1. Меню и Корзина
Этап 2. Поиск

Здесь описан только первый этап, второй выделен в отдельный тикет.


== Доп. требования
- Надо поддержать на клиенте оптимистичный рендеринг - то есть показывать
  нужные значения до их прихода с сервера, для ускорения UI.
- Добавить эксперимент на отключение фичи
- При превышении заранее заданного порога - отдавать вес в граммах


== Ограничения
- Все единицы измерений - только граммы. Почему:
    - литры и миллилитры в обозримом будущем не планируются (пока планов вообще нет)
      и даже если будут, вполне вероятно, что там будут не количества, кратные
      кванту, а predefined-количества (500мл/750мл/1500мл/2000мл итп). Сейчас
      это предусмотреть почти невозможно.
    - штуки - аналогично, не планируется, но опять же вероятно что пачки 
      надо будет делать отдельными кнопками-переключателями (1шт/12шт и все),
      а не квантами
- все доработки, связанные с корзиной, будут делаться в новой ее версии (eats-cart)


== Доработки
- eats-products
    - заведение нужных экспериментов (клиентского и рубильника на беке)
    - добавить вычисление квантов и выдачу их в ручке меню
    - аналогично - в ручке каруселей, и во всех других ручках
    - отдавать данные по весу в корзину в ручке `v2/menu/get-items`
    - багфикс и выкатка
- eats-cart
    - добавить в ручки корзины отдачу данных по квантам:
      GET POST /api/v1/cart
      PUT DELETE /api/v1/cart/{id}
      DELETE /api/v1/cart/disabled-items
      DELETE /api/v1/cart/unavailable-items-by-time
      DELETE /api/v1/cart/unavailable-promos
      POST /api/v1/cart/sync


== Формат клиентского эксперимента
{
  "enabled": true,
  "g_string": "г",          // Локализованное представление грамма
  "kg_string": "кг",        // Локализованное представление килограмма
  "kg_threshold": 1000      // При превышении веса данного товара в корзине
                                этого порога, надо отображать значение в кг
}

== Логика работы
1. `eats-products` самостоятельно, на основании данных от `eats-nomenclature`,
вычисляет цену за килограмм (это несложно, и так меньше работы в `eats-nomenclature`)
2. Отдает эту инфу в ручках меню и в `eats-cart`, которая тоже отдает на клиент
  - надо не забыть для весовых товаров проверять, что по ним не должны приходить акции 1+1, в этом случае 
    надо зажигать алерт, и возможно не отдавать акцию. Иначе странно будет (купи
    300г и получи еще 300г?)
3. Клиент:
  - если видит что в товаре есть блок `weight_data`, то считает товар весовым.
    Все что ниже - относится только к весовым товарам.
  - если клиентский эксперимент выключен или не пришел - с весовыми товарами
    отдельно ничего не делаем, считаем их обычными.
  - при добавлении товара в корзину, вместо количества штук, показывает количество
    квантов в граммах. Если количество грамм превышает `kg_threshold` из эксперимента,
    то показываем в килограммах. Локализованные значения `г`/`кг` приходят в эксперименте.
  - строку клиент формирует сам (то есть шаблон `{price} Р/кг` не приходит с бека)
  - цена за квант (которая приходит в `menu_item.decimal_{promo_}price`) меняется
    на цену за килограмм (чтобы клиенту было удобнее выбрать). Цену за квант
    продолжаем передавать, потому что это обязательные поля, и возможно понадобятся
    при отключении эксперимента, и возможно они понадобятся при динамическом показе
    добавленной суммы.
  - акционную плашку оставляем текущую, если цена за квант снизилась на 50%,
    то и цена за кг снизится на такой же процент.
  - плашка с кешбеком пока остается такая же, хоть это и открытый вопрос:
    странно что цена - за килограмм, а кешбек - за квант.
