# Предложение по структуре проекта

## Проблема

Сейчас при разработки новой логики зачастую случаются сложности при определении директории, в которую стоит добавлять код. Так же структура директории src имеет большое количество директорий в корне, что создаёт сложности в навигации по проекту.

## Схема директории src

Для большей понятности с примерами перенесённых директорий

   ━ 📂 src
    ┣━ 📂 views
    ┃  ┣━ 📂 convertors
    ┃  ┃  ┣━ 📜 categories_to_get_categories_response.hpp
    ┃  ┃  ┗━ 📜 categories_to_get_categories_response.cpp
    ┃  ┣━ 📂 place
    ┃  ┃  ┣━ 📂 convertors
    ┃  ┃  ┣━ 📜 view.hpp
    ┃  ┃  ┗━ 📜 view.cpp
    ┃  ┗━ 📂 get-categories
    ┣━ 📂 stq
    ┣━ 📂 caches
    ┣━ 📂 components
    ┣━ 📂 logic
    ┃  ┣━ 📂 get_product
    ┃  ┃  ┣━ 📜 get_product.hpp
    ┃  ┃  ┗━ 📜 get_product.cpp
    ┃  ┣━ 📂 for_search
    ┃  ┃  ┣━ 📜 dynamic_categories_builder.cpp
    ┃  ┃  ┣━ 📜 dynamic_categories_builder.hpp
    ┃  ┃  ┣━ 📜 dynamic_categories_builder_v2.cpp
    ┃  ┃  ┗━ 📜 dynamic_categories_builder_v2.hpp
    ┃  ┗━ merging
    ┣━ 📂 data-sources
    ┃  ┣━ 📂 requesters
    ┃  ┃  ┣━ 📂 nomenclature
    ┃  ┃  ┗━ 📂 catalog
    ┃  ┣━ 📂 postgres
    ┃  ┃  ┣━ 📂 sql
    ┃  ┃  ┣━ 📂 finding
    ┃  ┃  ┃  ┣━ 📜 brands_finder.cpp
    ┃  ┃  ┃  ┗━ 📜 brands_finder.hpp
    ┃  ┃  ┗━ 📂 mapping
    ┃  ┣━ 📂 redis
    ┃  ┗━ 📂 experiments
    ┣━ 📂 models
    ┗━ 📂 utils
       ┗━ 📜 convert_to_vector.hpp

## Описание структуры директории src

### views

view отвечает за конвертацию полученных из запроса данных, передачу их бизнес-логике `logic` и конвертацию результата работы бизнес-логики в тип результата.

#### convertors

Convertors можно вынести в подкаталог `convertors` каталога `views` для упрощения переиспользования кода. Так же если `convertor` нужен только в рамках одной ручки, он может быть реализован в директории ручки. `Convertors` отвечают а конвертацию между сгенерированными типами и `Models`.

### stq

stq так же должны реализовывать свою логику в каталоге бизнес-логики `logic`

### caches

Структура данных для кэша должна быть описана в каталоге моделей `models`. Здесь же инициализация. Для наполнение используются методы из `data-sources` или `logic`.

### logic

Бизнес логика. Выполняет операции над источниками данных `data-sources`. Результатом является структура/класс/их коллекция из `models`. Например, возврат каруселей категорий использует множество источников данных `Redis`, `pg`, `nomenclature`, `experiments` и содержит массивную логику, должен быть реализован в этой директории.

Примеры каталогов, которые можно перенести из `src` в `logic`:
- categories — билдеры категорий, выглядят скорее как use_case, чем как модель
- for_search
- place_assortment
- product_carousels

### data-sources / io / data-loaders / adaptors

`data-sources` — Источники данных. Можно использовать для того, чтобы избегать дублирование кода в бизнес-логике. Результатом является структура/класс/их коллекция из Models. Содержат максимально простую логику (выборка данных, фильтрация по каким-то параметрам)
Поддиректории директории `data-sources`:
- requesters
  -  nomenclature
  -  catalog
- postgres — для избежания дублирования, например классы и функции, отвечающие за получение маппинга 
  - sql — sql не должны быть разбросаны по всему проекту
  - mapping
- redis
- experiments

### models

Модели в идеале должны представлять из себя структуры и классы, лишённые сложной логики.

### utils 

В `utils` храним то, чего не хватает в стандартной библиотеке, но по каким-то причинам не добавляем.

## План по переезду на новую структуру 

При изменении или дополнении схемы обязательно обновляем эту спеку.
Структура будет использоваться при создании новых сервисов. Так же структура сервиса `eats-products` может быть обновлена следующим образом:

1. Новый код пытаемся раскладывать по новой структуре, если это не создаёт дублирования директорий.
2. В рамках техно перенести директории, которые подходят по смыслу новой структуре.
3. В рамках техно переработать код, который не попадает в новую структуру для соответствия ей.
