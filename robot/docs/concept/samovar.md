# Самовар

## Введение

Самовар — это система обхода, которая хранит информацию обо всех известных Яндексу ссылках и хостах и  некоторым образом решает, какие страницы надо скачать (обойти, запланировать).

Сам Самовар ничего не качает, для этого используется Zora. Для хранения данных используются динамические таблицы YT.

Динамические таблицы разделены на таблеты по диапазонам ключей. В примонтированной таблице каждый таблет обслуживается некоторой одной машиной кластера YT. Транзакции поддерживаются на стороне клиента: клиент сам взаимодействует с таблетами, при этом не задействованы какие-либо центральные сервера YT.
Пользовательский код выполняется на машинах в облаке. Они не хранят данных и не взаимодействуют друг с другом напрямую. Они даже не занют, сколько и каких приложений Самовара ещё запущено в облаке. Всё взаимодействие происходит через данные в YT.

## Как посмотреть информацию о хостах и страницах

Посмотреть данные можно сделать при помощи вьюера Самовара. Документациию по вьюеру можно найти на [странице](https://docs.yandex-team.ru/robot/concept/samovar_viewer). Вьюер хранит данные об обходе отдельных страниц и политик, которые использовались при обходе. 

## Как понять, что нужен Самовар

Самовар дает некоторые преимущества по сравнению с просто использованием Zora, если вам нужно прокачивать и получать большие объемы проиндексированных страниц. 

* **Большие объемы прокачек**
Большой поиск по HTML-страницам и картинкам уже сейчас стараются проиндексировать все сайты, до которых могут дотянуться. Таким образом, в базе уже сейчас индексируется очень большое число ссылок. Например, если вам нужно прокачивать товарные сайты, то велика вероятность, что нужный вам контент уже индексируется. К тому же, прокачивая ссылки через Самовар, вы добавляете их в "общий котел", где ими смогут воспользоваться и другие сервисы Яндекса. 

{% note warning %}

Общее правило при выборе, нужен Самовар или нет, таково: чем больше страниц вам потребуется прокачать, тем полезнее будет Самовар. Если количество страниц у вас начинается с нескольких миллионов страниц/ссылок, то для таких операций точно потребуется Самовар.

{% endnote %}

* **Выборка страниц для прокачки**
Если вам нужно просто прокачать заранее заданный список страниц последовательно и как можно скорее, для этого вполне хватит Зора. С другой стороны, если у вас есть большой список, из которого нужно приоритезировать те или иные страницы, или логика, которая будет скачивать страницы с определенной последовательностью, то Самовар будет вашим лучшим другом. С его помощью можно задать различные политики скачивания: например, если страница ответила http-кодом 503, прокачивать ее еще несколько раз в течение часа, чтобы проверить, не изменился ли код ответа. 

* **Распределение хостовых лимитов из коробки**
Сайты в интернете сильно различаются по размеру и мощности сервера, поэтому большое число прокачек может привести к неожиданным реакциям со стороны сервера: от большого числа отказов и серверных ошибок до блокировок отдельных IP. Именно поэтому наши роботы следуют политике [politeness](https://docs.yandex-team.ru/robot/concept/politeness_crawling_order). 
Вычислять и планировать вручную, сколько вы сможете скачать с того или иного хоста, может быть достаточно сложно. Самовар уже умеет контролировать хостовые лимиты, поэтому, если использовать его для скачивания большого числа документов с хоста, они будут индексироваться с учетом пропускной способности жерт... выбранного сайта. Таким образом все скачивания будут проходить с максимальной эффективностью.

## Обратная связь

Если у вас есть вопросы по поводу подключения Самовара для скачивания, вы можете задать вопросы [Владимиру Лошкареву](https://staff.yandex-team.ru/oddeye) и [Юрию Алексееву](https://staff.yandex-team.ru/yuryalekseev).
