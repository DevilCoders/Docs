# Описание вьюера Kwyt

## Введение
Kwyt — это вьюер, который позволяет увидеть подробную информацию об индексируемых страницах. В Kwyt располагаются записанные Zora данные, а вьюер Kwyt поднимает локальный [RTHUB](https://docs.yandex-team.ru/robot/concept/rthub) и с его помощью обрабатывает эти данные, чтобы получить ту информацию, которая в дальнейшем сможет попасть в базу Jupiter или другой экспорт.

Во вьюер попадают наиболее свежие данные, поэтому во вьюере можно увидеть данные, которые еще не попали в Lemur и базу Jupiter. К примеру, после добавления страницы в переобход Addurl, данные в Kwyt смогут попасть в течение часа. 

Для просмотра данных в поле 2 вводим адрес страницы, выбираем таблицу в разделе **Processor** и в левой части нажимаем на кнопку **Go**.
Начальная страница:

[![kwyt_top](https://jing.yandex-team.ru/files/oddeye/browser_Ddc6wWkbXi.png)](https://jing.yandex-team.ru/files/oddeye/browser_Ddc6wWkbXi.png)

1. Тип информации, который будет отображаться:

* **Document** — в этом разделе отображаются данные по отдельным HTML-страницам. Например, если указать страницу [https://yandex.ru/](https://yandex.ru/) , во вьюере отобразятся данные именно по данной главной странице сайта.
* **Robots** — здесь можно увидеть данные о robots.txt сайта, его код ответа и сам документ с директивами. 
* **Status** — хостовой статус сайта. Здесь можно увидеть, доступен ли сам домен для посещения.
* **Sitemaps** — показывает данные об обработке sitemap. Sitemap может располагаться по любому адресу на сайте, поэтому для проверки определенного файла необходимо ввести его адрес.

2. **Поле с адресом проверяемой страницы/сайта.**
3. **Дата-центр, откуда берутся данные о страницах.** В данный момент вся информация хранится на Arnold, поэтому менять информацию в этой графе не нужно.
4. **Processor** — экспорт [RTHUB](https://docs.yandex-team.ru/robot/concept/rthub), из которого будут загружаться данные. В Kwyt хранится огромное количество данных о страницах, связанных с разными аспектами индексирования: например, данные о турбо-страницах, Дзен, видео и многое другое. 
**5. Стейт** — это дата обращений робота, за которую отображаются данные во вьюере. Длинное число в стейте — это время конкретного посещения робота в Unix. Чтобы увидеть дату посещения в более привычном времени, можно навести стрелкой мыши на определенный стейт — всплывающая подсказка покажет конвертированную дату и время:

[![kwyt_states](https://jing.yandex-team.ru/files/oddeye/2019-02-16_13.12.21-aupjd.png)](https://jing.yandex-team.ru/files/oddeye/2019-02-16_13.12.21-aupjd.png)

## Document
 В рамках проверки индексирования HTML-страниц нам потребуются две таблицы: **Default** и **Base**.
В разделе **Default** можно посмотреть такие данные:
- **Charset** — кодировка страницы. 
- **Host** — доменное имя, которому принадлежит страница.
- **HttpBody** — полный документ страницы. 
В некоторых случаях, если при посещении страницы возникла ошибка, индексирующий робот не может скачать документ страницы, тогда это поле будет пустым. О возможных проблемах см. пункт ниже.
- **HttpCode** — http-ответ страницы. 200 ОК означает, что страница доступна и успешно индексируется, ошибки 3xx-4xx-5xx означают, что страницы недоступны роботу. Коды ошибок из 4 цифр означают наши роботные ошибки. Причины такой ошибки могут быть как на сайте, так и в некоторых случаях у самого робота. Подробнее они описаны на ((https://wiki.yandex-team.ru/Robot/KodyOshibok/ странице)). 
- **HttpHeaders** — HTTP-заголовок страницы.
- **HttpModTime** — дата, когда менялся заголовок страницы.
- **IsProcessedByRotor** — флаг показывает, скачивали ли страницу Ротором. Цифра 1 указывает, что страница была проиндексирована Ротором, 0 — что страницу обошли обычным роботом. 
- **LastAccess** — дата обхода страницы. Соответствует дате выбранного стейта.
- **MetaRefreshTarget** — если страница содержит мета-тег refresh, то поисковой робот обрабатывает такой тег как редирект 302. В этом поле отображается цель редиректа, если мета-тег есть.
- **RedirTarget** — цель редиректа, если страницы выполняет перенаправление 3xx на другую страницу.
- **RelCanonicalTarget** — адрес канонической страницы, если такой атрибут установлен. 
- **SourceName** — источник(робот), которым скачивали страницу при данном посещении. 
В разделе **Base** многие данные повторяются, основной интерес представляет пункт **Arc**:

[![kwyt_arc](https://jing.yandex-team.ru/files/oddeye/browser_LBxaYjxruK.png)](https://jing.yandex-team.ru/files/oddeye/browser_LBxaYjxruK.png)

Нажав на него, можно увидеть текстовый архив страницы: почти весь текст, который со страницы попадает в поисковую базу, будет отображаться под техническими характеристиками страницы:

[![kwyt_arc_archive](https://jing.yandex-team.ru/files/oddeye/browser_jHzFQs9rzi.png)](https://jing.yandex-team.ru/files/oddeye/browser_jHzFQs9rzi.png)

{% note info %}

Полезно использовать инструмент, чтобы проверить, индексируется ли тот или иной текст.
Заголовок из тега `<title>` попадает в текстовый архив и будет отображаться самой первой строкой в этом архиве. А вот текст из описания в теге `<description>` в архив не попадает, данные о теге можно посмотреть в httpbody.

{% endnote %}

{% note info %}

Если архив пуст, это не обязательно означает, что страница не отдавала совсем ничего. Стоит проверить httpbody, возможно, что страница отдавала скрипт или техническое сообщение об ошибке.

{% endnote %}

## Robots
В этом пункте можно указать адрес любой страницы: так как robots.txt всегда должен быть расположен по адресу site.ru/robots.txt , проверяться всегда будет файл именно по такому адресу. Пункты Default и Base в данном случае идентичны, поэтому можно проверять любой из них.
При проверке robots.txt интересны следующие данные:
- **LastAccess** — дата, когда обрабатывали robots.txt. Соответствует выбранному стейту.

{% note info %}

Robots.txt сайта обрабатывается очень часто, поэтому зачастую в Kwyt сохраняются данные о файле за небольшой период времени. Данные за более долгий период можно поискать во вьюере Юпитера.

{% endnote %}

- **IP** — IP-адрес, к которому робот совершает запросы при обходе сайта. Записывается в циферном значении, можно узнать при помощи конвертеров, например, [такого](https://www.silisoftware.com/tools/ipconverter.php):
- **RobotsHTTPCode** — код ответа robots.txt. Для обработки код ответа должен быть 200 ОК. Любой другой код ответа говорит о недоступности файла.См. выше про http-ошибки.
- **RobotsHeaders** — http-заголовок файла.
- **RobotsResponseBody** — непосредственно сам документ файла robots.txt. В отличии от данных вьюера Юпитера, в Kwyt данные о robots.txt не редактируется, поэтому здесь можно посмотреть, например, комментарии. К примеру, частая ошибка вебмастеров заключается в использовании директивы вида:
`Disallow: /#page`

Так как символ # рассматривается как комментарий, в базу Юпитера директива попадет под видом:
`Disallow: /`. В Kwyt же можно посмотреть полное описание директивы.

{% note info %}

В случае, когда robots.txt одного сайта выполняет редирект на robots.txt другого сайта (например, [http://site.ru/robots.txt](http://site.ru/robots.txt) => [https://2site.ru/robots.txt](https://2site.ru/robots.txt)), робот будет следовать цели редиректа и использовать robots.txt второго сайта как robots.txt первого. В Kwyt данных о редиректе в таком случае не будет: вьюер покажет тот файл, который используется. То есть, в случае из примера это будет [https://2site.ru/robots.txt](https://2site.ru/robots.txt) .

{% endnote %}

## Status
Как и в случае с robots.txt, можно указать адрес любой страницы, данные будут показаны для доменного имени в целом. Пункты Default и Base в данном случае идентичны, поэтому можно проверять любой из них. Можно посмотреть такие данные:
- **HasSslCertErrors** — показывает наличие ошибок в SSL-сертификате безопасности. 0 означает, что ошибок нет.
- **HostStatus** — информация о работоспособности сайта. 1 означает, что сайт доступен и успешно индексируется. 
- **LastAccess** — дата последнего обращения к домену.

## Sitemaps
Файл sitemap может располагаться по любому адресу на сайте, поэтому в адресное поле обязательно ввести нужный адрес sitemap. 
В разделе **Default** интересуют данные:
- **HttpCode** — обработка аналогична обработке HTML-страниц (см. выше).
- **HttpResponse** — HTTP-заголовок файла
- **LastAccess** — дата последней обработки файла
- **RedirTarget** — если страница выполняет перенаправление, в пункте будет показан адрес страницы/файла, на которую идет редирект.
В пункте **Base** дополнительно интересует пункт httpBody. В нем можно увидеть, какой именно документ отдает файл sitemap:

[![kwyt_sitemap](https://jing.yandex-team.ru/files/oddeye/2019-02-18_16.04.12-dlqzv.png)](https://jing.yandex-team.ru/files/oddeye/2019-02-18_16.04.12-dlqzv.png)

{% note info %}

Увидеть, какое количество ссылок обрабатывается в файле sitemap, можно во [вьюере Самовара](https://samovar-primary-arnold-gageboard.n.yandex-team.ru/viewer) в пункте **OutLinks**, где ищем поле `LinksCount`:

[![kwyt_urlcount](https://jing.yandex-team.ru/files/oddeye/browser_G69xiB1Xxi.png)](https://jing.yandex-team.ru/files/oddeye/browser_G69xiB1Xxi.png)

{% endnote %}
