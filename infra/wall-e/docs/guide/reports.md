
# Отчёты о сломавшихся хостах
Каждый день Wall-E создаёт в трекере тикеты-репорты о сломанных хостах в проекте. На следующий день тикеты закрываются, при необходимости создаются новые. В трекере заведена [отдельная очередь](https://st.yandex-team.ru/BURNE), в которой такие тикеты создаются по умолчанию.

Отчёты разбиваются на "секции", в данный существуют такие:
* Мёртвые хосты – список хостов, на которых некая задача завершилась ошибкой и хост не удалось починить, wall-e перевёл хост в статус dead, потому что больше ничего не может с ним сделать
* Хосты с ошибками – список хостов, на которых возникла ошибка при выполнении задачи.
* Хосты с инфраструктурами проблемами – список хостов, у которых обнаружены проблемы со свичом или стойкой
* Топ хостов за неделю – список из хостов, на которых автопочинка запускалась больше трёх раз за последнюю неделю. Эта секция появляется только по понедельникам.

Теоретически, мы можем добавлять новые секции или укрупнять/объединять существующие, на текущий момент мы не даём пользователям настраивать состав отчётов.

Каждый отчёт содержит хосты из нескольких проектов. Проекты, для которых не задано персональных настроек отчётов, группируются по Bot project ID, а ответственный выбирается из всех владельцев всех проектов группы (первый по алфавиту логин живого человека). Проекты, у которых есть персональные настройки отчётов, группируются по этим настройкам, то есть для всех проектов, у которых одинаковые параметры отчётов, будет создан один отчёт.

Мы позволяем настраивать следующие параметры отчётов:
* Включить/выключить отчёты
* Задать очередь для отчётов (вы всегда можете указать дефолтную очередь, [BURNE](https://st.yandex-team.ru/BURNE))
* Задать summary – уникальную подстроку, которая будет добавлена в summary тикета. Полезно для группировки ваших проектов в несколько отчётов вместо одного.
* Другие параметры отчётов – компонент очереди, epic или родительский тикет, ответственный сотрудник, теги и т.п.

Настраивать параметры можно через [api](https://api.wall-e.yandex-team.ru) или через консольную утилиту:
* если для проекта не настроены отчёты совсем, или нужно полностью заменить существующий настройки новыми:
  `$ wall-e projects reports set test BURNE "my test project" -e assignee=zomb-noname -m "configure custom project reports"`
* отредактировать настройки для проекта можно такой командой:
  `$ wall-e projects reports modify test --disabled -q BURNE -s "my test project" -e assignee= zomb-noname -m "configure custom project reports"`
* отобразить настройки для проекта:
  `$ wall-e projects reports get test`
* убрать все настройки для проекта:
  `$ wall-e projects reports reset test -m "remove custom report configuration from project"`

Команда для редактирования (`modify`) позволяет задать настройки в том числе, если отчёты для проекта ещё не настроены, но тогда должна быть заданы все поля, которые являются обязательными для операции `set`.

## Отчёты о хостах которые не дает починить CMS {#cms-reports}
Каждый день Wall-E создаёт в трекере тикеты-репорты о хостах, которые не удалось починить из-за того, что CMS не отдала хосты. Эти отчеты создаются для того, чтобы в обычных отчетах о проблемах такие хосты не появлялись. На данный момент отчеты включены для следующих CMS:
* clusterstate -> [okats@](http://staff.yandex-team.ru/okats)
* CMS кластеров YT -> [alximik@](http://staff.yandex-team.ru/alximik)
* Qloud -> [amich@](http://staff.yandex-team.ru/amich)

Для хостов попавших в отчеты нужно анализировать причины по которым CMS не отдала хосты и исправлять проблемы со стороны CMS.
