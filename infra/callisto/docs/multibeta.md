## конструкция мультибет

vla_multibeta_base: сервис в няне, совмещенный по инстансам с продом один к одному.
Один инстанс сервиса – один шард.
Деплой интегрирован в агента.

Шард под базовым прода сменяется только перезапуском инстанса.
Чтобы не получить двукратный расход памяти, инстанс мультибеты должен работать строго над тем же шардом, что и прод.
Мультибета переключается вместе с продом и конфигурируется таймстемпом в няне.
vla_multibeta_base:
    vars.conf:
        export YT_STATE=1513296920
Номер шарда берется из шардтега.
Полный путь к шарду прода конструируется в скрипте запуска агента и подаётся на вход.

Новый бинарник (или модели, или конфиг) выкатываются так:
    контроллер раздаёт конфиг с новыми ресурсами и указанием "поднять оба базовых"
    после набора кворума контроллер переконфигурирует какое-то место (средний или балансер над средним) так,
        чтобы запросы пошли только в новые базовые
    потом опускает старые базовые

по мере скачивания запустить слоты, дописав в конфиги базовых timestamp конфига комментарием в первой строчке,
слот идентифицируется портом, точнее, смещением порта

проверить что соответствует :IPORT+port_offset/yandsearch?info=getconfig -> timestamp & port_offset

## качалка в агенте
качает ресурсы из slots/*/resources:
    сгруппировать по слоту и сначала скачать тот слот, который указан в конфиге балансера как default
    проверить, что в текущий момент качается
    всё остальное стереть, а чтобы не стереть чужого, storage_root должен содержать порт
        и можно использовать deduplicate=hardlink
