# Версионированный InstanceCtl

##  Указание InstanceCtl в сервисе {#intro}

Чтобы запустить сервис в Nanny, необходимо указать в нём нужную версию [InstanceCtl](https://wiki.yandex-team.ru/JandeksPoisk/Sepe/instancectl/) - супревизора, запускающего исполняемые файлы сервиса на конечных машинах кластера и следящего за их состоянием. Для этого нужно:

1. Если в секции files присутствует файл loop-httpsearch или instancectl, то удалить его оттуда:

    ![img](https://jing.yandex-team.ru/files/sshipkov/remove.cafe8b4.png)

1. Выбрать последнюю доступную версию в `Instance Spec` сервиса:

    ![img](https://jing.yandex-team.ru/files/sshipkov/select.1dce449.png)

##  Автоматическое обновление InstanceCtl {#autoupdate}

Автоматическое обновление InstanceCtl работает только если сам InstanceCtl задан в сервисе так, как указано в [предыдущем пункте](#intro). Если InstanceCtl задан в секции `Files`, то его автообновление не будет работать.
Обновление InstanceCtl на последнюю стабильную версию происходит:

1. При ручном редактировании сервиса через UI Nanny. Эта опция включена по умолчанию и не требует настройки тикетной интеграции;
1. Через тикетную интеграцию. Тикеты на выкладку будут создаваться при сборке stable-релиза InstanceCtl, т.е. не дожидаясь, пока пользователь придёт в UI сервиса вручную. Можно также включить их автоматическую выкладку.

Чтобы включить тикетную интеграцию для автоматического обновления InstanceCtl, нужно:

1. Выполнить действия из [предыдущего пункта](#intro);
1. Включить `Tickets Integration` сервиса:
    ![img](https://jing.yandex-team.ru/files/sshipkov/enableti.53765a6.png)
1. Выбрать политику обновления InstanceCtl: `STABLE`. При появлении новых stable-релизов InstanceCtl будут создаваться тикеты на их выкладку в сервис, ожидающие ручного подтверждения. Если же хочется обновлять InstanceCtl в сервисе автоматически, без подтверждения, нужно также выставить флажок `Enable autocommit`:
    ![img](https://jing.yandex-team.ru/files/sshipkov/autoupdate-1.cd95280.png)

