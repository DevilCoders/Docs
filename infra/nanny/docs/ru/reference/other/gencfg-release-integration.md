# Gencfg Release Integration

##  Задачи {#goals}
Интеграция тикетов и сервисов Nanny с релизами Gencfg необходима для:

* обеспечения единого механизма учёта и управления выкладками релизов новых топологий gencfg, как выкатывающихся с помощью services 2.0, так и тех, что выкатываются «вручную» (с помощью кубиков и прочих инструментов);
* обеспечения механизма pull request-ов, который заключается в том, что операторы сервисов получают уведомления о новых релизах, но при этом имеют контроль над процедурой «коммита» релиза в описание сервиса и его выкладкой.

##  Механизм работы {#mechanism}
В задаче сборки и релиза новой топологии реализован механизм отправки уведомлений о новой версии топологии в Няню через вызов HTTP API. Последовательность действий следующая:

* В Няню поступает уведомление о релизе топологии.
* Няня создаёт объект `release` и сохраняет в базе данных.
* Асинхронный процесс обрабатывает `release` анализируя правила очередей и правила сервисов.
* При срабатывании правила - создаётся тикет, связанный с сервисом (если сработало правило сервиса).

##  Правила сервисов {#service-rules}
В сервисах Няни также можно настроить создание тикетов, если в релизе топологий gencfg изменились группы, которые использует сервис. На данный момент правило представляет собой переключатель "Вкл/Выкл", т.е. либо тикеты создаются, либо нет. Дополнительных фильтров кроме естественных не предусмотрено. Для настройки правила необходимо на странице сервиса перейти в Information -> Tickets Integration, указать очередь и настроить включение создания тикетов. Там же можно указать автоматическое применение изменений и настроить приоритет создаваемой при этом ревизии runtime атрибутов сервиса.

![gencfg-service-rule](https://jing.yandex-team.ru/files/sshipkov/gencfg-service-rule.c4de9f7.png)

